---
title: npm对项目依赖包版本管理的机制
date: 2017-12-11 12:00:01
tags: ['npm','semver','package','包版本管理']
category: 'coding'
---

## semver
[语义化版本控制规范](https://semver.org/lang/zh-CN/)

版本格式：主版本号.次版本号.修订号，版本号(major, minor, patch)递增规则如下：
1. 主版本号：当你做了不兼容的 API 修改，
2. 次版本号：当你做了向下兼容的功能性新增，
3. 修订号：当你做了向下兼容的问题修正。<!--more-->


#### Versions
版本是指例如 0.4.1、1.2.7、1.2.4-beta.0 这样表示包的特定版本的字符串。


#### Ranges
范围则是对满足特定规则的版本的一种表示，例如 1.2.3-2.3.4、1.x、^0.2、>1.4.0

* `<` 小于某个版
```json
{
    "babel": "<6.5.2",
}
```

* `<=` 小于等于某个版本
```json
{
    "babel": "<=6.5.2",
}
```

* `>` 大于某个版本
```json
{
    "babel": ">6.5.2",
}
```

* `>=` 大于等于某个版本
```json
{
    "babel": ">=6.5.2",
}
```

* `=` 等于某个版本
```json
{
    "babel": "=6.5.2",
}
```

* `X, x,*` 限定主版本号和次版本号
>* \* := >=0.0.0（任何版本满足）
>* 1.x := >=1.0.0 <2.0.0 (匹配的主要版本)
>* 1.2.x := >=1.2.0 <1.3.0 (匹配的主要和次要版本)
>* "" (空字符) := * := >=0.0.0
>* 1 := 1.x.x := >=1.0.0 <2.0.0
>* 1.2 := 1.2.x := >=1.2.0 <1.3.0

```json
{
    "babel": "~6.5.x",
}
```

* `~` 限定主版本号和次版本号
>* ~1.2.3 := >=1.2.3 <1.(2+1).0 := >=1.2.3 <1.3.0
>* ~1.2 := >=1.2.0 <1.(2+1).0 := >=1.2.0 <1.3.0 (等同于 1.2.x)
>* ~1 := >=1.0.0 <(1+1).0.0 := >=1.0.0 <2.0.0 (等同于 1.x)
>* ~0.2.3 := >=0.2.3 <0.(2+1).0 := >=0.2.3 <0.3.0
>* ~0.2 := >=0.2.0 <0.(2+1).0 := >=0.2.0 <0.3.0 (等同于 0.2.x)
>* ~0 := >=0.0.0 <(0+1).0.0 := >=0.0.0 <1.0.0 (等同于 0.x)

```json
{
    "babel": "~6.5.2",
}
```

* `^` 允许变化最左边的非零位的版本位
>* ^1.2.3 := >=1.2.3 <2.0.0
>* ^0.2.3 := >=0.2.3 <0.3.0
>* ^0.0.3 := >=0.0.3 <0.0.4
>* ^1.2.x := >=1.2.0 <2.0.0
>* ^0.0.x := >=0.0.0 <0.1.0
>* ^0.0 := >=0.0.0 <0.1.0
>* ^1.x := >=1.0.0 <2.0.0
>* ^0.x := >=0.0.0 <1.0.0

```json
{
    "babel": "^6.5.2",
}
```

#### npm install 的版本选择策略
* package.json没有对应包 install 没有限定版本：安装源的最新版本
* package.json有对应包 install 没有限定版本：package.json根据semver安装版本
* package.json没有对应包 install 限定版本：安装制定版本 package.json写入以^开头的版本依赖
* package.json有对应包 install 限定版本：安装制定版本 package.json依据按住改写以^开头的版本依赖