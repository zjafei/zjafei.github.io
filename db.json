{"meta":{"version":1,"warehouse":"3.0.2"},"models":{"Asset":[{"_id":"themes/yilia/source/slider.e37972.js","path":"slider.e37972.js","modified":0,"renderable":1},{"_id":"themes/yilia/source/main.507b3a.css","path":"main.507b3a.css","modified":0,"renderable":1},{"_id":"themes/yilia/source/mobile.fdc4b7.js","path":"mobile.fdc4b7.js","modified":0,"renderable":1},{"_id":"themes/yilia/source/main.507b3a.js","path":"main.507b3a.js","modified":0,"renderable":1},{"_id":"themes/yilia/source/img/preloader.gif","path":"img/preloader.gif","modified":0,"renderable":1},{"_id":"themes/yilia/source/img/default-skin.png","path":"img/default-skin.png","modified":0,"renderable":1},{"_id":"themes/yilia/source/img/scrollbar_arrow.png","path":"img/scrollbar_arrow.png","modified":0,"renderable":1},{"_id":"themes/yilia/source/fonts/iconfont.16acc2.ttf","path":"fonts/iconfont.16acc2.ttf","modified":0,"renderable":1},{"_id":"themes/yilia/source/fonts/iconfont.45d7ee.svg","path":"fonts/iconfont.45d7ee.svg","modified":0,"renderable":1},{"_id":"themes/yilia/source/fonts/tooltip.4004ff.svg","path":"fonts/tooltip.4004ff.svg","modified":0,"renderable":1},{"_id":"themes/yilia/source/fonts/iconfont.b322fa.eot","path":"fonts/iconfont.b322fa.eot","modified":0,"renderable":1},{"_id":"themes/yilia/source/fonts/default-skin.b257fa.svg","path":"fonts/default-skin.b257fa.svg","modified":0,"renderable":1},{"_id":"themes/yilia/source/fonts/iconfont.8c627f.woff","path":"fonts/iconfont.8c627f.woff","modified":0,"renderable":1}],"Cache":[{"_id":"themes/yilia/.babelrc","hash":"b1b76475ac17dc9e2fa50af96c9e31eea2d0f2b4","modified":1550631039821},{"_id":"themes/yilia/.editorconfig","hash":"da6d022b8f4d9c961e2f8f80677e92af8de0db4d","modified":1550631039830},{"_id":"themes/yilia/.gitattributes","hash":"e0f24dceeb1e6878a1dd9b01a2b9df1bc037a867","modified":1550631039854},{"_id":"themes/yilia/.eslintrc.js","hash":"5696ae049de010ed3786768b0c359f14c05b5ec6","modified":1550631039846},{"_id":"themes/yilia/.eslintignore","hash":"df0a50b13cc00acb749226fee3cee6e0351fb1d9","modified":1550631039837},{"_id":"themes/yilia/README.md","hash":"1bf755806af9d8874bd22e1abbdaaa24328ef4dc","modified":1550631039877},{"_id":"themes/yilia/_config.yml","hash":"92f66c9e48f7206be82d8b584978e2b3755a5bf0","modified":1550631039891},{"_id":"themes/yilia/.gitignore","hash":"9c4b7d27a1e3e5efa0c8ed143a032a85d586b03b","modified":1550631039865},{"_id":"themes/yilia/package.json","hash":"367cb9579d35968a942c243ab248a5f5ebfaf462","modified":1550631040618},{"_id":"themes/yilia/webpack.config.js","hash":"05ba46a4ae744272f5312e684928910dccad3755","modified":1550631041592},{"_id":"source/_posts/WDS错误提示代码规范HMR的配置.md","hash":"e79553d19dc6f8de928758761dcf10ef46f8ce99","modified":1550631038439},{"_id":"source/_posts/dva脚手架的demo.md","hash":"bc4fd3dc8463cdb6c22600fab6441454c22281d1","modified":1550631038457},{"_id":"source/_posts/npm对包版本管理的机制.md","hash":"c39cb5a1c305caa676428a0fdca50aaf1e01608e","modified":1550631038464},{"_id":"source/_posts/css布局：两栏、三栏，从圣杯到双飞翼.md","hash":"a32c8104a596806d313c49292a90a529aef4ed0c","modified":1550631038446},{"_id":"source/_posts/react-hooks-概览.md","hash":"391f104e6a7c9df13e2143982439a72983491afc","modified":1550927988876},{"_id":"source/_posts/react通过cloneElement修改props.children的props属性.md.back","hash":"0b71225da8ac73d782ad290ecaf9ef60a8d2fca1","modified":1550631038536},{"_id":"source/_posts/react-effects函数单元测试用例与实践体验.md","hash":"faac0d9a404a8f2ad4b0a4a5912ec196e82ba95f","modified":1550631038474},{"_id":"source/_posts/react的state和基于props的父子组件和兄弟组件沟通.md","hash":"04294a16cc097606f360c1715107e0ef18bc7a6f","modified":1550631038527},{"_id":"source/_posts/shell学习笔记二.md","hash":"281e19b72b857558668abbde0728380bd6b31c4e","modified":1550631038551},{"_id":"source/_posts/shell学习笔记一.md","hash":"c1c49ac2453ea01fd9a5b0bea0b858932bf38afe","modified":1550631038541},{"_id":"source/_posts/react-reducers函数单元测试用例与实践体验.md","hash":"c88b776297529a8a4f4b3a07982b79c565d90e2d","modified":1550631038499},{"_id":"source/_posts/shell学习笔记四.md","hash":"a024f379b1a36c07c80fec7f85fe98c728b598f1","modified":1550631038558},{"_id":"source/_posts/shell学习笔记三.md","hash":"5b6710d181c9cd33f3a85f8ea893d5ad8b3c6538","modified":1550631038548},{"_id":"source/_posts/react-model函数单元测试用例与实践体验.md","hash":"9aeab280478f96435dfdb13c2c2d4ad71d39c125","modified":1550631038488},{"_id":"source/_posts/webpack-集成-Integrations-翻译.md","hash":"484143c3e10490c9f22bdd1e730c432bf6286302","modified":1550631038591},{"_id":"source/_posts/react通过redux和redux-saga管理状态.md","hash":"a7dd5ab1f34281708b3f10d97d872f5c0cb6416f","modified":1550631038539},{"_id":"source/_posts/webpack的shimming的翻译.md","hash":"3f39ac7fce545bc44fdb17a5986bee8abc71be2b","modified":1550631038609},{"_id":"source/_posts/ubuntu安装Jenkins.md","hash":"6c0f648335e386d29dcbd053ae9159b2202fffab","modified":1550631038572},{"_id":"source/_posts/vuepie----基于apicloud的vue混和app开发脚手架.md","hash":"5fbe8fe8e0779a95159d06d44badd3f66c552c98","modified":1550631038581},{"_id":"source/_posts/react新生命周期替代旧生命周期的最佳实践.md","hash":"5f558e8ce490ff326b62e3135062ac774a136808","modified":1550631038513},{"_id":"source/_posts/webpack的常用插件.md","hash":"3d1fd3cfbe950d9c51fd12b0f9366cd9983a8176","modified":1550631038623},{"_id":"source/_posts/基于nodejs的简单RESTful服务代码.md","hash":"e4674bc5f391e9f4634e7fc2e9f3e907d590974b","modified":1550631038655},{"_id":"source/_posts/使您的JavaScript纯净.md","hash":"6d06ab8d1d8e88ad64da4861085a0c3e42ea02be","modified":1550631038652},{"_id":"source/_posts/ubuntu16-0-4上python版本切换的问题.md","hash":"dc0b1a023657f778dffbbd40d5acefecb805a8e6","modified":1550631038565},{"_id":"source/_posts/从高阶函数到高阶组件.md","hash":"6af0404fbb061b7769c1e65e7e8a1a29816ba81f","modified":1550631038638},{"_id":"source/_posts/高阶组件：react应用设计模式.md","hash":"3530f6762d654a55cd762d8707d8042b393d5276","modified":1550631038671},{"_id":"themes/yilia/layout/archive.ejs","hash":"2703b07cc8ac64ae46d1d263f4653013c7e1666b","modified":1550631040565},{"_id":"themes/yilia/layout/index.ejs","hash":"a35dc900203f9d8dd863ea4c1722198d6d457ec8","modified":1550631040575},{"_id":"themes/yilia/layout/category.ejs","hash":"765426a9c8236828dc34759e604cc2c52292835a","modified":1550631040568},{"_id":"themes/yilia/layout/layout.ejs","hash":"0a332bdbd3b86c231d690614687f5b97186b85d5","modified":1550631040597},{"_id":"themes/yilia/layout/page.ejs","hash":"7d80e4e36b14d30a7cd2ac1f61376d9ebf264e8b","modified":1550631040601},{"_id":"themes/yilia/layout/tag.ejs","hash":"eaa7b4ccb2ca7befb90142e4e68995fb1ea68b2e","modified":1550631040609},{"_id":"themes/yilia/languages/zh-CN.yml","hash":"ca40697097ab0b3672a80b455d3f4081292d1eed","modified":1550631039918},{"_id":"themes/yilia/languages/fr.yml","hash":"84ab164b37c6abf625473e9a0c18f6f815dd5fd9","modified":1550631039901},{"_id":"themes/yilia/languages/no.yml","hash":"965a171e70347215ec726952e63f5b47930931ef","modified":1550631039911},{"_id":"themes/yilia/languages/nl.yml","hash":"12ed59faba1fc4e8cdd1d42ab55ef518dde8039c","modified":1550631039904},{"_id":"themes/yilia/languages/zh-tw.yml","hash":"53ce3000c5f767759c7d2c4efcaa9049788599c3","modified":1550631039922},{"_id":"themes/yilia/layout/post.ejs","hash":"7d80e4e36b14d30a7cd2ac1f61376d9ebf264e8b","modified":1550631040606},{"_id":"themes/yilia/languages/ru.yml","hash":"4fda301bbd8b39f2c714e2c934eccc4b27c0a2b0","modified":1550631039915},{"_id":"themes/yilia/languages/default.yml","hash":"3083f319b352d21d80fc5e20113ddf27889c9d11","modified":1550631039897},{"_id":"themes/yilia/source-src/script.ejs","hash":"c21381e1317db7bb157f1d182b8c088cb7cba411","modified":1550631041292},{"_id":"themes/yilia/source/slider.e37972.js","hash":"6dec4e220c89049037eebc44404abd8455d22ad7","modified":1550631041581},{"_id":"themes/yilia/source/main.507b3a.css","hash":"ddf6e2c6b953c2c59a3c271e6070010a4cc81cf9","modified":1550631041366},{"_id":"themes/yilia/source-src/css.ejs","hash":"94dbdb02ca11849e415d54fb28546a598f2cffb1","modified":1550631040628},{"_id":"themes/yilia/layout/_partial/toc.ejs","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1550631040526},{"_id":"themes/yilia/source/mobile.fdc4b7.js","hash":"6bfff9bfe4d7e067b6289e851a4c424ac815af5e","modified":1550631041526},{"_id":"themes/yilia/source/main.507b3a.js","hash":"1be71323e357bcc2d99568bc622f23f152811f2e","modified":1550631041438},{"_id":"themes/yilia/layout/_partial/archive.ejs","hash":"a6e94061ac55b9eb55275f87b608d62f6ea35659","modified":1550631039984},{"_id":"themes/yilia/layout/_partial/after-footer.ejs","hash":"b86b248720ad415ec1b5fee53fb583776c776f83","modified":1550631039939},{"_id":"themes/yilia/layout/_partial/aside.ejs","hash":"8edbd7993b9b061611a193533a664e2e85eae748","modified":1550631040087},{"_id":"themes/yilia/layout/_partial/archive-post.ejs","hash":"1f7d4819b7f67602c4a1b99871808d2160b60978","modified":1550631039949},{"_id":"themes/yilia/layout/_partial/css.ejs","hash":"b011d92be321ebe09fa2b3179c08aa435b9d051c","modified":1550631040125},{"_id":"themes/yilia/layout/_partial/footer.ejs","hash":"42d97cc3bd098ff95d1f37dc9a84443da0af311a","modified":1550631040136},{"_id":"themes/yilia/layout/_partial/baidu-analytics.ejs","hash":"f0e6e88f9f7eb08b8fe51449a8a3016273507924","modified":1550631040114},{"_id":"themes/yilia/layout/_partial/google-analytics.ejs","hash":"f921e7f9223d7c95165e0f835f353b2938e40c45","modified":1550631040140},{"_id":"themes/yilia/layout/_partial/article.ejs","hash":"630c6ec866d056657d3d91e34b4c64eb993c0654","modified":1550631040068},{"_id":"themes/yilia/layout/_partial/header.ejs","hash":"6387a93dad7c3d778eb91e3821852fbf6813880c","modified":1550631040185},{"_id":"themes/yilia/layout/_partial/head.ejs","hash":"64f092186b5a744aa1603ce22bb1d44a34446add","modified":1550631040169},{"_id":"themes/yilia/layout/_partial/mobile-nav.ejs","hash":"7fbbfabf5e29525b24ada14613c21a26789132b4","modified":1550631040242},{"_id":"themes/yilia/layout/_partial/left-col.ejs","hash":"183d7ca4ba8e7c80694ffdc8cf39957092238346","modified":1550631040205},{"_id":"themes/yilia/layout/_partial/mathjax.ejs","hash":"151a1ef2173ba7b6789d349f0f8da89616cc1394","modified":1550631040221},{"_id":"themes/yilia/layout/_partial/viewer.ejs","hash":"e495790b2abe2290875817e42bd505bc611d3e26","modified":1550631040563},{"_id":"themes/yilia/layout/_partial/tools.ejs","hash":"c41341b9618e591538e1136a2d1637587c1bbd90","modified":1550631040554},{"_id":"themes/yilia/source-src/js/anm.js","hash":"4a4c5d82b09a3063f91a434388e6aa064fd7fd98","modified":1550631041096},{"_id":"themes/yilia/source-src/js/browser.js","hash":"04095b38cfd4316a23f8eb14b1ffaf95f78a4260","modified":1550631041131},{"_id":"themes/yilia/source-src/js/Q.js","hash":"d011af172064b6c6e0c7051d8f9879373ddac113","modified":1550631041080},{"_id":"themes/yilia/source-src/js/report.js","hash":"1f6c25cba98abdbf51dd7fda1b75ab655a24327f","modified":1550631041196},{"_id":"themes/yilia/source-src/js/fix.js","hash":"7f9599ffd5c5551538e90b97023e7d6c599d1ee6","modified":1550631041145},{"_id":"themes/yilia/source-src/js/aside.js","hash":"754f771264548a6c5a8ad842908e59ae4e7ed099","modified":1550631041111},{"_id":"themes/yilia/source-src/js/main.js","hash":"3894e60827c817319e43c9ff3ed045fc3d7336ce","modified":1550631041159},{"_id":"themes/yilia/source-src/js/share.js","hash":"b090f82cf80cba7da764753906d9e2cc2acdf30d","modified":1550631041212},{"_id":"themes/yilia/source-src/js/mobile.js","hash":"4d823b039fd296d24a454eae5a798b93c44560cb","modified":1550631041180},{"_id":"themes/yilia/source-src/js/slider.js","hash":"e846bcc5aac9c68b93f7b8de353df54d8d29f666","modified":1550631041226},{"_id":"themes/yilia/source-src/js/viewer.js","hash":"e8a35d4497fe1e0f119662ae08bd8404e5dab2a4","modified":1550631041262},{"_id":"themes/yilia/source-src/css/_function.scss","hash":"93a50dd19a93485712da1f8d0a1672482dd1eabc","modified":1550631040648},{"_id":"themes/yilia/source-src/js/util.js","hash":"8456e9d6b19532742582c99b2fb9d09e146e1c58","modified":1550631041250},{"_id":"themes/yilia/source-src/css/_core.scss","hash":"24f347a2412abbf58318369152504da9538f8d3b","modified":1550631040639},{"_id":"themes/yilia/source-src/css/article-nav.scss","hash":"43e507f2a48504079afd9471353337e23ca47470","modified":1550631040691},{"_id":"themes/yilia/source-src/css/archive.scss","hash":"7d27e22ac898e8fafec14549e940c73cbea1fba8","modified":1550631040655},{"_id":"themes/yilia/source-src/css/comment.scss","hash":"cafe3834017a3bf47420f37543725025225a2c89","modified":1550631040729},{"_id":"themes/yilia/source-src/css/article-main.scss","hash":"3fad68bd74260326f83090b0974dd80707e7bac7","modified":1550631040676},{"_id":"themes/yilia/source-src/css/article-inner.scss","hash":"d79f2d35a06de83a2a226ca790b7a0a34789c115","modified":1550631040663},{"_id":"themes/yilia/source-src/css/fonts.scss","hash":"97b8fba41c914145710b90091f400b845879577f","modified":1550631040831},{"_id":"themes/yilia/source-src/css/footer.scss","hash":"7c995410b25baaf61dfc5e148e22ca60330abcd3","modified":1550631040903},{"_id":"themes/yilia/source-src/css/global.scss","hash":"b4cb4f45a55d4250cd9056f76dab2a3c0dabcec4","modified":1550631040915},{"_id":"themes/yilia/source-src/css/grid.scss","hash":"849a29fcd7150214fcf7b9715fa5dc71d1f9b896","modified":1550631040925},{"_id":"themes/yilia/source-src/css/highlight.scss","hash":"3719994c2c9393813cc1d42b657205c368a329cb","modified":1550631040933},{"_id":"themes/yilia/source-src/css/article.scss","hash":"0f6d61af99ed4db87f8589db1feaea7747b55963","modified":1550631040700},{"_id":"themes/yilia/source-src/css/aside.scss","hash":"578a67464dd0f542197f7fcee158c991db058563","modified":1550631040709},{"_id":"themes/yilia/source-src/css/main.scss","hash":"2f86a014af93583caba78a563d9549826bf28294","modified":1550631040962},{"_id":"themes/yilia/source-src/css/mobile.scss","hash":"ace041d72f95b419f6a5e443191703c2b62007f4","modified":1550631040981},{"_id":"themes/yilia/source-src/css/page.scss","hash":"bf206bb7f7d0967bc8b7fdf01b7ffc99aff9ba88","modified":1550631040988},{"_id":"themes/yilia/source-src/css/reward.scss","hash":"80a4fcf9171d4a33235da96ac8a2b7dcabc45dfb","modified":1550631040995},{"_id":"themes/yilia/source-src/css/mobile-slider.scss","hash":"f053c609d84df0dd9eee1d11ddf0c19163a456be","modified":1550631040969},{"_id":"themes/yilia/source-src/css/left.scss","hash":"0d30c0e7cdb831c3881a017006c782f2214ac195","modified":1550631040955},{"_id":"themes/yilia/source-src/css/scroll.scss","hash":"9c8dfd1c76854ef063494ca76fac6360b391ed6d","modified":1550631041005},{"_id":"themes/yilia/source-src/css/share.scss","hash":"150c6425f6582e7ec78a873256ce49c9930e8805","modified":1550631041014},{"_id":"themes/yilia/source-src/css/social.scss","hash":"724162ccf3977e70a45d189abfaa20b6e2fba87b","modified":1550631041021},{"_id":"themes/yilia/source-src/css/tags-cloud.scss","hash":"c8aa84fca93862d3caae77c552873b8610f33327","modified":1550631041028},{"_id":"themes/yilia/source-src/css/tags.scss","hash":"ac67a3c7097849206244db9b0ba91daaba017ef5","modified":1550631041036},{"_id":"themes/yilia/source-src/css/tools.scss","hash":"1b1aa0908e58cf942b28e3881d07c5573c4129e1","modified":1550631041044},{"_id":"themes/yilia/source/img/preloader.gif","hash":"6342367c93c82da1b9c620e97c84a389cc43d96d","modified":1550631041353},{"_id":"themes/yilia/source/img/default-skin.png","hash":"ed95a8e40a2c3478c5915376acb8e5f33677f24d","modified":1550631041350},{"_id":"themes/yilia/source/img/scrollbar_arrow.png","hash":"d64a33c4ddfbdb89deeb6f4e3d36eb84dc4777c0","modified":1550631041357},{"_id":"themes/yilia/source/fonts/iconfont.16acc2.ttf","hash":"f342ac8bf4d937f42a7d6a0032ad267ab47eb7f2","modified":1550631041307},{"_id":"themes/yilia/source-src/css/tooltip.scss","hash":"53d5a554bc2f38e9bb3d26400a47767013c05216","modified":1550631041052},{"_id":"themes/yilia/source/fonts/iconfont.45d7ee.svg","hash":"f9304e5714d20861be7d8f4d36687e88e86b9e1b","modified":1550631041319},{"_id":"themes/yilia/source/fonts/tooltip.4004ff.svg","hash":"397fe4b1093bf9b62457dac48aa15dac06b54a3c","modified":1550631041345},{"_id":"themes/yilia/source/fonts/iconfont.b322fa.eot","hash":"bc8c5e88f4994a852041b4d83f126d9c4d419b4a","modified":1550631041340},{"_id":"themes/yilia/source/fonts/default-skin.b257fa.svg","hash":"2ac727c9e092331d35cce95af209ccfac6d4c7c7","modified":1550631041297},{"_id":"themes/yilia/source/fonts/iconfont.8c627f.woff","hash":"aa9672cb097f7fd73ae5a03bcd3d9d726935bc0a","modified":1550631041331},{"_id":"themes/yilia/layout/_partial/script.ejs","hash":"439f2afa6c3515a7edd67d512aae6eba5b1b0d0b","modified":1550631040525},{"_id":"themes/yilia/layout/_partial/post/gitment.ejs","hash":"e68bbac9ffb1ad27b56837c9abad6ed6bb7daa0c","modified":1550631040346},{"_id":"themes/yilia/layout/_partial/post/date.ejs","hash":"ef71c4081e866a494367575c59610e7e6339ece0","modified":1550631040313},{"_id":"themes/yilia/layout/_partial/post/changyan.ejs","hash":"ec71ffc2023cebd933c96bd35a7a23d44a30a422","modified":1550631040304},{"_id":"themes/yilia/layout/_partial/post/share.ejs","hash":"341103df70d0b476e3acd0afbc507a4a120d8f5f","modified":1550631040379},{"_id":"themes/yilia/layout/_partial/post/category.ejs","hash":"0809a4829aabeb4e911a3ed04ec28db4df7dfe3f","modified":1550631040265},{"_id":"themes/yilia/layout/_partial/post/nav.ejs","hash":"3e461fab91271cdf87c563efeb20194f447b74b6","modified":1666336497763},{"_id":"themes/yilia/layout/_partial/post/title.ejs","hash":"2f275739b6f1193c123646a5a31f37d48644c667","modified":1550631040402},{"_id":"themes/yilia/layout/_partial/post/tag.ejs","hash":"2e783e68755abb852760eb0e627a3fbb50a05a55","modified":1550631040399},{"_id":"themes/yilia/layout/_partial/post/wangyiyun.ejs","hash":"ea41c462168d9697caef9485862e9cac718a12c1","modified":1550631040421},{"_id":"themes/yilia/layout/_partial/post/duoshuo.ejs","hash":"e8399025ed3b980aedb821c92855889f5f12fd5b","modified":1550631040331},{"_id":"themes/yilia/source-src/css/core/_media-queries.scss","hash":"491ab3378d5c11005ba65c607608bb36b368a9d5","modified":1550631040768},{"_id":"themes/yilia/source-src/css/core/_mixin.scss","hash":"3bba5c77bad5981eac859fe05c9561d580ba7fa9","modified":1550631040792},{"_id":"themes/yilia/source-src/css/core/_animation.scss","hash":"63a37f26276f9207405afe0f2d65339ce295bbaf","modified":1550631040745},{"_id":"themes/yilia/source-src/css/core/_reset.scss","hash":"fab871fa93bd542e76a71a56428f2994a4aaf443","modified":1550631040806},{"_id":"themes/yilia/source-src/css/fonts/iconfont.ttf","hash":"f342ac8bf4d937f42a7d6a0032ad267ab47eb7f2","modified":1550631040872},{"_id":"themes/yilia/source-src/css/fonts/iconfont.svg","hash":"f9304e5714d20861be7d8f4d36687e88e86b9e1b","modified":1550631040863},{"_id":"themes/yilia/source-src/css/fonts/iconfont.eot","hash":"bc8c5e88f4994a852041b4d83f126d9c4d419b4a","modified":1550631040845},{"_id":"themes/yilia/source-src/css/fonts/iconfont.woff","hash":"aa9672cb097f7fd73ae5a03bcd3d9d726935bc0a","modified":1550631040887},{"_id":"themes/yilia/source-src/css/core/_variables.scss","hash":"fb511c505d1309249f21dc577d4ad2bad99a764f","modified":1550631040819},{"_id":"themes/yilia/source-src/css/img/scrollbar_arrow.png","hash":"d64a33c4ddfbdb89deeb6f4e3d36eb84dc4777c0","modified":1550631040943},{"_id":"themes/yilia/source-src/css/img/checkered-pattern.png","hash":"049262fa0886989d750637b264bed34ab51c23c8","modified":1550631040939},{"_id":"themes/yilia/source-src/css/img/tooltip.svg","hash":"397fe4b1093bf9b62457dac48aa15dac06b54a3c","modified":1550631040946},{"_id":"public/content.json","hash":"d9849eaa2b96179413b2944448df94ad546cd85f","modified":1666336674557},{"_id":"public/2019/02/20/react新生命周期替代旧生命周期的最佳实践/index.html","hash":"de951bc640edf63798203fc406b2809c5d30a5f0","modified":1666336674557},{"_id":"public/2018/08/19/vuepie----基于apicloud的vue混和app开发脚手架/index.html","hash":"826f1989b4247ecab65ba8c8b3a5ac62b585fb71","modified":1666336674557},{"_id":"public/2018/02/10/shell学习笔记四/index.html","hash":"76315ed69fb56696344a200a77cc8fe98816d1c5","modified":1666336674557},{"_id":"public/2018/06/04/基于nodejs的简单RESTful服务代码/index.html","hash":"9a8e95f0fa8036e3b70f349bb7d1dc340439f75b","modified":1666336674557},{"_id":"public/2018/01/23/shell学习笔记三/index.html","hash":"02995e9f6b77669150f17c6a3e6519c434baf40c","modified":1666336674557},{"_id":"public/2018/01/13/shell学习笔记二/index.html","hash":"3a71e27ff4f442d3e8c22745d3cd36e2a9551cf2","modified":1666336674557},{"_id":"public/2018/01/12/shell学习笔记一/index.html","hash":"7b1ec55e69331e42331999dac67ba9df5a1f75a5","modified":1666336674557},{"_id":"public/2019/02/22/react-hooks-概览/index.html","hash":"501474c027ec4829d338f11b4d3230fc6ba6ed96","modified":1666336674557},{"_id":"public/2017/12/30/WDS错误提示代码规范HMR的配置/index.html","hash":"4add8c7b194c2320619d45e703b448a8fd995dd7","modified":1666336674557},{"_id":"public/2017/12/26/dva脚手架的demo/index.html","hash":"50861c846d94fae3ec25c2720557f51d0ce17bf9","modified":1666336674557},{"_id":"public/2017/12/16/react-reducers函数单元测试用例与实践体验/index.html","hash":"361bee74341658f1af38f8baf51a0b2f87346689","modified":1666336674557},{"_id":"public/2017/12/16/react-model函数单元测试用例与实践体验/index.html","hash":"f790cbebb00d0515dd16dfed59c996815f149774","modified":1666336674557},{"_id":"public/2017/12/16/react通过redux和redux-saga管理状态/index.html","hash":"092a2b6d5de0a6ef0034579fdb5e4775ffe3c5c0","modified":1666336674557},{"_id":"public/2017/12/16/react-effects函数单元测试用例与实践体验/index.html","hash":"50371b5fd11a9b5658acd7ca14455d3fd401f7f0","modified":1666336674557},{"_id":"public/2017/12/11/ubuntu16-0-4上python版本切换的问题/index.html","hash":"a9d02f093f6c7719fcfd3a269bb6503fb09cec53","modified":1666336674557},{"_id":"public/2017/12/11/npm对包版本管理的机制/index.html","hash":"a9b7ebf550f668c6f542855d92750e19c1ba3543","modified":1666336674557},{"_id":"public/2017/11/23/css布局：两栏、三栏，从圣杯到双飞翼/index.html","hash":"ba6f3fa7e23ae42c681602c4159b1e714db49974","modified":1666336674557},{"_id":"public/2017/12/06/ubuntu安装Jenkins/index.html","hash":"f71bb60a0608a61ac915b371f8d4e5b5234acba5","modified":1666336674557},{"_id":"public/2017/11/12/高阶组件：react应用设计模式/index.html","hash":"da4dfa5663d993fc87536f0597f9ab7653d9ccec","modified":1666336674557},{"_id":"public/2017/11/15/从高阶函数到高阶组件/index.html","hash":"d9b130908b8575a76963157f4d84b791172facf7","modified":1666336674557},{"_id":"public/2017/11/11/webpack-集成-Integrations-翻译/index.html","hash":"c84d7b336804bb976b0cb66e8ccd53fcbbb21316","modified":1666336674557},{"_id":"public/2017/11/11/使您的JavaScript纯净/index.html","hash":"f318c863b2556454a1dbb81aafd8e891ee879696","modified":1666336674557},{"_id":"public/2017/11/03/webpack的shimming的翻译/index.html","hash":"862d8d4f8772070cf0151704ba9c75d6ebf698ac","modified":1666336674557},{"_id":"public/2017/12/16/react的state和基于props的父子组件和兄弟组件沟通/index.html","hash":"d0cdf194e5107b353e45225b008d315be80fce82","modified":1666336674557},{"_id":"public/2017/11/05/webpack的常用插件/index.html","hash":"ec55c8949ab4586f357f568501f8c21042a602d2","modified":1666336674557},{"_id":"public/categories/coding/index.html","hash":"380a1dceac3e64189fb919dc89addb1c49478021","modified":1666336674557},{"_id":"public/categories/coding/page/2/index.html","hash":"39cad0613606265182625c8ae5172e388c54ee75","modified":1666336674557},{"_id":"public/index.html","hash":"be02fc29639d977eff9c497e93169ceb53116b67","modified":1666336674557},{"_id":"public/categories/coding/page/3/index.html","hash":"438246d15b65f738223359b72be76b8eb3144258","modified":1666336674557},{"_id":"public/page/3/index.html","hash":"e7e336e378e28ce212210532e93f9ba7e617749c","modified":1666336674557},{"_id":"public/page/2/index.html","hash":"0b74f593b027239a60ac777a87c0c09948fb9d00","modified":1666336674557},{"_id":"public/archives/2017/index.html","hash":"5a5afaa49e4f0c0dc63f2812f3a8a24f3668448b","modified":1666336674557},{"_id":"public/archives/2017/11/index.html","hash":"e2c317cfa2713d08a3e1e4c019d62a708f418af4","modified":1666336674557},{"_id":"public/archives/2018/index.html","hash":"87115e7139a6939ddc038654e47160d419134611","modified":1666336674557},{"_id":"public/archives/index.html","hash":"9c739f0a8fc72b17c4ca4c85d3be82b31f715dba","modified":1666336674557},{"_id":"public/archives/2018/02/index.html","hash":"0ec8082094f52ac5a5be0911204248efd1e4f2d8","modified":1666336674557},{"_id":"public/archives/2017/12/index.html","hash":"39fcce14e2826051b58ad768092b3954b53591eb","modified":1666336674557},{"_id":"public/archives/2018/06/index.html","hash":"1544fa020d58a529650208e644fe6680b9f7d891","modified":1666336674557},{"_id":"public/archives/2018/01/index.html","hash":"0e3fdff1838ce4ead369a04a51748bda243619db","modified":1666336674557},{"_id":"public/archives/2018/08/index.html","hash":"3d656359a9963f2017647475e56331ba023589db","modified":1666336674557},{"_id":"public/archives/2019/index.html","hash":"7330ce2f0dc7940067c807a1c96021a7472672ff","modified":1666336674557},{"_id":"public/tags/WDS/index.html","hash":"13c63d47238ab6b2fdce10e07c539081fd6eb47f","modified":1666336674557},{"_id":"public/archives/2019/02/index.html","hash":"ef20add5d9ad1851f48ae0bdc9d2985d3e8bd958","modified":1666336674557},{"_id":"public/tags/eslint/index.html","hash":"3ca3ba94cc3f608def1e4045171ef92ffdfab10c","modified":1666336674557},{"_id":"public/tags/webpack-dev-server/index.html","hash":"a011909ebdfa750dfd6d69e866f61fb094752eeb","modified":1666336674557},{"_id":"public/tags/HMR/index.html","hash":"4065d93beab87ecb3870da2d3462ba9870114ca9","modified":1666336674557},{"_id":"public/tags/shell/index.html","hash":"d067653cd8bf3b039bd932177d39650dc8e49560","modified":1666336674557},{"_id":"public/tags/脚本/index.html","hash":"c2b4167bf516cdbf7fb01ffa29b8f6d6644675cf","modified":1666336674557},{"_id":"public/tags/终端/index.html","hash":"a3bfdddacf84daf92b3eec99d7db39b63b78f5d8","modified":1666336674557},{"_id":"public/tags/bash/index.html","hash":"07026010172861a9fa76244e8acc419258dd3c98","modified":1666336674557},{"_id":"public/tags/命令行/index.html","hash":"5137f0ecc8a75cf77e0cc60ab309acd6600de6c8","modified":1666336674557},{"_id":"public/tags/react/index.html","hash":"317dc3ef92a42dac905fd2287dc1bbad82a994ee","modified":1666336674557},{"_id":"public/tags/单元测试/index.html","hash":"eb5e0c521b7c9b2b2c7928d2a04de84d050b07d9","modified":1666336674557},{"_id":"public/tags/state/index.html","hash":"f7677dc8752f8f5d34871200b101c9e7aec252d3","modified":1666336674557},{"_id":"public/tags/props/index.html","hash":"1137677fd364a529b45e7ba0a79804768635776b","modified":1666336674557},{"_id":"public/tags/effects/index.html","hash":"4576c9401af9f3c481d7af0a57693bca01d008d1","modified":1666336674557},{"_id":"public/tags/组件沟通/index.html","hash":"5ad5c0b3e32b6a61592bbe52abca1e6cffce426e","modified":1666336674557},{"_id":"public/tags/信息传递/index.html","hash":"8ab6843d9f4f87a715041262a2970c36db2caa74","modified":1666336674557},{"_id":"public/tags/css布局/index.html","hash":"7b907c82d116eb551ac43ba438a95bffb57025a2","modified":1666336674557},{"_id":"public/tags/css/index.html","hash":"772a2e4c5708cc4f79e2e5776851b217a6487d67","modified":1666336674557},{"_id":"public/tags/两栏/index.html","hash":"ec63ccf5181980562201fcc57315dea3418487e8","modified":1666336674557},{"_id":"public/tags/双飞翼/index.html","hash":"602e881209b5c899615e27e1936bbbac9e768f27","modified":1666336674557},{"_id":"public/tags/三栏/index.html","hash":"704c4ddeecafb5d3e8c49d0cc219e3917b4c169e","modified":1666336674557},{"_id":"public/tags/圣杯/index.html","hash":"ae4660d44f4d9a41ad0db64459899ed78ef0bff0","modified":1666336674557},{"_id":"public/tags/bfc/index.html","hash":"d4eba1a7d70837a53696a3c0ecea964042e66d42","modified":1666336674557},{"_id":"public/tags/块格式化上下文/index.html","hash":"8b939c4d2e098251216908f1205222429de71d90","modified":1666336674557},{"_id":"public/tags/unit-test/index.html","hash":"2b4dbe5f18c3079a4bbfcc37f841aaf387465350","modified":1666336674557},{"_id":"public/tags/effect/index.html","hash":"30a86af1f5d8fc0ef342d1131f91f736b49132af","modified":1666336674557},{"_id":"public/tags/reduxe/index.html","hash":"675ac54dd7f903b1ec31f5210eeafee7f9c8653e","modified":1666336674557},{"_id":"public/tags/redux-saga/index.html","hash":"cf2967b34b198f3ad46535954b3ea0fc6d31086f","modified":1666336674557},{"_id":"public/tags/dispatch/index.html","hash":"78fe3fc5a1e2eae092569a653f7d8feccfe2ee80","modified":1666336674557},{"_id":"public/tags/reducer/index.html","hash":"b229266e73b0274266c73229e7a160116b6cddb9","modified":1666336674557},{"_id":"public/tags/npm/index.html","hash":"0d8b49de19c342b06e067476106dbad047ff4815","modified":1666336674557},{"_id":"public/tags/semver/index.html","hash":"85e0a81538ba6d9443d6e7c3768bba96bbfad390","modified":1666336674557},{"_id":"public/tags/包版本管理/index.html","hash":"909f1f15a4a5216daad8d281acafb2844e9bf635","modified":1666336674557},{"_id":"public/tags/package/index.html","hash":"810442ee1db819bc0f5ae3611f337ff47e9849ad","modified":1666336674557},{"_id":"public/tags/webpack/index.html","hash":"d7a014cfeb7b33b8b97f60ac105a6ac0af532fdd","modified":1666336674557},{"_id":"public/tags/js/index.html","hash":"4930271ca514a28f60350e9d883efa0eda847af0","modified":1666336674557},{"_id":"public/tags/前端/index.html","hash":"8b3732c052c311a1d0502a4ca07ecd33a7bff78e","modified":1666336674557},{"_id":"public/tags/javascript/index.html","hash":"4bd7ba126ef04ba8aa633810738d06c19ff53ba6","modified":1666336674557},{"_id":"public/tags/shimming/index.html","hash":"ee9bf3e28d0cd2f3d3de5ee7d858bc821a131a56","modified":1666336674557},{"_id":"public/tags/生命周期/index.html","hash":"5093f104438cb0d8c673a6ca01256a6a6bf66076","modified":1666336674557},{"_id":"public/tags/integrations/index.html","hash":"a889e26148b8d16ea9474c5f3d0903753836b907","modified":1666336674557},{"_id":"public/tags/Fiber/index.html","hash":"c31765147385c5479f468216b8e46d1af24a3ee2","modified":1666336674557},{"_id":"public/tags/getDerivedStateFromProps/index.html","hash":"71bc3e6ac29e86d798a59e364491c6434e004930","modified":1666336674557},{"_id":"public/tags/getSnapshotBeforeUpdate/index.html","hash":"4adff29bc94e94d972c99e8316de6e94a5ae0a91","modified":1666336674557},{"_id":"public/tags/最佳实践/index.html","hash":"d2ee4d6d8688d84aa3a6d2367855519b3a368daa","modified":1666336674557},{"_id":"public/tags/CI/index.html","hash":"9d5afd5ca9846c2371f2cc6188c648a2390abbf6","modified":1666336674557},{"_id":"public/tags/持续集成/index.html","hash":"816769aa1226e55ce6117d798b4d328a86be6a9f","modified":1666336674557},{"_id":"public/tags/jenkins/index.html","hash":"3b56f1cb802d4d0b7d607ad6b4e547da54a51a80","modified":1666336674557},{"_id":"public/tags/ubuntu/index.html","hash":"e2103500924f89c6a9885661b63c79ce81d0b902","modified":1666336674557},{"_id":"public/tags/http/index.html","hash":"82291ab69a27f8659463e4f414a7f5a975260cc7","modified":1666336674557},{"_id":"public/tags/nodejs/index.html","hash":"bb45ea08666c04e764b06eee330ffaed6743b8b1","modified":1666336674557},{"_id":"public/tags/RESTful/index.html","hash":"bf43410213c5a484a46d7e14ed204365cb1eec64","modified":1666336674557},{"_id":"public/tags/cURL/index.html","hash":"ef1644757db7a052f9dc86ade1cfb8f5b158fe63","modified":1666336674557},{"_id":"public/tags/版本/index.html","hash":"26ddeb790164099943edaa3d1a44b1e49da485b6","modified":1666336674557},{"_id":"public/tags/版本管理/index.html","hash":"7a1b5ee3aba5d46bd4de8190cf5bbce4e6a19b4d","modified":1666336674557},{"_id":"public/tags/python/index.html","hash":"f8442e4721232922a0e5ef67fef640abc659b479","modified":1666336674557},{"_id":"public/tags/切换/index.html","hash":"ff9005daa52fa827f3e0bc24ec9d9911d7157e18","modified":1666336674557},{"_id":"public/tags/side-effects/index.html","hash":"674db407034bbf1573844aa10dbb32e9dc37463d","modified":1666336674557},{"_id":"public/tags/副作用/index.html","hash":"039c44bd97db75c592b32e2aeffa0bb170ad465e","modified":1666336674557},{"_id":"public/tags/vue/index.html","hash":"bcaf49779f33d22b51b73fe78ed4b6a79c8e0af4","modified":1666336674557},{"_id":"public/tags/纯函数/index.html","hash":"e75587b57841c85a7a1bdb72b6a98e946bf12b6d","modified":1666336674557},{"_id":"public/tags/apicloud/index.html","hash":"cb9724eda035c14aff5baf9311eb7da2860bd4c7","modified":1666336674557},{"_id":"public/tags/hybrid-app/index.html","hash":"9adc2c41693f87064a4c4828019a078569a8abd2","modified":1666336674557},{"_id":"public/tags/pure-funtion/index.html","hash":"1a14d794cce859a403a745a397d8510682cbb7c1","modified":1666336674557},{"_id":"public/tags/tools/index.html","hash":"190b69cd42024a300932810aece342810482327b","modified":1666336674557},{"_id":"public/tags/cli/index.html","hash":"34f65fbad9b4f8948f51970e0e8328f2cf62b922","modified":1666336674557},{"_id":"public/tags/组件/index.html","hash":"fd4fa0d272f0adc335c4485b1019e4349dc76003","modified":1666336674557},{"_id":"public/tags/Higher-Order-Components/index.html","hash":"3fb47f9f76fda14a0ae5b0e3a1af0f4bd8ad5a59","modified":1666336674557},{"_id":"public/tags/高阶组件/index.html","hash":"fde9b158c3afa00aca75bc85e79c5206f6495eff","modified":1666336674557},{"_id":"public/tags/高阶函数/index.html","hash":"cc1bf1f9f6c537ee756407c1fcf579d0beb9f4bb","modified":1666336674557},{"_id":"public/tags/model/index.html","hash":"201dcf4e0b6f978a7a1ad213ee6b776ea2ccb2ed","modified":1666336674557},{"_id":"public/tags/continuous-integration/index.html","hash":"a1d1bd714e04044515b44ff1fd060dc9e50af093","modified":1666336674557},{"_id":"public/categories/coding/page/4/index.html","hash":"d43cbf9fe31499942605d5cb43d1ad8c1fb8a634","modified":1666336674557},{"_id":"public/page/4/index.html","hash":"a23e76cf142b37b29315af490bb0f598eb9e040c","modified":1666336674557},{"_id":"public/tags/hooks/index.html","hash":"34cac066e98feb6944e401fd3c6cb646f11db87e","modified":1666336674557},{"_id":"public/tags/useState/index.html","hash":"d757cab4d5b0bc8e30962eba642451468d48d3dd","modified":1666336674557},{"_id":"public/tags/useEffect/index.html","hash":"0acba1deb763c0af7c1ba9c04564d0179a52be08","modified":1666336674557},{"_id":"public/tags/自定义钩子/index.html","hash":"58d7507ced5f7746b8f910ab0390a546a9298ad6","modified":1666336674557},{"_id":"source/_posts/优化代码的小技巧（三）.md","hash":"465512d42acb86e354b0e2301e2fbb5b4735797c","modified":1551346018954},{"_id":"public/2019/02/28/优化代码的小技巧（三）/index.html","hash":"690985d0e036dfd60bc8c0f6c404ab9edcb76732","modified":1666336674557},{"_id":"public/tags/函数式编程/index.html","hash":"c6a43680f63a34c74a90e74d8d9fd8f44df5feeb","modified":1666336674557},{"_id":"public/tags/Functional-programming/index.html","hash":"c18fc534d2c7ccc2bc113c424a8b44336f7a6a00","modified":1666336674557},{"_id":"public/tags/优化代码/index.html","hash":"00fe3bb4e1cf56537b2e3ab553ea55e46a07c5ab","modified":1666336674557},{"_id":"public/tags/钩子/index.html","hash":"8dc0164f369956fb99e4f287e279db991abea1f7","modified":1666336674557},{"_id":"public/img/preloader.gif","hash":"6342367c93c82da1b9c620e97c84a389cc43d96d","modified":1666336674557},{"_id":"public/img/default-skin.png","hash":"ed95a8e40a2c3478c5915376acb8e5f33677f24d","modified":1666336674557},{"_id":"public/fonts/iconfont.16acc2.ttf","hash":"f342ac8bf4d937f42a7d6a0032ad267ab47eb7f2","modified":1666336674557},{"_id":"public/img/scrollbar_arrow.png","hash":"d64a33c4ddfbdb89deeb6f4e3d36eb84dc4777c0","modified":1666336674557},{"_id":"public/fonts/iconfont.45d7ee.svg","hash":"f9304e5714d20861be7d8f4d36687e88e86b9e1b","modified":1666336674557},{"_id":"public/fonts/tooltip.4004ff.svg","hash":"397fe4b1093bf9b62457dac48aa15dac06b54a3c","modified":1666336674557},{"_id":"public/fonts/iconfont.b322fa.eot","hash":"bc8c5e88f4994a852041b4d83f126d9c4d419b4a","modified":1666336674557},{"_id":"public/fonts/iconfont.8c627f.woff","hash":"aa9672cb097f7fd73ae5a03bcd3d9d726935bc0a","modified":1666336674557},{"_id":"public/fonts/default-skin.b257fa.svg","hash":"2ac727c9e092331d35cce95af209ccfac6d4c7c7","modified":1666336674557},{"_id":"public/slider.e37972.js","hash":"6dec4e220c89049037eebc44404abd8455d22ad7","modified":1666336674557},{"_id":"public/main.507b3a.css","hash":"ddf6e2c6b953c2c59a3c271e6070010a4cc81cf9","modified":1666336674557},{"_id":"public/main.507b3a.js","hash":"1be71323e357bcc2d99568bc622f23f152811f2e","modified":1666336674557},{"_id":"public/mobile.fdc4b7.js","hash":"6bfff9bfe4d7e067b6289e851a4c424ac815af5e","modified":1666336674557},{"_id":"source/_posts/taro-with-DVA-tarojs-配合-dva-js的实践.md","hash":"a6a9b47afbd9920ec7c2e9a46016580451a7d07b","modified":1564727068279},{"_id":"public/2019/08/02/taro-with-DVA-tarojs-配合-dva-js的实践/index.html","hash":"f0c8f98d1bb220bfa4e854df5b3a62f09df4efb8","modified":1666336674557},{"_id":"public/archives/2019/08/index.html","hash":"8e4fafe2cf1aa4b5e14a69bed2279f93d39b1cb3","modified":1666336674557},{"_id":"public/tags/react/page/2/index.html","hash":"186bde8c67692c24c6c20bc9d46dee158589aa15","modified":1666336674557},{"_id":"public/tags/taro-js/index.html","hash":"40592fee1b2bfaba363465f8dc78fe502af1cb5d","modified":1666336674557},{"_id":"public/tags/小程序/index.html","hash":"0dd6ac987f7a5a75fe5344134ecc45a292416387","modified":1666336674557},{"_id":"public/tags/dvajs/index.html","hash":"e372a9f7624bfac9b7c2cfab66be8ffa5c09ca1f","modified":1666336674557},{"_id":"source/_posts/nginx基于pfx文件创建https.md","hash":"ae4189c5f70b5c3aaf8befbb7258212cf81837a1","modified":1591024426786},{"_id":"public/2020/06/01/nginx基于pfx文件创建https/index.html","hash":"f831118008d765cea688166faf1da7cd7cd7df60","modified":1666336674557},{"_id":"public/tags/nginx/index.html","hash":"4e25cf425b27b2163482568636c2d0dd3be23b95","modified":1666336674557},{"_id":"public/tags/pfx/index.html","hash":"f7cbd6c946ab1fd415e176d9083b21e29c30b6d1","modified":1666336674557},{"_id":"public/tags/https/index.html","hash":"65f8fa0a5b2882ad19de3d01f546a164709ceea8","modified":1666336674557},{"_id":"public/archives/2020/index.html","hash":"9ab3705527868fdd54e43e995f9f7dfafb7c1b9c","modified":1666336674557},{"_id":"public/archives/2020/06/index.html","hash":"b3a12040a491b33a925197266806d4407b4275f3","modified":1666336674557},{"_id":"source/_posts/centOS服务器添加服务添加启动项脚本.md","hash":"34807f95a28c5e5d72bedd990038249e72901a10","modified":1592031642360},{"_id":"public/2020/06/13/centOS服务器添加服务添加启动项脚本/index.html","hash":"449b37a3ee70f0fa3b22e78001229aa57d7d09a6","modified":1666336674557},{"_id":"public/tags/centOS/index.html","hash":"0504816847d7b735a184d4a06d559d75b736570c","modified":1666336674557},{"_id":"public/tags/service/index.html","hash":"aad439a30c04e02427f814a6c3d40ec908925ea4","modified":1666336674557},{"_id":"public/tags/启动项/index.html","hash":"193747bb2ef1414dea4075c070ea27cd0e036369","modified":1666336674557},{"_id":"public/tags/rc-local/index.html","hash":"cc04105857d1db51bf6091f60b4bf01783a007e9","modified":1666336674557},{"_id":"public/tags/daemon/index.html","hash":"7843459ceea477a24f7e0989d4fa2489caa8a415","modified":1666336674557},{"_id":"public/tags/reload/index.html","hash":"02b0e42afb46e3be3c09c4f3ec90a9c21ecc0d82","modified":1666336674557},{"_id":"public/tags/systemctl/index.html","hash":"cf278a5b5831414c3450dda9fc0f6053517481d6","modified":1666336674557}],"Category":[{"name":"coding","_id":"cjsgue0e20002gpi6t4cvdqge"}],"Data":[],"Page":[],"Post":[{"title":"WDS错误提示代码规范HMR的配置","date":"2017-12-30T02:28:54.000Z","_content":"## 项目结构\n```bash\n/\n├─ app\n│   ├─ index.js\n│   └─ print.js\n├─ build\n├─ package.json\n└─ webpack.config.js\n```\n<!--more-->\n/app/index.js\n\n```javascript\nimport print from './print';\n\nfunction component(text = 'hello world!') {\n    const element = document.createElement('div');\n    element.innerHTML = text;\n\n    const p = document.createElement('input');\n    p.type = 'checkbox';\n    element.appendChild(p);\n\n    const btn = document.createElement('button');\n    btn.id = 'btn';\n    btn.innerHTML = '点击';\n    btn.onclick = print.log;\n    element.appendChild(btn);\n\n    return element;\n}\n\ndocument.body.appendChild(component());\n```\n\n/app/print.js\n\n```javascript\nexport default {\n    log() {\n        console.log('5678');\n    },\n};\n```\n\n/package.json\n\n```json\n{\n    \"name\": \"webpack-dev-server-demo\",\n    \"version\": \"1.0.0\",\n    \"description\": \"\",\n    \"main\": \"index.js\",\n    \"scripts\": {\n        \"test\": \"echo \\\"Error: no test specified\\\" && exit 1\"\n    },\n    \"keywords\": [],\n    \"author\": \"\",\n    \"license\": \"ISC\",\n    \"devDependencies\": {\n        \"html-webpack-plugin\": \"^2.28.0\",\n        \"webpack\": \"^2.3.2\"\n    }\n}\n```\n\n/webpack.config.js\n\n```javascript\nconst path = require('path');\nconst HtmlWebpackPlugin = require('html-webpack-plugin');\nconst PATHS = {\n  app: path.join(__dirname, 'app'),\n  build: path.join(__dirname, 'build'),\n};\n\nmodule.exports = {\n  entry: {\n    app: PATHS.app,\n  },\n  output: {\n    path: PATHS.build,\n    filename: '[name].js',\n  },\n  plugins: [\n    new HtmlWebpackPlugin({\n      title: 'Webpack demo',\n    }),\n  ],\n};\n```\n## 初始化项目\n\n```bash\nnpm install\n```\n\n## 安装 WDS----webpack-dev-server\n\n```bash\nnpm install webpack-dev-server --save-dev\n```\n\n## 修改 package.json， 添加 script:\n\n```diff\n{\n    \"name\": \"webpack-dev-server-demo\",\n    \"version\": \"1.0.0\",\n    \"description\": \"\",\n    \"main\": \"index.js\",\n    \"scripts\": {\n-       \"test\": \"echo \\\"Error: no test specified\\\" && exit 1\"\n+       \"test\": \"echo \\\"Error: no test specified\\\" && exit 1\",\n+       \"start\": \"webpack-dev-server --env development\",\n+       \"build\": \"webpack --env production\"\n    },\n    \"keywords\": [],\n    \"author\": \"\",\n    \"license\": \"ISC\",\n    \"devDependencies\": {\n        \"html-webpack-plugin\": \"^2.28.0\",\n        \"webpack\": \"^2.3.2\",\n        \"webpack-dev-server\": \"^2.9.7\"\n    }\n}\n```\n## 启动服务\n\n```bash\nnpm start\n```\n\n浏览器中打开  [http://localhost:8080/](http://localhost:8080/)，修改 /app/print.js 代码，页面会整体刷新。\n\n## WDS 端口号等配置相关\n\n修改 /webpack.config.js\n\n```diff\nconst path = require('path');\nconst HtmlWebpackPlugin = require('html-webpack-plugin');\n\nconst PATHS = {\n  app: path.join(__dirname, 'app'),\n  build: path.join(__dirname, 'build'),\n};\n\nmodule.exports = {\n+ devServer: {\n+   host: process.env.HOST,\n+   port: 8090,\n+ },\n  entry: {\n    app: PATHS.app,\n  },\n  output: {\n    path: PATHS.build,\n    filename: '[name].js',\n  },\n  plugins: [\n    new HtmlWebpackPlugin({\n      title: 'Webpack demo',\n    }),\n  ],\n};\n```\n\n```bash\nnpm start\n```\n\n浏览器中打开  [http://localhost:8090/](http://localhost:8090/)\n\n## 配置 [ESLint](http://eslint.cn/) 实现代码规范自动测试\n### 安装`ESLint`\n\n```bash\nnpm install eslint --save-dev\n```\n### 修改 /package.json\n\n```diff\n{\n  \"name\": \"webpack-dev-server-demo\",\n  \"version\": \"1.0.0\",\n  \"description\": \"\",\n  \"main\": \"index.js\",\n  \"scripts\": {\n    \"test\": \"echo \\\"Error: no test specified\\\" && exit 1\",\n    \"start\": \"webpack-dev-server --env development\",\n-   \"build\": \"webpack --env production\"\n+   \"build\": \"webpack --env production\",\n+   \"lintjs\": \"eslint app/ webpack.*.js --cache\"\n  },\n  \"keywords\": [],\n  \"author\": \"\",\n  \"license\": \"ISC\",\n  \"devDependencies\": {\n    \"eslint\": \"^4.14.0\",\n    \"html-webpack-plugin\": \"^2.28.0\",\n    \"webpack\": \"^2.3.2\",\n    \"webpack-dev-server\": \"^2.9.7\"\n  }\n}\n```\n\n### 添加ESLint配置文件 /.eslintrc.js\n\n```javascript\nmodule.exports = {\n    env: {\n        browser: true,\n        commonjs: true,\n        es6: true,\n        node: true,\n    },\n    extends: 'eslint:recommended',\n    parserOptions: {\n        sourceType: 'module',\n    },\n    rules: {\n        'comma-dangle': ['error', 'always-multiline'],\n        indent: ['error', 4],\n        'linebreak-style': ['error', 'unix'],\n        quotes: ['error', 'single'],\n        semi: ['error', 'always'],\n        'no-unused-vars': ['warn'],\n        'no-console': 0,\n    },\n};\n```\n\n### 执行ESLint\n\n```bash\nnpm run lintjs\n```\n\n### 自动解决部分错误\n\n```bash\nnpm run lintjs -- --fix\n```\n\n### 在webpage中自动进行eslint\n\n安装 eslint-loader \n\n```bash\nnpm install eslint-loader --save-dev\n```\n\n在webpack.config.js添加相关配置\n\n```diff\nconst path = require('path');\nconst HtmlWebpackPlugin = require('html-webpack-plugin');\n\nconst PATHS = {\n  app: path.join(__dirname, 'app'),\n  build: path.join(__dirname, 'build'),\n};\n\nmodule.exports = {\n  devServer: {\n    host: process.env.HOST,\n    port: 8090,\n  },\n  entry: {\n    app: PATHS.app,\n  },\n  output: {\n    path: PATHS.build,\n    filename: '[name].js',\n  },\n+ module: {\n+   rules: [\n+     {\n+       test: /\\.js$/,\n+       enforce: 'pre', // 前置loader\n+       loader: 'eslint-loader',\n+       options: {\n+         emitWarning: true, // 是否发出警告\n+       },\n+     },\n+   ],\n+ },\n  plugins: [\n    new HtmlWebpackPlugin({\n      title: 'Webpack demo',\n    }),\n  ],\n};\n```\n\n修改一个js，运行\n\n```bash\nnpm start\n```\n\n出现错误，运行\n\n```bash\nnpm run lintjs -- --fix\n```\n\n接着运行\n\n```bash\nnpm start\n```\n\n### 在浏览器中显示错误信息\n\n在webpack.config.js添加相关配置\n\n```diff\nconst path = require('path');\nconst HtmlWebpackPlugin = require('html-webpack-plugin');\n\nconst PATHS = {\n  app: path.join(__dirname, 'app'),\n  build: path.join(__dirname, 'build'),\n};\n\nmodule.exports = {\n  devServer: {\n    host: process.env.HOST,\n    port: 8090,\n+   overlay: {\n+     errors: true,\n+     warnings: true,\n+   },\n  },\n  entry: {\n    app: PATHS.app,\n  },\n  output: {\n    path: PATHS.build,\n    filename: '[name].js',\n  },\n  module: {\n    rules: [\n      {\n        test: /\\.js$/,\n        enforce: 'pre',\n\n        loader: 'eslint-loader',\n        options: {\n          emitWarning: true,\n        },\n      },\n    ],\n  },\n  plugins: [\n    new HtmlWebpackPlugin({\n      title: 'Webpack demo',\n    }),\n  ],\n};\n```\n\n### 添加 HMR(hot module replacement) 模块热更新\n\n在webpack.config.js添加相关配置\n\n```diff \nconst path = require('path');\nconst HtmlWebpackPlugin = require('html-webpack-plugin');\n+ const webpack  = require('webpack');\n\nconst PATHS = {\n  app: path.join(__dirname, 'app'),\n  build: path.join(__dirname, 'build'),\n};\n\nmodule.exports = {\n  devServer: {\n    host: process.env.HOST,\n    port: 8090,\n    overlay: {\n      errors: true,\n      warnings: true,\n    },\n+   hotOnly: true,\n  },\n  entry: {\n    app: PATHS.app,\n  },\n  output: {\n    path: PATHS.build,\n    filename: '[name].js',\n  },\n  module: {\n    rules: [\n      {\n        test: /\\.js$/,\n        enforce: 'pre',\n\n        loader: 'eslint-loader',\n        options: {\n          emitWarning: true,\n        },\n      },\n    ],\n  },\n  plugins: [\n    new HtmlWebpackPlugin({\n      title: 'Webpack demo',\n    }),\n+   new webpack.HotModuleReplacementPlugin(),\n  ],\n};\n```\n\n修改/app/index.js\n\n```diff \nimport print from './print';\n\nfunction component(text = 'hello world!') {\n    const element = document.createElement('div');\n    element.innerHTML = text;\n\n    const p = document.createElement('input');\n    p.type = 'checkbox';\n    element.appendChild(p);\n\n    const btn = document.createElement('button');\n    btn.id = 'btn';\n    btn.innerHTML = '点击';\n    btn.onclick = print.log;\n    element.appendChild(btn);\n\n    return element;\n}\n\ndocument.body.appendChild(component());\n\n+if (module.hot) {\n+    module.hot.accept('./print', () => {\n+        console.log('print热更新了');\n+        print.log();\n+    });\n+}\n```\n\n修改print.js console 有输出 但是点击按钮还是原来的输出\n\n修改/app/index.js\n\n```diff \nimport print from './print';\n\nfunction component(text = 'hello world!') {\n    const element = document.createElement('div');\n    element.innerHTML = text;\n\n    const p = document.createElement('input');\n    p.type = 'checkbox';\n    element.appendChild(p);\n\n    const btn = document.createElement('button');\n    btn.id = 'btn';\n    btn.innerHTML = '点击';\n    btn.onclick = print.log;\n    element.appendChild(btn);\n\n    return element;\n}\n\ndocument.body.appendChild(component());\n\nif (module.hot) {\n    module.hot.accept('./print', () => {\n        console.log('print热更新了');\n+       window.document.getElementById('btn').onclick = print.log;\n        print.log();\n    });\n}\n```\n\n修改print.js console 有输出 点击按钮是新的输出","source":"_posts/WDS错误提示代码规范HMR的配置.md","raw":"---\ntitle: WDS错误提示代码规范HMR的配置\ndate: 2017-12-30 10:28:54\ntags: ['WDS','eslint','HMR','webpack-dev-server']\ncategory: 'coding'\n---\n## 项目结构\n```bash\n/\n├─ app\n│   ├─ index.js\n│   └─ print.js\n├─ build\n├─ package.json\n└─ webpack.config.js\n```\n<!--more-->\n/app/index.js\n\n```javascript\nimport print from './print';\n\nfunction component(text = 'hello world!') {\n    const element = document.createElement('div');\n    element.innerHTML = text;\n\n    const p = document.createElement('input');\n    p.type = 'checkbox';\n    element.appendChild(p);\n\n    const btn = document.createElement('button');\n    btn.id = 'btn';\n    btn.innerHTML = '点击';\n    btn.onclick = print.log;\n    element.appendChild(btn);\n\n    return element;\n}\n\ndocument.body.appendChild(component());\n```\n\n/app/print.js\n\n```javascript\nexport default {\n    log() {\n        console.log('5678');\n    },\n};\n```\n\n/package.json\n\n```json\n{\n    \"name\": \"webpack-dev-server-demo\",\n    \"version\": \"1.0.0\",\n    \"description\": \"\",\n    \"main\": \"index.js\",\n    \"scripts\": {\n        \"test\": \"echo \\\"Error: no test specified\\\" && exit 1\"\n    },\n    \"keywords\": [],\n    \"author\": \"\",\n    \"license\": \"ISC\",\n    \"devDependencies\": {\n        \"html-webpack-plugin\": \"^2.28.0\",\n        \"webpack\": \"^2.3.2\"\n    }\n}\n```\n\n/webpack.config.js\n\n```javascript\nconst path = require('path');\nconst HtmlWebpackPlugin = require('html-webpack-plugin');\nconst PATHS = {\n  app: path.join(__dirname, 'app'),\n  build: path.join(__dirname, 'build'),\n};\n\nmodule.exports = {\n  entry: {\n    app: PATHS.app,\n  },\n  output: {\n    path: PATHS.build,\n    filename: '[name].js',\n  },\n  plugins: [\n    new HtmlWebpackPlugin({\n      title: 'Webpack demo',\n    }),\n  ],\n};\n```\n## 初始化项目\n\n```bash\nnpm install\n```\n\n## 安装 WDS----webpack-dev-server\n\n```bash\nnpm install webpack-dev-server --save-dev\n```\n\n## 修改 package.json， 添加 script:\n\n```diff\n{\n    \"name\": \"webpack-dev-server-demo\",\n    \"version\": \"1.0.0\",\n    \"description\": \"\",\n    \"main\": \"index.js\",\n    \"scripts\": {\n-       \"test\": \"echo \\\"Error: no test specified\\\" && exit 1\"\n+       \"test\": \"echo \\\"Error: no test specified\\\" && exit 1\",\n+       \"start\": \"webpack-dev-server --env development\",\n+       \"build\": \"webpack --env production\"\n    },\n    \"keywords\": [],\n    \"author\": \"\",\n    \"license\": \"ISC\",\n    \"devDependencies\": {\n        \"html-webpack-plugin\": \"^2.28.0\",\n        \"webpack\": \"^2.3.2\",\n        \"webpack-dev-server\": \"^2.9.7\"\n    }\n}\n```\n## 启动服务\n\n```bash\nnpm start\n```\n\n浏览器中打开  [http://localhost:8080/](http://localhost:8080/)，修改 /app/print.js 代码，页面会整体刷新。\n\n## WDS 端口号等配置相关\n\n修改 /webpack.config.js\n\n```diff\nconst path = require('path');\nconst HtmlWebpackPlugin = require('html-webpack-plugin');\n\nconst PATHS = {\n  app: path.join(__dirname, 'app'),\n  build: path.join(__dirname, 'build'),\n};\n\nmodule.exports = {\n+ devServer: {\n+   host: process.env.HOST,\n+   port: 8090,\n+ },\n  entry: {\n    app: PATHS.app,\n  },\n  output: {\n    path: PATHS.build,\n    filename: '[name].js',\n  },\n  plugins: [\n    new HtmlWebpackPlugin({\n      title: 'Webpack demo',\n    }),\n  ],\n};\n```\n\n```bash\nnpm start\n```\n\n浏览器中打开  [http://localhost:8090/](http://localhost:8090/)\n\n## 配置 [ESLint](http://eslint.cn/) 实现代码规范自动测试\n### 安装`ESLint`\n\n```bash\nnpm install eslint --save-dev\n```\n### 修改 /package.json\n\n```diff\n{\n  \"name\": \"webpack-dev-server-demo\",\n  \"version\": \"1.0.0\",\n  \"description\": \"\",\n  \"main\": \"index.js\",\n  \"scripts\": {\n    \"test\": \"echo \\\"Error: no test specified\\\" && exit 1\",\n    \"start\": \"webpack-dev-server --env development\",\n-   \"build\": \"webpack --env production\"\n+   \"build\": \"webpack --env production\",\n+   \"lintjs\": \"eslint app/ webpack.*.js --cache\"\n  },\n  \"keywords\": [],\n  \"author\": \"\",\n  \"license\": \"ISC\",\n  \"devDependencies\": {\n    \"eslint\": \"^4.14.0\",\n    \"html-webpack-plugin\": \"^2.28.0\",\n    \"webpack\": \"^2.3.2\",\n    \"webpack-dev-server\": \"^2.9.7\"\n  }\n}\n```\n\n### 添加ESLint配置文件 /.eslintrc.js\n\n```javascript\nmodule.exports = {\n    env: {\n        browser: true,\n        commonjs: true,\n        es6: true,\n        node: true,\n    },\n    extends: 'eslint:recommended',\n    parserOptions: {\n        sourceType: 'module',\n    },\n    rules: {\n        'comma-dangle': ['error', 'always-multiline'],\n        indent: ['error', 4],\n        'linebreak-style': ['error', 'unix'],\n        quotes: ['error', 'single'],\n        semi: ['error', 'always'],\n        'no-unused-vars': ['warn'],\n        'no-console': 0,\n    },\n};\n```\n\n### 执行ESLint\n\n```bash\nnpm run lintjs\n```\n\n### 自动解决部分错误\n\n```bash\nnpm run lintjs -- --fix\n```\n\n### 在webpage中自动进行eslint\n\n安装 eslint-loader \n\n```bash\nnpm install eslint-loader --save-dev\n```\n\n在webpack.config.js添加相关配置\n\n```diff\nconst path = require('path');\nconst HtmlWebpackPlugin = require('html-webpack-plugin');\n\nconst PATHS = {\n  app: path.join(__dirname, 'app'),\n  build: path.join(__dirname, 'build'),\n};\n\nmodule.exports = {\n  devServer: {\n    host: process.env.HOST,\n    port: 8090,\n  },\n  entry: {\n    app: PATHS.app,\n  },\n  output: {\n    path: PATHS.build,\n    filename: '[name].js',\n  },\n+ module: {\n+   rules: [\n+     {\n+       test: /\\.js$/,\n+       enforce: 'pre', // 前置loader\n+       loader: 'eslint-loader',\n+       options: {\n+         emitWarning: true, // 是否发出警告\n+       },\n+     },\n+   ],\n+ },\n  plugins: [\n    new HtmlWebpackPlugin({\n      title: 'Webpack demo',\n    }),\n  ],\n};\n```\n\n修改一个js，运行\n\n```bash\nnpm start\n```\n\n出现错误，运行\n\n```bash\nnpm run lintjs -- --fix\n```\n\n接着运行\n\n```bash\nnpm start\n```\n\n### 在浏览器中显示错误信息\n\n在webpack.config.js添加相关配置\n\n```diff\nconst path = require('path');\nconst HtmlWebpackPlugin = require('html-webpack-plugin');\n\nconst PATHS = {\n  app: path.join(__dirname, 'app'),\n  build: path.join(__dirname, 'build'),\n};\n\nmodule.exports = {\n  devServer: {\n    host: process.env.HOST,\n    port: 8090,\n+   overlay: {\n+     errors: true,\n+     warnings: true,\n+   },\n  },\n  entry: {\n    app: PATHS.app,\n  },\n  output: {\n    path: PATHS.build,\n    filename: '[name].js',\n  },\n  module: {\n    rules: [\n      {\n        test: /\\.js$/,\n        enforce: 'pre',\n\n        loader: 'eslint-loader',\n        options: {\n          emitWarning: true,\n        },\n      },\n    ],\n  },\n  plugins: [\n    new HtmlWebpackPlugin({\n      title: 'Webpack demo',\n    }),\n  ],\n};\n```\n\n### 添加 HMR(hot module replacement) 模块热更新\n\n在webpack.config.js添加相关配置\n\n```diff \nconst path = require('path');\nconst HtmlWebpackPlugin = require('html-webpack-plugin');\n+ const webpack  = require('webpack');\n\nconst PATHS = {\n  app: path.join(__dirname, 'app'),\n  build: path.join(__dirname, 'build'),\n};\n\nmodule.exports = {\n  devServer: {\n    host: process.env.HOST,\n    port: 8090,\n    overlay: {\n      errors: true,\n      warnings: true,\n    },\n+   hotOnly: true,\n  },\n  entry: {\n    app: PATHS.app,\n  },\n  output: {\n    path: PATHS.build,\n    filename: '[name].js',\n  },\n  module: {\n    rules: [\n      {\n        test: /\\.js$/,\n        enforce: 'pre',\n\n        loader: 'eslint-loader',\n        options: {\n          emitWarning: true,\n        },\n      },\n    ],\n  },\n  plugins: [\n    new HtmlWebpackPlugin({\n      title: 'Webpack demo',\n    }),\n+   new webpack.HotModuleReplacementPlugin(),\n  ],\n};\n```\n\n修改/app/index.js\n\n```diff \nimport print from './print';\n\nfunction component(text = 'hello world!') {\n    const element = document.createElement('div');\n    element.innerHTML = text;\n\n    const p = document.createElement('input');\n    p.type = 'checkbox';\n    element.appendChild(p);\n\n    const btn = document.createElement('button');\n    btn.id = 'btn';\n    btn.innerHTML = '点击';\n    btn.onclick = print.log;\n    element.appendChild(btn);\n\n    return element;\n}\n\ndocument.body.appendChild(component());\n\n+if (module.hot) {\n+    module.hot.accept('./print', () => {\n+        console.log('print热更新了');\n+        print.log();\n+    });\n+}\n```\n\n修改print.js console 有输出 但是点击按钮还是原来的输出\n\n修改/app/index.js\n\n```diff \nimport print from './print';\n\nfunction component(text = 'hello world!') {\n    const element = document.createElement('div');\n    element.innerHTML = text;\n\n    const p = document.createElement('input');\n    p.type = 'checkbox';\n    element.appendChild(p);\n\n    const btn = document.createElement('button');\n    btn.id = 'btn';\n    btn.innerHTML = '点击';\n    btn.onclick = print.log;\n    element.appendChild(btn);\n\n    return element;\n}\n\ndocument.body.appendChild(component());\n\nif (module.hot) {\n    module.hot.accept('./print', () => {\n        console.log('print热更新了');\n+       window.document.getElementById('btn').onclick = print.log;\n        print.log();\n    });\n}\n```\n\n修改print.js console 有输出 点击按钮是新的输出","slug":"WDS错误提示代码规范HMR的配置","published":1,"updated":"2019-02-20T02:50:38.439Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjsgue0ds0000gpi66gwzqcas","content":"<h2 id=\"项目结构\"><a href=\"#项目结构\" class=\"headerlink\" title=\"项目结构\"></a>项目结构</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/</span><br><span class=\"line\">├─ app</span><br><span class=\"line\">│   ├─ index.js</span><br><span class=\"line\">│   └─ print.js</span><br><span class=\"line\">├─ build</span><br><span class=\"line\">├─ package.json</span><br><span class=\"line\">└─ webpack.config.js</span><br></pre></td></tr></table></figure>\n<a id=\"more\"></a>\n<p>/app/index.js</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> print <span class=\"keyword\">from</span> <span class=\"string\">'./print'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">component</span>(<span class=\"params\">text = <span class=\"string\">'hello world!'</span></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> element = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'div'</span>);</span><br><span class=\"line\">    element.innerHTML = text;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> p = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'input'</span>);</span><br><span class=\"line\">    p.type = <span class=\"string\">'checkbox'</span>;</span><br><span class=\"line\">    element.appendChild(p);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> btn = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'button'</span>);</span><br><span class=\"line\">    btn.id = <span class=\"string\">'btn'</span>;</span><br><span class=\"line\">    btn.innerHTML = <span class=\"string\">'点击'</span>;</span><br><span class=\"line\">    btn.onclick = print.log;</span><br><span class=\"line\">    element.appendChild(btn);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> element;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">document</span>.body.appendChild(component());</span><br></pre></td></tr></table></figure>\n<p>/app/print.js</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">    log() &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'5678'</span>);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>/package.json</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"webpack-dev-server-demo\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"version\"</span>: <span class=\"string\">\"1.0.0\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"description\"</span>: <span class=\"string\">\"\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"main\"</span>: <span class=\"string\">\"index.js\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"scripts\"</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">\"test\"</span>: <span class=\"string\">\"echo \\\"Error: no test specified\\\" &amp;&amp; exit 1\"</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">\"keywords\"</span>: [],</span><br><span class=\"line\">    <span class=\"attr\">\"author\"</span>: <span class=\"string\">\"\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"license\"</span>: <span class=\"string\">\"ISC\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"devDependencies\"</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">\"html-webpack-plugin\"</span>: <span class=\"string\">\"^2.28.0\"</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"webpack\"</span>: <span class=\"string\">\"^2.3.2\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>/webpack.config.js</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> HtmlWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">'html-webpack-plugin'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> PATHS = &#123;</span><br><span class=\"line\">  <span class=\"attr\">app</span>: path.join(__dirname, <span class=\"string\">'app'</span>),</span><br><span class=\"line\">  <span class=\"attr\">build</span>: path.join(__dirname, <span class=\"string\">'build'</span>),</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  <span class=\"attr\">entry</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">app</span>: PATHS.app,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">output</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">path</span>: PATHS.build,</span><br><span class=\"line\">    <span class=\"attr\">filename</span>: <span class=\"string\">'[name].js'</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">plugins</span>: [</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      <span class=\"attr\">title</span>: <span class=\"string\">'Webpack demo'</span>,</span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ],</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install</span><br></pre></td></tr></table></figure>\n<h2 id=\"安装-WDS—-webpack-dev-server\"><a href=\"#安装-WDS—-webpack-dev-server\" class=\"headerlink\" title=\"安装 WDS—-webpack-dev-server\"></a>安装 WDS—-webpack-dev-server</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install webpack-dev-server --save-dev</span><br></pre></td></tr></table></figure>\n<h2 id=\"修改-package-json，-添加-script\"><a href=\"#修改-package-json，-添加-script\" class=\"headerlink\" title=\"修改 package.json， 添加 script:\"></a>修改 package.json， 添加 script:</h2><figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    \"name\": \"webpack-dev-server-demo\",</span><br><span class=\"line\">    \"version\": \"1.0.0\",</span><br><span class=\"line\">    \"description\": \"\",</span><br><span class=\"line\">    \"main\": \"index.js\",</span><br><span class=\"line\">    \"scripts\": &#123;</span><br><span class=\"line\"><span class=\"deletion\">-       \"test\": \"echo \\\"Error: no test specified\\\" &amp;&amp; exit 1\"</span></span><br><span class=\"line\"><span class=\"addition\">+       \"test\": \"echo \\\"Error: no test specified\\\" &amp;&amp; exit 1\",</span></span><br><span class=\"line\"><span class=\"addition\">+       \"start\": \"webpack-dev-server --env development\",</span></span><br><span class=\"line\"><span class=\"addition\">+       \"build\": \"webpack --env production\"</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    \"keywords\": [],</span><br><span class=\"line\">    \"author\": \"\",</span><br><span class=\"line\">    \"license\": \"ISC\",</span><br><span class=\"line\">    \"devDependencies\": &#123;</span><br><span class=\"line\">        \"html-webpack-plugin\": \"^2.28.0\",</span><br><span class=\"line\">        \"webpack\": \"^2.3.2\",</span><br><span class=\"line\">        \"webpack-dev-server\": \"^2.9.7\"</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"启动服务\"><a href=\"#启动服务\" class=\"headerlink\" title=\"启动服务\"></a>启动服务</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm start</span><br></pre></td></tr></table></figure>\n<p>浏览器中打开  <a href=\"http://localhost:8080/\" target=\"_blank\" rel=\"external\">http://localhost:8080/</a>，修改 /app/print.js 代码，页面会整体刷新。</p>\n<h2 id=\"WDS-端口号等配置相关\"><a href=\"#WDS-端口号等配置相关\" class=\"headerlink\" title=\"WDS 端口号等配置相关\"></a>WDS 端口号等配置相关</h2><p>修改 /webpack.config.js</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const path = require('path');</span><br><span class=\"line\">const HtmlWebpackPlugin = require('html-webpack-plugin');</span><br><span class=\"line\"></span><br><span class=\"line\">const PATHS = &#123;</span><br><span class=\"line\">  app: path.join(__dirname, 'app'),</span><br><span class=\"line\">  build: path.join(__dirname, 'build'),</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">module.exports = &#123;</span><br><span class=\"line\"><span class=\"addition\">+ devServer: &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+   host: process.env.HOST,</span></span><br><span class=\"line\"><span class=\"addition\">+   port: 8090,</span></span><br><span class=\"line\"><span class=\"addition\">+ &#125;,</span></span><br><span class=\"line\">  entry: &#123;</span><br><span class=\"line\">    app: PATHS.app,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  output: &#123;</span><br><span class=\"line\">    path: PATHS.build,</span><br><span class=\"line\">    filename: '[name].js',</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    new HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      title: 'Webpack demo',</span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ],</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm start</span><br></pre></td></tr></table></figure>\n<p>浏览器中打开  <a href=\"http://localhost:8090/\" target=\"_blank\" rel=\"external\">http://localhost:8090/</a></p>\n<h2 id=\"配置-ESLint-实现代码规范自动测试\"><a href=\"#配置-ESLint-实现代码规范自动测试\" class=\"headerlink\" title=\"配置 ESLint 实现代码规范自动测试\"></a>配置 <a href=\"http://eslint.cn/\" target=\"_blank\" rel=\"external\">ESLint</a> 实现代码规范自动测试</h2><h3 id=\"安装ESLint\"><a href=\"#安装ESLint\" class=\"headerlink\" title=\"安装ESLint\"></a>安装<code>ESLint</code></h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install eslint --save-dev</span><br></pre></td></tr></table></figure>\n<h3 id=\"修改-package-json\"><a href=\"#修改-package-json\" class=\"headerlink\" title=\"修改 /package.json\"></a>修改 /package.json</h3><figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  \"name\": \"webpack-dev-server-demo\",</span><br><span class=\"line\">  \"version\": \"1.0.0\",</span><br><span class=\"line\">  \"description\": \"\",</span><br><span class=\"line\">  \"main\": \"index.js\",</span><br><span class=\"line\">  \"scripts\": &#123;</span><br><span class=\"line\">    \"test\": \"echo \\\"Error: no test specified\\\" &amp;&amp; exit 1\",</span><br><span class=\"line\">    \"start\": \"webpack-dev-server --env development\",</span><br><span class=\"line\"><span class=\"deletion\">-   \"build\": \"webpack --env production\"</span></span><br><span class=\"line\"><span class=\"addition\">+   \"build\": \"webpack --env production\",</span></span><br><span class=\"line\"><span class=\"addition\">+   \"lintjs\": \"eslint app/ webpack.*.js --cache\"</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  \"keywords\": [],</span><br><span class=\"line\">  \"author\": \"\",</span><br><span class=\"line\">  \"license\": \"ISC\",</span><br><span class=\"line\">  \"devDependencies\": &#123;</span><br><span class=\"line\">    \"eslint\": \"^4.14.0\",</span><br><span class=\"line\">    \"html-webpack-plugin\": \"^2.28.0\",</span><br><span class=\"line\">    \"webpack\": \"^2.3.2\",</span><br><span class=\"line\">    \"webpack-dev-server\": \"^2.9.7\"</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"添加ESLint配置文件-eslintrc-js\"><a href=\"#添加ESLint配置文件-eslintrc-js\" class=\"headerlink\" title=\"添加ESLint配置文件 /.eslintrc.js\"></a>添加ESLint配置文件 /.eslintrc.js</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">    <span class=\"attr\">env</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">browser</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"attr\">commonjs</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"attr\">es6</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"attr\">node</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">extends</span>: <span class=\"string\">'eslint:recommended'</span>,</span><br><span class=\"line\">    <span class=\"attr\">parserOptions</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">sourceType</span>: <span class=\"string\">'module'</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">rules</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">'comma-dangle'</span>: [<span class=\"string\">'error'</span>, <span class=\"string\">'always-multiline'</span>],</span><br><span class=\"line\">        <span class=\"attr\">indent</span>: [<span class=\"string\">'error'</span>, <span class=\"number\">4</span>],</span><br><span class=\"line\">        <span class=\"string\">'linebreak-style'</span>: [<span class=\"string\">'error'</span>, <span class=\"string\">'unix'</span>],</span><br><span class=\"line\">        <span class=\"attr\">quotes</span>: [<span class=\"string\">'error'</span>, <span class=\"string\">'single'</span>],</span><br><span class=\"line\">        <span class=\"attr\">semi</span>: [<span class=\"string\">'error'</span>, <span class=\"string\">'always'</span>],</span><br><span class=\"line\">        <span class=\"string\">'no-unused-vars'</span>: [<span class=\"string\">'warn'</span>],</span><br><span class=\"line\">        <span class=\"string\">'no-console'</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h3 id=\"执行ESLint\"><a href=\"#执行ESLint\" class=\"headerlink\" title=\"执行ESLint\"></a>执行ESLint</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm run lintjs</span><br></pre></td></tr></table></figure>\n<h3 id=\"自动解决部分错误\"><a href=\"#自动解决部分错误\" class=\"headerlink\" title=\"自动解决部分错误\"></a>自动解决部分错误</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm run lintjs -- --fix</span><br></pre></td></tr></table></figure>\n<h3 id=\"在webpage中自动进行eslint\"><a href=\"#在webpage中自动进行eslint\" class=\"headerlink\" title=\"在webpage中自动进行eslint\"></a>在webpage中自动进行eslint</h3><p>安装 eslint-loader </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install eslint-loader --save-dev</span><br></pre></td></tr></table></figure>\n<p>在webpack.config.js添加相关配置</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const path = require('path');</span><br><span class=\"line\">const HtmlWebpackPlugin = require('html-webpack-plugin');</span><br><span class=\"line\"></span><br><span class=\"line\">const PATHS = &#123;</span><br><span class=\"line\">  app: path.join(__dirname, 'app'),</span><br><span class=\"line\">  build: path.join(__dirname, 'build'),</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">module.exports = &#123;</span><br><span class=\"line\">  devServer: &#123;</span><br><span class=\"line\">    host: process.env.HOST,</span><br><span class=\"line\">    port: 8090,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  entry: &#123;</span><br><span class=\"line\">    app: PATHS.app,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  output: &#123;</span><br><span class=\"line\">    path: PATHS.build,</span><br><span class=\"line\">    filename: '[name].js',</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\"><span class=\"addition\">+ module: &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+   rules: [</span></span><br><span class=\"line\"><span class=\"addition\">+     &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+       test: /\\.js$/,</span></span><br><span class=\"line\"><span class=\"addition\">+       enforce: 'pre', // 前置loader</span></span><br><span class=\"line\"><span class=\"addition\">+       loader: 'eslint-loader',</span></span><br><span class=\"line\"><span class=\"addition\">+       options: &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+         emitWarning: true, // 是否发出警告</span></span><br><span class=\"line\"><span class=\"addition\">+       &#125;,</span></span><br><span class=\"line\"><span class=\"addition\">+     &#125;,</span></span><br><span class=\"line\"><span class=\"addition\">+   ],</span></span><br><span class=\"line\"><span class=\"addition\">+ &#125;,</span></span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    new HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      title: 'Webpack demo',</span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ],</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>修改一个js，运行</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm start</span><br></pre></td></tr></table></figure>\n<p>出现错误，运行</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm run lintjs -- --fix</span><br></pre></td></tr></table></figure>\n<p>接着运行</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm start</span><br></pre></td></tr></table></figure>\n<h3 id=\"在浏览器中显示错误信息\"><a href=\"#在浏览器中显示错误信息\" class=\"headerlink\" title=\"在浏览器中显示错误信息\"></a>在浏览器中显示错误信息</h3><p>在webpack.config.js添加相关配置</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const path = require('path');</span><br><span class=\"line\">const HtmlWebpackPlugin = require('html-webpack-plugin');</span><br><span class=\"line\"></span><br><span class=\"line\">const PATHS = &#123;</span><br><span class=\"line\">  app: path.join(__dirname, 'app'),</span><br><span class=\"line\">  build: path.join(__dirname, 'build'),</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">module.exports = &#123;</span><br><span class=\"line\">  devServer: &#123;</span><br><span class=\"line\">    host: process.env.HOST,</span><br><span class=\"line\">    port: 8090,</span><br><span class=\"line\"><span class=\"addition\">+   overlay: &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+     errors: true,</span></span><br><span class=\"line\"><span class=\"addition\">+     warnings: true,</span></span><br><span class=\"line\"><span class=\"addition\">+   &#125;,</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  entry: &#123;</span><br><span class=\"line\">    app: PATHS.app,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  output: &#123;</span><br><span class=\"line\">    path: PATHS.build,</span><br><span class=\"line\">    filename: '[name].js',</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  module: &#123;</span><br><span class=\"line\">    rules: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: /\\.js$/,</span><br><span class=\"line\">        enforce: 'pre',</span><br><span class=\"line\"></span><br><span class=\"line\">        loader: 'eslint-loader',</span><br><span class=\"line\">        options: &#123;</span><br><span class=\"line\">          emitWarning: true,</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    new HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      title: 'Webpack demo',</span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ],</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h3 id=\"添加-HMR-hot-module-replacement-模块热更新\"><a href=\"#添加-HMR-hot-module-replacement-模块热更新\" class=\"headerlink\" title=\"添加 HMR(hot module replacement) 模块热更新\"></a>添加 HMR(hot module replacement) 模块热更新</h3><p>在webpack.config.js添加相关配置</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const path = require('path');</span><br><span class=\"line\">const HtmlWebpackPlugin = require('html-webpack-plugin');</span><br><span class=\"line\"><span class=\"addition\">+ const webpack  = require('webpack');</span></span><br><span class=\"line\"></span><br><span class=\"line\">const PATHS = &#123;</span><br><span class=\"line\">  app: path.join(__dirname, 'app'),</span><br><span class=\"line\">  build: path.join(__dirname, 'build'),</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">module.exports = &#123;</span><br><span class=\"line\">  devServer: &#123;</span><br><span class=\"line\">    host: process.env.HOST,</span><br><span class=\"line\">    port: 8090,</span><br><span class=\"line\">    overlay: &#123;</span><br><span class=\"line\">      errors: true,</span><br><span class=\"line\">      warnings: true,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"><span class=\"addition\">+   hotOnly: true,</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  entry: &#123;</span><br><span class=\"line\">    app: PATHS.app,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  output: &#123;</span><br><span class=\"line\">    path: PATHS.build,</span><br><span class=\"line\">    filename: '[name].js',</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  module: &#123;</span><br><span class=\"line\">    rules: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: /\\.js$/,</span><br><span class=\"line\">        enforce: 'pre',</span><br><span class=\"line\"></span><br><span class=\"line\">        loader: 'eslint-loader',</span><br><span class=\"line\">        options: &#123;</span><br><span class=\"line\">          emitWarning: true,</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    new HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      title: 'Webpack demo',</span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\"><span class=\"addition\">+   new webpack.HotModuleReplacementPlugin(),</span></span><br><span class=\"line\">  ],</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>修改/app/index.js</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import print from './print';</span><br><span class=\"line\"></span><br><span class=\"line\">function component(text = 'hello world!') &#123;</span><br><span class=\"line\">    const element = document.createElement('div');</span><br><span class=\"line\">    element.innerHTML = text;</span><br><span class=\"line\"></span><br><span class=\"line\">    const p = document.createElement('input');</span><br><span class=\"line\">    p.type = 'checkbox';</span><br><span class=\"line\">    element.appendChild(p);</span><br><span class=\"line\"></span><br><span class=\"line\">    const btn = document.createElement('button');</span><br><span class=\"line\">    btn.id = 'btn';</span><br><span class=\"line\">    btn.innerHTML = '点击';</span><br><span class=\"line\">    btn.onclick = print.log;</span><br><span class=\"line\">    element.appendChild(btn);</span><br><span class=\"line\"></span><br><span class=\"line\">    return element;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">document.body.appendChild(component());</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"addition\">+if (module.hot) &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+    module.hot.accept('./print', () =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+        console.log('print热更新了');</span></span><br><span class=\"line\"><span class=\"addition\">+        print.log();</span></span><br><span class=\"line\"><span class=\"addition\">+    &#125;);</span></span><br><span class=\"line\"><span class=\"addition\">+&#125;</span></span><br></pre></td></tr></table></figure>\n<p>修改print.js console 有输出 但是点击按钮还是原来的输出</p>\n<p>修改/app/index.js</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import print from './print';</span><br><span class=\"line\"></span><br><span class=\"line\">function component(text = 'hello world!') &#123;</span><br><span class=\"line\">    const element = document.createElement('div');</span><br><span class=\"line\">    element.innerHTML = text;</span><br><span class=\"line\"></span><br><span class=\"line\">    const p = document.createElement('input');</span><br><span class=\"line\">    p.type = 'checkbox';</span><br><span class=\"line\">    element.appendChild(p);</span><br><span class=\"line\"></span><br><span class=\"line\">    const btn = document.createElement('button');</span><br><span class=\"line\">    btn.id = 'btn';</span><br><span class=\"line\">    btn.innerHTML = '点击';</span><br><span class=\"line\">    btn.onclick = print.log;</span><br><span class=\"line\">    element.appendChild(btn);</span><br><span class=\"line\"></span><br><span class=\"line\">    return element;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">document.body.appendChild(component());</span><br><span class=\"line\"></span><br><span class=\"line\">if (module.hot) &#123;</span><br><span class=\"line\">    module.hot.accept('./print', () =&gt; &#123;</span><br><span class=\"line\">        console.log('print热更新了');</span><br><span class=\"line\"><span class=\"addition\">+       window.document.getElementById('btn').onclick = print.log;</span></span><br><span class=\"line\">        print.log();</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>修改print.js console 有输出 点击按钮是新的输出</p>\n","excerpt":"<h2 id=\"项目结构\"><a href=\"#项目结构\" class=\"headerlink\" title=\"项目结构\"></a>项目结构</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/</span><br><span class=\"line\">├─ app</span><br><span class=\"line\">│   ├─ index.js</span><br><span class=\"line\">│   └─ print.js</span><br><span class=\"line\">├─ build</span><br><span class=\"line\">├─ package.json</span><br><span class=\"line\">└─ webpack.config.js</span><br></pre></td></tr></table></figure>","more":"<p>/app/index.js</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> print <span class=\"keyword\">from</span> <span class=\"string\">'./print'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">component</span>(<span class=\"params\">text = <span class=\"string\">'hello world!'</span></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> element = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'div'</span>);</span><br><span class=\"line\">    element.innerHTML = text;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> p = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'input'</span>);</span><br><span class=\"line\">    p.type = <span class=\"string\">'checkbox'</span>;</span><br><span class=\"line\">    element.appendChild(p);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> btn = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'button'</span>);</span><br><span class=\"line\">    btn.id = <span class=\"string\">'btn'</span>;</span><br><span class=\"line\">    btn.innerHTML = <span class=\"string\">'点击'</span>;</span><br><span class=\"line\">    btn.onclick = print.log;</span><br><span class=\"line\">    element.appendChild(btn);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> element;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">document</span>.body.appendChild(component());</span><br></pre></td></tr></table></figure>\n<p>/app/print.js</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">    log() &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'5678'</span>);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>/package.json</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"webpack-dev-server-demo\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"version\"</span>: <span class=\"string\">\"1.0.0\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"description\"</span>: <span class=\"string\">\"\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"main\"</span>: <span class=\"string\">\"index.js\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"scripts\"</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">\"test\"</span>: <span class=\"string\">\"echo \\\"Error: no test specified\\\" &amp;&amp; exit 1\"</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">\"keywords\"</span>: [],</span><br><span class=\"line\">    <span class=\"attr\">\"author\"</span>: <span class=\"string\">\"\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"license\"</span>: <span class=\"string\">\"ISC\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"devDependencies\"</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">\"html-webpack-plugin\"</span>: <span class=\"string\">\"^2.28.0\"</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"webpack\"</span>: <span class=\"string\">\"^2.3.2\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>/webpack.config.js</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> HtmlWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">'html-webpack-plugin'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> PATHS = &#123;</span><br><span class=\"line\">  <span class=\"attr\">app</span>: path.join(__dirname, <span class=\"string\">'app'</span>),</span><br><span class=\"line\">  <span class=\"attr\">build</span>: path.join(__dirname, <span class=\"string\">'build'</span>),</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  <span class=\"attr\">entry</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">app</span>: PATHS.app,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">output</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">path</span>: PATHS.build,</span><br><span class=\"line\">    <span class=\"attr\">filename</span>: <span class=\"string\">'[name].js'</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">plugins</span>: [</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      <span class=\"attr\">title</span>: <span class=\"string\">'Webpack demo'</span>,</span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ],</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h2 id=\"初始化项目\"><a href=\"#初始化项目\" class=\"headerlink\" title=\"初始化项目\"></a>初始化项目</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install</span><br></pre></td></tr></table></figure>\n<h2 id=\"安装-WDS—-webpack-dev-server\"><a href=\"#安装-WDS—-webpack-dev-server\" class=\"headerlink\" title=\"安装 WDS—-webpack-dev-server\"></a>安装 WDS—-webpack-dev-server</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install webpack-dev-server --save-dev</span><br></pre></td></tr></table></figure>\n<h2 id=\"修改-package-json，-添加-script\"><a href=\"#修改-package-json，-添加-script\" class=\"headerlink\" title=\"修改 package.json， 添加 script:\"></a>修改 package.json， 添加 script:</h2><figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    \"name\": \"webpack-dev-server-demo\",</span><br><span class=\"line\">    \"version\": \"1.0.0\",</span><br><span class=\"line\">    \"description\": \"\",</span><br><span class=\"line\">    \"main\": \"index.js\",</span><br><span class=\"line\">    \"scripts\": &#123;</span><br><span class=\"line\"><span class=\"deletion\">-       \"test\": \"echo \\\"Error: no test specified\\\" &amp;&amp; exit 1\"</span></span><br><span class=\"line\"><span class=\"addition\">+       \"test\": \"echo \\\"Error: no test specified\\\" &amp;&amp; exit 1\",</span></span><br><span class=\"line\"><span class=\"addition\">+       \"start\": \"webpack-dev-server --env development\",</span></span><br><span class=\"line\"><span class=\"addition\">+       \"build\": \"webpack --env production\"</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    \"keywords\": [],</span><br><span class=\"line\">    \"author\": \"\",</span><br><span class=\"line\">    \"license\": \"ISC\",</span><br><span class=\"line\">    \"devDependencies\": &#123;</span><br><span class=\"line\">        \"html-webpack-plugin\": \"^2.28.0\",</span><br><span class=\"line\">        \"webpack\": \"^2.3.2\",</span><br><span class=\"line\">        \"webpack-dev-server\": \"^2.9.7\"</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"启动服务\"><a href=\"#启动服务\" class=\"headerlink\" title=\"启动服务\"></a>启动服务</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm start</span><br></pre></td></tr></table></figure>\n<p>浏览器中打开  <a href=\"http://localhost:8080/\">http://localhost:8080/</a>，修改 /app/print.js 代码，页面会整体刷新。</p>\n<h2 id=\"WDS-端口号等配置相关\"><a href=\"#WDS-端口号等配置相关\" class=\"headerlink\" title=\"WDS 端口号等配置相关\"></a>WDS 端口号等配置相关</h2><p>修改 /webpack.config.js</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const path = require('path');</span><br><span class=\"line\">const HtmlWebpackPlugin = require('html-webpack-plugin');</span><br><span class=\"line\"></span><br><span class=\"line\">const PATHS = &#123;</span><br><span class=\"line\">  app: path.join(__dirname, 'app'),</span><br><span class=\"line\">  build: path.join(__dirname, 'build'),</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">module.exports = &#123;</span><br><span class=\"line\"><span class=\"addition\">+ devServer: &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+   host: process.env.HOST,</span></span><br><span class=\"line\"><span class=\"addition\">+   port: 8090,</span></span><br><span class=\"line\"><span class=\"addition\">+ &#125;,</span></span><br><span class=\"line\">  entry: &#123;</span><br><span class=\"line\">    app: PATHS.app,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  output: &#123;</span><br><span class=\"line\">    path: PATHS.build,</span><br><span class=\"line\">    filename: '[name].js',</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    new HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      title: 'Webpack demo',</span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ],</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm start</span><br></pre></td></tr></table></figure>\n<p>浏览器中打开  <a href=\"http://localhost:8090/\">http://localhost:8090/</a></p>\n<h2 id=\"配置-ESLint-实现代码规范自动测试\"><a href=\"#配置-ESLint-实现代码规范自动测试\" class=\"headerlink\" title=\"配置 ESLint 实现代码规范自动测试\"></a>配置 <a href=\"http://eslint.cn/\">ESLint</a> 实现代码规范自动测试</h2><h3 id=\"安装ESLint\"><a href=\"#安装ESLint\" class=\"headerlink\" title=\"安装ESLint\"></a>安装<code>ESLint</code></h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install eslint --save-dev</span><br></pre></td></tr></table></figure>\n<h3 id=\"修改-package-json\"><a href=\"#修改-package-json\" class=\"headerlink\" title=\"修改 /package.json\"></a>修改 /package.json</h3><figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  \"name\": \"webpack-dev-server-demo\",</span><br><span class=\"line\">  \"version\": \"1.0.0\",</span><br><span class=\"line\">  \"description\": \"\",</span><br><span class=\"line\">  \"main\": \"index.js\",</span><br><span class=\"line\">  \"scripts\": &#123;</span><br><span class=\"line\">    \"test\": \"echo \\\"Error: no test specified\\\" &amp;&amp; exit 1\",</span><br><span class=\"line\">    \"start\": \"webpack-dev-server --env development\",</span><br><span class=\"line\"><span class=\"deletion\">-   \"build\": \"webpack --env production\"</span></span><br><span class=\"line\"><span class=\"addition\">+   \"build\": \"webpack --env production\",</span></span><br><span class=\"line\"><span class=\"addition\">+   \"lintjs\": \"eslint app/ webpack.*.js --cache\"</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  \"keywords\": [],</span><br><span class=\"line\">  \"author\": \"\",</span><br><span class=\"line\">  \"license\": \"ISC\",</span><br><span class=\"line\">  \"devDependencies\": &#123;</span><br><span class=\"line\">    \"eslint\": \"^4.14.0\",</span><br><span class=\"line\">    \"html-webpack-plugin\": \"^2.28.0\",</span><br><span class=\"line\">    \"webpack\": \"^2.3.2\",</span><br><span class=\"line\">    \"webpack-dev-server\": \"^2.9.7\"</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"添加ESLint配置文件-eslintrc-js\"><a href=\"#添加ESLint配置文件-eslintrc-js\" class=\"headerlink\" title=\"添加ESLint配置文件 /.eslintrc.js\"></a>添加ESLint配置文件 /.eslintrc.js</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">    <span class=\"attr\">env</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">browser</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"attr\">commonjs</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"attr\">es6</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"attr\">node</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">extends</span>: <span class=\"string\">'eslint:recommended'</span>,</span><br><span class=\"line\">    <span class=\"attr\">parserOptions</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">sourceType</span>: <span class=\"string\">'module'</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">rules</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">'comma-dangle'</span>: [<span class=\"string\">'error'</span>, <span class=\"string\">'always-multiline'</span>],</span><br><span class=\"line\">        <span class=\"attr\">indent</span>: [<span class=\"string\">'error'</span>, <span class=\"number\">4</span>],</span><br><span class=\"line\">        <span class=\"string\">'linebreak-style'</span>: [<span class=\"string\">'error'</span>, <span class=\"string\">'unix'</span>],</span><br><span class=\"line\">        <span class=\"attr\">quotes</span>: [<span class=\"string\">'error'</span>, <span class=\"string\">'single'</span>],</span><br><span class=\"line\">        <span class=\"attr\">semi</span>: [<span class=\"string\">'error'</span>, <span class=\"string\">'always'</span>],</span><br><span class=\"line\">        <span class=\"string\">'no-unused-vars'</span>: [<span class=\"string\">'warn'</span>],</span><br><span class=\"line\">        <span class=\"string\">'no-console'</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h3 id=\"执行ESLint\"><a href=\"#执行ESLint\" class=\"headerlink\" title=\"执行ESLint\"></a>执行ESLint</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm run lintjs</span><br></pre></td></tr></table></figure>\n<h3 id=\"自动解决部分错误\"><a href=\"#自动解决部分错误\" class=\"headerlink\" title=\"自动解决部分错误\"></a>自动解决部分错误</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm run lintjs -- --fix</span><br></pre></td></tr></table></figure>\n<h3 id=\"在webpage中自动进行eslint\"><a href=\"#在webpage中自动进行eslint\" class=\"headerlink\" title=\"在webpage中自动进行eslint\"></a>在webpage中自动进行eslint</h3><p>安装 eslint-loader </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install eslint-loader --save-dev</span><br></pre></td></tr></table></figure>\n<p>在webpack.config.js添加相关配置</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const path = require('path');</span><br><span class=\"line\">const HtmlWebpackPlugin = require('html-webpack-plugin');</span><br><span class=\"line\"></span><br><span class=\"line\">const PATHS = &#123;</span><br><span class=\"line\">  app: path.join(__dirname, 'app'),</span><br><span class=\"line\">  build: path.join(__dirname, 'build'),</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">module.exports = &#123;</span><br><span class=\"line\">  devServer: &#123;</span><br><span class=\"line\">    host: process.env.HOST,</span><br><span class=\"line\">    port: 8090,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  entry: &#123;</span><br><span class=\"line\">    app: PATHS.app,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  output: &#123;</span><br><span class=\"line\">    path: PATHS.build,</span><br><span class=\"line\">    filename: '[name].js',</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\"><span class=\"addition\">+ module: &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+   rules: [</span></span><br><span class=\"line\"><span class=\"addition\">+     &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+       test: /\\.js$/,</span></span><br><span class=\"line\"><span class=\"addition\">+       enforce: 'pre', // 前置loader</span></span><br><span class=\"line\"><span class=\"addition\">+       loader: 'eslint-loader',</span></span><br><span class=\"line\"><span class=\"addition\">+       options: &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+         emitWarning: true, // 是否发出警告</span></span><br><span class=\"line\"><span class=\"addition\">+       &#125;,</span></span><br><span class=\"line\"><span class=\"addition\">+     &#125;,</span></span><br><span class=\"line\"><span class=\"addition\">+   ],</span></span><br><span class=\"line\"><span class=\"addition\">+ &#125;,</span></span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    new HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      title: 'Webpack demo',</span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ],</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>修改一个js，运行</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm start</span><br></pre></td></tr></table></figure>\n<p>出现错误，运行</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm run lintjs -- --fix</span><br></pre></td></tr></table></figure>\n<p>接着运行</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm start</span><br></pre></td></tr></table></figure>\n<h3 id=\"在浏览器中显示错误信息\"><a href=\"#在浏览器中显示错误信息\" class=\"headerlink\" title=\"在浏览器中显示错误信息\"></a>在浏览器中显示错误信息</h3><p>在webpack.config.js添加相关配置</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const path = require('path');</span><br><span class=\"line\">const HtmlWebpackPlugin = require('html-webpack-plugin');</span><br><span class=\"line\"></span><br><span class=\"line\">const PATHS = &#123;</span><br><span class=\"line\">  app: path.join(__dirname, 'app'),</span><br><span class=\"line\">  build: path.join(__dirname, 'build'),</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">module.exports = &#123;</span><br><span class=\"line\">  devServer: &#123;</span><br><span class=\"line\">    host: process.env.HOST,</span><br><span class=\"line\">    port: 8090,</span><br><span class=\"line\"><span class=\"addition\">+   overlay: &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+     errors: true,</span></span><br><span class=\"line\"><span class=\"addition\">+     warnings: true,</span></span><br><span class=\"line\"><span class=\"addition\">+   &#125;,</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  entry: &#123;</span><br><span class=\"line\">    app: PATHS.app,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  output: &#123;</span><br><span class=\"line\">    path: PATHS.build,</span><br><span class=\"line\">    filename: '[name].js',</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  module: &#123;</span><br><span class=\"line\">    rules: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: /\\.js$/,</span><br><span class=\"line\">        enforce: 'pre',</span><br><span class=\"line\"></span><br><span class=\"line\">        loader: 'eslint-loader',</span><br><span class=\"line\">        options: &#123;</span><br><span class=\"line\">          emitWarning: true,</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    new HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      title: 'Webpack demo',</span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">  ],</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h3 id=\"添加-HMR-hot-module-replacement-模块热更新\"><a href=\"#添加-HMR-hot-module-replacement-模块热更新\" class=\"headerlink\" title=\"添加 HMR(hot module replacement) 模块热更新\"></a>添加 HMR(hot module replacement) 模块热更新</h3><p>在webpack.config.js添加相关配置</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const path = require('path');</span><br><span class=\"line\">const HtmlWebpackPlugin = require('html-webpack-plugin');</span><br><span class=\"line\"><span class=\"addition\">+ const webpack  = require('webpack');</span></span><br><span class=\"line\"></span><br><span class=\"line\">const PATHS = &#123;</span><br><span class=\"line\">  app: path.join(__dirname, 'app'),</span><br><span class=\"line\">  build: path.join(__dirname, 'build'),</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">module.exports = &#123;</span><br><span class=\"line\">  devServer: &#123;</span><br><span class=\"line\">    host: process.env.HOST,</span><br><span class=\"line\">    port: 8090,</span><br><span class=\"line\">    overlay: &#123;</span><br><span class=\"line\">      errors: true,</span><br><span class=\"line\">      warnings: true,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"><span class=\"addition\">+   hotOnly: true,</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  entry: &#123;</span><br><span class=\"line\">    app: PATHS.app,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  output: &#123;</span><br><span class=\"line\">    path: PATHS.build,</span><br><span class=\"line\">    filename: '[name].js',</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  module: &#123;</span><br><span class=\"line\">    rules: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: /\\.js$/,</span><br><span class=\"line\">        enforce: 'pre',</span><br><span class=\"line\"></span><br><span class=\"line\">        loader: 'eslint-loader',</span><br><span class=\"line\">        options: &#123;</span><br><span class=\"line\">          emitWarning: true,</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    new HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      title: 'Webpack demo',</span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\"><span class=\"addition\">+   new webpack.HotModuleReplacementPlugin(),</span></span><br><span class=\"line\">  ],</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>修改/app/index.js</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import print from './print';</span><br><span class=\"line\"></span><br><span class=\"line\">function component(text = 'hello world!') &#123;</span><br><span class=\"line\">    const element = document.createElement('div');</span><br><span class=\"line\">    element.innerHTML = text;</span><br><span class=\"line\"></span><br><span class=\"line\">    const p = document.createElement('input');</span><br><span class=\"line\">    p.type = 'checkbox';</span><br><span class=\"line\">    element.appendChild(p);</span><br><span class=\"line\"></span><br><span class=\"line\">    const btn = document.createElement('button');</span><br><span class=\"line\">    btn.id = 'btn';</span><br><span class=\"line\">    btn.innerHTML = '点击';</span><br><span class=\"line\">    btn.onclick = print.log;</span><br><span class=\"line\">    element.appendChild(btn);</span><br><span class=\"line\"></span><br><span class=\"line\">    return element;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">document.body.appendChild(component());</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"addition\">+if (module.hot) &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+    module.hot.accept('./print', () =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+        console.log('print热更新了');</span></span><br><span class=\"line\"><span class=\"addition\">+        print.log();</span></span><br><span class=\"line\"><span class=\"addition\">+    &#125;);</span></span><br><span class=\"line\"><span class=\"addition\">+&#125;</span></span><br></pre></td></tr></table></figure>\n<p>修改print.js console 有输出 但是点击按钮还是原来的输出</p>\n<p>修改/app/index.js</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import print from './print';</span><br><span class=\"line\"></span><br><span class=\"line\">function component(text = 'hello world!') &#123;</span><br><span class=\"line\">    const element = document.createElement('div');</span><br><span class=\"line\">    element.innerHTML = text;</span><br><span class=\"line\"></span><br><span class=\"line\">    const p = document.createElement('input');</span><br><span class=\"line\">    p.type = 'checkbox';</span><br><span class=\"line\">    element.appendChild(p);</span><br><span class=\"line\"></span><br><span class=\"line\">    const btn = document.createElement('button');</span><br><span class=\"line\">    btn.id = 'btn';</span><br><span class=\"line\">    btn.innerHTML = '点击';</span><br><span class=\"line\">    btn.onclick = print.log;</span><br><span class=\"line\">    element.appendChild(btn);</span><br><span class=\"line\"></span><br><span class=\"line\">    return element;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">document.body.appendChild(component());</span><br><span class=\"line\"></span><br><span class=\"line\">if (module.hot) &#123;</span><br><span class=\"line\">    module.hot.accept('./print', () =&gt; &#123;</span><br><span class=\"line\">        console.log('print热更新了');</span><br><span class=\"line\"><span class=\"addition\">+       window.document.getElementById('btn').onclick = print.log;</span></span><br><span class=\"line\">        print.log();</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>修改print.js console 有输出 点击按钮是新的输出</p>"},{"title":"react hooks（钩子）概览和一些实践","date":"2019-02-22T12:13:15.000Z","_content":">钩子是 React 16.8中的新增功能。它们允许您在不编写类的情况下使用 state 和其他 React 功能。\n\n钩子是向下兼容的。在我介绍向你介绍这个新功能前你最好对 React 有所了解。\n\n<!--more-->\n\n## 状态钩子\n\n下面是个计数器的事例。当你点击按钮时，数值就会增加：\n\n```JSX\nimport React, { useState } from 'react';\n\nfunction Example() {\n  // 声明一个新的状态变量，我们将其称为“count”\n  const [count, setCount] = useState(0);\n\n  return (\n    <div>\n      <p>You clicked {count} times</p>\n      <button onClick={() => setCount(count + 1)}>\n        Click me\n      </button>\n    </div>\n  );\n}\n```\n\n在这里 `useState` 就是一个钩子（过会我们再说这样做的意义）。在函数组件里面使用钩子为函数组件添加内部状态。React 将在每次渲染之间保留此状态。`useState` 方法会返回一个长度为2的数组。第一个元素就是你定义的状态，第二个元素就是用来更新这个状态的方法。你可以在处理事件的时候来调取这个方法。这个和类里面的 `this.setState` 和像，但是他不能像 `this.setState` 那样同时合并新旧状态。\n\n`useState` 接受一个参数作为状态的初始值。在刚刚的事例中，这个值就是 `0`，因为通常计算都是从零开始的。但是不同于 `this.state`，钩子的状态不一定必须是对象。初始状态参数只在第一次渲染的时使用。\n\n## 声明多个状态变量\n\n你可以在同一个组件里面定义多个状态钩子\n\n```JSX\nfunction ExampleWithManyStates() {\n  // 声明多个状态变量！\n  const [age, setAge] = useState(42);\n  const [fruit, setFruit] = useState('banana');\n  const [todos, setTodos] = useState([{ text: 'Learn Hooks' }]);\n  // ...\n}\n```\n\n数组解构语法允许我们为通过调用 `useState` 声明的状态变量赋予不同的名称。命名并不是 `useState` API的一部分。React 假设如果多次调用 `useState`，则在每次渲染期间以相同的顺序执行。下面我们将讨论为什么要这样做，以及何时使用他。\n\n## 什么是钩子？\n\n钩子函数可以使你的函数组件拥有 React state 和生命周期功能。钩子在类内部不起作用----它们允许你在没有类的情况下使用 React。（我们并不建议你重写你现有的组件，但是你可以在新的组件里面使用钩子。）\n\nReact 提供了一些像 `useState` 这样的内置钩子。你还可以创建自己的钩子以复用不同组件之间的状态行为。我们先来看看内置的钩子。\n\n## 作用钩子\n\n在 React 组件修改 DOM 前你一般都需要获取数据。我们管这种操作叫 `“side effects”（副作用）`（有时也简称“effects”），因为他们功能同时影响其他组件并且渲染无法完成。\n\n副作用钩子 `useEffect` 为组件添加了执行副作用操作的功能。这个与 React 类中的 `componentDidMount`，`componentDidUpdate` 和 `componentWillUnmount` 具有相同的用途，但是统一成为了一个API。（过会我们将展示一个使用 `useEffect` 副作用钩子的函数。 ）\n\n例如，此组件在 React 更新 DOM 后设置文档标题：\n\n```JSX\nimport React, { useState, useEffect } from 'react';\n\nfunction Example() {\n  const [count, setCount] = useState(0);\n\n  // 类似 componentDidMount 和 componentDidUpdate:\n  useEffect(() => {\n    // 通过浏览器的 API 更新文档的标题\n    document.title = `You clicked ${count} times`;\n  });\n\n  return (\n    <div>\n      <p>You clicked {count} times</p>\n      <button onClick={() => setCount(count + 1)}>\n        Click me\n      </button>\n    </div>\n  );\n}\n```\n\n但你调用 `useEffect` 的时候，你就在告诉 React 在重新渲染 DOM 之后执行你的作用函数。副作用函数是在组件内声明，因此可以访问其 props 和 state。默认情况下 React 在每次渲染后都会执行作用函数----同样包括第一次渲染。（我们将更多地讨论如何使用效果钩，以及他与类的生命周期的差异。）\n\n作用函数还可以根据返回函数来指定如何“清理”它们。例如，下面这个组件使用作用函数来订阅朋友的在线状态，并通过取消订阅来清理状态：\n\n```JSX\nimport React, { useState, useEffect } from 'react';\n\nfunction FriendStatus(props) {\n  const [isOnline, setIsOnline] = useState(null);\n\n  function handleStatusChange(status) {\n    setIsOnline(status.isOnline);\n  }\n\n  useEffect(() => {\n    ChatAPI.subscribeToFriendStatus(props.friend.id, handleStatusChange);\n\n    return () => {\n      ChatAPI.unsubscribeFromFriendStatus(props.friend.id, handleStatusChange);\n    };\n  });\n\n  if (isOnline === null) {\n    return 'Loading...';\n  }\n  return isOnline ? 'Online' : 'Offline';\n}\n```\n\n在这个事例中， React 会在组件销毁的时候通过 `ChatAPI` 来取消订阅。而且每次渲染的时候都会重新执行效果函数。（甚至当传递给 `ChatAPI` 的  `props.friend.id` 没有改变的情况下可以告诉 React 忽略重新订阅。）\n\n就像使用 `useState` 一样，您可以在组件中使用多个作用函数：\n\n```JSX\nfunction FriendStatusWithCounter(props) {\n  const [count, setCount] = useState(0);\n  useEffect(() => {\n    document.title = `You clicked ${count} times`;\n  });\n\n  const [isOnline, setIsOnline] = useState(null);\n  useEffect(() => {\n    ChatAPI.subscribeToFriendStatus(props.friend.id, handleStatusChange);\n    return () => {\n      ChatAPI.unsubscribeFromFriendStatus(props.friend.id, handleStatusChange);\n    };\n  });\n\n  function handleStatusChange(status) {\n    setIsOnline(status.isOnline);\n  }\n  // ...\n```\n\n通过钩子，您可以根据需要组织组件中的副作用函数（例如添加和删除订阅），而不是强制通过生命周期的函数进行处理。\n\n## 钩子的规则\n\n钩子本质就是一个 JavaScript 函数，但是他有两个特殊的规则：\n\n* 只能在 **顶层** 调用钩子。不要在循环，条件或嵌套函数中调用钩子。\n\n* 只能在 React 函数组件中调用钩子。不要在一般的 JavaScript 函数里调用钩子。（还有一个可以调用钩子的地方----自定义钩子。马上我们就会了解他。）\n\n## 自定义钩子\n\n有时，我们希望在组件之间复用一些有状态逻辑。一般有两个方法解决这个问题：`高价组件` 和 `渲染参数（render  props）`。自定义钩子可以在不添加组件的情况下解决上面的问题。\n\n前面我们介绍了一个通过 `useState` 和 `useEffect` 钩子来订阅朋友在线状态的组件。现在我们想把这个订阅的逻辑使用到其他组件中去。\n\n首先我们将创建自定义钩子组件 `useFriendStatus` 用来封装这个逻辑。\n\n```JSX\nimport React, { useState, useEffect } from 'react';\n\nfunction useFriendStatus(friendID) {\n  const [isOnline, setIsOnline] = useState(null);\n\n  function handleStatusChange(status) {\n    setIsOnline(status.isOnline);\n  }\n\n  useEffect(() => {\n    ChatAPI.subscribeToFriendStatus(friendID, handleStatusChange);\n    return () => {\n      ChatAPI.unsubscribeFromFriendStatus(friendID, handleStatusChange);\n    };\n  });\n\n  return isOnline;\n}\n```\n\n使用 `friendID` 作为参数，并返回我们的朋友是否在线。\n\n现在我们可以在其他组件中使用它：\n\n```JSX\nfunction FriendStatus(props) {\n  const isOnline = useFriendStatus(props.friend.id);\n\n  if (isOnline === null) {\n    return 'Loading...';\n  }\n  return isOnline ? 'Online' : 'Offline';\n}\n```\n\n```JSX\nfunction FriendListItem(props) {\n  const isOnline = useFriendStatus(props.friend.id);\n\n  return (\n    <li style={{ color: isOnline ? 'green' : 'black' }}>\n      {props.friend.name}\n    </li>\n  );\n}\n```\n\n这些组件的状态完全独立。钩子只是复用 *状态逻辑*` 的一种方式，而不是状态本身。事实上，每次调用钩子都有一个完全孤立的状态----所以你甚至可以在一个组件中使用两次相同的自定义钩子。\n\n您可以编写自定义钩子，涵盖各种用例，如表单处理，动画，声明订阅，计时器，以及可能还有更多我们想到的用例。我们希望自定义钩子可以在 React 社区火起来。\n\n## 其他钩子\n\n你可能会发现一些不太常用的内置钩子也很有用。例如，`useContext` 允许你在不引入嵌套的情况下订阅 React 上下文：\n\n```JSX\nfunction Example() {\n  const locale = useContext(LocaleContext);\n  const theme = useContext(ThemeContext);\n  // ...\n}\n```\n\n`useReducer` 允许你使用 reducer 管理复杂组件的本地状态：\n\n```JSX\nfunction Todos() {\n  const [todos, dispatch] = useReducer(todosReducer);\n  // ...\n```\n\n## 推荐阅读\n* [添加钩子功能的初衷](https://reactjs.org/docs/hooks-intro.html)\n* [状态钩子](https://reactjs.org/docs/hooks-state.html)\n* [钩子API介绍](https://reactjs.org/docs/hooks-reference.html)\n* [钩子常见问题](https://reactjs.org/docs/hooks-faq.html)\n\n","source":"_posts/react-hooks-概览.md","raw":"---\ntitle: react hooks（钩子）概览和一些实践\ndate: 2019-02-22 20:13:15\ntags: ['react','hooks','useState','useEffect','钩子','自定义钩子']\ncategory: 'coding'\n---\n>钩子是 React 16.8中的新增功能。它们允许您在不编写类的情况下使用 state 和其他 React 功能。\n\n钩子是向下兼容的。在我介绍向你介绍这个新功能前你最好对 React 有所了解。\n\n<!--more-->\n\n## 状态钩子\n\n下面是个计数器的事例。当你点击按钮时，数值就会增加：\n\n```JSX\nimport React, { useState } from 'react';\n\nfunction Example() {\n  // 声明一个新的状态变量，我们将其称为“count”\n  const [count, setCount] = useState(0);\n\n  return (\n    <div>\n      <p>You clicked {count} times</p>\n      <button onClick={() => setCount(count + 1)}>\n        Click me\n      </button>\n    </div>\n  );\n}\n```\n\n在这里 `useState` 就是一个钩子（过会我们再说这样做的意义）。在函数组件里面使用钩子为函数组件添加内部状态。React 将在每次渲染之间保留此状态。`useState` 方法会返回一个长度为2的数组。第一个元素就是你定义的状态，第二个元素就是用来更新这个状态的方法。你可以在处理事件的时候来调取这个方法。这个和类里面的 `this.setState` 和像，但是他不能像 `this.setState` 那样同时合并新旧状态。\n\n`useState` 接受一个参数作为状态的初始值。在刚刚的事例中，这个值就是 `0`，因为通常计算都是从零开始的。但是不同于 `this.state`，钩子的状态不一定必须是对象。初始状态参数只在第一次渲染的时使用。\n\n## 声明多个状态变量\n\n你可以在同一个组件里面定义多个状态钩子\n\n```JSX\nfunction ExampleWithManyStates() {\n  // 声明多个状态变量！\n  const [age, setAge] = useState(42);\n  const [fruit, setFruit] = useState('banana');\n  const [todos, setTodos] = useState([{ text: 'Learn Hooks' }]);\n  // ...\n}\n```\n\n数组解构语法允许我们为通过调用 `useState` 声明的状态变量赋予不同的名称。命名并不是 `useState` API的一部分。React 假设如果多次调用 `useState`，则在每次渲染期间以相同的顺序执行。下面我们将讨论为什么要这样做，以及何时使用他。\n\n## 什么是钩子？\n\n钩子函数可以使你的函数组件拥有 React state 和生命周期功能。钩子在类内部不起作用----它们允许你在没有类的情况下使用 React。（我们并不建议你重写你现有的组件，但是你可以在新的组件里面使用钩子。）\n\nReact 提供了一些像 `useState` 这样的内置钩子。你还可以创建自己的钩子以复用不同组件之间的状态行为。我们先来看看内置的钩子。\n\n## 作用钩子\n\n在 React 组件修改 DOM 前你一般都需要获取数据。我们管这种操作叫 `“side effects”（副作用）`（有时也简称“effects”），因为他们功能同时影响其他组件并且渲染无法完成。\n\n副作用钩子 `useEffect` 为组件添加了执行副作用操作的功能。这个与 React 类中的 `componentDidMount`，`componentDidUpdate` 和 `componentWillUnmount` 具有相同的用途，但是统一成为了一个API。（过会我们将展示一个使用 `useEffect` 副作用钩子的函数。 ）\n\n例如，此组件在 React 更新 DOM 后设置文档标题：\n\n```JSX\nimport React, { useState, useEffect } from 'react';\n\nfunction Example() {\n  const [count, setCount] = useState(0);\n\n  // 类似 componentDidMount 和 componentDidUpdate:\n  useEffect(() => {\n    // 通过浏览器的 API 更新文档的标题\n    document.title = `You clicked ${count} times`;\n  });\n\n  return (\n    <div>\n      <p>You clicked {count} times</p>\n      <button onClick={() => setCount(count + 1)}>\n        Click me\n      </button>\n    </div>\n  );\n}\n```\n\n但你调用 `useEffect` 的时候，你就在告诉 React 在重新渲染 DOM 之后执行你的作用函数。副作用函数是在组件内声明，因此可以访问其 props 和 state。默认情况下 React 在每次渲染后都会执行作用函数----同样包括第一次渲染。（我们将更多地讨论如何使用效果钩，以及他与类的生命周期的差异。）\n\n作用函数还可以根据返回函数来指定如何“清理”它们。例如，下面这个组件使用作用函数来订阅朋友的在线状态，并通过取消订阅来清理状态：\n\n```JSX\nimport React, { useState, useEffect } from 'react';\n\nfunction FriendStatus(props) {\n  const [isOnline, setIsOnline] = useState(null);\n\n  function handleStatusChange(status) {\n    setIsOnline(status.isOnline);\n  }\n\n  useEffect(() => {\n    ChatAPI.subscribeToFriendStatus(props.friend.id, handleStatusChange);\n\n    return () => {\n      ChatAPI.unsubscribeFromFriendStatus(props.friend.id, handleStatusChange);\n    };\n  });\n\n  if (isOnline === null) {\n    return 'Loading...';\n  }\n  return isOnline ? 'Online' : 'Offline';\n}\n```\n\n在这个事例中， React 会在组件销毁的时候通过 `ChatAPI` 来取消订阅。而且每次渲染的时候都会重新执行效果函数。（甚至当传递给 `ChatAPI` 的  `props.friend.id` 没有改变的情况下可以告诉 React 忽略重新订阅。）\n\n就像使用 `useState` 一样，您可以在组件中使用多个作用函数：\n\n```JSX\nfunction FriendStatusWithCounter(props) {\n  const [count, setCount] = useState(0);\n  useEffect(() => {\n    document.title = `You clicked ${count} times`;\n  });\n\n  const [isOnline, setIsOnline] = useState(null);\n  useEffect(() => {\n    ChatAPI.subscribeToFriendStatus(props.friend.id, handleStatusChange);\n    return () => {\n      ChatAPI.unsubscribeFromFriendStatus(props.friend.id, handleStatusChange);\n    };\n  });\n\n  function handleStatusChange(status) {\n    setIsOnline(status.isOnline);\n  }\n  // ...\n```\n\n通过钩子，您可以根据需要组织组件中的副作用函数（例如添加和删除订阅），而不是强制通过生命周期的函数进行处理。\n\n## 钩子的规则\n\n钩子本质就是一个 JavaScript 函数，但是他有两个特殊的规则：\n\n* 只能在 **顶层** 调用钩子。不要在循环，条件或嵌套函数中调用钩子。\n\n* 只能在 React 函数组件中调用钩子。不要在一般的 JavaScript 函数里调用钩子。（还有一个可以调用钩子的地方----自定义钩子。马上我们就会了解他。）\n\n## 自定义钩子\n\n有时，我们希望在组件之间复用一些有状态逻辑。一般有两个方法解决这个问题：`高价组件` 和 `渲染参数（render  props）`。自定义钩子可以在不添加组件的情况下解决上面的问题。\n\n前面我们介绍了一个通过 `useState` 和 `useEffect` 钩子来订阅朋友在线状态的组件。现在我们想把这个订阅的逻辑使用到其他组件中去。\n\n首先我们将创建自定义钩子组件 `useFriendStatus` 用来封装这个逻辑。\n\n```JSX\nimport React, { useState, useEffect } from 'react';\n\nfunction useFriendStatus(friendID) {\n  const [isOnline, setIsOnline] = useState(null);\n\n  function handleStatusChange(status) {\n    setIsOnline(status.isOnline);\n  }\n\n  useEffect(() => {\n    ChatAPI.subscribeToFriendStatus(friendID, handleStatusChange);\n    return () => {\n      ChatAPI.unsubscribeFromFriendStatus(friendID, handleStatusChange);\n    };\n  });\n\n  return isOnline;\n}\n```\n\n使用 `friendID` 作为参数，并返回我们的朋友是否在线。\n\n现在我们可以在其他组件中使用它：\n\n```JSX\nfunction FriendStatus(props) {\n  const isOnline = useFriendStatus(props.friend.id);\n\n  if (isOnline === null) {\n    return 'Loading...';\n  }\n  return isOnline ? 'Online' : 'Offline';\n}\n```\n\n```JSX\nfunction FriendListItem(props) {\n  const isOnline = useFriendStatus(props.friend.id);\n\n  return (\n    <li style={{ color: isOnline ? 'green' : 'black' }}>\n      {props.friend.name}\n    </li>\n  );\n}\n```\n\n这些组件的状态完全独立。钩子只是复用 *状态逻辑*` 的一种方式，而不是状态本身。事实上，每次调用钩子都有一个完全孤立的状态----所以你甚至可以在一个组件中使用两次相同的自定义钩子。\n\n您可以编写自定义钩子，涵盖各种用例，如表单处理，动画，声明订阅，计时器，以及可能还有更多我们想到的用例。我们希望自定义钩子可以在 React 社区火起来。\n\n## 其他钩子\n\n你可能会发现一些不太常用的内置钩子也很有用。例如，`useContext` 允许你在不引入嵌套的情况下订阅 React 上下文：\n\n```JSX\nfunction Example() {\n  const locale = useContext(LocaleContext);\n  const theme = useContext(ThemeContext);\n  // ...\n}\n```\n\n`useReducer` 允许你使用 reducer 管理复杂组件的本地状态：\n\n```JSX\nfunction Todos() {\n  const [todos, dispatch] = useReducer(todosReducer);\n  // ...\n```\n\n## 推荐阅读\n* [添加钩子功能的初衷](https://reactjs.org/docs/hooks-intro.html)\n* [状态钩子](https://reactjs.org/docs/hooks-state.html)\n* [钩子API介绍](https://reactjs.org/docs/hooks-reference.html)\n* [钩子常见问题](https://reactjs.org/docs/hooks-faq.html)\n\n","slug":"react-hooks-概览","published":1,"updated":"2019-02-23T13:19:48.876Z","_id":"cjsgue0dy0001gpi6pjujt2dy","comments":1,"layout":"post","photos":[],"link":"","content":"<blockquote>\n<p>钩子是 React 16.8中的新增功能。它们允许您在不编写类的情况下使用 state 和其他 React 功能。</p>\n</blockquote>\n<p>钩子是向下兼容的。在我介绍向你介绍这个新功能前你最好对 React 有所了解。</p>\n<a id=\"more\"></a>\n\n<h2 id=\"状态钩子\"><a href=\"#状态钩子\" class=\"headerlink\" title=\"状态钩子\"></a>状态钩子</h2><p>下面是个计数器的事例。当你点击按钮时，数值就会增加：</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React, &#123; useState &#125; <span class=\"keyword\">from</span> <span class=\"string\">'react'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Example</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 声明一个新的状态变量，我们将其称为“count”</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> [count, setCount] = useState(<span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    &lt;div&gt;</span><br><span class=\"line\">      &lt;p&gt;You clicked &#123;count&#125; times&lt;<span class=\"regexp\">/p&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">      &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">        Click me</span></span><br><span class=\"line\"><span class=\"regexp\">      &lt;/</span>button&gt;</span><br><span class=\"line\">    &lt;<span class=\"regexp\">/div&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">  );</span></span><br><span class=\"line\"><span class=\"regexp\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>在这里 <code>useState</code> 就是一个钩子（过会我们再说这样做的意义）。在函数组件里面使用钩子为函数组件添加内部状态。React 将在每次渲染之间保留此状态。<code>useState</code> 方法会返回一个长度为2的数组。第一个元素就是你定义的状态，第二个元素就是用来更新这个状态的方法。你可以在处理事件的时候来调取这个方法。这个和类里面的 <code>this.setState</code> 和像，但是他不能像 <code>this.setState</code> 那样同时合并新旧状态。</p>\n<p><code>useState</code> 接受一个参数作为状态的初始值。在刚刚的事例中，这个值就是 <code>0</code>，因为通常计算都是从零开始的。但是不同于 <code>this.state</code>，钩子的状态不一定必须是对象。初始状态参数只在第一次渲染的时使用。</p>\n<h2 id=\"声明多个状态变量\"><a href=\"#声明多个状态变量\" class=\"headerlink\" title=\"声明多个状态变量\"></a>声明多个状态变量</h2><p>你可以在同一个组件里面定义多个状态钩子</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">ExampleWithManyStates</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 声明多个状态变量！</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> [age, setAge] = useState(<span class=\"number\">42</span>);</span><br><span class=\"line\">  <span class=\"keyword\">const</span> [fruit, setFruit] = useState(<span class=\"string\">'banana'</span>);</span><br><span class=\"line\">  <span class=\"keyword\">const</span> [todos, setTodos] = useState([&#123; <span class=\"attr\">text</span>: <span class=\"string\">'Learn Hooks'</span> &#125;]);</span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>数组解构语法允许我们为通过调用 <code>useState</code> 声明的状态变量赋予不同的名称。命名并不是 <code>useState</code> API的一部分。React 假设如果多次调用 <code>useState</code>，则在每次渲染期间以相同的顺序执行。下面我们将讨论为什么要这样做，以及何时使用他。</p>\n<h2 id=\"什么是钩子？\"><a href=\"#什么是钩子？\" class=\"headerlink\" title=\"什么是钩子？\"></a>什么是钩子？</h2><p>钩子函数可以使你的函数组件拥有 React state 和生命周期功能。钩子在类内部不起作用—-它们允许你在没有类的情况下使用 React。（我们并不建议你重写你现有的组件，但是你可以在新的组件里面使用钩子。）</p>\n<p>React 提供了一些像 <code>useState</code> 这样的内置钩子。你还可以创建自己的钩子以复用不同组件之间的状态行为。我们先来看看内置的钩子。</p>\n<h2 id=\"作用钩子\"><a href=\"#作用钩子\" class=\"headerlink\" title=\"作用钩子\"></a>作用钩子</h2><p>在 React 组件修改 DOM 前你一般都需要获取数据。我们管这种操作叫 <code>“side effects”（副作用）</code>（有时也简称“effects”），因为他们功能同时影响其他组件并且渲染无法完成。</p>\n<p>副作用钩子 <code>useEffect</code> 为组件添加了执行副作用操作的功能。这个与 React 类中的 <code>componentDidMount</code>，<code>componentDidUpdate</code> 和 <code>componentWillUnmount</code> 具有相同的用途，但是统一成为了一个API。（过会我们将展示一个使用 <code>useEffect</code> 副作用钩子的函数。 ）</p>\n<p>例如，此组件在 React 更新 DOM 后设置文档标题：</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React, &#123; useState, useEffect &#125; <span class=\"keyword\">from</span> <span class=\"string\">'react'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Example</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> [count, setCount] = useState(<span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 类似 componentDidMount 和 componentDidUpdate:</span></span><br><span class=\"line\">  useEffect(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 通过浏览器的 API 更新文档的标题</span></span><br><span class=\"line\">    <span class=\"built_in\">document</span>.title = <span class=\"string\">`You clicked <span class=\"subst\">$&#123;count&#125;</span> times`</span>;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    &lt;div&gt;</span><br><span class=\"line\">      &lt;p&gt;You clicked &#123;count&#125; times&lt;<span class=\"regexp\">/p&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">      &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">        Click me</span></span><br><span class=\"line\"><span class=\"regexp\">      &lt;/</span>button&gt;</span><br><span class=\"line\">    &lt;<span class=\"regexp\">/div&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">  );</span></span><br><span class=\"line\"><span class=\"regexp\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>但你调用 <code>useEffect</code> 的时候，你就在告诉 React 在重新渲染 DOM 之后执行你的作用函数。副作用函数是在组件内声明，因此可以访问其 props 和 state。默认情况下 React 在每次渲染后都会执行作用函数—-同样包括第一次渲染。（我们将更多地讨论如何使用效果钩，以及他与类的生命周期的差异。）</p>\n<p>作用函数还可以根据返回函数来指定如何“清理”它们。例如，下面这个组件使用作用函数来订阅朋友的在线状态，并通过取消订阅来清理状态：</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React, &#123; useState, useEffect &#125; <span class=\"keyword\">from</span> <span class=\"string\">'react'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">FriendStatus</span>(<span class=\"params\">props</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> [isOnline, setIsOnline] = useState(<span class=\"literal\">null</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">handleStatusChange</span>(<span class=\"params\">status</span>) </span>&#123;</span><br><span class=\"line\">    setIsOnline(status.isOnline);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  useEffect(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    ChatAPI.subscribeToFriendStatus(props.friend.id, handleStatusChange);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      ChatAPI.unsubscribeFromFriendStatus(props.friend.id, handleStatusChange);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (isOnline === <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">'Loading...'</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> isOnline ? <span class=\"string\">'Online'</span> : <span class=\"string\">'Offline'</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在这个事例中， React 会在组件销毁的时候通过 <code>ChatAPI</code> 来取消订阅。而且每次渲染的时候都会重新执行效果函数。（甚至当传递给 <code>ChatAPI</code> 的  <code>props.friend.id</code> 没有改变的情况下可以告诉 React 忽略重新订阅。）</p>\n<p>就像使用 <code>useState</code> 一样，您可以在组件中使用多个作用函数：</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">FriendStatusWithCounter</span>(<span class=\"params\">props</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> [count, setCount] = useState(<span class=\"number\">0</span>);</span><br><span class=\"line\">  useEffect(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.title = <span class=\"string\">`You clicked <span class=\"subst\">$&#123;count&#125;</span> times`</span>;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> [isOnline, setIsOnline] = useState(<span class=\"literal\">null</span>);</span><br><span class=\"line\">  useEffect(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    ChatAPI.subscribeToFriendStatus(props.friend.id, handleStatusChange);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      ChatAPI.unsubscribeFromFriendStatus(props.friend.id, handleStatusChange);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">handleStatusChange</span>(<span class=\"params\">status</span>) </span>&#123;</span><br><span class=\"line\">    setIsOnline(status.isOnline);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br></pre></td></tr></table></figure>\n\n<p>通过钩子，您可以根据需要组织组件中的副作用函数（例如添加和删除订阅），而不是强制通过生命周期的函数进行处理。</p>\n<h2 id=\"钩子的规则\"><a href=\"#钩子的规则\" class=\"headerlink\" title=\"钩子的规则\"></a>钩子的规则</h2><p>钩子本质就是一个 JavaScript 函数，但是他有两个特殊的规则：</p>\n<ul>\n<li><p>只能在 <strong>顶层</strong> 调用钩子。不要在循环，条件或嵌套函数中调用钩子。</p>\n</li>\n<li><p>只能在 React 函数组件中调用钩子。不要在一般的 JavaScript 函数里调用钩子。（还有一个可以调用钩子的地方—-自定义钩子。马上我们就会了解他。）</p>\n</li>\n</ul>\n<h2 id=\"自定义钩子\"><a href=\"#自定义钩子\" class=\"headerlink\" title=\"自定义钩子\"></a>自定义钩子</h2><p>有时，我们希望在组件之间复用一些有状态逻辑。一般有两个方法解决这个问题：<code>高价组件</code> 和 <code>渲染参数（render  props）</code>。自定义钩子可以在不添加组件的情况下解决上面的问题。</p>\n<p>前面我们介绍了一个通过 <code>useState</code> 和 <code>useEffect</code> 钩子来订阅朋友在线状态的组件。现在我们想把这个订阅的逻辑使用到其他组件中去。</p>\n<p>首先我们将创建自定义钩子组件 <code>useFriendStatus</code> 用来封装这个逻辑。</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React, &#123; useState, useEffect &#125; <span class=\"keyword\">from</span> <span class=\"string\">'react'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">useFriendStatus</span>(<span class=\"params\">friendID</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> [isOnline, setIsOnline] = useState(<span class=\"literal\">null</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">handleStatusChange</span>(<span class=\"params\">status</span>) </span>&#123;</span><br><span class=\"line\">    setIsOnline(status.isOnline);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  useEffect(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    ChatAPI.subscribeToFriendStatus(friendID, handleStatusChange);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      ChatAPI.unsubscribeFromFriendStatus(friendID, handleStatusChange);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> isOnline;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>使用 <code>friendID</code> 作为参数，并返回我们的朋友是否在线。</p>\n<p>现在我们可以在其他组件中使用它：</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">FriendStatus</span>(<span class=\"params\">props</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> isOnline = useFriendStatus(props.friend.id);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (isOnline === <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">'Loading...'</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> isOnline ? <span class=\"string\">'Online'</span> : <span class=\"string\">'Offline'</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">FriendListItem</span>(<span class=\"params\">props</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> isOnline = useFriendStatus(props.friend.id);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    &lt;li style=&#123;&#123; <span class=\"attr\">color</span>: isOnline ? <span class=\"string\">'green'</span> : <span class=\"string\">'black'</span> &#125;&#125;&gt;</span><br><span class=\"line\">      &#123;props.friend.name&#125;</span><br><span class=\"line\">    &lt;<span class=\"regexp\">/li&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">  );</span></span><br><span class=\"line\"><span class=\"regexp\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>这些组件的状态完全独立。钩子只是复用 <em>状态逻辑</em>` 的一种方式，而不是状态本身。事实上，每次调用钩子都有一个完全孤立的状态—-所以你甚至可以在一个组件中使用两次相同的自定义钩子。</p>\n<p>您可以编写自定义钩子，涵盖各种用例，如表单处理，动画，声明订阅，计时器，以及可能还有更多我们想到的用例。我们希望自定义钩子可以在 React 社区火起来。</p>\n<h2 id=\"其他钩子\"><a href=\"#其他钩子\" class=\"headerlink\" title=\"其他钩子\"></a>其他钩子</h2><p>你可能会发现一些不太常用的内置钩子也很有用。例如，<code>useContext</code> 允许你在不引入嵌套的情况下订阅 React 上下文：</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Example</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> locale = useContext(LocaleContext);</span><br><span class=\"line\">  <span class=\"keyword\">const</span> theme = useContext(ThemeContext);</span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>useReducer</code> 允许你使用 reducer 管理复杂组件的本地状态：</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Todos</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> [todos, dispatch] = useReducer(todosReducer);</span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"推荐阅读\"><a href=\"#推荐阅读\" class=\"headerlink\" title=\"推荐阅读\"></a>推荐阅读</h2><ul>\n<li><a href=\"https://reactjs.org/docs/hooks-intro.html\" target=\"_blank\" rel=\"noopener\">添加钩子功能的初衷</a></li>\n<li><a href=\"https://reactjs.org/docs/hooks-state.html\" target=\"_blank\" rel=\"noopener\">状态钩子</a></li>\n<li><a href=\"https://reactjs.org/docs/hooks-reference.html\" target=\"_blank\" rel=\"noopener\">钩子API介绍</a></li>\n<li><a href=\"https://reactjs.org/docs/hooks-faq.html\" target=\"_blank\" rel=\"noopener\">钩子常见问题</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<blockquote>\n<p>钩子是 React 16.8中的新增功能。它们允许您在不编写类的情况下使用 state 和其他 React 功能。</p>\n</blockquote>\n<p>钩子是向下兼容的。在我介绍向你介绍这个新功能前你最好对 React 有所了解。</p>","more":"<h2 id=\"状态钩子\"><a href=\"#状态钩子\" class=\"headerlink\" title=\"状态钩子\"></a>状态钩子</h2><p>下面是个计数器的事例。当你点击按钮时，数值就会增加：</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React, &#123; useState &#125; <span class=\"keyword\">from</span> <span class=\"string\">'react'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Example</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 声明一个新的状态变量，我们将其称为“count”</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> [count, setCount] = useState(<span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    &lt;div&gt;</span><br><span class=\"line\">      &lt;p&gt;You clicked &#123;count&#125; times&lt;<span class=\"regexp\">/p&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">      &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">        Click me</span></span><br><span class=\"line\"><span class=\"regexp\">      &lt;/</span>button&gt;</span><br><span class=\"line\">    &lt;<span class=\"regexp\">/div&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">  );</span></span><br><span class=\"line\"><span class=\"regexp\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>在这里 <code>useState</code> 就是一个钩子（过会我们再说这样做的意义）。在函数组件里面使用钩子为函数组件添加内部状态。React 将在每次渲染之间保留此状态。<code>useState</code> 方法会返回一个长度为2的数组。第一个元素就是你定义的状态，第二个元素就是用来更新这个状态的方法。你可以在处理事件的时候来调取这个方法。这个和类里面的 <code>this.setState</code> 和像，但是他不能像 <code>this.setState</code> 那样同时合并新旧状态。</p>\n<p><code>useState</code> 接受一个参数作为状态的初始值。在刚刚的事例中，这个值就是 <code>0</code>，因为通常计算都是从零开始的。但是不同于 <code>this.state</code>，钩子的状态不一定必须是对象。初始状态参数只在第一次渲染的时使用。</p>\n<h2 id=\"声明多个状态变量\"><a href=\"#声明多个状态变量\" class=\"headerlink\" title=\"声明多个状态变量\"></a>声明多个状态变量</h2><p>你可以在同一个组件里面定义多个状态钩子</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">ExampleWithManyStates</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 声明多个状态变量！</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> [age, setAge] = useState(<span class=\"number\">42</span>);</span><br><span class=\"line\">  <span class=\"keyword\">const</span> [fruit, setFruit] = useState(<span class=\"string\">'banana'</span>);</span><br><span class=\"line\">  <span class=\"keyword\">const</span> [todos, setTodos] = useState([&#123; <span class=\"attr\">text</span>: <span class=\"string\">'Learn Hooks'</span> &#125;]);</span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>数组解构语法允许我们为通过调用 <code>useState</code> 声明的状态变量赋予不同的名称。命名并不是 <code>useState</code> API的一部分。React 假设如果多次调用 <code>useState</code>，则在每次渲染期间以相同的顺序执行。下面我们将讨论为什么要这样做，以及何时使用他。</p>\n<h2 id=\"什么是钩子？\"><a href=\"#什么是钩子？\" class=\"headerlink\" title=\"什么是钩子？\"></a>什么是钩子？</h2><p>钩子函数可以使你的函数组件拥有 React state 和生命周期功能。钩子在类内部不起作用—-它们允许你在没有类的情况下使用 React。（我们并不建议你重写你现有的组件，但是你可以在新的组件里面使用钩子。）</p>\n<p>React 提供了一些像 <code>useState</code> 这样的内置钩子。你还可以创建自己的钩子以复用不同组件之间的状态行为。我们先来看看内置的钩子。</p>\n<h2 id=\"作用钩子\"><a href=\"#作用钩子\" class=\"headerlink\" title=\"作用钩子\"></a>作用钩子</h2><p>在 React 组件修改 DOM 前你一般都需要获取数据。我们管这种操作叫 <code>“side effects”（副作用）</code>（有时也简称“effects”），因为他们功能同时影响其他组件并且渲染无法完成。</p>\n<p>副作用钩子 <code>useEffect</code> 为组件添加了执行副作用操作的功能。这个与 React 类中的 <code>componentDidMount</code>，<code>componentDidUpdate</code> 和 <code>componentWillUnmount</code> 具有相同的用途，但是统一成为了一个API。（过会我们将展示一个使用 <code>useEffect</code> 副作用钩子的函数。 ）</p>\n<p>例如，此组件在 React 更新 DOM 后设置文档标题：</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React, &#123; useState, useEffect &#125; <span class=\"keyword\">from</span> <span class=\"string\">'react'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Example</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> [count, setCount] = useState(<span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 类似 componentDidMount 和 componentDidUpdate:</span></span><br><span class=\"line\">  useEffect(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 通过浏览器的 API 更新文档的标题</span></span><br><span class=\"line\">    <span class=\"built_in\">document</span>.title = <span class=\"string\">`You clicked <span class=\"subst\">$&#123;count&#125;</span> times`</span>;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    &lt;div&gt;</span><br><span class=\"line\">      &lt;p&gt;You clicked &#123;count&#125; times&lt;<span class=\"regexp\">/p&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">      &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">        Click me</span></span><br><span class=\"line\"><span class=\"regexp\">      &lt;/</span>button&gt;</span><br><span class=\"line\">    &lt;<span class=\"regexp\">/div&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">  );</span></span><br><span class=\"line\"><span class=\"regexp\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>但你调用 <code>useEffect</code> 的时候，你就在告诉 React 在重新渲染 DOM 之后执行你的作用函数。副作用函数是在组件内声明，因此可以访问其 props 和 state。默认情况下 React 在每次渲染后都会执行作用函数—-同样包括第一次渲染。（我们将更多地讨论如何使用效果钩，以及他与类的生命周期的差异。）</p>\n<p>作用函数还可以根据返回函数来指定如何“清理”它们。例如，下面这个组件使用作用函数来订阅朋友的在线状态，并通过取消订阅来清理状态：</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React, &#123; useState, useEffect &#125; <span class=\"keyword\">from</span> <span class=\"string\">'react'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">FriendStatus</span>(<span class=\"params\">props</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> [isOnline, setIsOnline] = useState(<span class=\"literal\">null</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">handleStatusChange</span>(<span class=\"params\">status</span>) </span>&#123;</span><br><span class=\"line\">    setIsOnline(status.isOnline);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  useEffect(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    ChatAPI.subscribeToFriendStatus(props.friend.id, handleStatusChange);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      ChatAPI.unsubscribeFromFriendStatus(props.friend.id, handleStatusChange);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (isOnline === <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">'Loading...'</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> isOnline ? <span class=\"string\">'Online'</span> : <span class=\"string\">'Offline'</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在这个事例中， React 会在组件销毁的时候通过 <code>ChatAPI</code> 来取消订阅。而且每次渲染的时候都会重新执行效果函数。（甚至当传递给 <code>ChatAPI</code> 的  <code>props.friend.id</code> 没有改变的情况下可以告诉 React 忽略重新订阅。）</p>\n<p>就像使用 <code>useState</code> 一样，您可以在组件中使用多个作用函数：</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">FriendStatusWithCounter</span>(<span class=\"params\">props</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> [count, setCount] = useState(<span class=\"number\">0</span>);</span><br><span class=\"line\">  useEffect(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.title = <span class=\"string\">`You clicked <span class=\"subst\">$&#123;count&#125;</span> times`</span>;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> [isOnline, setIsOnline] = useState(<span class=\"literal\">null</span>);</span><br><span class=\"line\">  useEffect(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    ChatAPI.subscribeToFriendStatus(props.friend.id, handleStatusChange);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      ChatAPI.unsubscribeFromFriendStatus(props.friend.id, handleStatusChange);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">handleStatusChange</span>(<span class=\"params\">status</span>) </span>&#123;</span><br><span class=\"line\">    setIsOnline(status.isOnline);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br></pre></td></tr></table></figure>\n\n<p>通过钩子，您可以根据需要组织组件中的副作用函数（例如添加和删除订阅），而不是强制通过生命周期的函数进行处理。</p>\n<h2 id=\"钩子的规则\"><a href=\"#钩子的规则\" class=\"headerlink\" title=\"钩子的规则\"></a>钩子的规则</h2><p>钩子本质就是一个 JavaScript 函数，但是他有两个特殊的规则：</p>\n<ul>\n<li><p>只能在 <strong>顶层</strong> 调用钩子。不要在循环，条件或嵌套函数中调用钩子。</p>\n</li>\n<li><p>只能在 React 函数组件中调用钩子。不要在一般的 JavaScript 函数里调用钩子。（还有一个可以调用钩子的地方—-自定义钩子。马上我们就会了解他。）</p>\n</li>\n</ul>\n<h2 id=\"自定义钩子\"><a href=\"#自定义钩子\" class=\"headerlink\" title=\"自定义钩子\"></a>自定义钩子</h2><p>有时，我们希望在组件之间复用一些有状态逻辑。一般有两个方法解决这个问题：<code>高价组件</code> 和 <code>渲染参数（render  props）</code>。自定义钩子可以在不添加组件的情况下解决上面的问题。</p>\n<p>前面我们介绍了一个通过 <code>useState</code> 和 <code>useEffect</code> 钩子来订阅朋友在线状态的组件。现在我们想把这个订阅的逻辑使用到其他组件中去。</p>\n<p>首先我们将创建自定义钩子组件 <code>useFriendStatus</code> 用来封装这个逻辑。</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React, &#123; useState, useEffect &#125; <span class=\"keyword\">from</span> <span class=\"string\">'react'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">useFriendStatus</span>(<span class=\"params\">friendID</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> [isOnline, setIsOnline] = useState(<span class=\"literal\">null</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">handleStatusChange</span>(<span class=\"params\">status</span>) </span>&#123;</span><br><span class=\"line\">    setIsOnline(status.isOnline);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  useEffect(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    ChatAPI.subscribeToFriendStatus(friendID, handleStatusChange);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      ChatAPI.unsubscribeFromFriendStatus(friendID, handleStatusChange);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> isOnline;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>使用 <code>friendID</code> 作为参数，并返回我们的朋友是否在线。</p>\n<p>现在我们可以在其他组件中使用它：</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">FriendStatus</span>(<span class=\"params\">props</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> isOnline = useFriendStatus(props.friend.id);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (isOnline === <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">'Loading...'</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> isOnline ? <span class=\"string\">'Online'</span> : <span class=\"string\">'Offline'</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">FriendListItem</span>(<span class=\"params\">props</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> isOnline = useFriendStatus(props.friend.id);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    &lt;li style=&#123;&#123; <span class=\"attr\">color</span>: isOnline ? <span class=\"string\">'green'</span> : <span class=\"string\">'black'</span> &#125;&#125;&gt;</span><br><span class=\"line\">      &#123;props.friend.name&#125;</span><br><span class=\"line\">    &lt;<span class=\"regexp\">/li&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">  );</span></span><br><span class=\"line\"><span class=\"regexp\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>这些组件的状态完全独立。钩子只是复用 <em>状态逻辑</em>` 的一种方式，而不是状态本身。事实上，每次调用钩子都有一个完全孤立的状态—-所以你甚至可以在一个组件中使用两次相同的自定义钩子。</p>\n<p>您可以编写自定义钩子，涵盖各种用例，如表单处理，动画，声明订阅，计时器，以及可能还有更多我们想到的用例。我们希望自定义钩子可以在 React 社区火起来。</p>\n<h2 id=\"其他钩子\"><a href=\"#其他钩子\" class=\"headerlink\" title=\"其他钩子\"></a>其他钩子</h2><p>你可能会发现一些不太常用的内置钩子也很有用。例如，<code>useContext</code> 允许你在不引入嵌套的情况下订阅 React 上下文：</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Example</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> locale = useContext(LocaleContext);</span><br><span class=\"line\">  <span class=\"keyword\">const</span> theme = useContext(ThemeContext);</span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>useReducer</code> 允许你使用 reducer 管理复杂组件的本地状态：</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Todos</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> [todos, dispatch] = useReducer(todosReducer);</span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"推荐阅读\"><a href=\"#推荐阅读\" class=\"headerlink\" title=\"推荐阅读\"></a>推荐阅读</h2><ul>\n<li><a href=\"https://reactjs.org/docs/hooks-intro.html\" target=\"_blank\" rel=\"noopener\">添加钩子功能的初衷</a></li>\n<li><a href=\"https://reactjs.org/docs/hooks-state.html\" target=\"_blank\" rel=\"noopener\">状态钩子</a></li>\n<li><a href=\"https://reactjs.org/docs/hooks-reference.html\" target=\"_blank\" rel=\"noopener\">钩子API介绍</a></li>\n<li><a href=\"https://reactjs.org/docs/hooks-faq.html\" target=\"_blank\" rel=\"noopener\">钩子常见问题</a></li>\n</ul>"},{"title":"shell学习笔记二","date":"2018-01-13T03:44:03.000Z","_content":"`shell`是一种程序设计语言。作为命令语言，它交互式解释和执行用户输入的命令或者自动地解释和执行预先设定好的一连串的命令；作为程序设计语言，它定义了各种变量和参数，并提供了许多在高级语言中才具有的控制结构，包括循环和分支。\n<!--more-->\n## I/O 输入与输出\n\n* a > b a输出给 b \n* a < b 接受d的输入\n* a | b a 的输出作为 b 的输入\n\n```bash\necho 'hello shell' > helloShell\n```\n\n输出 `hello shell` 到 `helloShell` 文件中\n\n```text\nhello eric\n```\n\n继续\n\n```bash\necho 'hello eric' > helloShell\n```\n\n`helloShell` 文件中有 \n\n```text\nhello eric\n```\n\n继续\n\n```bash\necho 'hello eric' >> helloShell\n```\n\n`helloShell` 文件中有 \n```text\nhello eric\nhello eric\n```\n\n继续\n\n```bash\ntr 'l' 'x' < helloShell > hexxoShexx\n```\n\n会创建一个 `hexxoShexx` 文件，内容为：\n\n```text\nhexxo shexx\n```\n\n\n继续\n\n```bash\necho 'hello shell ' | tr 'h' 't' > telloStell \n```\n\n会创建一个 `telloStell` 文件，内容为：\n\n```text\ntello stell\n```\n\n## 小实验 tr 与 PATH 的结合使用 \n\n```bash\necho $PATH | tr ':' '\\n' > pathList.txt\n```\n\n创建 pathList.txt 文件，里面逐行列出了用户的环境变量\n\n## grep 正则匹配输出\n\n```bash\nwhoami | grep ^e\n```\n\n输出\n\n```bash\neric\n```\n\n```bash\nwhoami | grep ^i\n```\n\n无输出\n\n## 执行追踪 set -x\n\n```bash\ncat > get.sh\n#! /bin/sh\n\nset -x\necho 1st echo\n\nset +x\necho 2nd echo\n```\n\n> `ctrl + d`\n\n```bash\n./get.sh\n```\n\n输出 \n\n```bash\n+ echo 1st echo\n1st echo\n+ set +x\n2nd echo\n```\n\n今天就到这里，下次继续。","source":"_posts/shell学习笔记二.md","raw":"---\ntitle: shell学习笔记二\ndate: 2018-01-13 11:44:03\ntags: ['shell','bash','脚本','终端','命令行']\ncategory: 'coding'\n---\n`shell`是一种程序设计语言。作为命令语言，它交互式解释和执行用户输入的命令或者自动地解释和执行预先设定好的一连串的命令；作为程序设计语言，它定义了各种变量和参数，并提供了许多在高级语言中才具有的控制结构，包括循环和分支。\n<!--more-->\n## I/O 输入与输出\n\n* a > b a输出给 b \n* a < b 接受d的输入\n* a | b a 的输出作为 b 的输入\n\n```bash\necho 'hello shell' > helloShell\n```\n\n输出 `hello shell` 到 `helloShell` 文件中\n\n```text\nhello eric\n```\n\n继续\n\n```bash\necho 'hello eric' > helloShell\n```\n\n`helloShell` 文件中有 \n\n```text\nhello eric\n```\n\n继续\n\n```bash\necho 'hello eric' >> helloShell\n```\n\n`helloShell` 文件中有 \n```text\nhello eric\nhello eric\n```\n\n继续\n\n```bash\ntr 'l' 'x' < helloShell > hexxoShexx\n```\n\n会创建一个 `hexxoShexx` 文件，内容为：\n\n```text\nhexxo shexx\n```\n\n\n继续\n\n```bash\necho 'hello shell ' | tr 'h' 't' > telloStell \n```\n\n会创建一个 `telloStell` 文件，内容为：\n\n```text\ntello stell\n```\n\n## 小实验 tr 与 PATH 的结合使用 \n\n```bash\necho $PATH | tr ':' '\\n' > pathList.txt\n```\n\n创建 pathList.txt 文件，里面逐行列出了用户的环境变量\n\n## grep 正则匹配输出\n\n```bash\nwhoami | grep ^e\n```\n\n输出\n\n```bash\neric\n```\n\n```bash\nwhoami | grep ^i\n```\n\n无输出\n\n## 执行追踪 set -x\n\n```bash\ncat > get.sh\n#! /bin/sh\n\nset -x\necho 1st echo\n\nset +x\necho 2nd echo\n```\n\n> `ctrl + d`\n\n```bash\n./get.sh\n```\n\n输出 \n\n```bash\n+ echo 1st echo\n1st echo\n+ set +x\n2nd echo\n```\n\n今天就到这里，下次继续。","slug":"shell学习笔记二","published":1,"updated":"2019-02-20T02:50:38.551Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjsgue0e50004gpi613qntlxe","content":"<p><code>shell</code>是一种程序设计语言。作为命令语言，它交互式解释和执行用户输入的命令或者自动地解释和执行预先设定好的一连串的命令；作为程序设计语言，它定义了各种变量和参数，并提供了许多在高级语言中才具有的控制结构，包括循环和分支。<br><a id=\"more\"></a></p>\n<h2 id=\"I-O-输入与输出\"><a href=\"#I-O-输入与输出\" class=\"headerlink\" title=\"I/O 输入与输出\"></a>I/O 输入与输出</h2><ul>\n<li>a &gt; b a输出给 b </li>\n<li>a &lt; b 接受d的输入</li>\n<li>a | b a 的输出作为 b 的输入</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">'hello shell'</span> &gt; helloShell</span><br></pre></td></tr></table></figure>\n<p>输出 <code>hello shell</code> 到 <code>helloShell</code> 文件中</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hello eric</span><br></pre></td></tr></table></figure>\n<p>继续</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">'hello eric'</span> &gt; helloShell</span><br></pre></td></tr></table></figure>\n<p><code>helloShell</code> 文件中有 </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hello eric</span><br></pre></td></tr></table></figure>\n<p>继续</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">'hello eric'</span> &gt;&gt; helloShell</span><br></pre></td></tr></table></figure>\n<p><code>helloShell</code> 文件中有<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hello eric</span><br><span class=\"line\">hello eric</span><br></pre></td></tr></table></figure></p>\n<p>继续</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tr <span class=\"string\">'l'</span> <span class=\"string\">'x'</span> &lt; helloShell &gt; hexxoShexx</span><br></pre></td></tr></table></figure>\n<p>会创建一个 <code>hexxoShexx</code> 文件，内容为：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexxo shexx</span><br></pre></td></tr></table></figure>\n<p>继续</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">'hello shell '</span> | tr <span class=\"string\">'h'</span> <span class=\"string\">'t'</span> &gt; telloStell</span><br></pre></td></tr></table></figure>\n<p>会创建一个 <code>telloStell</code> 文件，内容为：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tello stell</span><br></pre></td></tr></table></figure>\n<h2 id=\"小实验-tr-与-PATH-的结合使用\"><a href=\"#小实验-tr-与-PATH-的结合使用\" class=\"headerlink\" title=\"小实验 tr 与 PATH 的结合使用\"></a>小实验 tr 与 PATH 的结合使用</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"variable\">$PATH</span> | tr <span class=\"string\">':'</span> <span class=\"string\">'\\n'</span> &gt; pathList.txt</span><br></pre></td></tr></table></figure>\n<p>创建 pathList.txt 文件，里面逐行列出了用户的环境变量</p>\n<h2 id=\"grep-正则匹配输出\"><a href=\"#grep-正则匹配输出\" class=\"headerlink\" title=\"grep 正则匹配输出\"></a>grep 正则匹配输出</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">whoami | grep ^e</span><br></pre></td></tr></table></figure>\n<p>输出</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">eric</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">whoami | grep ^i</span><br></pre></td></tr></table></figure>\n<p>无输出</p>\n<h2 id=\"执行追踪-set-x\"><a href=\"#执行追踪-set-x\" class=\"headerlink\" title=\"执行追踪 set -x\"></a>执行追踪 set -x</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat &gt; get.sh</span><br><span class=\"line\"><span class=\"meta\">#! /bin/sh</span><br><span class=\"line\"></span></span><br><span class=\"line\"><span class=\"built_in\">set</span> -x</span><br><span class=\"line\"><span class=\"built_in\">echo</span> 1st <span class=\"built_in\">echo</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">set</span> +x</span><br><span class=\"line\"><span class=\"built_in\">echo</span> 2nd <span class=\"built_in\">echo</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><code>ctrl + d</code></p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./get.sh</span><br></pre></td></tr></table></figure>\n<p>输出 </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">+ <span class=\"built_in\">echo</span> 1st <span class=\"built_in\">echo</span></span><br><span class=\"line\">1st <span class=\"built_in\">echo</span></span><br><span class=\"line\">+ <span class=\"built_in\">set</span> +x</span><br><span class=\"line\">2nd <span class=\"built_in\">echo</span></span><br></pre></td></tr></table></figure>\n<p>今天就到这里，下次继续。</p>\n","excerpt":"<p><code>shell</code>是一种程序设计语言。作为命令语言，它交互式解释和执行用户输入的命令或者自动地解释和执行预先设定好的一连串的命令；作为程序设计语言，它定义了各种变量和参数，并提供了许多在高级语言中才具有的控制结构，包括循环和分支。<br>","more":"</p>\n<h2 id=\"I-O-输入与输出\"><a href=\"#I-O-输入与输出\" class=\"headerlink\" title=\"I/O 输入与输出\"></a>I/O 输入与输出</h2><ul>\n<li>a &gt; b a输出给 b </li>\n<li>a &lt; b 接受d的输入</li>\n<li>a | b a 的输出作为 b 的输入</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">'hello shell'</span> &gt; helloShell</span><br></pre></td></tr></table></figure>\n<p>输出 <code>hello shell</code> 到 <code>helloShell</code> 文件中</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hello eric</span><br></pre></td></tr></table></figure>\n<p>继续</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">'hello eric'</span> &gt; helloShell</span><br></pre></td></tr></table></figure>\n<p><code>helloShell</code> 文件中有 </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hello eric</span><br></pre></td></tr></table></figure>\n<p>继续</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">'hello eric'</span> &gt;&gt; helloShell</span><br></pre></td></tr></table></figure>\n<p><code>helloShell</code> 文件中有<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hello eric</span><br><span class=\"line\">hello eric</span><br></pre></td></tr></table></figure></p>\n<p>继续</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tr <span class=\"string\">'l'</span> <span class=\"string\">'x'</span> &lt; helloShell &gt; hexxoShexx</span><br></pre></td></tr></table></figure>\n<p>会创建一个 <code>hexxoShexx</code> 文件，内容为：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexxo shexx</span><br></pre></td></tr></table></figure>\n<p>继续</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">'hello shell '</span> | tr <span class=\"string\">'h'</span> <span class=\"string\">'t'</span> &gt; telloStell</span><br></pre></td></tr></table></figure>\n<p>会创建一个 <code>telloStell</code> 文件，内容为：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tello stell</span><br></pre></td></tr></table></figure>\n<h2 id=\"小实验-tr-与-PATH-的结合使用\"><a href=\"#小实验-tr-与-PATH-的结合使用\" class=\"headerlink\" title=\"小实验 tr 与 PATH 的结合使用\"></a>小实验 tr 与 PATH 的结合使用</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"variable\">$PATH</span> | tr <span class=\"string\">':'</span> <span class=\"string\">'\\n'</span> &gt; pathList.txt</span><br></pre></td></tr></table></figure>\n<p>创建 pathList.txt 文件，里面逐行列出了用户的环境变量</p>\n<h2 id=\"grep-正则匹配输出\"><a href=\"#grep-正则匹配输出\" class=\"headerlink\" title=\"grep 正则匹配输出\"></a>grep 正则匹配输出</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">whoami | grep ^e</span><br></pre></td></tr></table></figure>\n<p>输出</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">eric</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">whoami | grep ^i</span><br></pre></td></tr></table></figure>\n<p>无输出</p>\n<h2 id=\"执行追踪-set-x\"><a href=\"#执行追踪-set-x\" class=\"headerlink\" title=\"执行追踪 set -x\"></a>执行追踪 set -x</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat &gt; get.sh</span><br><span class=\"line\"><span class=\"meta\">#! /bin/sh</span><br><span class=\"line\"></span></span><br><span class=\"line\"><span class=\"built_in\">set</span> -x</span><br><span class=\"line\"><span class=\"built_in\">echo</span> 1st <span class=\"built_in\">echo</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">set</span> +x</span><br><span class=\"line\"><span class=\"built_in\">echo</span> 2nd <span class=\"built_in\">echo</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><code>ctrl + d</code></p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./get.sh</span><br></pre></td></tr></table></figure>\n<p>输出 </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">+ <span class=\"built_in\">echo</span> 1st <span class=\"built_in\">echo</span></span><br><span class=\"line\">1st <span class=\"built_in\">echo</span></span><br><span class=\"line\">+ <span class=\"built_in\">set</span> +x</span><br><span class=\"line\">2nd <span class=\"built_in\">echo</span></span><br></pre></td></tr></table></figure>\n<p>今天就到这里，下次继续。</p>"},{"title":"react effects函数单元测试用例与实践体验","date":"2017-12-16T12:26:18.000Z","_content":"effects 函数是很强调业务的代码块\n\n所以复制的业务会有很多分支代码\n\n导致测试用例成倍的增长\n\n虽然测试用例相同的代码可以使用  beforeAll 和 afterAll 来归纳相同代码\n\n但是这样也使得测试代码本事的逻辑变的复杂 难以维护 难以理解\n\n所以对 effects 函数复杂业务的拆分是解决问题的关键\n\n把相同的业务进行抽取 做自己的的单元测试\n\n函数只写自己特有的代码\n<!--more-->\n被测试代码\n```javascript\nimport { Customer, Machine, Tenant } from 'models';\nimport { Error, parseResponse, request } from 'utils';\nimport { MessageException, NetworkException, Relocation } from 'exceptions';\nimport { Message, Modal } from 'antd';\n \n\nexport const api = {\n    searchOneCustomerByPhone: (params) => Customer.searchOneCustomerByPhone(params),\n    createCustomer: (params) => Customer.createCustomer(params),\n};\nexport default {\n    namespace: 'app',\n    state: {\n    },\n\n    reducers: {\n    },\n\n    effects: {\n\n        * catchException({ payload }, {}) {\n            throw payload;\n        },\n\n        * searchCustomerFormCancel({}, { put, select }) {\n            const { searchCustomerForm } = yield select(viewModelStateSelector);\n\n            yield put({ type: 'saveIsSearchCustomerFormVisible', payload: false });\n            searchCustomerForm.resetFields();\n            yield put({ type: 'saveSearchCustomerFormPhone', payload: { phone: '' } });\n            yield put({\n                type: 'saveSearchCustomerList', payload: {\n                    total_item_count: 0,\n                    data_list: [],\n                }\n            });\n        },\n\n        * searchCustomerFormSubmit({}, { call, put, select }) {\n            const { searchCustomerForm } = yield select(viewModelStateSelector);\n            searchCustomerForm.validateFields();\n            const wrongFields = searchCustomerForm.getFieldsError();\n            if (!Object.keys(wrongFields).filter(field => wrongFields[field] !== undefined).length) {\n                const { searchCustomerFormPhone } = yield select(viewModelStateSelector);\n\n                try {\n                    yield put({ type: 'saveIsSearchCustomerFormLoading', payload: true });\n                    const fetchResult = yield call(request, api.searchOneCustomerByPhone(searchCustomerFormPhone.phone));\n                    yield put({ type: 'saveIsSearchCustomerFormLoading', payload: false });\n\n                    if (fetchResult.XGcbJsonCode === 0) {\n\n                        if (fetchResult.XGcbJsonResult.customer === null) {\n                            yield put({ type: 'createCustomerFormOpen' });\n                        } else {\n                            yield put({\n                                type: 'saveSearchCustomerList', payload: {\n                                    data_list: [fetchResult.XGcbJsonResult.customer],\n                                    total_item_count: 1,\n                                }\n                            });\n                        }\n\n                    } else {\n                        yield put({\n                            type: 'catchException',\n                            payload: new MessageException(Error.getError(fetchResult.XGcbJsonCode, {}, '无法找到客户配置信息，请重新尝试！')),\n                        });\n                    }\n                } catch (e) {\n                    if (e instanceof NetworkException) {\n                        yield put({\n                            type: 'catchException',\n                            payload: new MessageException('网络错误，请重试！'),\n                        });\n                    } else {\n                        throw e;\n                    }\n                }\n            }\n        }, \n    }\n}\n```\n\n测试代码\n\n```javascript\nimport { effects } from 'dva/saga';\nimport { Error, parseResponse, request } from 'utils';\nimport { MessageException, NetworkException, RelocationException } from 'exceptions';\nimport app, { viewModelStateSelector, api } from './app';\n\nconst { call, put, select } = effects;\n\ndescribe('app model', () => {\n    test('name space', () => {\n        expect(app.namespace).toBe('app');\n    });\n\n    test('effects catchException has throw', () => {\n        expect(app.effects.catchException({ payload: new MessageException('这是一个错误测试') }, {})).toThrowError();\n    });\n\n    test('effects searchCustomerFormCancel', () => {\n        const resetFields = jest.fn();\n        const generator = app.effects.searchCustomerFormCancel({}, { select, put });\n\n /***\n * 在测试代码 只关心每一行代码的情况 每一行代码需要什么 不关心代码之间的关系\n * 上一行代码值可以通过被测试行的 mock 数据来代替\n * generator 的 next 与到 yield 就停止\n * generator 的 next 得到的是 {value:上一步 yield 的返回值, done:false}\n * generator 的 next 的参数作为上一次 yield 的返回值\n * 如果没有上一步 yield 在 generator 函数内永远返回 undefined\n * yield 的返回值不是作为 generator 函数内部变量的赋值 而是近视于 return 作为 generator 函数的 next() 方法返回值的 value 值\n * generator 函数内部变量要获取 yield 的返回值 只有依赖next() 方法参数的 value 值\n *\n function* f(x) {\n for(var i = 0; true; i++) {\n var reset = yield i;//这里的 reset 还是 undefined\n console.log('reset:' + reset);//这里的 reset 就根据 next() 的传递\n if(reset===false) { i = -1; }\n }\n }\n const g = f(0);\n let x = g.next(0);\n x = g.next(x.value);\n x = g.next(x.value);\n */\n\n //todo 函数开始\n let next = generator.next();\n\n  //todo 遇到第一个 yield 停止了 得到 yield 的返回值通过 next.value 等到 与期待值 select(viewModelStateSelector) 进行比较\n expect(next.value).toEqual(select(viewModelStateSelector));\n        \n  //todo 所以通过给next添加参数来 mock 上次 yield 的返回值\n //todo 因为在第一的 yield 是对返回值有定义的 而且对返回值有调用\n //todo 而这里的 next 获取的是 yield put({ type: 'saveIsSearchCustomerFormVisible', payload: false }); 的返回值\n next = generator.next({\n            searchCustomerForm: {\n                resetFields: resetFields,\n            }\n        });\n  //todo 进行数值比较\n expect(next.value).toEqual(put({ type: 'saveIsSearchCustomerFormVisible', payload: false }));\n\n  //todo 这里的 next 获取的是yield put({ type: 'saveSearchCustomerFormPhone', payload: { phone: '' } });的返回值\n //todo 同时我们要进行 yield select(viewModelStateSelector); 对应的 next 的输出的 mock 的函数行为测试\n //todo 这里的 next 对应的是 yield put({ type: 'saveSearchCustomerFormPhone', payload: { phone: '' } });\n next = generator.next();\n  //todo mock 函数只负责行为的测试\n expect(resetFields.mock.calls.length).toBe(1);\n  expect(resetFields.mock.calls[0].length).toBe(0);\n\n  //todo 这里是对数值的比较\n expect(next.value).toEqual(put({ type: 'saveSearchCustomerFormPhone', payload: { phone: '' } }));\n        next = generator.next();\n        expect(next.value).toEqual(put({\n            type: 'saveSearchCustomerList', payload: {\n                total_item_count: 0,\n                data_list: [],\n            }\n        }));\n    });\n\n  describe('effects searchCustomerFormSubmit', () => {//todo describe 包裹 test 反过来不测试\n test('form has error', () => {\n\n            const mockPut = jest.fn();\n            const mockCall = jest.fn();\n            const validateFields = jest.fn();\n            const getFieldsError = jest.fn();\n\n            getFieldsError.mockReturnValue({});\n\n            const generator = app.effects.searchCustomerFormSubmit({}, { mockCall, mockPut, select });\n\n            let next = generator.next();\n            expect(next.value).toEqual(select(viewModelStateSelector));\n            generator.next({\n                searchCustomerForm: {\n                    validateFields: validateFields,\n                    getFieldsError: getFieldsError,\n                }\n            });\n            expect(validateFields.mock.calls.length).toBe(1);\n            expect(getFieldsError.mock.calls.length).toBe(1);\n            expect(mockCall.mock.calls.length).toBe(0);\n            expect(mockPut.mock.calls.length).toBe(0);\n\n        });\n\n        test('fetch result has network error', () => {\n            const validateFields = jest.fn();\n            const getFieldsError = jest.fn();\n\n\n            getFieldsError.mockReturnValue({});\n            const generator = app.effects.searchCustomerFormSubmit({}, { select, call, put });\n\n            let next = generator.next();\n            expect(next.value).toEqual(select(viewModelStateSelector));\n            next = generator.next({\n                searchCustomerForm: {\n                    validateFields: validateFields,\n                    getFieldsError: getFieldsError,\n                }\n            });\n\n            expect(validateFields.mock.calls.length).toBe(1);\n            expect(getFieldsError.mock.calls.length).toBe(1);\n            expect(next.value).toEqual(select(viewModelStateSelector));\n            next = generator.next({\n                searchCustomerFormPhone: {\n                    phone: ''\n }\n            });\n            expect(next.value).toEqual(put({ type: 'saveIsSearchCustomerFormLoading', payload: true }));\n\n            next = generator.next();\n            expect(next.value).toEqual(call(request, api.searchOneCustomerByPhone('')));\n\n            next = generator.throw(new NetworkException());\n            expect(next.value).toEqual(put({\n                type: 'catchException',\n                payload: new MessageException('网络错误，请重试！'),\n            }));\n        });\n\n        test('fetch result XGcbJsonCode === 0 customer === null', () => {\n            const validateFields = jest.fn();\n            const getFieldsError = jest.fn();\n\n\n            getFieldsError.mockReturnValue({});\n            const generator = app.effects.searchCustomerFormSubmit({}, { select, call, put });\n\n            let next = generator.next();\n            expect(next.value).toEqual(select(viewModelStateSelector));\n            next = generator.next({\n                searchCustomerForm: {\n                    validateFields: validateFields,\n                    getFieldsError: getFieldsError,\n                }\n            });\n\n            expect(validateFields.mock.calls.length).toBe(1);\n            expect(getFieldsError.mock.calls.length).toBe(1);\n            expect(next.value).toEqual(select(viewModelStateSelector));\n            next = generator.next({\n                searchCustomerFormPhone: {\n                    phone: ''\n }\n            });\n            expect(next.value).toEqual(put({ type: 'saveIsSearchCustomerFormLoading', payload: true }));\n\n            next = generator.next();\n            expect(next.value).toEqual(call(request, api.searchOneCustomerByPhone('')));\n\n            next = generator.next({\n                XGcbJsonCode: 0,\n                XGcbJsonResult: {\n                    customer: null\n }\n            });\n            expect(next.value).toEqual(put({ type: 'saveIsSearchCustomerFormLoading', payload: false }));\n\n            next = generator.next();\n            expect(next.value).toEqual(put({ type: 'createCustomerFormOpen' }));\n        });\n\n        test('fetch result XGcbJsonCode === 0 customer !== null', () => {\n            const validateFields = jest.fn();\n            const getFieldsError = jest.fn();\n\n\n            getFieldsError.mockReturnValue({});\n            const generator = app.effects.searchCustomerFormSubmit({}, { select, call, put });\n\n            let next = generator.next();\n            expect(next.value).toEqual(select(viewModelStateSelector));\n            next = generator.next({\n                searchCustomerForm: {\n                    validateFields: validateFields,\n                    getFieldsError: getFieldsError,\n                }\n            });\n\n            expect(validateFields.mock.calls.length).toBe(1);\n            expect(getFieldsError.mock.calls.length).toBe(1);\n            expect(next.value).toEqual(select(viewModelStateSelector));\n            next = generator.next({\n                searchCustomerFormPhone: {\n                    phone: ''\n }\n            });\n            expect(next.value).toEqual(put({ type: 'saveIsSearchCustomerFormLoading', payload: true }));\n\n            next = generator.next();\n            expect(next.value).toEqual(call(request, api.searchOneCustomerByPhone('')));\n\n            next = generator.next({\n                XGcbJsonCode: 0,\n                XGcbJsonResult: {\n                    customer: {}\n                }\n            });\n            expect(next.value).toEqual(put({ type: 'saveIsSearchCustomerFormLoading', payload: false }));\n\n            next = generator.next();\n            expect(next.value).toEqual(put({\n                type: 'saveSearchCustomerList', payload: {\n                    data_list: [{}],\n                    total_item_count: 1,\n                }\n            }));\n        });\n\n        test('fetch result XGcbJsonCode !== 0', () => {\n            const validateFields = jest.fn();\n            const getFieldsError = jest.fn();\n\n            getFieldsError.mockReturnValue({});\n            const generator = app.effects.searchCustomerFormSubmit({}, { select, call, put });\n\n            let next = generator.next();\n            expect(next.value).toEqual(select(viewModelStateSelector));\n            next = generator.next({\n                searchCustomerForm: {\n                    validateFields: validateFields,\n                    getFieldsError: getFieldsError,\n                }\n            });\n\n            expect(validateFields.mock.calls.length).toBe(1);\n            expect(getFieldsError.mock.calls.length).toBe(1);\n            expect(next.value).toEqual(select(viewModelStateSelector));\n            next = generator.next({\n                searchCustomerFormPhone: {\n                    phone: ''\n }\n            });\n            expect(next.value).toEqual(put({ type: 'saveIsSearchCustomerFormLoading', payload: true }));\n\n            next = generator.next();\n            expect(next.value).toEqual(call(request, api.searchOneCustomerByPhone('')));\n\n            next = generator.next({\n                XGcbJsonCode: 222,\n                XGcbJsonResult: {\n                    customer: null\n }\n            });\n            expect(next.value).toEqual(put({ type: 'saveIsSearchCustomerFormLoading', payload: false }));\n\n            next = generator.next();\n            expect(next.value).toEqual(put({\n                type: 'catchException',\n                payload: new MessageException('无法找到客户配置信息，请重新尝试！'),\n            }));\n        });\n    });\n});\n```\n\n测试 effects 函数主要是测试 Generator 函数每一步是否与预期的相同\n\n相同的标准是值的相同和调取的参数是否一样\n\n值的相同  这里强调的是结果\n\n```javascript\nexpect(app.effects.searchCustomerFormSubmit({}, { select, call, put }).next().value).toEqual(put({ type: 'saveIsSearchCustomerFormLoading', payload: true }));\n```\n\n参数相同  这里强调的是行为\n\n```javascript\nexpect(mockPut).toHaveBeenCalledWith({ type: 'saveIsSearchCustomerFormLoading', payload: true });\n```\n\n测试用例的覆盖最基本的是要做到每个分支都要做一个流程的测试块\n\n```javascript\nif (!Object.keys(wrongFields).filter(field => wrongFields[field] !== undefined).length)\n```\n\n对应 \n\n```javascript\ntest('form has error', () => {});\n```\n\n```javascript\ntry\n```\n对应\n\n```javascript\ntest('fetch result has network error', () =>{});\n``` \n\n```javascript\nif (fetchResult.XGcbJsonCode === 0) \n```\n对应\n\n```javascript\ntest('fetch result XGcbJsonCode === 0 customer === null', () =>{});\n```\n\n```javascript \ntest('fetch result XGcbJsonCode === 0 customer !== null', () =>{});\n```\n\n```javascript\nif (fetchResult.XGcbJsonResult.customer === null)\n```\n对应\n\n```javascript\ntest('fetch result XGcbJsonCode === 0 customer === null', () =>{});\n```\n\n测试用例还要覆盖反例\n\n```javascript\ntest('fetch result XGcbJsonCode !== 0', () =>{});\n```\n\n```javascript\ntest('fetch result XGcbJsonCode === 0 customer !== null', () =>{});\n```\n\n对于像 select, call 这样有返回数据的要在next方法中添加mock数据\n\n```javascript\n next = generator.next({\n                XGcbJsonCode: 222,\n                XGcbJsonResult: {\n                    customer: null\n              }\n});\n````\n\nmock数据要覆盖全部分支用例\n\n```javascript\nnext = generator.next({\n                XGcbJsonCode: 0,\n                XGcbJsonResult: {\n                    customer: {}\n                }\n});\n``` \n ","source":"_posts/react-effects函数单元测试用例与实践体验.md","raw":"---\ntitle: react effects函数单元测试用例与实践体验\ndate: 2017-12-16 20:26:18\ntags: ['单元测试','unit test','react','effects']\ncategory: 'coding'\n---\neffects 函数是很强调业务的代码块\n\n所以复制的业务会有很多分支代码\n\n导致测试用例成倍的增长\n\n虽然测试用例相同的代码可以使用  beforeAll 和 afterAll 来归纳相同代码\n\n但是这样也使得测试代码本事的逻辑变的复杂 难以维护 难以理解\n\n所以对 effects 函数复杂业务的拆分是解决问题的关键\n\n把相同的业务进行抽取 做自己的的单元测试\n\n函数只写自己特有的代码\n<!--more-->\n被测试代码\n```javascript\nimport { Customer, Machine, Tenant } from 'models';\nimport { Error, parseResponse, request } from 'utils';\nimport { MessageException, NetworkException, Relocation } from 'exceptions';\nimport { Message, Modal } from 'antd';\n \n\nexport const api = {\n    searchOneCustomerByPhone: (params) => Customer.searchOneCustomerByPhone(params),\n    createCustomer: (params) => Customer.createCustomer(params),\n};\nexport default {\n    namespace: 'app',\n    state: {\n    },\n\n    reducers: {\n    },\n\n    effects: {\n\n        * catchException({ payload }, {}) {\n            throw payload;\n        },\n\n        * searchCustomerFormCancel({}, { put, select }) {\n            const { searchCustomerForm } = yield select(viewModelStateSelector);\n\n            yield put({ type: 'saveIsSearchCustomerFormVisible', payload: false });\n            searchCustomerForm.resetFields();\n            yield put({ type: 'saveSearchCustomerFormPhone', payload: { phone: '' } });\n            yield put({\n                type: 'saveSearchCustomerList', payload: {\n                    total_item_count: 0,\n                    data_list: [],\n                }\n            });\n        },\n\n        * searchCustomerFormSubmit({}, { call, put, select }) {\n            const { searchCustomerForm } = yield select(viewModelStateSelector);\n            searchCustomerForm.validateFields();\n            const wrongFields = searchCustomerForm.getFieldsError();\n            if (!Object.keys(wrongFields).filter(field => wrongFields[field] !== undefined).length) {\n                const { searchCustomerFormPhone } = yield select(viewModelStateSelector);\n\n                try {\n                    yield put({ type: 'saveIsSearchCustomerFormLoading', payload: true });\n                    const fetchResult = yield call(request, api.searchOneCustomerByPhone(searchCustomerFormPhone.phone));\n                    yield put({ type: 'saveIsSearchCustomerFormLoading', payload: false });\n\n                    if (fetchResult.XGcbJsonCode === 0) {\n\n                        if (fetchResult.XGcbJsonResult.customer === null) {\n                            yield put({ type: 'createCustomerFormOpen' });\n                        } else {\n                            yield put({\n                                type: 'saveSearchCustomerList', payload: {\n                                    data_list: [fetchResult.XGcbJsonResult.customer],\n                                    total_item_count: 1,\n                                }\n                            });\n                        }\n\n                    } else {\n                        yield put({\n                            type: 'catchException',\n                            payload: new MessageException(Error.getError(fetchResult.XGcbJsonCode, {}, '无法找到客户配置信息，请重新尝试！')),\n                        });\n                    }\n                } catch (e) {\n                    if (e instanceof NetworkException) {\n                        yield put({\n                            type: 'catchException',\n                            payload: new MessageException('网络错误，请重试！'),\n                        });\n                    } else {\n                        throw e;\n                    }\n                }\n            }\n        }, \n    }\n}\n```\n\n测试代码\n\n```javascript\nimport { effects } from 'dva/saga';\nimport { Error, parseResponse, request } from 'utils';\nimport { MessageException, NetworkException, RelocationException } from 'exceptions';\nimport app, { viewModelStateSelector, api } from './app';\n\nconst { call, put, select } = effects;\n\ndescribe('app model', () => {\n    test('name space', () => {\n        expect(app.namespace).toBe('app');\n    });\n\n    test('effects catchException has throw', () => {\n        expect(app.effects.catchException({ payload: new MessageException('这是一个错误测试') }, {})).toThrowError();\n    });\n\n    test('effects searchCustomerFormCancel', () => {\n        const resetFields = jest.fn();\n        const generator = app.effects.searchCustomerFormCancel({}, { select, put });\n\n /***\n * 在测试代码 只关心每一行代码的情况 每一行代码需要什么 不关心代码之间的关系\n * 上一行代码值可以通过被测试行的 mock 数据来代替\n * generator 的 next 与到 yield 就停止\n * generator 的 next 得到的是 {value:上一步 yield 的返回值, done:false}\n * generator 的 next 的参数作为上一次 yield 的返回值\n * 如果没有上一步 yield 在 generator 函数内永远返回 undefined\n * yield 的返回值不是作为 generator 函数内部变量的赋值 而是近视于 return 作为 generator 函数的 next() 方法返回值的 value 值\n * generator 函数内部变量要获取 yield 的返回值 只有依赖next() 方法参数的 value 值\n *\n function* f(x) {\n for(var i = 0; true; i++) {\n var reset = yield i;//这里的 reset 还是 undefined\n console.log('reset:' + reset);//这里的 reset 就根据 next() 的传递\n if(reset===false) { i = -1; }\n }\n }\n const g = f(0);\n let x = g.next(0);\n x = g.next(x.value);\n x = g.next(x.value);\n */\n\n //todo 函数开始\n let next = generator.next();\n\n  //todo 遇到第一个 yield 停止了 得到 yield 的返回值通过 next.value 等到 与期待值 select(viewModelStateSelector) 进行比较\n expect(next.value).toEqual(select(viewModelStateSelector));\n        \n  //todo 所以通过给next添加参数来 mock 上次 yield 的返回值\n //todo 因为在第一的 yield 是对返回值有定义的 而且对返回值有调用\n //todo 而这里的 next 获取的是 yield put({ type: 'saveIsSearchCustomerFormVisible', payload: false }); 的返回值\n next = generator.next({\n            searchCustomerForm: {\n                resetFields: resetFields,\n            }\n        });\n  //todo 进行数值比较\n expect(next.value).toEqual(put({ type: 'saveIsSearchCustomerFormVisible', payload: false }));\n\n  //todo 这里的 next 获取的是yield put({ type: 'saveSearchCustomerFormPhone', payload: { phone: '' } });的返回值\n //todo 同时我们要进行 yield select(viewModelStateSelector); 对应的 next 的输出的 mock 的函数行为测试\n //todo 这里的 next 对应的是 yield put({ type: 'saveSearchCustomerFormPhone', payload: { phone: '' } });\n next = generator.next();\n  //todo mock 函数只负责行为的测试\n expect(resetFields.mock.calls.length).toBe(1);\n  expect(resetFields.mock.calls[0].length).toBe(0);\n\n  //todo 这里是对数值的比较\n expect(next.value).toEqual(put({ type: 'saveSearchCustomerFormPhone', payload: { phone: '' } }));\n        next = generator.next();\n        expect(next.value).toEqual(put({\n            type: 'saveSearchCustomerList', payload: {\n                total_item_count: 0,\n                data_list: [],\n            }\n        }));\n    });\n\n  describe('effects searchCustomerFormSubmit', () => {//todo describe 包裹 test 反过来不测试\n test('form has error', () => {\n\n            const mockPut = jest.fn();\n            const mockCall = jest.fn();\n            const validateFields = jest.fn();\n            const getFieldsError = jest.fn();\n\n            getFieldsError.mockReturnValue({});\n\n            const generator = app.effects.searchCustomerFormSubmit({}, { mockCall, mockPut, select });\n\n            let next = generator.next();\n            expect(next.value).toEqual(select(viewModelStateSelector));\n            generator.next({\n                searchCustomerForm: {\n                    validateFields: validateFields,\n                    getFieldsError: getFieldsError,\n                }\n            });\n            expect(validateFields.mock.calls.length).toBe(1);\n            expect(getFieldsError.mock.calls.length).toBe(1);\n            expect(mockCall.mock.calls.length).toBe(0);\n            expect(mockPut.mock.calls.length).toBe(0);\n\n        });\n\n        test('fetch result has network error', () => {\n            const validateFields = jest.fn();\n            const getFieldsError = jest.fn();\n\n\n            getFieldsError.mockReturnValue({});\n            const generator = app.effects.searchCustomerFormSubmit({}, { select, call, put });\n\n            let next = generator.next();\n            expect(next.value).toEqual(select(viewModelStateSelector));\n            next = generator.next({\n                searchCustomerForm: {\n                    validateFields: validateFields,\n                    getFieldsError: getFieldsError,\n                }\n            });\n\n            expect(validateFields.mock.calls.length).toBe(1);\n            expect(getFieldsError.mock.calls.length).toBe(1);\n            expect(next.value).toEqual(select(viewModelStateSelector));\n            next = generator.next({\n                searchCustomerFormPhone: {\n                    phone: ''\n }\n            });\n            expect(next.value).toEqual(put({ type: 'saveIsSearchCustomerFormLoading', payload: true }));\n\n            next = generator.next();\n            expect(next.value).toEqual(call(request, api.searchOneCustomerByPhone('')));\n\n            next = generator.throw(new NetworkException());\n            expect(next.value).toEqual(put({\n                type: 'catchException',\n                payload: new MessageException('网络错误，请重试！'),\n            }));\n        });\n\n        test('fetch result XGcbJsonCode === 0 customer === null', () => {\n            const validateFields = jest.fn();\n            const getFieldsError = jest.fn();\n\n\n            getFieldsError.mockReturnValue({});\n            const generator = app.effects.searchCustomerFormSubmit({}, { select, call, put });\n\n            let next = generator.next();\n            expect(next.value).toEqual(select(viewModelStateSelector));\n            next = generator.next({\n                searchCustomerForm: {\n                    validateFields: validateFields,\n                    getFieldsError: getFieldsError,\n                }\n            });\n\n            expect(validateFields.mock.calls.length).toBe(1);\n            expect(getFieldsError.mock.calls.length).toBe(1);\n            expect(next.value).toEqual(select(viewModelStateSelector));\n            next = generator.next({\n                searchCustomerFormPhone: {\n                    phone: ''\n }\n            });\n            expect(next.value).toEqual(put({ type: 'saveIsSearchCustomerFormLoading', payload: true }));\n\n            next = generator.next();\n            expect(next.value).toEqual(call(request, api.searchOneCustomerByPhone('')));\n\n            next = generator.next({\n                XGcbJsonCode: 0,\n                XGcbJsonResult: {\n                    customer: null\n }\n            });\n            expect(next.value).toEqual(put({ type: 'saveIsSearchCustomerFormLoading', payload: false }));\n\n            next = generator.next();\n            expect(next.value).toEqual(put({ type: 'createCustomerFormOpen' }));\n        });\n\n        test('fetch result XGcbJsonCode === 0 customer !== null', () => {\n            const validateFields = jest.fn();\n            const getFieldsError = jest.fn();\n\n\n            getFieldsError.mockReturnValue({});\n            const generator = app.effects.searchCustomerFormSubmit({}, { select, call, put });\n\n            let next = generator.next();\n            expect(next.value).toEqual(select(viewModelStateSelector));\n            next = generator.next({\n                searchCustomerForm: {\n                    validateFields: validateFields,\n                    getFieldsError: getFieldsError,\n                }\n            });\n\n            expect(validateFields.mock.calls.length).toBe(1);\n            expect(getFieldsError.mock.calls.length).toBe(1);\n            expect(next.value).toEqual(select(viewModelStateSelector));\n            next = generator.next({\n                searchCustomerFormPhone: {\n                    phone: ''\n }\n            });\n            expect(next.value).toEqual(put({ type: 'saveIsSearchCustomerFormLoading', payload: true }));\n\n            next = generator.next();\n            expect(next.value).toEqual(call(request, api.searchOneCustomerByPhone('')));\n\n            next = generator.next({\n                XGcbJsonCode: 0,\n                XGcbJsonResult: {\n                    customer: {}\n                }\n            });\n            expect(next.value).toEqual(put({ type: 'saveIsSearchCustomerFormLoading', payload: false }));\n\n            next = generator.next();\n            expect(next.value).toEqual(put({\n                type: 'saveSearchCustomerList', payload: {\n                    data_list: [{}],\n                    total_item_count: 1,\n                }\n            }));\n        });\n\n        test('fetch result XGcbJsonCode !== 0', () => {\n            const validateFields = jest.fn();\n            const getFieldsError = jest.fn();\n\n            getFieldsError.mockReturnValue({});\n            const generator = app.effects.searchCustomerFormSubmit({}, { select, call, put });\n\n            let next = generator.next();\n            expect(next.value).toEqual(select(viewModelStateSelector));\n            next = generator.next({\n                searchCustomerForm: {\n                    validateFields: validateFields,\n                    getFieldsError: getFieldsError,\n                }\n            });\n\n            expect(validateFields.mock.calls.length).toBe(1);\n            expect(getFieldsError.mock.calls.length).toBe(1);\n            expect(next.value).toEqual(select(viewModelStateSelector));\n            next = generator.next({\n                searchCustomerFormPhone: {\n                    phone: ''\n }\n            });\n            expect(next.value).toEqual(put({ type: 'saveIsSearchCustomerFormLoading', payload: true }));\n\n            next = generator.next();\n            expect(next.value).toEqual(call(request, api.searchOneCustomerByPhone('')));\n\n            next = generator.next({\n                XGcbJsonCode: 222,\n                XGcbJsonResult: {\n                    customer: null\n }\n            });\n            expect(next.value).toEqual(put({ type: 'saveIsSearchCustomerFormLoading', payload: false }));\n\n            next = generator.next();\n            expect(next.value).toEqual(put({\n                type: 'catchException',\n                payload: new MessageException('无法找到客户配置信息，请重新尝试！'),\n            }));\n        });\n    });\n});\n```\n\n测试 effects 函数主要是测试 Generator 函数每一步是否与预期的相同\n\n相同的标准是值的相同和调取的参数是否一样\n\n值的相同  这里强调的是结果\n\n```javascript\nexpect(app.effects.searchCustomerFormSubmit({}, { select, call, put }).next().value).toEqual(put({ type: 'saveIsSearchCustomerFormLoading', payload: true }));\n```\n\n参数相同  这里强调的是行为\n\n```javascript\nexpect(mockPut).toHaveBeenCalledWith({ type: 'saveIsSearchCustomerFormLoading', payload: true });\n```\n\n测试用例的覆盖最基本的是要做到每个分支都要做一个流程的测试块\n\n```javascript\nif (!Object.keys(wrongFields).filter(field => wrongFields[field] !== undefined).length)\n```\n\n对应 \n\n```javascript\ntest('form has error', () => {});\n```\n\n```javascript\ntry\n```\n对应\n\n```javascript\ntest('fetch result has network error', () =>{});\n``` \n\n```javascript\nif (fetchResult.XGcbJsonCode === 0) \n```\n对应\n\n```javascript\ntest('fetch result XGcbJsonCode === 0 customer === null', () =>{});\n```\n\n```javascript \ntest('fetch result XGcbJsonCode === 0 customer !== null', () =>{});\n```\n\n```javascript\nif (fetchResult.XGcbJsonResult.customer === null)\n```\n对应\n\n```javascript\ntest('fetch result XGcbJsonCode === 0 customer === null', () =>{});\n```\n\n测试用例还要覆盖反例\n\n```javascript\ntest('fetch result XGcbJsonCode !== 0', () =>{});\n```\n\n```javascript\ntest('fetch result XGcbJsonCode === 0 customer !== null', () =>{});\n```\n\n对于像 select, call 这样有返回数据的要在next方法中添加mock数据\n\n```javascript\n next = generator.next({\n                XGcbJsonCode: 222,\n                XGcbJsonResult: {\n                    customer: null\n              }\n});\n````\n\nmock数据要覆盖全部分支用例\n\n```javascript\nnext = generator.next({\n                XGcbJsonCode: 0,\n                XGcbJsonResult: {\n                    customer: {}\n                }\n});\n``` \n ","slug":"react-effects函数单元测试用例与实践体验","published":1,"updated":"2019-02-20T02:50:38.474Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjsgue0e70005gpi631xcsa13","content":"<p>effects 函数是很强调业务的代码块</p>\n<p>所以复制的业务会有很多分支代码</p>\n<p>导致测试用例成倍的增长</p>\n<p>虽然测试用例相同的代码可以使用  beforeAll 和 afterAll 来归纳相同代码</p>\n<p>但是这样也使得测试代码本事的逻辑变的复杂 难以维护 难以理解</p>\n<p>所以对 effects 函数复杂业务的拆分是解决问题的关键</p>\n<p>把相同的业务进行抽取 做自己的的单元测试</p>\n<p>函数只写自己特有的代码<br><a id=\"more\"></a><br>被测试代码<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; Customer, Machine, Tenant &#125; <span class=\"keyword\">from</span> <span class=\"string\">'models'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"built_in\">Error</span>, parseResponse, request &#125; <span class=\"keyword\">from</span> <span class=\"string\">'utils'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; MessageException, NetworkException, Relocation &#125; <span class=\"keyword\">from</span> <span class=\"string\">'exceptions'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; Message, Modal &#125; <span class=\"keyword\">from</span> <span class=\"string\">'antd'</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> api = &#123;</span><br><span class=\"line\">    <span class=\"attr\">searchOneCustomerByPhone</span>: <span class=\"function\">(<span class=\"params\">params</span>) =&gt;</span> Customer.searchOneCustomerByPhone(params),</span><br><span class=\"line\">    <span class=\"attr\">createCustomer</span>: <span class=\"function\">(<span class=\"params\">params</span>) =&gt;</span> Customer.createCustomer(params),</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">namespace</span>: <span class=\"string\">'app'</span>,</span><br><span class=\"line\">    <span class=\"attr\">state</span>: &#123;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">reducers</span>: &#123;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">effects</span>: &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        * catchException(&#123; payload &#125;, &#123;&#125;) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> payload;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">        * searchCustomerFormCancel(&#123;&#125;, &#123; put, select &#125;) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> &#123; searchCustomerForm &#125; = <span class=\"keyword\">yield</span> select(viewModelStateSelector);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">yield</span> put(&#123; <span class=\"attr\">type</span>: <span class=\"string\">'saveIsSearchCustomerFormVisible'</span>, <span class=\"attr\">payload</span>: <span class=\"literal\">false</span> &#125;);</span><br><span class=\"line\">            searchCustomerForm.resetFields();</span><br><span class=\"line\">            <span class=\"keyword\">yield</span> put(&#123; <span class=\"attr\">type</span>: <span class=\"string\">'saveSearchCustomerFormPhone'</span>, <span class=\"attr\">payload</span>: &#123; <span class=\"attr\">phone</span>: <span class=\"string\">''</span> &#125; &#125;);</span><br><span class=\"line\">            <span class=\"keyword\">yield</span> put(&#123;</span><br><span class=\"line\">                <span class=\"attr\">type</span>: <span class=\"string\">'saveSearchCustomerList'</span>, <span class=\"attr\">payload</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">total_item_count</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">                    <span class=\"attr\">data_list</span>: [],</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">        * searchCustomerFormSubmit(&#123;&#125;, &#123; call, put, select &#125;) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> &#123; searchCustomerForm &#125; = <span class=\"keyword\">yield</span> select(viewModelStateSelector);</span><br><span class=\"line\">            searchCustomerForm.validateFields();</span><br><span class=\"line\">            <span class=\"keyword\">const</span> wrongFields = searchCustomerForm.getFieldsError();</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!<span class=\"built_in\">Object</span>.keys(wrongFields).filter(<span class=\"function\"><span class=\"params\">field</span> =&gt;</span> wrongFields[field] !== <span class=\"literal\">undefined</span>).length) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">const</span> &#123; searchCustomerFormPhone &#125; = <span class=\"keyword\">yield</span> select(viewModelStateSelector);</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">yield</span> put(&#123; <span class=\"attr\">type</span>: <span class=\"string\">'saveIsSearchCustomerFormLoading'</span>, <span class=\"attr\">payload</span>: <span class=\"literal\">true</span> &#125;);</span><br><span class=\"line\">                    <span class=\"keyword\">const</span> fetchResult = <span class=\"keyword\">yield</span> call(request, api.searchOneCustomerByPhone(searchCustomerFormPhone.phone));</span><br><span class=\"line\">                    <span class=\"keyword\">yield</span> put(&#123; <span class=\"attr\">type</span>: <span class=\"string\">'saveIsSearchCustomerFormLoading'</span>, <span class=\"attr\">payload</span>: <span class=\"literal\">false</span> &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (fetchResult.XGcbJsonCode === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (fetchResult.XGcbJsonResult.customer === <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                            <span class=\"keyword\">yield</span> put(&#123; <span class=\"attr\">type</span>: <span class=\"string\">'createCustomerFormOpen'</span> &#125;);</span><br><span class=\"line\">                        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                            <span class=\"keyword\">yield</span> put(&#123;</span><br><span class=\"line\">                                <span class=\"attr\">type</span>: <span class=\"string\">'saveSearchCustomerList'</span>, <span class=\"attr\">payload</span>: &#123;</span><br><span class=\"line\">                                    <span class=\"attr\">data_list</span>: [fetchResult.XGcbJsonResult.customer],</span><br><span class=\"line\">                                    <span class=\"attr\">total_item_count</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">                                &#125;</span><br><span class=\"line\">                            &#125;);</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">yield</span> put(&#123;</span><br><span class=\"line\">                            <span class=\"attr\">type</span>: <span class=\"string\">'catchException'</span>,</span><br><span class=\"line\">                            <span class=\"attr\">payload</span>: <span class=\"keyword\">new</span> MessageException(<span class=\"built_in\">Error</span>.getError(fetchResult.XGcbJsonCode, &#123;&#125;, <span class=\"string\">'无法找到客户配置信息，请重新尝试！'</span>)),</span><br><span class=\"line\">                        &#125;);</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (e <span class=\"keyword\">instanceof</span> NetworkException) &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">yield</span> put(&#123;</span><br><span class=\"line\">                            <span class=\"attr\">type</span>: <span class=\"string\">'catchException'</span>,</span><br><span class=\"line\">                            <span class=\"attr\">payload</span>: <span class=\"keyword\">new</span> MessageException(<span class=\"string\">'网络错误，请重试！'</span>),</span><br><span class=\"line\">                        &#125;);</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">throw</span> e;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;, </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>测试代码</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; effects &#125; <span class=\"keyword\">from</span> <span class=\"string\">'dva/saga'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"built_in\">Error</span>, parseResponse, request &#125; <span class=\"keyword\">from</span> <span class=\"string\">'utils'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; MessageException, NetworkException, RelocationException &#125; <span class=\"keyword\">from</span> <span class=\"string\">'exceptions'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> app, &#123; viewModelStateSelector, api &#125; <span class=\"keyword\">from</span> <span class=\"string\">'./app'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; call, put, select &#125; = effects;</span><br><span class=\"line\"></span><br><span class=\"line\">describe(<span class=\"string\">'app model'</span>, () =&gt; &#123;</span><br><span class=\"line\">    test(<span class=\"string\">'name space'</span>, () =&gt; &#123;</span><br><span class=\"line\">        expect(app.namespace).toBe(<span class=\"string\">'app'</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    test(<span class=\"string\">'effects catchException has throw'</span>, () =&gt; &#123;</span><br><span class=\"line\">        expect(app.effects.catchException(&#123; <span class=\"attr\">payload</span>: <span class=\"keyword\">new</span> MessageException(<span class=\"string\">'这是一个错误测试'</span>) &#125;, &#123;&#125;)).toThrowError();</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    test(<span class=\"string\">'effects searchCustomerFormCancel'</span>, () =&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> resetFields = jest.fn();</span><br><span class=\"line\">        <span class=\"keyword\">const</span> generator = app.effects.searchCustomerFormCancel(&#123;&#125;, &#123; select, put &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\">/***</span><br><span class=\"line\"> * 在测试代码 只关心每一行代码的情况 每一行代码需要什么 不关心代码之间的关系</span><br><span class=\"line\"> * 上一行代码值可以通过被测试行的 mock 数据来代替</span><br><span class=\"line\"> * generator 的 next 与到 yield 就停止</span><br><span class=\"line\"> * generator 的 next 得到的是 &#123;value:上一步 yield 的返回值, done:false&#125;</span><br><span class=\"line\"> * generator 的 next 的参数作为上一次 yield 的返回值</span><br><span class=\"line\"> * 如果没有上一步 yield 在 generator 函数内永远返回 undefined</span><br><span class=\"line\"> * yield 的返回值不是作为 generator 函数内部变量的赋值 而是近视于 return 作为 generator 函数的 next() 方法返回值的 value 值</span><br><span class=\"line\"> * generator 函数内部变量要获取 yield 的返回值 只有依赖next() 方法参数的 value 值</span><br><span class=\"line\"> *</span><br><span class=\"line\"> function* f(x) &#123;</span><br><span class=\"line\"> for(var i = 0; true; i++) &#123;</span><br><span class=\"line\"> var reset = yield i;//这里的 reset 还是 undefined</span><br><span class=\"line\"> console.log('reset:' + reset);//这里的 reset 就根据 next() 的传递</span><br><span class=\"line\"> if(reset===false) &#123; i = -1; &#125;</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"> const g = f(0);</span><br><span class=\"line\"> let x = g.next(0);</span><br><span class=\"line\"> x = g.next(x.value);</span><br><span class=\"line\"> x = g.next(x.value);</span><br><span class=\"line\"> */</span></span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\">//todo 函数开始</span></span><br><span class=\"line\"> <span class=\"keyword\">let</span> next = generator.next();</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//todo 遇到第一个 yield 停止了 得到 yield 的返回值通过 next.value 等到 与期待值 select(viewModelStateSelector) 进行比较</span></span><br><span class=\"line\"> expect(next.value).toEqual(select(viewModelStateSelector));</span><br><span class=\"line\">        </span><br><span class=\"line\">  <span class=\"comment\">//todo 所以通过给next添加参数来 mock 上次 yield 的返回值</span></span><br><span class=\"line\"> <span class=\"comment\">//todo 因为在第一的 yield 是对返回值有定义的 而且对返回值有调用</span></span><br><span class=\"line\"> <span class=\"comment\">//todo 而这里的 next 获取的是 yield put(&#123; type: 'saveIsSearchCustomerFormVisible', payload: false &#125;); 的返回值</span></span><br><span class=\"line\"> next = generator.next(&#123;</span><br><span class=\"line\">            <span class=\"attr\">searchCustomerForm</span>: &#123;</span><br><span class=\"line\">                <span class=\"attr\">resetFields</span>: resetFields,</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">  <span class=\"comment\">//todo 进行数值比较</span></span><br><span class=\"line\"> expect(next.value).toEqual(put(&#123; <span class=\"attr\">type</span>: <span class=\"string\">'saveIsSearchCustomerFormVisible'</span>, <span class=\"attr\">payload</span>: <span class=\"literal\">false</span> &#125;));</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//todo 这里的 next 获取的是yield put(&#123; type: 'saveSearchCustomerFormPhone', payload: &#123; phone: '' &#125; &#125;);的返回值</span></span><br><span class=\"line\"> <span class=\"comment\">//todo 同时我们要进行 yield select(viewModelStateSelector); 对应的 next 的输出的 mock 的函数行为测试</span></span><br><span class=\"line\"> <span class=\"comment\">//todo 这里的 next 对应的是 yield put(&#123; type: 'saveSearchCustomerFormPhone', payload: &#123; phone: '' &#125; &#125;);</span></span><br><span class=\"line\"> next = generator.next();</span><br><span class=\"line\">  <span class=\"comment\">//todo mock 函数只负责行为的测试</span></span><br><span class=\"line\"> expect(resetFields.mock.calls.length).toBe(<span class=\"number\">1</span>);</span><br><span class=\"line\">  expect(resetFields.mock.calls[<span class=\"number\">0</span>].length).toBe(<span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//todo 这里是对数值的比较</span></span><br><span class=\"line\"> expect(next.value).toEqual(put(&#123; <span class=\"attr\">type</span>: <span class=\"string\">'saveSearchCustomerFormPhone'</span>, <span class=\"attr\">payload</span>: &#123; <span class=\"attr\">phone</span>: <span class=\"string\">''</span> &#125; &#125;));</span><br><span class=\"line\">        next = generator.next();</span><br><span class=\"line\">        expect(next.value).toEqual(put(&#123;</span><br><span class=\"line\">            <span class=\"attr\">type</span>: <span class=\"string\">'saveSearchCustomerList'</span>, <span class=\"attr\">payload</span>: &#123;</span><br><span class=\"line\">                <span class=\"attr\">total_item_count</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">                <span class=\"attr\">data_list</span>: [],</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;));</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  describe(<span class=\"string\">'effects searchCustomerFormSubmit'</span>, () =&gt; &#123;<span class=\"comment\">//todo describe 包裹 test 反过来不测试</span></span><br><span class=\"line\"> test(<span class=\"string\">'form has error'</span>, () =&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">const</span> mockPut = jest.fn();</span><br><span class=\"line\">            <span class=\"keyword\">const</span> mockCall = jest.fn();</span><br><span class=\"line\">            <span class=\"keyword\">const</span> validateFields = jest.fn();</span><br><span class=\"line\">            <span class=\"keyword\">const</span> getFieldsError = jest.fn();</span><br><span class=\"line\"></span><br><span class=\"line\">            getFieldsError.mockReturnValue(&#123;&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">const</span> generator = app.effects.searchCustomerFormSubmit(&#123;&#125;, &#123; mockCall, mockPut, select &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">let</span> next = generator.next();</span><br><span class=\"line\">            expect(next.value).toEqual(select(viewModelStateSelector));</span><br><span class=\"line\">            generator.next(&#123;</span><br><span class=\"line\">                <span class=\"attr\">searchCustomerForm</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">validateFields</span>: validateFields,</span><br><span class=\"line\">                    <span class=\"attr\">getFieldsError</span>: getFieldsError,</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            expect(validateFields.mock.calls.length).toBe(<span class=\"number\">1</span>);</span><br><span class=\"line\">            expect(getFieldsError.mock.calls.length).toBe(<span class=\"number\">1</span>);</span><br><span class=\"line\">            expect(mockCall.mock.calls.length).toBe(<span class=\"number\">0</span>);</span><br><span class=\"line\">            expect(mockPut.mock.calls.length).toBe(<span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        test(<span class=\"string\">'fetch result has network error'</span>, () =&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> validateFields = jest.fn();</span><br><span class=\"line\">            <span class=\"keyword\">const</span> getFieldsError = jest.fn();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">            getFieldsError.mockReturnValue(&#123;&#125;);</span><br><span class=\"line\">            <span class=\"keyword\">const</span> generator = app.effects.searchCustomerFormSubmit(&#123;&#125;, &#123; select, call, put &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">let</span> next = generator.next();</span><br><span class=\"line\">            expect(next.value).toEqual(select(viewModelStateSelector));</span><br><span class=\"line\">            next = generator.next(&#123;</span><br><span class=\"line\">                <span class=\"attr\">searchCustomerForm</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">validateFields</span>: validateFields,</span><br><span class=\"line\">                    <span class=\"attr\">getFieldsError</span>: getFieldsError,</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">            expect(validateFields.mock.calls.length).toBe(<span class=\"number\">1</span>);</span><br><span class=\"line\">            expect(getFieldsError.mock.calls.length).toBe(<span class=\"number\">1</span>);</span><br><span class=\"line\">            expect(next.value).toEqual(select(viewModelStateSelector));</span><br><span class=\"line\">            next = generator.next(&#123;</span><br><span class=\"line\">                <span class=\"attr\">searchCustomerFormPhone</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">phone</span>: <span class=\"string\">''</span></span><br><span class=\"line\"> &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            expect(next.value).toEqual(put(&#123; <span class=\"attr\">type</span>: <span class=\"string\">'saveIsSearchCustomerFormLoading'</span>, <span class=\"attr\">payload</span>: <span class=\"literal\">true</span> &#125;));</span><br><span class=\"line\"></span><br><span class=\"line\">            next = generator.next();</span><br><span class=\"line\">            expect(next.value).toEqual(call(request, api.searchOneCustomerByPhone(<span class=\"string\">''</span>)));</span><br><span class=\"line\"></span><br><span class=\"line\">            next = generator.throw(<span class=\"keyword\">new</span> NetworkException());</span><br><span class=\"line\">            expect(next.value).toEqual(put(&#123;</span><br><span class=\"line\">                <span class=\"attr\">type</span>: <span class=\"string\">'catchException'</span>,</span><br><span class=\"line\">                <span class=\"attr\">payload</span>: <span class=\"keyword\">new</span> MessageException(<span class=\"string\">'网络错误，请重试！'</span>),</span><br><span class=\"line\">            &#125;));</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        test(<span class=\"string\">'fetch result XGcbJsonCode === 0 customer === null'</span>, () =&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> validateFields = jest.fn();</span><br><span class=\"line\">            <span class=\"keyword\">const</span> getFieldsError = jest.fn();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">            getFieldsError.mockReturnValue(&#123;&#125;);</span><br><span class=\"line\">            <span class=\"keyword\">const</span> generator = app.effects.searchCustomerFormSubmit(&#123;&#125;, &#123; select, call, put &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">let</span> next = generator.next();</span><br><span class=\"line\">            expect(next.value).toEqual(select(viewModelStateSelector));</span><br><span class=\"line\">            next = generator.next(&#123;</span><br><span class=\"line\">                <span class=\"attr\">searchCustomerForm</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">validateFields</span>: validateFields,</span><br><span class=\"line\">                    <span class=\"attr\">getFieldsError</span>: getFieldsError,</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">            expect(validateFields.mock.calls.length).toBe(<span class=\"number\">1</span>);</span><br><span class=\"line\">            expect(getFieldsError.mock.calls.length).toBe(<span class=\"number\">1</span>);</span><br><span class=\"line\">            expect(next.value).toEqual(select(viewModelStateSelector));</span><br><span class=\"line\">            next = generator.next(&#123;</span><br><span class=\"line\">                <span class=\"attr\">searchCustomerFormPhone</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">phone</span>: <span class=\"string\">''</span></span><br><span class=\"line\"> &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            expect(next.value).toEqual(put(&#123; <span class=\"attr\">type</span>: <span class=\"string\">'saveIsSearchCustomerFormLoading'</span>, <span class=\"attr\">payload</span>: <span class=\"literal\">true</span> &#125;));</span><br><span class=\"line\"></span><br><span class=\"line\">            next = generator.next();</span><br><span class=\"line\">            expect(next.value).toEqual(call(request, api.searchOneCustomerByPhone(<span class=\"string\">''</span>)));</span><br><span class=\"line\"></span><br><span class=\"line\">            next = generator.next(&#123;</span><br><span class=\"line\">                <span class=\"attr\">XGcbJsonCode</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">                <span class=\"attr\">XGcbJsonResult</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">customer</span>: <span class=\"literal\">null</span></span><br><span class=\"line\"> &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            expect(next.value).toEqual(put(&#123; <span class=\"attr\">type</span>: <span class=\"string\">'saveIsSearchCustomerFormLoading'</span>, <span class=\"attr\">payload</span>: <span class=\"literal\">false</span> &#125;));</span><br><span class=\"line\"></span><br><span class=\"line\">            next = generator.next();</span><br><span class=\"line\">            expect(next.value).toEqual(put(&#123; <span class=\"attr\">type</span>: <span class=\"string\">'createCustomerFormOpen'</span> &#125;));</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        test(<span class=\"string\">'fetch result XGcbJsonCode === 0 customer !== null'</span>, () =&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> validateFields = jest.fn();</span><br><span class=\"line\">            <span class=\"keyword\">const</span> getFieldsError = jest.fn();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">            getFieldsError.mockReturnValue(&#123;&#125;);</span><br><span class=\"line\">            <span class=\"keyword\">const</span> generator = app.effects.searchCustomerFormSubmit(&#123;&#125;, &#123; select, call, put &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">let</span> next = generator.next();</span><br><span class=\"line\">            expect(next.value).toEqual(select(viewModelStateSelector));</span><br><span class=\"line\">            next = generator.next(&#123;</span><br><span class=\"line\">                <span class=\"attr\">searchCustomerForm</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">validateFields</span>: validateFields,</span><br><span class=\"line\">                    <span class=\"attr\">getFieldsError</span>: getFieldsError,</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">            expect(validateFields.mock.calls.length).toBe(<span class=\"number\">1</span>);</span><br><span class=\"line\">            expect(getFieldsError.mock.calls.length).toBe(<span class=\"number\">1</span>);</span><br><span class=\"line\">            expect(next.value).toEqual(select(viewModelStateSelector));</span><br><span class=\"line\">            next = generator.next(&#123;</span><br><span class=\"line\">                <span class=\"attr\">searchCustomerFormPhone</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">phone</span>: <span class=\"string\">''</span></span><br><span class=\"line\"> &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            expect(next.value).toEqual(put(&#123; <span class=\"attr\">type</span>: <span class=\"string\">'saveIsSearchCustomerFormLoading'</span>, <span class=\"attr\">payload</span>: <span class=\"literal\">true</span> &#125;));</span><br><span class=\"line\"></span><br><span class=\"line\">            next = generator.next();</span><br><span class=\"line\">            expect(next.value).toEqual(call(request, api.searchOneCustomerByPhone(<span class=\"string\">''</span>)));</span><br><span class=\"line\"></span><br><span class=\"line\">            next = generator.next(&#123;</span><br><span class=\"line\">                <span class=\"attr\">XGcbJsonCode</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">                <span class=\"attr\">XGcbJsonResult</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">customer</span>: &#123;&#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            expect(next.value).toEqual(put(&#123; <span class=\"attr\">type</span>: <span class=\"string\">'saveIsSearchCustomerFormLoading'</span>, <span class=\"attr\">payload</span>: <span class=\"literal\">false</span> &#125;));</span><br><span class=\"line\"></span><br><span class=\"line\">            next = generator.next();</span><br><span class=\"line\">            expect(next.value).toEqual(put(&#123;</span><br><span class=\"line\">                <span class=\"attr\">type</span>: <span class=\"string\">'saveSearchCustomerList'</span>, <span class=\"attr\">payload</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">data_list</span>: [&#123;&#125;],</span><br><span class=\"line\">                    <span class=\"attr\">total_item_count</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;));</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        test(<span class=\"string\">'fetch result XGcbJsonCode !== 0'</span>, () =&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> validateFields = jest.fn();</span><br><span class=\"line\">            <span class=\"keyword\">const</span> getFieldsError = jest.fn();</span><br><span class=\"line\"></span><br><span class=\"line\">            getFieldsError.mockReturnValue(&#123;&#125;);</span><br><span class=\"line\">            <span class=\"keyword\">const</span> generator = app.effects.searchCustomerFormSubmit(&#123;&#125;, &#123; select, call, put &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">let</span> next = generator.next();</span><br><span class=\"line\">            expect(next.value).toEqual(select(viewModelStateSelector));</span><br><span class=\"line\">            next = generator.next(&#123;</span><br><span class=\"line\">                <span class=\"attr\">searchCustomerForm</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">validateFields</span>: validateFields,</span><br><span class=\"line\">                    <span class=\"attr\">getFieldsError</span>: getFieldsError,</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">            expect(validateFields.mock.calls.length).toBe(<span class=\"number\">1</span>);</span><br><span class=\"line\">            expect(getFieldsError.mock.calls.length).toBe(<span class=\"number\">1</span>);</span><br><span class=\"line\">            expect(next.value).toEqual(select(viewModelStateSelector));</span><br><span class=\"line\">            next = generator.next(&#123;</span><br><span class=\"line\">                <span class=\"attr\">searchCustomerFormPhone</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">phone</span>: <span class=\"string\">''</span></span><br><span class=\"line\"> &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            expect(next.value).toEqual(put(&#123; <span class=\"attr\">type</span>: <span class=\"string\">'saveIsSearchCustomerFormLoading'</span>, <span class=\"attr\">payload</span>: <span class=\"literal\">true</span> &#125;));</span><br><span class=\"line\"></span><br><span class=\"line\">            next = generator.next();</span><br><span class=\"line\">            expect(next.value).toEqual(call(request, api.searchOneCustomerByPhone(<span class=\"string\">''</span>)));</span><br><span class=\"line\"></span><br><span class=\"line\">            next = generator.next(&#123;</span><br><span class=\"line\">                <span class=\"attr\">XGcbJsonCode</span>: <span class=\"number\">222</span>,</span><br><span class=\"line\">                <span class=\"attr\">XGcbJsonResult</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">customer</span>: <span class=\"literal\">null</span></span><br><span class=\"line\"> &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            expect(next.value).toEqual(put(&#123; <span class=\"attr\">type</span>: <span class=\"string\">'saveIsSearchCustomerFormLoading'</span>, <span class=\"attr\">payload</span>: <span class=\"literal\">false</span> &#125;));</span><br><span class=\"line\"></span><br><span class=\"line\">            next = generator.next();</span><br><span class=\"line\">            expect(next.value).toEqual(put(&#123;</span><br><span class=\"line\">                <span class=\"attr\">type</span>: <span class=\"string\">'catchException'</span>,</span><br><span class=\"line\">                <span class=\"attr\">payload</span>: <span class=\"keyword\">new</span> MessageException(<span class=\"string\">'无法找到客户配置信息，请重新尝试！'</span>),</span><br><span class=\"line\">            &#125;));</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>测试 effects 函数主要是测试 Generator 函数每一步是否与预期的相同</p>\n<p>相同的标准是值的相同和调取的参数是否一样</p>\n<p>值的相同  这里强调的是结果</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">expect(app.effects.searchCustomerFormSubmit(&#123;&#125;, &#123; select, call, put &#125;).next().value).toEqual(put(&#123; <span class=\"attr\">type</span>: <span class=\"string\">'saveIsSearchCustomerFormLoading'</span>, <span class=\"attr\">payload</span>: <span class=\"literal\">true</span> &#125;));</span><br></pre></td></tr></table></figure>\n<p>参数相同  这里强调的是行为</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">expect(mockPut).toHaveBeenCalledWith(&#123; <span class=\"attr\">type</span>: <span class=\"string\">'saveIsSearchCustomerFormLoading'</span>, <span class=\"attr\">payload</span>: <span class=\"literal\">true</span> &#125;);</span><br></pre></td></tr></table></figure>\n<p>测试用例的覆盖最基本的是要做到每个分支都要做一个流程的测试块</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (!<span class=\"built_in\">Object</span>.keys(wrongFields).filter(<span class=\"function\"><span class=\"params\">field</span> =&gt;</span> wrongFields[field] !== <span class=\"literal\">undefined</span>).length)</span><br></pre></td></tr></table></figure>\n<p>对应 </p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">test(<span class=\"string\">'form has error'</span>, () =&gt; &#123;&#125;);</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">try</span></span><br></pre></td></tr></table></figure>\n<p>对应</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">test(<span class=\"string\">'fetch result has network error'</span>, () =&gt;&#123;&#125;);</span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">` </span><br><span class=\"line\"></span><br><span class=\"line\">`</span><span class=\"string\">``</span>javascript</span><br><span class=\"line\"><span class=\"keyword\">if</span> (fetchResult.XGcbJsonCode === <span class=\"number\">0</span>)</span><br></pre></td></tr></table></figure>\n<p>对应</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">test(<span class=\"string\">'fetch result XGcbJsonCode === 0 customer === null'</span>, () =&gt;&#123;&#125;);</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">test(<span class=\"string\">'fetch result XGcbJsonCode === 0 customer !== null'</span>, () =&gt;&#123;&#125;);</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (fetchResult.XGcbJsonResult.customer === <span class=\"literal\">null</span>)</span><br></pre></td></tr></table></figure>\n<p>对应</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">test(<span class=\"string\">'fetch result XGcbJsonCode === 0 customer === null'</span>, () =&gt;&#123;&#125;);</span><br></pre></td></tr></table></figure>\n<p>测试用例还要覆盖反例</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">test(<span class=\"string\">'fetch result XGcbJsonCode !== 0'</span>, () =&gt;&#123;&#125;);</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">test(<span class=\"string\">'fetch result XGcbJsonCode === 0 customer !== null'</span>, () =&gt;&#123;&#125;);</span><br></pre></td></tr></table></figure>\n<p>对于像 select, call 这样有返回数据的要在next方法中添加mock数据</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> next = generator.next(&#123;</span><br><span class=\"line\">                <span class=\"attr\">XGcbJsonCode</span>: <span class=\"number\">222</span>,</span><br><span class=\"line\">                <span class=\"attr\">XGcbJsonResult</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">customer</span>: <span class=\"literal\">null</span></span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"string\">`</span></span><br></pre></td></tr></table></figure>\n<p>mock数据要覆盖全部分支用例</p>\n<pre><code class=\"javascript\">next = generator.next({\n                XGcbJsonCode: <span class=\"number\">0</span>,\n                XGcbJsonResult: {\n                    customer: {}\n                }\n});\n</code></pre>\n","excerpt":"<p>effects 函数是很强调业务的代码块</p>\n<p>所以复制的业务会有很多分支代码</p>\n<p>导致测试用例成倍的增长</p>\n<p>虽然测试用例相同的代码可以使用  beforeAll 和 afterAll 来归纳相同代码</p>\n<p>但是这样也使得测试代码本事的逻辑变的复杂 难以维护 难以理解</p>\n<p>所以对 effects 函数复杂业务的拆分是解决问题的关键</p>\n<p>把相同的业务进行抽取 做自己的的单元测试</p>\n<p>函数只写自己特有的代码<br>","more":"<br>被测试代码<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; Customer, Machine, Tenant &#125; <span class=\"keyword\">from</span> <span class=\"string\">'models'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"built_in\">Error</span>, parseResponse, request &#125; <span class=\"keyword\">from</span> <span class=\"string\">'utils'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; MessageException, NetworkException, Relocation &#125; <span class=\"keyword\">from</span> <span class=\"string\">'exceptions'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; Message, Modal &#125; <span class=\"keyword\">from</span> <span class=\"string\">'antd'</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> api = &#123;</span><br><span class=\"line\">    <span class=\"attr\">searchOneCustomerByPhone</span>: <span class=\"function\">(<span class=\"params\">params</span>) =&gt;</span> Customer.searchOneCustomerByPhone(params),</span><br><span class=\"line\">    <span class=\"attr\">createCustomer</span>: <span class=\"function\">(<span class=\"params\">params</span>) =&gt;</span> Customer.createCustomer(params),</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">namespace</span>: <span class=\"string\">'app'</span>,</span><br><span class=\"line\">    <span class=\"attr\">state</span>: &#123;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">reducers</span>: &#123;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attr\">effects</span>: &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        * catchException(&#123; payload &#125;, &#123;&#125;) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> payload;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">        * searchCustomerFormCancel(&#123;&#125;, &#123; put, select &#125;) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> &#123; searchCustomerForm &#125; = <span class=\"keyword\">yield</span> select(viewModelStateSelector);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">yield</span> put(&#123; <span class=\"attr\">type</span>: <span class=\"string\">'saveIsSearchCustomerFormVisible'</span>, <span class=\"attr\">payload</span>: <span class=\"literal\">false</span> &#125;);</span><br><span class=\"line\">            searchCustomerForm.resetFields();</span><br><span class=\"line\">            <span class=\"keyword\">yield</span> put(&#123; <span class=\"attr\">type</span>: <span class=\"string\">'saveSearchCustomerFormPhone'</span>, <span class=\"attr\">payload</span>: &#123; <span class=\"attr\">phone</span>: <span class=\"string\">''</span> &#125; &#125;);</span><br><span class=\"line\">            <span class=\"keyword\">yield</span> put(&#123;</span><br><span class=\"line\">                <span class=\"attr\">type</span>: <span class=\"string\">'saveSearchCustomerList'</span>, <span class=\"attr\">payload</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">total_item_count</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">                    <span class=\"attr\">data_list</span>: [],</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">        * searchCustomerFormSubmit(&#123;&#125;, &#123; call, put, select &#125;) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> &#123; searchCustomerForm &#125; = <span class=\"keyword\">yield</span> select(viewModelStateSelector);</span><br><span class=\"line\">            searchCustomerForm.validateFields();</span><br><span class=\"line\">            <span class=\"keyword\">const</span> wrongFields = searchCustomerForm.getFieldsError();</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!<span class=\"built_in\">Object</span>.keys(wrongFields).filter(<span class=\"function\"><span class=\"params\">field</span> =&gt;</span> wrongFields[field] !== <span class=\"literal\">undefined</span>).length) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">const</span> &#123; searchCustomerFormPhone &#125; = <span class=\"keyword\">yield</span> select(viewModelStateSelector);</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">yield</span> put(&#123; <span class=\"attr\">type</span>: <span class=\"string\">'saveIsSearchCustomerFormLoading'</span>, <span class=\"attr\">payload</span>: <span class=\"literal\">true</span> &#125;);</span><br><span class=\"line\">                    <span class=\"keyword\">const</span> fetchResult = <span class=\"keyword\">yield</span> call(request, api.searchOneCustomerByPhone(searchCustomerFormPhone.phone));</span><br><span class=\"line\">                    <span class=\"keyword\">yield</span> put(&#123; <span class=\"attr\">type</span>: <span class=\"string\">'saveIsSearchCustomerFormLoading'</span>, <span class=\"attr\">payload</span>: <span class=\"literal\">false</span> &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (fetchResult.XGcbJsonCode === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (fetchResult.XGcbJsonResult.customer === <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                            <span class=\"keyword\">yield</span> put(&#123; <span class=\"attr\">type</span>: <span class=\"string\">'createCustomerFormOpen'</span> &#125;);</span><br><span class=\"line\">                        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                            <span class=\"keyword\">yield</span> put(&#123;</span><br><span class=\"line\">                                <span class=\"attr\">type</span>: <span class=\"string\">'saveSearchCustomerList'</span>, <span class=\"attr\">payload</span>: &#123;</span><br><span class=\"line\">                                    <span class=\"attr\">data_list</span>: [fetchResult.XGcbJsonResult.customer],</span><br><span class=\"line\">                                    <span class=\"attr\">total_item_count</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">                                &#125;</span><br><span class=\"line\">                            &#125;);</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">yield</span> put(&#123;</span><br><span class=\"line\">                            <span class=\"attr\">type</span>: <span class=\"string\">'catchException'</span>,</span><br><span class=\"line\">                            <span class=\"attr\">payload</span>: <span class=\"keyword\">new</span> MessageException(<span class=\"built_in\">Error</span>.getError(fetchResult.XGcbJsonCode, &#123;&#125;, <span class=\"string\">'无法找到客户配置信息，请重新尝试！'</span>)),</span><br><span class=\"line\">                        &#125;);</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (e <span class=\"keyword\">instanceof</span> NetworkException) &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">yield</span> put(&#123;</span><br><span class=\"line\">                            <span class=\"attr\">type</span>: <span class=\"string\">'catchException'</span>,</span><br><span class=\"line\">                            <span class=\"attr\">payload</span>: <span class=\"keyword\">new</span> MessageException(<span class=\"string\">'网络错误，请重试！'</span>),</span><br><span class=\"line\">                        &#125;);</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">throw</span> e;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;, </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>测试代码</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; effects &#125; <span class=\"keyword\">from</span> <span class=\"string\">'dva/saga'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"built_in\">Error</span>, parseResponse, request &#125; <span class=\"keyword\">from</span> <span class=\"string\">'utils'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; MessageException, NetworkException, RelocationException &#125; <span class=\"keyword\">from</span> <span class=\"string\">'exceptions'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> app, &#123; viewModelStateSelector, api &#125; <span class=\"keyword\">from</span> <span class=\"string\">'./app'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; call, put, select &#125; = effects;</span><br><span class=\"line\"></span><br><span class=\"line\">describe(<span class=\"string\">'app model'</span>, () =&gt; &#123;</span><br><span class=\"line\">    test(<span class=\"string\">'name space'</span>, () =&gt; &#123;</span><br><span class=\"line\">        expect(app.namespace).toBe(<span class=\"string\">'app'</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    test(<span class=\"string\">'effects catchException has throw'</span>, () =&gt; &#123;</span><br><span class=\"line\">        expect(app.effects.catchException(&#123; <span class=\"attr\">payload</span>: <span class=\"keyword\">new</span> MessageException(<span class=\"string\">'这是一个错误测试'</span>) &#125;, &#123;&#125;)).toThrowError();</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    test(<span class=\"string\">'effects searchCustomerFormCancel'</span>, () =&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> resetFields = jest.fn();</span><br><span class=\"line\">        <span class=\"keyword\">const</span> generator = app.effects.searchCustomerFormCancel(&#123;&#125;, &#123; select, put &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\">/***</span><br><span class=\"line\"> * 在测试代码 只关心每一行代码的情况 每一行代码需要什么 不关心代码之间的关系</span><br><span class=\"line\"> * 上一行代码值可以通过被测试行的 mock 数据来代替</span><br><span class=\"line\"> * generator 的 next 与到 yield 就停止</span><br><span class=\"line\"> * generator 的 next 得到的是 &#123;value:上一步 yield 的返回值, done:false&#125;</span><br><span class=\"line\"> * generator 的 next 的参数作为上一次 yield 的返回值</span><br><span class=\"line\"> * 如果没有上一步 yield 在 generator 函数内永远返回 undefined</span><br><span class=\"line\"> * yield 的返回值不是作为 generator 函数内部变量的赋值 而是近视于 return 作为 generator 函数的 next() 方法返回值的 value 值</span><br><span class=\"line\"> * generator 函数内部变量要获取 yield 的返回值 只有依赖next() 方法参数的 value 值</span><br><span class=\"line\"> *</span><br><span class=\"line\"> function* f(x) &#123;</span><br><span class=\"line\"> for(var i = 0; true; i++) &#123;</span><br><span class=\"line\"> var reset = yield i;//这里的 reset 还是 undefined</span><br><span class=\"line\"> console.log('reset:' + reset);//这里的 reset 就根据 next() 的传递</span><br><span class=\"line\"> if(reset===false) &#123; i = -1; &#125;</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"> const g = f(0);</span><br><span class=\"line\"> let x = g.next(0);</span><br><span class=\"line\"> x = g.next(x.value);</span><br><span class=\"line\"> x = g.next(x.value);</span><br><span class=\"line\"> */</span></span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\">//todo 函数开始</span></span><br><span class=\"line\"> <span class=\"keyword\">let</span> next = generator.next();</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//todo 遇到第一个 yield 停止了 得到 yield 的返回值通过 next.value 等到 与期待值 select(viewModelStateSelector) 进行比较</span></span><br><span class=\"line\"> expect(next.value).toEqual(select(viewModelStateSelector));</span><br><span class=\"line\">        </span><br><span class=\"line\">  <span class=\"comment\">//todo 所以通过给next添加参数来 mock 上次 yield 的返回值</span></span><br><span class=\"line\"> <span class=\"comment\">//todo 因为在第一的 yield 是对返回值有定义的 而且对返回值有调用</span></span><br><span class=\"line\"> <span class=\"comment\">//todo 而这里的 next 获取的是 yield put(&#123; type: 'saveIsSearchCustomerFormVisible', payload: false &#125;); 的返回值</span></span><br><span class=\"line\"> next = generator.next(&#123;</span><br><span class=\"line\">            <span class=\"attr\">searchCustomerForm</span>: &#123;</span><br><span class=\"line\">                <span class=\"attr\">resetFields</span>: resetFields,</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">  <span class=\"comment\">//todo 进行数值比较</span></span><br><span class=\"line\"> expect(next.value).toEqual(put(&#123; <span class=\"attr\">type</span>: <span class=\"string\">'saveIsSearchCustomerFormVisible'</span>, <span class=\"attr\">payload</span>: <span class=\"literal\">false</span> &#125;));</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//todo 这里的 next 获取的是yield put(&#123; type: 'saveSearchCustomerFormPhone', payload: &#123; phone: '' &#125; &#125;);的返回值</span></span><br><span class=\"line\"> <span class=\"comment\">//todo 同时我们要进行 yield select(viewModelStateSelector); 对应的 next 的输出的 mock 的函数行为测试</span></span><br><span class=\"line\"> <span class=\"comment\">//todo 这里的 next 对应的是 yield put(&#123; type: 'saveSearchCustomerFormPhone', payload: &#123; phone: '' &#125; &#125;);</span></span><br><span class=\"line\"> next = generator.next();</span><br><span class=\"line\">  <span class=\"comment\">//todo mock 函数只负责行为的测试</span></span><br><span class=\"line\"> expect(resetFields.mock.calls.length).toBe(<span class=\"number\">1</span>);</span><br><span class=\"line\">  expect(resetFields.mock.calls[<span class=\"number\">0</span>].length).toBe(<span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//todo 这里是对数值的比较</span></span><br><span class=\"line\"> expect(next.value).toEqual(put(&#123; <span class=\"attr\">type</span>: <span class=\"string\">'saveSearchCustomerFormPhone'</span>, <span class=\"attr\">payload</span>: &#123; <span class=\"attr\">phone</span>: <span class=\"string\">''</span> &#125; &#125;));</span><br><span class=\"line\">        next = generator.next();</span><br><span class=\"line\">        expect(next.value).toEqual(put(&#123;</span><br><span class=\"line\">            <span class=\"attr\">type</span>: <span class=\"string\">'saveSearchCustomerList'</span>, <span class=\"attr\">payload</span>: &#123;</span><br><span class=\"line\">                <span class=\"attr\">total_item_count</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">                <span class=\"attr\">data_list</span>: [],</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;));</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  describe(<span class=\"string\">'effects searchCustomerFormSubmit'</span>, () =&gt; &#123;<span class=\"comment\">//todo describe 包裹 test 反过来不测试</span></span><br><span class=\"line\"> test(<span class=\"string\">'form has error'</span>, () =&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">const</span> mockPut = jest.fn();</span><br><span class=\"line\">            <span class=\"keyword\">const</span> mockCall = jest.fn();</span><br><span class=\"line\">            <span class=\"keyword\">const</span> validateFields = jest.fn();</span><br><span class=\"line\">            <span class=\"keyword\">const</span> getFieldsError = jest.fn();</span><br><span class=\"line\"></span><br><span class=\"line\">            getFieldsError.mockReturnValue(&#123;&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">const</span> generator = app.effects.searchCustomerFormSubmit(&#123;&#125;, &#123; mockCall, mockPut, select &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">let</span> next = generator.next();</span><br><span class=\"line\">            expect(next.value).toEqual(select(viewModelStateSelector));</span><br><span class=\"line\">            generator.next(&#123;</span><br><span class=\"line\">                <span class=\"attr\">searchCustomerForm</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">validateFields</span>: validateFields,</span><br><span class=\"line\">                    <span class=\"attr\">getFieldsError</span>: getFieldsError,</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            expect(validateFields.mock.calls.length).toBe(<span class=\"number\">1</span>);</span><br><span class=\"line\">            expect(getFieldsError.mock.calls.length).toBe(<span class=\"number\">1</span>);</span><br><span class=\"line\">            expect(mockCall.mock.calls.length).toBe(<span class=\"number\">0</span>);</span><br><span class=\"line\">            expect(mockPut.mock.calls.length).toBe(<span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        test(<span class=\"string\">'fetch result has network error'</span>, () =&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> validateFields = jest.fn();</span><br><span class=\"line\">            <span class=\"keyword\">const</span> getFieldsError = jest.fn();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">            getFieldsError.mockReturnValue(&#123;&#125;);</span><br><span class=\"line\">            <span class=\"keyword\">const</span> generator = app.effects.searchCustomerFormSubmit(&#123;&#125;, &#123; select, call, put &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">let</span> next = generator.next();</span><br><span class=\"line\">            expect(next.value).toEqual(select(viewModelStateSelector));</span><br><span class=\"line\">            next = generator.next(&#123;</span><br><span class=\"line\">                <span class=\"attr\">searchCustomerForm</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">validateFields</span>: validateFields,</span><br><span class=\"line\">                    <span class=\"attr\">getFieldsError</span>: getFieldsError,</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">            expect(validateFields.mock.calls.length).toBe(<span class=\"number\">1</span>);</span><br><span class=\"line\">            expect(getFieldsError.mock.calls.length).toBe(<span class=\"number\">1</span>);</span><br><span class=\"line\">            expect(next.value).toEqual(select(viewModelStateSelector));</span><br><span class=\"line\">            next = generator.next(&#123;</span><br><span class=\"line\">                <span class=\"attr\">searchCustomerFormPhone</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">phone</span>: <span class=\"string\">''</span></span><br><span class=\"line\"> &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            expect(next.value).toEqual(put(&#123; <span class=\"attr\">type</span>: <span class=\"string\">'saveIsSearchCustomerFormLoading'</span>, <span class=\"attr\">payload</span>: <span class=\"literal\">true</span> &#125;));</span><br><span class=\"line\"></span><br><span class=\"line\">            next = generator.next();</span><br><span class=\"line\">            expect(next.value).toEqual(call(request, api.searchOneCustomerByPhone(<span class=\"string\">''</span>)));</span><br><span class=\"line\"></span><br><span class=\"line\">            next = generator.throw(<span class=\"keyword\">new</span> NetworkException());</span><br><span class=\"line\">            expect(next.value).toEqual(put(&#123;</span><br><span class=\"line\">                <span class=\"attr\">type</span>: <span class=\"string\">'catchException'</span>,</span><br><span class=\"line\">                <span class=\"attr\">payload</span>: <span class=\"keyword\">new</span> MessageException(<span class=\"string\">'网络错误，请重试！'</span>),</span><br><span class=\"line\">            &#125;));</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        test(<span class=\"string\">'fetch result XGcbJsonCode === 0 customer === null'</span>, () =&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> validateFields = jest.fn();</span><br><span class=\"line\">            <span class=\"keyword\">const</span> getFieldsError = jest.fn();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">            getFieldsError.mockReturnValue(&#123;&#125;);</span><br><span class=\"line\">            <span class=\"keyword\">const</span> generator = app.effects.searchCustomerFormSubmit(&#123;&#125;, &#123; select, call, put &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">let</span> next = generator.next();</span><br><span class=\"line\">            expect(next.value).toEqual(select(viewModelStateSelector));</span><br><span class=\"line\">            next = generator.next(&#123;</span><br><span class=\"line\">                <span class=\"attr\">searchCustomerForm</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">validateFields</span>: validateFields,</span><br><span class=\"line\">                    <span class=\"attr\">getFieldsError</span>: getFieldsError,</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">            expect(validateFields.mock.calls.length).toBe(<span class=\"number\">1</span>);</span><br><span class=\"line\">            expect(getFieldsError.mock.calls.length).toBe(<span class=\"number\">1</span>);</span><br><span class=\"line\">            expect(next.value).toEqual(select(viewModelStateSelector));</span><br><span class=\"line\">            next = generator.next(&#123;</span><br><span class=\"line\">                <span class=\"attr\">searchCustomerFormPhone</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">phone</span>: <span class=\"string\">''</span></span><br><span class=\"line\"> &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            expect(next.value).toEqual(put(&#123; <span class=\"attr\">type</span>: <span class=\"string\">'saveIsSearchCustomerFormLoading'</span>, <span class=\"attr\">payload</span>: <span class=\"literal\">true</span> &#125;));</span><br><span class=\"line\"></span><br><span class=\"line\">            next = generator.next();</span><br><span class=\"line\">            expect(next.value).toEqual(call(request, api.searchOneCustomerByPhone(<span class=\"string\">''</span>)));</span><br><span class=\"line\"></span><br><span class=\"line\">            next = generator.next(&#123;</span><br><span class=\"line\">                <span class=\"attr\">XGcbJsonCode</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">                <span class=\"attr\">XGcbJsonResult</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">customer</span>: <span class=\"literal\">null</span></span><br><span class=\"line\"> &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            expect(next.value).toEqual(put(&#123; <span class=\"attr\">type</span>: <span class=\"string\">'saveIsSearchCustomerFormLoading'</span>, <span class=\"attr\">payload</span>: <span class=\"literal\">false</span> &#125;));</span><br><span class=\"line\"></span><br><span class=\"line\">            next = generator.next();</span><br><span class=\"line\">            expect(next.value).toEqual(put(&#123; <span class=\"attr\">type</span>: <span class=\"string\">'createCustomerFormOpen'</span> &#125;));</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        test(<span class=\"string\">'fetch result XGcbJsonCode === 0 customer !== null'</span>, () =&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> validateFields = jest.fn();</span><br><span class=\"line\">            <span class=\"keyword\">const</span> getFieldsError = jest.fn();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">            getFieldsError.mockReturnValue(&#123;&#125;);</span><br><span class=\"line\">            <span class=\"keyword\">const</span> generator = app.effects.searchCustomerFormSubmit(&#123;&#125;, &#123; select, call, put &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">let</span> next = generator.next();</span><br><span class=\"line\">            expect(next.value).toEqual(select(viewModelStateSelector));</span><br><span class=\"line\">            next = generator.next(&#123;</span><br><span class=\"line\">                <span class=\"attr\">searchCustomerForm</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">validateFields</span>: validateFields,</span><br><span class=\"line\">                    <span class=\"attr\">getFieldsError</span>: getFieldsError,</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">            expect(validateFields.mock.calls.length).toBe(<span class=\"number\">1</span>);</span><br><span class=\"line\">            expect(getFieldsError.mock.calls.length).toBe(<span class=\"number\">1</span>);</span><br><span class=\"line\">            expect(next.value).toEqual(select(viewModelStateSelector));</span><br><span class=\"line\">            next = generator.next(&#123;</span><br><span class=\"line\">                <span class=\"attr\">searchCustomerFormPhone</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">phone</span>: <span class=\"string\">''</span></span><br><span class=\"line\"> &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            expect(next.value).toEqual(put(&#123; <span class=\"attr\">type</span>: <span class=\"string\">'saveIsSearchCustomerFormLoading'</span>, <span class=\"attr\">payload</span>: <span class=\"literal\">true</span> &#125;));</span><br><span class=\"line\"></span><br><span class=\"line\">            next = generator.next();</span><br><span class=\"line\">            expect(next.value).toEqual(call(request, api.searchOneCustomerByPhone(<span class=\"string\">''</span>)));</span><br><span class=\"line\"></span><br><span class=\"line\">            next = generator.next(&#123;</span><br><span class=\"line\">                <span class=\"attr\">XGcbJsonCode</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">                <span class=\"attr\">XGcbJsonResult</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">customer</span>: &#123;&#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            expect(next.value).toEqual(put(&#123; <span class=\"attr\">type</span>: <span class=\"string\">'saveIsSearchCustomerFormLoading'</span>, <span class=\"attr\">payload</span>: <span class=\"literal\">false</span> &#125;));</span><br><span class=\"line\"></span><br><span class=\"line\">            next = generator.next();</span><br><span class=\"line\">            expect(next.value).toEqual(put(&#123;</span><br><span class=\"line\">                <span class=\"attr\">type</span>: <span class=\"string\">'saveSearchCustomerList'</span>, <span class=\"attr\">payload</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">data_list</span>: [&#123;&#125;],</span><br><span class=\"line\">                    <span class=\"attr\">total_item_count</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;));</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        test(<span class=\"string\">'fetch result XGcbJsonCode !== 0'</span>, () =&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> validateFields = jest.fn();</span><br><span class=\"line\">            <span class=\"keyword\">const</span> getFieldsError = jest.fn();</span><br><span class=\"line\"></span><br><span class=\"line\">            getFieldsError.mockReturnValue(&#123;&#125;);</span><br><span class=\"line\">            <span class=\"keyword\">const</span> generator = app.effects.searchCustomerFormSubmit(&#123;&#125;, &#123; select, call, put &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">let</span> next = generator.next();</span><br><span class=\"line\">            expect(next.value).toEqual(select(viewModelStateSelector));</span><br><span class=\"line\">            next = generator.next(&#123;</span><br><span class=\"line\">                <span class=\"attr\">searchCustomerForm</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">validateFields</span>: validateFields,</span><br><span class=\"line\">                    <span class=\"attr\">getFieldsError</span>: getFieldsError,</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">            expect(validateFields.mock.calls.length).toBe(<span class=\"number\">1</span>);</span><br><span class=\"line\">            expect(getFieldsError.mock.calls.length).toBe(<span class=\"number\">1</span>);</span><br><span class=\"line\">            expect(next.value).toEqual(select(viewModelStateSelector));</span><br><span class=\"line\">            next = generator.next(&#123;</span><br><span class=\"line\">                <span class=\"attr\">searchCustomerFormPhone</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">phone</span>: <span class=\"string\">''</span></span><br><span class=\"line\"> &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            expect(next.value).toEqual(put(&#123; <span class=\"attr\">type</span>: <span class=\"string\">'saveIsSearchCustomerFormLoading'</span>, <span class=\"attr\">payload</span>: <span class=\"literal\">true</span> &#125;));</span><br><span class=\"line\"></span><br><span class=\"line\">            next = generator.next();</span><br><span class=\"line\">            expect(next.value).toEqual(call(request, api.searchOneCustomerByPhone(<span class=\"string\">''</span>)));</span><br><span class=\"line\"></span><br><span class=\"line\">            next = generator.next(&#123;</span><br><span class=\"line\">                <span class=\"attr\">XGcbJsonCode</span>: <span class=\"number\">222</span>,</span><br><span class=\"line\">                <span class=\"attr\">XGcbJsonResult</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">customer</span>: <span class=\"literal\">null</span></span><br><span class=\"line\"> &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            expect(next.value).toEqual(put(&#123; <span class=\"attr\">type</span>: <span class=\"string\">'saveIsSearchCustomerFormLoading'</span>, <span class=\"attr\">payload</span>: <span class=\"literal\">false</span> &#125;));</span><br><span class=\"line\"></span><br><span class=\"line\">            next = generator.next();</span><br><span class=\"line\">            expect(next.value).toEqual(put(&#123;</span><br><span class=\"line\">                <span class=\"attr\">type</span>: <span class=\"string\">'catchException'</span>,</span><br><span class=\"line\">                <span class=\"attr\">payload</span>: <span class=\"keyword\">new</span> MessageException(<span class=\"string\">'无法找到客户配置信息，请重新尝试！'</span>),</span><br><span class=\"line\">            &#125;));</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>测试 effects 函数主要是测试 Generator 函数每一步是否与预期的相同</p>\n<p>相同的标准是值的相同和调取的参数是否一样</p>\n<p>值的相同  这里强调的是结果</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">expect(app.effects.searchCustomerFormSubmit(&#123;&#125;, &#123; select, call, put &#125;).next().value).toEqual(put(&#123; <span class=\"attr\">type</span>: <span class=\"string\">'saveIsSearchCustomerFormLoading'</span>, <span class=\"attr\">payload</span>: <span class=\"literal\">true</span> &#125;));</span><br></pre></td></tr></table></figure>\n<p>参数相同  这里强调的是行为</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">expect(mockPut).toHaveBeenCalledWith(&#123; <span class=\"attr\">type</span>: <span class=\"string\">'saveIsSearchCustomerFormLoading'</span>, <span class=\"attr\">payload</span>: <span class=\"literal\">true</span> &#125;);</span><br></pre></td></tr></table></figure>\n<p>测试用例的覆盖最基本的是要做到每个分支都要做一个流程的测试块</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (!<span class=\"built_in\">Object</span>.keys(wrongFields).filter(<span class=\"function\"><span class=\"params\">field</span> =&gt;</span> wrongFields[field] !== <span class=\"literal\">undefined</span>).length)</span><br></pre></td></tr></table></figure>\n<p>对应 </p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">test(<span class=\"string\">'form has error'</span>, () =&gt; &#123;&#125;);</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">try</span></span><br></pre></td></tr></table></figure>\n<p>对应</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">test(<span class=\"string\">'fetch result has network error'</span>, () =&gt;&#123;&#125;);</span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">` </span><br><span class=\"line\"></span><br><span class=\"line\">`</span><span class=\"string\">``</span>javascript</span><br><span class=\"line\"><span class=\"keyword\">if</span> (fetchResult.XGcbJsonCode === <span class=\"number\">0</span>)</span><br></pre></td></tr></table></figure>\n<p>对应</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">test(<span class=\"string\">'fetch result XGcbJsonCode === 0 customer === null'</span>, () =&gt;&#123;&#125;);</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">test(<span class=\"string\">'fetch result XGcbJsonCode === 0 customer !== null'</span>, () =&gt;&#123;&#125;);</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (fetchResult.XGcbJsonResult.customer === <span class=\"literal\">null</span>)</span><br></pre></td></tr></table></figure>\n<p>对应</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">test(<span class=\"string\">'fetch result XGcbJsonCode === 0 customer === null'</span>, () =&gt;&#123;&#125;);</span><br></pre></td></tr></table></figure>\n<p>测试用例还要覆盖反例</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">test(<span class=\"string\">'fetch result XGcbJsonCode !== 0'</span>, () =&gt;&#123;&#125;);</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">test(<span class=\"string\">'fetch result XGcbJsonCode === 0 customer !== null'</span>, () =&gt;&#123;&#125;);</span><br></pre></td></tr></table></figure>\n<p>对于像 select, call 这样有返回数据的要在next方法中添加mock数据</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> next = generator.next(&#123;</span><br><span class=\"line\">                <span class=\"attr\">XGcbJsonCode</span>: <span class=\"number\">222</span>,</span><br><span class=\"line\">                <span class=\"attr\">XGcbJsonResult</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">customer</span>: <span class=\"literal\">null</span></span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"string\">`</span></span><br></pre></td></tr></table></figure>\n<p>mock数据要覆盖全部分支用例</p>\n<pre><code class=\"javascript\">next = generator.next({\n                XGcbJsonCode: <span class=\"number\">0</span>,\n                XGcbJsonResult: {\n                    customer: {}\n                }\n});\n</code></pre>"},{"title":"shell学习笔记一","date":"2018-01-12T01:54:03.000Z","_content":"在计算机科学中，Shell俗称壳（用来区别于核），是指“提供使用者使用界面”的软件（命令解析器）。它类似于DOS下的command.com和后来的cmd.exe。它接收用户命令，然后调用相应的应用程序。\n<!--more-->\n## 给文件添加可以执行的权限\n```bash\nchmod +x shell-test.sh\n```\n\n## `#! /bin/bash` 执行解释器\n\n## shell 执行内建命令，`PATH`变量列出的目录中寻找特定的命令\n\n```bash\n#! /bin/bash\nll;\n```\n\n终端输出 \n\n```bash\n./shell-test.sh: line 2: ll: command not found\n```\n\n如果使用\n\n```bash\n#! /bin/bash\nls --color=auto -alF;\n```\n\n终端正常输出\n\n```bash\ntotal 0\ndrwxrwxrwx 0 root root 4096 Jan 11 20:18 ./\ndrwxrwxrwx 0 root root 4096 Jan 11 20:16 ../\ndrwxrwxrwx 0 root root 4096 Jan 11 20:17 .git/\n-rwxrwxrwx 1 root root  122 Jan 11 20:22 README.md*\n-rwxrwxrwx 1 root root   59 Jan 11 20:26 shell-test.sh*\n```\n\n查看 `PATH` 变量的内容\n\n```bash\necho $PATH;\n```\n\n## 使用 `&` 与 `;` 的区别\n\n* 使用 `&`，不用等待 `&`前的代码结束就可以执行后面的代码：\n\n```bash\n#! /bin/bash\ncd ../ & \nls --color=auto -alF;\n```\n\n终端输出当前目录文件列表\n\n* 使用 `;`，等待 `;`前的代码结束才可以执行后面的代码：\n\n```bash\n#! /bin/bash\ncd ../ ; \nls --color=auto -alF;\n```\n终端输出上一层目录文件列表\n\n## 变量\n\n* 变量名等号值要紧紧相贴\n* 使用变量的时候变量名前面要加$\n\n### \n```bash\n#! /bin/bash\ntest='hello shell'; \necho $test;\n```\n\n## echo 输出\n\n### 加不加单引号都可以，但是对于一些特殊字符还是需要单引号的：\n```bash\n#! /bin/bash\necho hello world;\necho 'hello world';\necho 'hello world;'\n```\n\n## printf 的输出\n\n```bash\n#! /bin/bash\nprintf 'hello world \\n';\nprintf 'hello world \\n';\n```\n### printf 字符串的传参\n\n```bash\n#! /bin/bash\nprintf '%s %s \\n' hello world;\n```\n\n今天就到这里，下次继续。","source":"_posts/shell学习笔记一.md","raw":"---\ntitle: shell学习笔记一\ndate: 2018-01-12 09:54:03\ntags: ['shell','bash','脚本','终端','命令行']\ncategory: 'coding'\n---\n在计算机科学中，Shell俗称壳（用来区别于核），是指“提供使用者使用界面”的软件（命令解析器）。它类似于DOS下的command.com和后来的cmd.exe。它接收用户命令，然后调用相应的应用程序。\n<!--more-->\n## 给文件添加可以执行的权限\n```bash\nchmod +x shell-test.sh\n```\n\n## `#! /bin/bash` 执行解释器\n\n## shell 执行内建命令，`PATH`变量列出的目录中寻找特定的命令\n\n```bash\n#! /bin/bash\nll;\n```\n\n终端输出 \n\n```bash\n./shell-test.sh: line 2: ll: command not found\n```\n\n如果使用\n\n```bash\n#! /bin/bash\nls --color=auto -alF;\n```\n\n终端正常输出\n\n```bash\ntotal 0\ndrwxrwxrwx 0 root root 4096 Jan 11 20:18 ./\ndrwxrwxrwx 0 root root 4096 Jan 11 20:16 ../\ndrwxrwxrwx 0 root root 4096 Jan 11 20:17 .git/\n-rwxrwxrwx 1 root root  122 Jan 11 20:22 README.md*\n-rwxrwxrwx 1 root root   59 Jan 11 20:26 shell-test.sh*\n```\n\n查看 `PATH` 变量的内容\n\n```bash\necho $PATH;\n```\n\n## 使用 `&` 与 `;` 的区别\n\n* 使用 `&`，不用等待 `&`前的代码结束就可以执行后面的代码：\n\n```bash\n#! /bin/bash\ncd ../ & \nls --color=auto -alF;\n```\n\n终端输出当前目录文件列表\n\n* 使用 `;`，等待 `;`前的代码结束才可以执行后面的代码：\n\n```bash\n#! /bin/bash\ncd ../ ; \nls --color=auto -alF;\n```\n终端输出上一层目录文件列表\n\n## 变量\n\n* 变量名等号值要紧紧相贴\n* 使用变量的时候变量名前面要加$\n\n### \n```bash\n#! /bin/bash\ntest='hello shell'; \necho $test;\n```\n\n## echo 输出\n\n### 加不加单引号都可以，但是对于一些特殊字符还是需要单引号的：\n```bash\n#! /bin/bash\necho hello world;\necho 'hello world';\necho 'hello world;'\n```\n\n## printf 的输出\n\n```bash\n#! /bin/bash\nprintf 'hello world \\n';\nprintf 'hello world \\n';\n```\n### printf 字符串的传参\n\n```bash\n#! /bin/bash\nprintf '%s %s \\n' hello world;\n```\n\n今天就到这里，下次继续。","slug":"shell学习笔记一","published":1,"updated":"2019-02-20T02:50:38.541Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjsgue0e90006gpi66ijio50o","content":"<p>在计算机科学中，Shell俗称壳（用来区别于核），是指“提供使用者使用界面”的软件（命令解析器）。它类似于DOS下的command.com和后来的cmd.exe。它接收用户命令，然后调用相应的应用程序。<br><a id=\"more\"></a></p>\n<h2 id=\"给文件添加可以执行的权限\"><a href=\"#给文件添加可以执行的权限\" class=\"headerlink\" title=\"给文件添加可以执行的权限\"></a>给文件添加可以执行的权限</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chmod +x shell-test.sh</span><br></pre></td></tr></table></figure>\n<h2 id=\"bin-bash-执行解释器\"><a href=\"#bin-bash-执行解释器\" class=\"headerlink\" title=\"#! /bin/bash 执行解释器\"></a><code>#! /bin/bash</code> 执行解释器</h2><h2 id=\"shell-执行内建命令，PATH变量列出的目录中寻找特定的命令\"><a href=\"#shell-执行内建命令，PATH变量列出的目录中寻找特定的命令\" class=\"headerlink\" title=\"shell 执行内建命令，PATH变量列出的目录中寻找特定的命令\"></a>shell 执行内建命令，<code>PATH</code>变量列出的目录中寻找特定的命令</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#! /bin/bash</span></span><br><span class=\"line\">ll;</span><br></pre></td></tr></table></figure>\n<p>终端输出 </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./shell-test.sh: line 2: ll: <span class=\"built_in\">command</span> not found</span><br></pre></td></tr></table></figure>\n<p>如果使用</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#! /bin/bash</span></span><br><span class=\"line\">ls --color=auto -alF;</span><br></pre></td></tr></table></figure>\n<p>终端正常输出</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">total 0</span><br><span class=\"line\">drwxrwxrwx 0 root root 4096 Jan 11 20:18 ./</span><br><span class=\"line\">drwxrwxrwx 0 root root 4096 Jan 11 20:16 ../</span><br><span class=\"line\">drwxrwxrwx 0 root root 4096 Jan 11 20:17 .git/</span><br><span class=\"line\">-rwxrwxrwx 1 root root  122 Jan 11 20:22 README.md*</span><br><span class=\"line\">-rwxrwxrwx 1 root root   59 Jan 11 20:26 shell-test.sh*</span><br></pre></td></tr></table></figure>\n<p>查看 <code>PATH</code> 变量的内容</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"variable\">$PATH</span>;</span><br></pre></td></tr></table></figure>\n<h2 id=\"使用-amp-与-的区别\"><a href=\"#使用-amp-与-的区别\" class=\"headerlink\" title=\"使用 &amp; 与 ; 的区别\"></a>使用 <code>&amp;</code> 与 <code>;</code> 的区别</h2><ul>\n<li>使用 <code>&amp;</code>，不用等待 <code>&amp;</code>前的代码结束就可以执行后面的代码：</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#! /bin/bash</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> ../ &amp; </span><br><span class=\"line\">ls --color=auto -alF;</span><br></pre></td></tr></table></figure>\n<p>终端输出当前目录文件列表</p>\n<ul>\n<li>使用 <code>;</code>，等待 <code>;</code>前的代码结束才可以执行后面的代码：</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#! /bin/bash</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> ../ ; </span><br><span class=\"line\">ls --color=auto -alF;</span><br></pre></td></tr></table></figure>\n<p>终端输出上一层目录文件列表</p>\n<h2 id=\"变量\"><a href=\"#变量\" class=\"headerlink\" title=\"变量\"></a>变量</h2><ul>\n<li>变量名等号值要紧紧相贴</li>\n<li>使用变量的时候变量名前面要加$</li>\n</ul>\n<p>###<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#! /bin/bash</span></span><br><span class=\"line\"><span class=\"built_in\">test</span>=<span class=\"string\">'hello shell'</span>; </span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"variable\">$test</span>;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"echo-输出\"><a href=\"#echo-输出\" class=\"headerlink\" title=\"echo 输出\"></a>echo 输出</h2><h3 id=\"加不加单引号都可以，但是对于一些特殊字符还是需要单引号的：\"><a href=\"#加不加单引号都可以，但是对于一些特殊字符还是需要单引号的：\" class=\"headerlink\" title=\"加不加单引号都可以，但是对于一些特殊字符还是需要单引号的：\"></a>加不加单引号都可以，但是对于一些特殊字符还是需要单引号的：</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#! /bin/bash</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> hello world;</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">'hello world'</span>;</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">'hello world;'</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"printf-的输出\"><a href=\"#printf-的输出\" class=\"headerlink\" title=\"printf 的输出\"></a>printf 的输出</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#! /bin/bash</span></span><br><span class=\"line\"><span class=\"built_in\">printf</span> <span class=\"string\">'hello world \\n'</span>;</span><br><span class=\"line\"><span class=\"built_in\">printf</span> <span class=\"string\">'hello world \\n'</span>;</span><br></pre></td></tr></table></figure>\n<h3 id=\"printf-字符串的传参\"><a href=\"#printf-字符串的传参\" class=\"headerlink\" title=\"printf 字符串的传参\"></a>printf 字符串的传参</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#! /bin/bash</span></span><br><span class=\"line\"><span class=\"built_in\">printf</span> <span class=\"string\">'%s %s \\n'</span> hello world;</span><br></pre></td></tr></table></figure>\n<p>今天就到这里，下次继续。</p>\n","excerpt":"<p>在计算机科学中，Shell俗称壳（用来区别于核），是指“提供使用者使用界面”的软件（命令解析器）。它类似于DOS下的command.com和后来的cmd.exe。它接收用户命令，然后调用相应的应用程序。<br>","more":"</p>\n<h2 id=\"给文件添加可以执行的权限\"><a href=\"#给文件添加可以执行的权限\" class=\"headerlink\" title=\"给文件添加可以执行的权限\"></a>给文件添加可以执行的权限</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chmod +x shell-test.sh</span><br></pre></td></tr></table></figure>\n<h2 id=\"bin-bash-执行解释器\"><a href=\"#bin-bash-执行解释器\" class=\"headerlink\" title=\"#! /bin/bash 执行解释器\"></a><code>#! /bin/bash</code> 执行解释器</h2><h2 id=\"shell-执行内建命令，PATH变量列出的目录中寻找特定的命令\"><a href=\"#shell-执行内建命令，PATH变量列出的目录中寻找特定的命令\" class=\"headerlink\" title=\"shell 执行内建命令，PATH变量列出的目录中寻找特定的命令\"></a>shell 执行内建命令，<code>PATH</code>变量列出的目录中寻找特定的命令</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#! /bin/bash</span></span><br><span class=\"line\">ll;</span><br></pre></td></tr></table></figure>\n<p>终端输出 </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./shell-test.sh: line 2: ll: <span class=\"built_in\">command</span> not found</span><br></pre></td></tr></table></figure>\n<p>如果使用</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#! /bin/bash</span></span><br><span class=\"line\">ls --color=auto -alF;</span><br></pre></td></tr></table></figure>\n<p>终端正常输出</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">total 0</span><br><span class=\"line\">drwxrwxrwx 0 root root 4096 Jan 11 20:18 ./</span><br><span class=\"line\">drwxrwxrwx 0 root root 4096 Jan 11 20:16 ../</span><br><span class=\"line\">drwxrwxrwx 0 root root 4096 Jan 11 20:17 .git/</span><br><span class=\"line\">-rwxrwxrwx 1 root root  122 Jan 11 20:22 README.md*</span><br><span class=\"line\">-rwxrwxrwx 1 root root   59 Jan 11 20:26 shell-test.sh*</span><br></pre></td></tr></table></figure>\n<p>查看 <code>PATH</code> 变量的内容</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"variable\">$PATH</span>;</span><br></pre></td></tr></table></figure>\n<h2 id=\"使用-amp-与-的区别\"><a href=\"#使用-amp-与-的区别\" class=\"headerlink\" title=\"使用 &amp; 与 ; 的区别\"></a>使用 <code>&amp;</code> 与 <code>;</code> 的区别</h2><ul>\n<li>使用 <code>&amp;</code>，不用等待 <code>&amp;</code>前的代码结束就可以执行后面的代码：</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#! /bin/bash</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> ../ &amp; </span><br><span class=\"line\">ls --color=auto -alF;</span><br></pre></td></tr></table></figure>\n<p>终端输出当前目录文件列表</p>\n<ul>\n<li>使用 <code>;</code>，等待 <code>;</code>前的代码结束才可以执行后面的代码：</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#! /bin/bash</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> ../ ; </span><br><span class=\"line\">ls --color=auto -alF;</span><br></pre></td></tr></table></figure>\n<p>终端输出上一层目录文件列表</p>\n<h2 id=\"变量\"><a href=\"#变量\" class=\"headerlink\" title=\"变量\"></a>变量</h2><ul>\n<li>变量名等号值要紧紧相贴</li>\n<li>使用变量的时候变量名前面要加$</li>\n</ul>\n<p>###<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#! /bin/bash</span></span><br><span class=\"line\"><span class=\"built_in\">test</span>=<span class=\"string\">'hello shell'</span>; </span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"variable\">$test</span>;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"echo-输出\"><a href=\"#echo-输出\" class=\"headerlink\" title=\"echo 输出\"></a>echo 输出</h2><h3 id=\"加不加单引号都可以，但是对于一些特殊字符还是需要单引号的：\"><a href=\"#加不加单引号都可以，但是对于一些特殊字符还是需要单引号的：\" class=\"headerlink\" title=\"加不加单引号都可以，但是对于一些特殊字符还是需要单引号的：\"></a>加不加单引号都可以，但是对于一些特殊字符还是需要单引号的：</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#! /bin/bash</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> hello world;</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">'hello world'</span>;</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">'hello world;'</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"printf-的输出\"><a href=\"#printf-的输出\" class=\"headerlink\" title=\"printf 的输出\"></a>printf 的输出</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#! /bin/bash</span></span><br><span class=\"line\"><span class=\"built_in\">printf</span> <span class=\"string\">'hello world \\n'</span>;</span><br><span class=\"line\"><span class=\"built_in\">printf</span> <span class=\"string\">'hello world \\n'</span>;</span><br></pre></td></tr></table></figure>\n<h3 id=\"printf-字符串的传参\"><a href=\"#printf-字符串的传参\" class=\"headerlink\" title=\"printf 字符串的传参\"></a>printf 字符串的传参</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#! /bin/bash</span></span><br><span class=\"line\"><span class=\"built_in\">printf</span> <span class=\"string\">'%s %s \\n'</span> hello world;</span><br></pre></td></tr></table></figure>\n<p>今天就到这里，下次继续。</p>"},{"title":"react基于state和props的父子组件和兄弟组件沟通","date":"2017-12-16T06:05:41.000Z","_content":"\n# react-state react状态管理\n\nReact是Facebook开源的一个用于构建用户界面的Javascript库，React专注于MVC架构中的V，即视图。\n\n## Virtual DOM\n\n是一个模拟 DOM 树的 JavaScript 对象。 React 使用 Virtual DOM 来渲染 UI， 同时监听 Virtual DOM 上数据的变化并自动迁移这些变化到 UI 上。\n\n## React Elements\n\n代表 HTML 元素的 JavaScript 对象。 这些 JavaScript 对象最后被编译成对应的 HTML 元素。\n\n## JSX\n\nReact 定义的一种 JavaScript 语法扩展，类似于 XML 。 JSX 是可选的， 我们完全可以使用 JavaScript 来编写 React 应用， 不过 JSX 提供了一套更为简便的方式来写 React 应用。<!--more-->\n\n```JSX\nvar div = React.createElement('div', null, \"Hello React\");\n// 使用 JSX\nvar div = <div>Hello React</div>;\n```\n\n## Components\n\n封装 React Elements， 包含一个或者多个 React Elements。 Components 用于创建可以复用的 UI 模块，例如 分页，侧栏导航等。\n\n```JSX\nvar HelloMessage = React.createClass({\n  render() {\n    return <div>Hello {this.props.name}</div>;\n  }\n});\n```\n\n## Props\n\n在上一个例子中，可以看到有一个特殊的引用： `this.props.name`。 这个引用称之为 `Props`，可以将他想象成 Component 的设置选项。\n\n在使用上， Props 类似于 HTML 中的属性：\n\n```JSX\nvar HelloMessage = React.createClass({\n  render() {\n    return <HelloMessage name=\"foo\" />;\n  }\n});\n```\n\n在 Component 内部，通过 this.props.name 来引用这个 Props：\n\n```JSX\nvar HelloMessage = React.createClass({\n  render() {\n    return <div>Hello {this.props.name}</div>;\n  }\n});\n```\n\n需要注意的是， Props 仅用来定制 Component， 这些数据不应该被改动。 如果涉及到需要做改动的数据， 得考虑使用 `state`。\n\n## Stateful Component\nState 数据代表 Component 的状态， 用于维护 Component 内部的状态。 当 State 发生改变之后， React 将会重新渲染 UI 。State 数据通过 this.state 访问：\n\n```JSX\nvar Greeting = React.createClass({\n  constructor () {\n    this.state = { greeted: false };\n  },\n  render() {\n    var response = this.state.greeted ? 'Yes' : 'No';\n\n    return (\n      <div>\n        <div>Hello React</div>\n        <span>{response}</span>\n        <button onClick={()=>{\n            this.setState({\n                    greeted: !this.state.greeted\n                });\n            },}>\n            Hi\n        </button>\n      </div>\n    );\n  }\n});\n```\n![dom action state的关系图](/0/state.png)\n\n当 State 发生改变后， React 将 Component 渲染到 Virtual DOM，新的 Virtual DOM 与 旧版本的进行比对，检查出改变的部分并更新浏览器的 DOM。 在这个例子中，当按钮被点击后， `greeted`状态数据发生了变化，UI 跟随着更新。\n\n\n## Props与State的结合\n```JSX\nvar Greeting = React.createClass({\n  constructor () {\n    this.state = { greeted: false };\n  },\n  \n  render() {\n    var response = this.state.greeted ? 'Yes' : 'No';\n\n    return (\n      <div>\n        <div>Hello {this.props.name}</div>\n        <span>{response}</span>\n         <button onClick={()=>{\n            this.setState({\n                    greeted: !this.state.greeted\n                });\n            },}>\n            Hi\n        </button>\n      </div>\n    );\n  }\n});\n\nvar users = [\"foo\", \"bar\", \"baz\"];\n\nvar GreetingApp = React.createClass({\n  render() {\n    var greetings = this.props.users.map((user)=>{\n      return <Greeting name={user} />;\n    });\n\n    return <div>{greetings}</div>;\n  }\n});\n```\n\n## 单向数据流\n\nReact是单向数据流，数据主要从父节点传递到子节点（通过props）。\n\n如果父级的某个props改变了，React会重渲染所有的子节点。\n\n### 父子组件沟通\n* 父组件更新组件状态  -----props----->　子组件更新\n* 子组件更新父组件状态   -----需要父组件传递回调函数----->  子组件调用触发\n\n>`子组件更新父组件就需要 父组件通过props传递一个回调函数到子组件中，这个回调函数可以更新父组件，子组件就是通过触发这个回调函数，从而使父组件得到更新。`\n\n![父子组件沟通](/0/propsFlow.png)\n\n```JSX\nconst Greeting = React.createClass({\n  constructor () {\n    this.state = { greeted: false };\n  },\n  render() {\n    var response = this.state.greeted ? 'Yes' : 'No';\n\n    return (\n      <div>\n        <div>Hello {this.props.name}</div>\n        <span>{response}</span>\n        <button onClick={()=>{\n            const greeted = !this.state.greeted;\n            this.setState({\n                    greeted: greeted,\n                });\n            this.props.changeName(greeted?'eric':'mazheng');   \n            },}>\n            Hi\n        </button>\n      </div>\n    );\n  }\n});\n\nconst UseGreeting = React.createClass({\n  constructor () {\n    this.state = { name: 'eric' };\n  },\n  render() {\n    return (\n        <Greeting\n            name={this.state.name}\n            changeName={(newName)=>{\n                this.setState({\n                    name: newName,\n                }); \n            }}\n        />\n    );\n  }\n});\n```\n\n### 兄弟组件沟通\n\n* 按照React单向数据流方式，我们需要借助父组件进行传递，通过父组件回调函数改变兄弟组件的props。\n\n![兄弟组件沟通](/0/brothers.png)\n\n","source":"_posts/react的state和基于props的父子组件和兄弟组件沟通.md","raw":"---\ntitle: react基于state和props的父子组件和兄弟组件沟通\ndate: 2017-12-16 14:05:41\ntags: ['react','state','props','组件沟通','信息传递']\ncategory: 'coding'\n---\n\n# react-state react状态管理\n\nReact是Facebook开源的一个用于构建用户界面的Javascript库，React专注于MVC架构中的V，即视图。\n\n## Virtual DOM\n\n是一个模拟 DOM 树的 JavaScript 对象。 React 使用 Virtual DOM 来渲染 UI， 同时监听 Virtual DOM 上数据的变化并自动迁移这些变化到 UI 上。\n\n## React Elements\n\n代表 HTML 元素的 JavaScript 对象。 这些 JavaScript 对象最后被编译成对应的 HTML 元素。\n\n## JSX\n\nReact 定义的一种 JavaScript 语法扩展，类似于 XML 。 JSX 是可选的， 我们完全可以使用 JavaScript 来编写 React 应用， 不过 JSX 提供了一套更为简便的方式来写 React 应用。<!--more-->\n\n```JSX\nvar div = React.createElement('div', null, \"Hello React\");\n// 使用 JSX\nvar div = <div>Hello React</div>;\n```\n\n## Components\n\n封装 React Elements， 包含一个或者多个 React Elements。 Components 用于创建可以复用的 UI 模块，例如 分页，侧栏导航等。\n\n```JSX\nvar HelloMessage = React.createClass({\n  render() {\n    return <div>Hello {this.props.name}</div>;\n  }\n});\n```\n\n## Props\n\n在上一个例子中，可以看到有一个特殊的引用： `this.props.name`。 这个引用称之为 `Props`，可以将他想象成 Component 的设置选项。\n\n在使用上， Props 类似于 HTML 中的属性：\n\n```JSX\nvar HelloMessage = React.createClass({\n  render() {\n    return <HelloMessage name=\"foo\" />;\n  }\n});\n```\n\n在 Component 内部，通过 this.props.name 来引用这个 Props：\n\n```JSX\nvar HelloMessage = React.createClass({\n  render() {\n    return <div>Hello {this.props.name}</div>;\n  }\n});\n```\n\n需要注意的是， Props 仅用来定制 Component， 这些数据不应该被改动。 如果涉及到需要做改动的数据， 得考虑使用 `state`。\n\n## Stateful Component\nState 数据代表 Component 的状态， 用于维护 Component 内部的状态。 当 State 发生改变之后， React 将会重新渲染 UI 。State 数据通过 this.state 访问：\n\n```JSX\nvar Greeting = React.createClass({\n  constructor () {\n    this.state = { greeted: false };\n  },\n  render() {\n    var response = this.state.greeted ? 'Yes' : 'No';\n\n    return (\n      <div>\n        <div>Hello React</div>\n        <span>{response}</span>\n        <button onClick={()=>{\n            this.setState({\n                    greeted: !this.state.greeted\n                });\n            },}>\n            Hi\n        </button>\n      </div>\n    );\n  }\n});\n```\n![dom action state的关系图](/0/state.png)\n\n当 State 发生改变后， React 将 Component 渲染到 Virtual DOM，新的 Virtual DOM 与 旧版本的进行比对，检查出改变的部分并更新浏览器的 DOM。 在这个例子中，当按钮被点击后， `greeted`状态数据发生了变化，UI 跟随着更新。\n\n\n## Props与State的结合\n```JSX\nvar Greeting = React.createClass({\n  constructor () {\n    this.state = { greeted: false };\n  },\n  \n  render() {\n    var response = this.state.greeted ? 'Yes' : 'No';\n\n    return (\n      <div>\n        <div>Hello {this.props.name}</div>\n        <span>{response}</span>\n         <button onClick={()=>{\n            this.setState({\n                    greeted: !this.state.greeted\n                });\n            },}>\n            Hi\n        </button>\n      </div>\n    );\n  }\n});\n\nvar users = [\"foo\", \"bar\", \"baz\"];\n\nvar GreetingApp = React.createClass({\n  render() {\n    var greetings = this.props.users.map((user)=>{\n      return <Greeting name={user} />;\n    });\n\n    return <div>{greetings}</div>;\n  }\n});\n```\n\n## 单向数据流\n\nReact是单向数据流，数据主要从父节点传递到子节点（通过props）。\n\n如果父级的某个props改变了，React会重渲染所有的子节点。\n\n### 父子组件沟通\n* 父组件更新组件状态  -----props----->　子组件更新\n* 子组件更新父组件状态   -----需要父组件传递回调函数----->  子组件调用触发\n\n>`子组件更新父组件就需要 父组件通过props传递一个回调函数到子组件中，这个回调函数可以更新父组件，子组件就是通过触发这个回调函数，从而使父组件得到更新。`\n\n![父子组件沟通](/0/propsFlow.png)\n\n```JSX\nconst Greeting = React.createClass({\n  constructor () {\n    this.state = { greeted: false };\n  },\n  render() {\n    var response = this.state.greeted ? 'Yes' : 'No';\n\n    return (\n      <div>\n        <div>Hello {this.props.name}</div>\n        <span>{response}</span>\n        <button onClick={()=>{\n            const greeted = !this.state.greeted;\n            this.setState({\n                    greeted: greeted,\n                });\n            this.props.changeName(greeted?'eric':'mazheng');   \n            },}>\n            Hi\n        </button>\n      </div>\n    );\n  }\n});\n\nconst UseGreeting = React.createClass({\n  constructor () {\n    this.state = { name: 'eric' };\n  },\n  render() {\n    return (\n        <Greeting\n            name={this.state.name}\n            changeName={(newName)=>{\n                this.setState({\n                    name: newName,\n                }); \n            }}\n        />\n    );\n  }\n});\n```\n\n### 兄弟组件沟通\n\n* 按照React单向数据流方式，我们需要借助父组件进行传递，通过父组件回调函数改变兄弟组件的props。\n\n![兄弟组件沟通](/0/brothers.png)\n\n","slug":"react的state和基于props的父子组件和兄弟组件沟通","published":1,"updated":"2020-06-01T14:22:08.828Z","_id":"cjsgue0ed0009gpi602zon8hj","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"react-state-react状态管理\"><a href=\"#react-state-react状态管理\" class=\"headerlink\" title=\"react-state react状态管理\"></a>react-state react状态管理</h1><p>React是Facebook开源的一个用于构建用户界面的Javascript库，React专注于MVC架构中的V，即视图。</p>\n<h2 id=\"Virtual-DOM\"><a href=\"#Virtual-DOM\" class=\"headerlink\" title=\"Virtual DOM\"></a>Virtual DOM</h2><p>是一个模拟 DOM 树的 JavaScript 对象。 React 使用 Virtual DOM 来渲染 UI， 同时监听 Virtual DOM 上数据的变化并自动迁移这些变化到 UI 上。</p>\n<h2 id=\"React-Elements\"><a href=\"#React-Elements\" class=\"headerlink\" title=\"React Elements\"></a>React Elements</h2><p>代表 HTML 元素的 JavaScript 对象。 这些 JavaScript 对象最后被编译成对应的 HTML 元素。</p>\n<h2 id=\"JSX\"><a href=\"#JSX\" class=\"headerlink\" title=\"JSX\"></a>JSX</h2><p>React 定义的一种 JavaScript 语法扩展，类似于 XML 。 JSX 是可选的， 我们完全可以使用 JavaScript 来编写 React 应用， 不过 JSX 提供了一套更为简便的方式来写 React 应用。<a id=\"more\"></a></p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> div = React.createElement(<span class=\"string\">'div'</span>, <span class=\"literal\">null</span>, <span class=\"string\">\"Hello React\"</span>);</span><br><span class=\"line\"><span class=\"comment\">// 使用 JSX</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> div = <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>Hello React<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span>;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Components\"><a href=\"#Components\" class=\"headerlink\" title=\"Components\"></a>Components</h2><p>封装 React Elements， 包含一个或者多个 React Elements。 Components 用于创建可以复用的 UI 模块，例如 分页，侧栏导航等。</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> HelloMessage = React.createClass(&#123;</span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>Hello &#123;this.props.name&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Props\"><a href=\"#Props\" class=\"headerlink\" title=\"Props\"></a>Props</h2><p>在上一个例子中，可以看到有一个特殊的引用： <code>this.props.name</code>。 这个引用称之为 <code>Props</code>，可以将他想象成 Component 的设置选项。</p>\n<p>在使用上， Props 类似于 HTML 中的属性：</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> HelloMessage = React.createClass(&#123;</span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">HelloMessage</span> <span class=\"attr\">name</span>=<span class=\"string\">\"foo\"</span> /&gt;</span></span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>在 Component 内部，通过 this.props.name 来引用这个 Props：</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> HelloMessage = React.createClass(&#123;</span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>Hello &#123;this.props.name&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>需要注意的是， Props 仅用来定制 Component， 这些数据不应该被改动。 如果涉及到需要做改动的数据， 得考虑使用 <code>state</code>。</p>\n<h2 id=\"Stateful-Component\"><a href=\"#Stateful-Component\" class=\"headerlink\" title=\"Stateful Component\"></a>Stateful Component</h2><p>State 数据代表 Component 的状态， 用于维护 Component 内部的状态。 当 State 发生改变之后， React 将会重新渲染 UI 。State 数据通过 this.state 访问：</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> Greeting = React.createClass(&#123;</span><br><span class=\"line\">  <span class=\"keyword\">constructor</span> () &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.state = &#123; <span class=\"attr\">greeted</span>: <span class=\"literal\">false</span> &#125;;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> response = <span class=\"keyword\">this</span>.state.greeted ? <span class=\"string\">'Yes'</span> : <span class=\"string\">'No'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      &lt;div&gt;</span><br><span class=\"line\">        &lt;div&gt;Hello React&lt;<span class=\"regexp\">/div&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">        &lt;span&gt;&#123;response&#125;&lt;/</span>span&gt;</span><br><span class=\"line\">        &lt;button onClick=&#123;()=&gt;&#123;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.setState(&#123;</span><br><span class=\"line\">                    greeted: !<span class=\"keyword\">this</span>.state.greeted</span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\">            &#125;,&#125;&gt;</span><br><span class=\"line\">            Hi</span><br><span class=\"line\">        &lt;<span class=\"regexp\">/button&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">      &lt;/</span>div&gt;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p><img src=\"/0/state.png\" alt=\"dom action state的关系图\"></p>\n<p>当 State 发生改变后， React 将 Component 渲染到 Virtual DOM，新的 Virtual DOM 与 旧版本的进行比对，检查出改变的部分并更新浏览器的 DOM。 在这个例子中，当按钮被点击后， <code>greeted</code>状态数据发生了变化，UI 跟随着更新。</p>\n<h2 id=\"Props与State的结合\"><a href=\"#Props与State的结合\" class=\"headerlink\" title=\"Props与State的结合\"></a>Props与State的结合</h2><figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> Greeting = React.createClass(&#123;</span><br><span class=\"line\">  <span class=\"keyword\">constructor</span> () &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.state = &#123; <span class=\"attr\">greeted</span>: <span class=\"literal\">false</span> &#125;;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  </span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> response = <span class=\"keyword\">this</span>.state.greeted ? <span class=\"string\">'Yes'</span> : <span class=\"string\">'No'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      &lt;div&gt;</span><br><span class=\"line\">        &lt;div&gt;Hello &#123;<span class=\"keyword\">this</span>.props.name&#125;&lt;<span class=\"regexp\">/div&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">        &lt;span&gt;&#123;response&#125;&lt;/</span>span&gt;</span><br><span class=\"line\">         &lt;button onClick=&#123;()=&gt;&#123;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.setState(&#123;</span><br><span class=\"line\">                    greeted: !<span class=\"keyword\">this</span>.state.greeted</span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\">            &#125;,&#125;&gt;</span><br><span class=\"line\">            Hi</span><br><span class=\"line\">        &lt;<span class=\"regexp\">/button&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">      &lt;/</span>div&gt;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> users = [<span class=\"string\">\"foo\"</span>, <span class=\"string\">\"bar\"</span>, <span class=\"string\">\"baz\"</span>];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> GreetingApp = React.createClass(&#123;</span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> greetings = <span class=\"keyword\">this</span>.props.users.map(<span class=\"function\">(<span class=\"params\">user</span>)=&gt;</span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">Greeting</span> <span class=\"attr\">name</span>=<span class=\"string\">&#123;user&#125;</span> /&gt;</span></span>;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;greetings&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"单向数据流\"><a href=\"#单向数据流\" class=\"headerlink\" title=\"单向数据流\"></a>单向数据流</h2><p>React是单向数据流，数据主要从父节点传递到子节点（通过props）。</p>\n<p>如果父级的某个props改变了，React会重渲染所有的子节点。</p>\n<h3 id=\"父子组件沟通\"><a href=\"#父子组件沟通\" class=\"headerlink\" title=\"父子组件沟通\"></a>父子组件沟通</h3><ul>\n<li>父组件更新组件状态  —–props—–&gt;　子组件更新</li>\n<li>子组件更新父组件状态   —–需要父组件传递回调函数—–&gt;  子组件调用触发</li>\n</ul>\n<blockquote>\n<p><code>子组件更新父组件就需要 父组件通过props传递一个回调函数到子组件中，这个回调函数可以更新父组件，子组件就是通过触发这个回调函数，从而使父组件得到更新。</code></p>\n</blockquote>\n<p><img src=\"/0/propsFlow.png\" alt=\"父子组件沟通\"></p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> Greeting = React.createClass(&#123;</span><br><span class=\"line\">  <span class=\"keyword\">constructor</span> () &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.state = &#123; <span class=\"attr\">greeted</span>: <span class=\"literal\">false</span> &#125;;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> response = <span class=\"keyword\">this</span>.state.greeted ? <span class=\"string\">'Yes'</span> : <span class=\"string\">'No'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      &lt;div&gt;</span><br><span class=\"line\">        &lt;div&gt;Hello &#123;<span class=\"keyword\">this</span>.props.name&#125;&lt;<span class=\"regexp\">/div&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">        &lt;span&gt;&#123;response&#125;&lt;/</span>span&gt;</span><br><span class=\"line\">        &lt;button onClick=&#123;()=&gt;&#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> greeted = !<span class=\"keyword\">this</span>.state.greeted;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.setState(&#123;</span><br><span class=\"line\">                    greeted: greeted,</span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.props.changeName(greeted?<span class=\"string\">'eric'</span>:<span class=\"string\">'mazheng'</span>);   </span><br><span class=\"line\">            &#125;,&#125;&gt;</span><br><span class=\"line\">            Hi</span><br><span class=\"line\">        &lt;<span class=\"regexp\">/button&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">      &lt;/</span>div&gt;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> UseGreeting = React.createClass(&#123;</span><br><span class=\"line\">  <span class=\"keyword\">constructor</span> () &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.state = &#123; <span class=\"attr\">name</span>: <span class=\"string\">'eric'</span> &#125;;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">        &lt;Greeting</span><br><span class=\"line\">            name=&#123;<span class=\"keyword\">this</span>.state.name&#125;</span><br><span class=\"line\">            changeName=&#123;(newName)=&gt;&#123;</span><br><span class=\"line\">                <span class=\"keyword\">this</span>.setState(&#123;</span><br><span class=\"line\">                    name: newName,</span><br><span class=\"line\">                &#125;); </span><br><span class=\"line\">            &#125;&#125;</span><br><span class=\"line\">        /&gt;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"兄弟组件沟通\"><a href=\"#兄弟组件沟通\" class=\"headerlink\" title=\"兄弟组件沟通\"></a>兄弟组件沟通</h3><ul>\n<li>按照React单向数据流方式，我们需要借助父组件进行传递，通过父组件回调函数改变兄弟组件的props。</li>\n</ul>\n<p><img src=\"/0/brothers.png\" alt=\"兄弟组件沟通\"></p>\n","site":{"data":{}},"excerpt":"<h1 id=\"react-state-react状态管理\"><a href=\"#react-state-react状态管理\" class=\"headerlink\" title=\"react-state react状态管理\"></a>react-state react状态管理</h1><p>React是Facebook开源的一个用于构建用户界面的Javascript库，React专注于MVC架构中的V，即视图。</p>\n<h2 id=\"Virtual-DOM\"><a href=\"#Virtual-DOM\" class=\"headerlink\" title=\"Virtual DOM\"></a>Virtual DOM</h2><p>是一个模拟 DOM 树的 JavaScript 对象。 React 使用 Virtual DOM 来渲染 UI， 同时监听 Virtual DOM 上数据的变化并自动迁移这些变化到 UI 上。</p>\n<h2 id=\"React-Elements\"><a href=\"#React-Elements\" class=\"headerlink\" title=\"React Elements\"></a>React Elements</h2><p>代表 HTML 元素的 JavaScript 对象。 这些 JavaScript 对象最后被编译成对应的 HTML 元素。</p>\n<h2 id=\"JSX\"><a href=\"#JSX\" class=\"headerlink\" title=\"JSX\"></a>JSX</h2><p>React 定义的一种 JavaScript 语法扩展，类似于 XML 。 JSX 是可选的， 我们完全可以使用 JavaScript 来编写 React 应用， 不过 JSX 提供了一套更为简便的方式来写 React 应用。","more":"</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> div = React.createElement(<span class=\"string\">'div'</span>, <span class=\"literal\">null</span>, <span class=\"string\">\"Hello React\"</span>);</span><br><span class=\"line\"><span class=\"comment\">// 使用 JSX</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> div = <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>Hello React<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span>;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Components\"><a href=\"#Components\" class=\"headerlink\" title=\"Components\"></a>Components</h2><p>封装 React Elements， 包含一个或者多个 React Elements。 Components 用于创建可以复用的 UI 模块，例如 分页，侧栏导航等。</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> HelloMessage = React.createClass(&#123;</span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>Hello &#123;this.props.name&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Props\"><a href=\"#Props\" class=\"headerlink\" title=\"Props\"></a>Props</h2><p>在上一个例子中，可以看到有一个特殊的引用： <code>this.props.name</code>。 这个引用称之为 <code>Props</code>，可以将他想象成 Component 的设置选项。</p>\n<p>在使用上， Props 类似于 HTML 中的属性：</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> HelloMessage = React.createClass(&#123;</span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">HelloMessage</span> <span class=\"attr\">name</span>=<span class=\"string\">\"foo\"</span> /&gt;</span></span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>在 Component 内部，通过 this.props.name 来引用这个 Props：</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> HelloMessage = React.createClass(&#123;</span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>Hello &#123;this.props.name&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>需要注意的是， Props 仅用来定制 Component， 这些数据不应该被改动。 如果涉及到需要做改动的数据， 得考虑使用 <code>state</code>。</p>\n<h2 id=\"Stateful-Component\"><a href=\"#Stateful-Component\" class=\"headerlink\" title=\"Stateful Component\"></a>Stateful Component</h2><p>State 数据代表 Component 的状态， 用于维护 Component 内部的状态。 当 State 发生改变之后， React 将会重新渲染 UI 。State 数据通过 this.state 访问：</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> Greeting = React.createClass(&#123;</span><br><span class=\"line\">  <span class=\"keyword\">constructor</span> () &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.state = &#123; <span class=\"attr\">greeted</span>: <span class=\"literal\">false</span> &#125;;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> response = <span class=\"keyword\">this</span>.state.greeted ? <span class=\"string\">'Yes'</span> : <span class=\"string\">'No'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      &lt;div&gt;</span><br><span class=\"line\">        &lt;div&gt;Hello React&lt;<span class=\"regexp\">/div&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">        &lt;span&gt;&#123;response&#125;&lt;/</span>span&gt;</span><br><span class=\"line\">        &lt;button onClick=&#123;()=&gt;&#123;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.setState(&#123;</span><br><span class=\"line\">                    greeted: !<span class=\"keyword\">this</span>.state.greeted</span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\">            &#125;,&#125;&gt;</span><br><span class=\"line\">            Hi</span><br><span class=\"line\">        &lt;<span class=\"regexp\">/button&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">      &lt;/</span>div&gt;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p><img src=\"/0/state.png\" alt=\"dom action state的关系图\"></p>\n<p>当 State 发生改变后， React 将 Component 渲染到 Virtual DOM，新的 Virtual DOM 与 旧版本的进行比对，检查出改变的部分并更新浏览器的 DOM。 在这个例子中，当按钮被点击后， <code>greeted</code>状态数据发生了变化，UI 跟随着更新。</p>\n<h2 id=\"Props与State的结合\"><a href=\"#Props与State的结合\" class=\"headerlink\" title=\"Props与State的结合\"></a>Props与State的结合</h2><figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> Greeting = React.createClass(&#123;</span><br><span class=\"line\">  <span class=\"keyword\">constructor</span> () &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.state = &#123; <span class=\"attr\">greeted</span>: <span class=\"literal\">false</span> &#125;;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  </span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> response = <span class=\"keyword\">this</span>.state.greeted ? <span class=\"string\">'Yes'</span> : <span class=\"string\">'No'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      &lt;div&gt;</span><br><span class=\"line\">        &lt;div&gt;Hello &#123;<span class=\"keyword\">this</span>.props.name&#125;&lt;<span class=\"regexp\">/div&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">        &lt;span&gt;&#123;response&#125;&lt;/</span>span&gt;</span><br><span class=\"line\">         &lt;button onClick=&#123;()=&gt;&#123;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.setState(&#123;</span><br><span class=\"line\">                    greeted: !<span class=\"keyword\">this</span>.state.greeted</span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\">            &#125;,&#125;&gt;</span><br><span class=\"line\">            Hi</span><br><span class=\"line\">        &lt;<span class=\"regexp\">/button&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">      &lt;/</span>div&gt;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> users = [<span class=\"string\">\"foo\"</span>, <span class=\"string\">\"bar\"</span>, <span class=\"string\">\"baz\"</span>];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> GreetingApp = React.createClass(&#123;</span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> greetings = <span class=\"keyword\">this</span>.props.users.map(<span class=\"function\">(<span class=\"params\">user</span>)=&gt;</span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">Greeting</span> <span class=\"attr\">name</span>=<span class=\"string\">&#123;user&#125;</span> /&gt;</span></span>;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;greetings&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"单向数据流\"><a href=\"#单向数据流\" class=\"headerlink\" title=\"单向数据流\"></a>单向数据流</h2><p>React是单向数据流，数据主要从父节点传递到子节点（通过props）。</p>\n<p>如果父级的某个props改变了，React会重渲染所有的子节点。</p>\n<h3 id=\"父子组件沟通\"><a href=\"#父子组件沟通\" class=\"headerlink\" title=\"父子组件沟通\"></a>父子组件沟通</h3><ul>\n<li>父组件更新组件状态  —–props—–&gt;　子组件更新</li>\n<li>子组件更新父组件状态   —–需要父组件传递回调函数—–&gt;  子组件调用触发</li>\n</ul>\n<blockquote>\n<p><code>子组件更新父组件就需要 父组件通过props传递一个回调函数到子组件中，这个回调函数可以更新父组件，子组件就是通过触发这个回调函数，从而使父组件得到更新。</code></p>\n</blockquote>\n<p><img src=\"/0/propsFlow.png\" alt=\"父子组件沟通\"></p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> Greeting = React.createClass(&#123;</span><br><span class=\"line\">  <span class=\"keyword\">constructor</span> () &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.state = &#123; <span class=\"attr\">greeted</span>: <span class=\"literal\">false</span> &#125;;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> response = <span class=\"keyword\">this</span>.state.greeted ? <span class=\"string\">'Yes'</span> : <span class=\"string\">'No'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      &lt;div&gt;</span><br><span class=\"line\">        &lt;div&gt;Hello &#123;<span class=\"keyword\">this</span>.props.name&#125;&lt;<span class=\"regexp\">/div&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">        &lt;span&gt;&#123;response&#125;&lt;/</span>span&gt;</span><br><span class=\"line\">        &lt;button onClick=&#123;()=&gt;&#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> greeted = !<span class=\"keyword\">this</span>.state.greeted;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.setState(&#123;</span><br><span class=\"line\">                    greeted: greeted,</span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.props.changeName(greeted?<span class=\"string\">'eric'</span>:<span class=\"string\">'mazheng'</span>);   </span><br><span class=\"line\">            &#125;,&#125;&gt;</span><br><span class=\"line\">            Hi</span><br><span class=\"line\">        &lt;<span class=\"regexp\">/button&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">      &lt;/</span>div&gt;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> UseGreeting = React.createClass(&#123;</span><br><span class=\"line\">  <span class=\"keyword\">constructor</span> () &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.state = &#123; <span class=\"attr\">name</span>: <span class=\"string\">'eric'</span> &#125;;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">        &lt;Greeting</span><br><span class=\"line\">            name=&#123;<span class=\"keyword\">this</span>.state.name&#125;</span><br><span class=\"line\">            changeName=&#123;(newName)=&gt;&#123;</span><br><span class=\"line\">                <span class=\"keyword\">this</span>.setState(&#123;</span><br><span class=\"line\">                    name: newName,</span><br><span class=\"line\">                &#125;); </span><br><span class=\"line\">            &#125;&#125;</span><br><span class=\"line\">        /&gt;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"兄弟组件沟通\"><a href=\"#兄弟组件沟通\" class=\"headerlink\" title=\"兄弟组件沟通\"></a>兄弟组件沟通</h3><ul>\n<li>按照React单向数据流方式，我们需要借助父组件进行传递，通过父组件回调函数改变兄弟组件的props。</li>\n</ul>\n<p><img src=\"/0/brothers.png\" alt=\"兄弟组件沟通\"></p>"},{"title":"css布局：两栏、三栏，从圣杯到双飞翼","date":"2017-11-23T14:45:40.000Z","_content":"\n## 常规的垂直布局\n\n```html\n<!DOCTYPE html>\n<html>\n\n<head>\n    <style>\n        .header{\n            background-color: red;\n            height: 100px;\n        }\n        .bodyer{\n            background-color: green;\n            height: 500px;\n        }\n        .footer{\n            background-color: yellow;\n            height: 50px;\n        }\n    </style>\n</head>\n\n<body>\n    <div class=\"header\">\n        Hello CSS layout\n    </div> \n    <div class=\"bodyer\">\n        some thing\n    </div> \n    <div class=\"footer\">copyright</div>\n</body>\n\n</html>\n```\n<!--more-->\n垂直布局就是这样的简单，因为垂直布局可以充分的利用[区块元素](https://zh.wikipedia.org/wiki/HTML元素#.E5.8D.80.E5.A1.8A.E5.85.83.E7.B4.A0)的特点就可以实现。\n\n## 常规的水平布局\n### 通过inline-block实现（inline与inline-block的区别）\n\n```html\n<!DOCTYPE html>\n<html>\n\n<head>\n    <style>\n        .bodyer {\n            background-color: green;\n            height: 500px;\n        }\n        .col {\n            background-color: red;\n            display: inline-block;\n            width: 200px;\n            height: 200px;\n        }\n    </style>\n</head>\n\n<body>\n    <div class=\"bodyer\">\n        <div class=\"col\">0</div>\n        <div class=\"col\">1</div>\n        <div class=\"col\">2</div>\n        <div class=\"col\">3</div>\n        <div class=\"col\">4</div>\n        <div class=\"col\">5</div>\n        <div class=\"col\">6</div>\n        <div class=\"col\">7</div>\n        <div class=\"col\">8</div>\n        <div class=\"col\">9</div>\n    </div>\n</body>\n\n</html>\n```\n\n### 通过float\n\n```html\n<!DOCTYPE html>\n<html>\n\n<head>\n    <style>\n        \n        .bodyer {\n            background-color: green;\n        }\n        .col {\n            background-color: red;\n            float: left;\n            width: 200px;\n            height: 200px;\n        }\n    </style>\n</head>\n\n<body>\n    <div class=\"bodyer\">\n        <span class=\"col\">0</span>\n        <span class=\"col\">1</span>\n        <span class=\"col\">2</span>\n        <span class=\"col\">3</span>\n        <span class=\"col\">4</span>\n        <span class=\"col\">5</span>\n        <span class=\"col\">6</span>\n        <span class=\"col\">7</span>\n        <span class=\"col\">8</span>\n        <span class=\"col\">9</span>\n    </div>\n</body>\n\n</html>\n```\n\n通过 `direction: rtl` 我们可以看出来 `display: inline-block` 只是利用了从左到右的 `普通流（normal flow）`。\n\n### 两栏布局\n#### bodyer:bfc sidebar:float content:float \n\n```html\n<!DOCTYPE html>\n<html>\n\n<head>\n    <style>\n        .bodyer {\n            background-color: green;\n            padding-bottom: 20px;\n            overflow: hidden;\n        }\n        .sidebar {\n            background-color: red;\n            float: left;\n            width: 200px;\n            height: 500px;\n            margin-right: 10px;\n        }\n        .content {\n            background-color: yellow;\n            float: left;\n            width: 720px;\n            height: 500px;\n        }\n    </style>\n</head>\n\n<body>\n    <div class=\"bodyer\">\n        <div class=\"sidebar\">sidebar</div>\n        <div class=\"content\">content</div>\n    </div>\n</body>\n\n</html>\n```\n\n+ 优点：好理解，左右的间距不取决于sidebar的宽度。\n+ 缺点：sidebar content 要定宽，无法自适应。父级元素要 `bfc`。\n\n#### sidebar:float \n\n```html\n<!DOCTYPE html>\n<html>\n\n<head>\n    <style>\n        .bodyer {\n            background-color: green;\n            padding-bottom: 20px;\n        }\n        .sidebar {\n            background-color: red;\n            float: left;\n            width: 200px;\n            height: 500px;\n        }\n        .content {\n            background-color: yellow;\n            height: 500px;\n            margin-left: 210px;\n        }\n    </style>\n</head>\n\n<body>\n    <div class=\"bodyer\">\n        <div class=\"sidebar\">sidebar</div>\n        <div class=\"content\">content</div>\n    </div>\n</body>\n\n</html>\n```\n\n+ 优点：可以自适应，父级元素无须 `bfc`。\n+ 缺点：左右的间距要根据 sidebar 的宽度来决定。\n\n#### sidebar:float content:bfc\n\n```html\n<!DOCTYPE html>\n<html>\n\n<head>\n    <style>\n        .bodyer {\n            background-color: green;\n            padding-bottom: 20px;\n        }\n        .sidebar {\n            background-color: red;\n            float: left;\n            width: 200px;\n            height: 500px;\n            margin-right: 10px;\n        }\n        .content {\n            background-color: yellow;\n            height: 500px;\n            overflow: auto;\n        }\n    </style>\n</head>\n\n<body>\n    <div class=\"bodyer\">\n        <div class=\"sidebar\">sidebar</div>\n        <div class=\"content\">content</div>\n    </div>\n</body>\n\n</html>\n```\n\n+ 优点：可以自适应，父级元素无须 `bfc`，左右的间距不取决于sidebar的宽度。\n+ 缺点：bfc带的副作用\n\n### 三栏布局\n#### sidebar:float content:bfc\n  \n```html\n<!DOCTYPE html>\n<html>\n\n<head>\n    <style>\n        .fl{\n            float: left;\n            margin-right: 10px;\n        }\n        .fr{\n            float: right;\n            margin-left: 10px;\n        }\n        .bodyer {\n            background-color: green;\n            padding-bottom: 20px;\n        }\n        .sidebar {\n            background-color: red;\n            width: 200px;\n            height: 500px;\n        }\n        .content {\n            background-color: yellow;\n            height: 500px;\n            overflow: auto;\n        }\n    </style>\n</head>\n\n<body>\n    <div class=\"bodyer\">\n        <div class=\"sidebar fl\">sidebar</div>\n        <div class=\"sidebar fr\">sidebar</div>\n        <div class=\"content\">content</div>\n    </div>\n</body>\n\n</html>\n```\n\n+ 优点：可以自适应，父级元素无须 `bfc`，左右的间距不取决于sidebar的宽度。元素、css较少。\n+ 缺点：sidebar会下榻 子元素的顺序有要求\n\n#### 圣杯布局\n\n```html\n<!DOCTYPE html>\n<html>\n\n<head>\n    <style>\n        .fl {\n            float: left;\n            height: 500px;\n        }\n\n        .bodyer {\n            background-color: green;\n            padding-bottom: 20px;\n            overflow: auto;\n            padding: 0 210px;\n        }\n\n        .sidebar {\n            background-color: red;\n            position: relative;\n            width: 200px;\n        }\n\n        .left-sidebar {\n            margin-left: -100%;\n            left: -210px;\n        }\n        .right-sidebar {\n            margin-left: -200px;\n            right: -210px;\n        }\n\n        .content {\n            width: 100%;\n            background-color: yellow;\n        }\n    </style>\n</head>\n\n<body>\n    <div class=\"bodyer\">\n        <div class=\"content fl\">content</div>\n        <div class=\"sidebar fl left-sidebar\">sidebar</div>\n        <div class=\"sidebar fl right-sidebar\">sidebar</div>\n    </div>\n</body>\n\n</html>\n```\n\n+ 优点：可以自适应， 子元素的顺序无要求。\n+ 缺点：sidebar会下榻，左右的间距取决于sidebar的宽度\n\n\n#### 双飞翼布局\n\n```html\n<!DOCTYPE html>\n<html>\n\n<head>\n    <style>\n        .fl {\n            float: left;\n        }\n\n        .bodyer {\n            width: 100%;\n            background-color: green;\n            padding-bottom: 20px;\n        }\n\n        .content {\n            width: 100%;\n        }\n\n        .content-main {\n            margin-left: 210px;\n            margin-right: 210px;\n            background-color: yellow;\n            height: 500px;\n        }\n\n        .sidebar {\n            width: 200px;\n            background-color: red;\n            height: 500px;\n        }\n\n        .left-sidebar {\n            margin-left: -100%;\n        }\n\n        .right-sidebar {\n            margin-left: -200px;\n        }\n    </style>\n</head>\n\n<body>\n    <div class=\"bodyer fl\">\n        <div class=\"content fl\">\n            <div class=\"content-main\">\n                content\n            </div>\n        </div>\n        <div class=\"sidebar left-sidebar fl\">sidebar</div>\n        <div class=\"sidebar right-sidebar fl\">sidebar</div>\n    </div>\n</body>\n\n</html>\n```\n\n+ 优点：可以自适应， 子元素的顺序无要求，塌陷的机会更小。\n+ 缺点：sidebar会下榻，左右的间距取决于sidebar的宽度\n\n\n## 参考\n+ [学习CSS布局](http://zh.learnlayout.com/)\n+ [BFC块格式化上下文](https://developer.mozilla.org/zh-CN/docs/Web/Guide/CSS/Block_formatting_context)\n+ [浮动元素的规则](http://blog.csdn.net/gemingzhu/article/details/51623761) \n\n","source":"_posts/css布局：两栏、三栏，从圣杯到双飞翼.md","raw":"---\ntitle: css布局：两栏、三栏，从圣杯到双飞翼\ndate: 2017-11-23 22:45:40\ntags: ['css布局','css','两栏','三栏','圣杯','双飞翼','bfc','块格式化上下文']\ncategory: 'coding'\n---\n\n## 常规的垂直布局\n\n```html\n<!DOCTYPE html>\n<html>\n\n<head>\n    <style>\n        .header{\n            background-color: red;\n            height: 100px;\n        }\n        .bodyer{\n            background-color: green;\n            height: 500px;\n        }\n        .footer{\n            background-color: yellow;\n            height: 50px;\n        }\n    </style>\n</head>\n\n<body>\n    <div class=\"header\">\n        Hello CSS layout\n    </div> \n    <div class=\"bodyer\">\n        some thing\n    </div> \n    <div class=\"footer\">copyright</div>\n</body>\n\n</html>\n```\n<!--more-->\n垂直布局就是这样的简单，因为垂直布局可以充分的利用[区块元素](https://zh.wikipedia.org/wiki/HTML元素#.E5.8D.80.E5.A1.8A.E5.85.83.E7.B4.A0)的特点就可以实现。\n\n## 常规的水平布局\n### 通过inline-block实现（inline与inline-block的区别）\n\n```html\n<!DOCTYPE html>\n<html>\n\n<head>\n    <style>\n        .bodyer {\n            background-color: green;\n            height: 500px;\n        }\n        .col {\n            background-color: red;\n            display: inline-block;\n            width: 200px;\n            height: 200px;\n        }\n    </style>\n</head>\n\n<body>\n    <div class=\"bodyer\">\n        <div class=\"col\">0</div>\n        <div class=\"col\">1</div>\n        <div class=\"col\">2</div>\n        <div class=\"col\">3</div>\n        <div class=\"col\">4</div>\n        <div class=\"col\">5</div>\n        <div class=\"col\">6</div>\n        <div class=\"col\">7</div>\n        <div class=\"col\">8</div>\n        <div class=\"col\">9</div>\n    </div>\n</body>\n\n</html>\n```\n\n### 通过float\n\n```html\n<!DOCTYPE html>\n<html>\n\n<head>\n    <style>\n        \n        .bodyer {\n            background-color: green;\n        }\n        .col {\n            background-color: red;\n            float: left;\n            width: 200px;\n            height: 200px;\n        }\n    </style>\n</head>\n\n<body>\n    <div class=\"bodyer\">\n        <span class=\"col\">0</span>\n        <span class=\"col\">1</span>\n        <span class=\"col\">2</span>\n        <span class=\"col\">3</span>\n        <span class=\"col\">4</span>\n        <span class=\"col\">5</span>\n        <span class=\"col\">6</span>\n        <span class=\"col\">7</span>\n        <span class=\"col\">8</span>\n        <span class=\"col\">9</span>\n    </div>\n</body>\n\n</html>\n```\n\n通过 `direction: rtl` 我们可以看出来 `display: inline-block` 只是利用了从左到右的 `普通流（normal flow）`。\n\n### 两栏布局\n#### bodyer:bfc sidebar:float content:float \n\n```html\n<!DOCTYPE html>\n<html>\n\n<head>\n    <style>\n        .bodyer {\n            background-color: green;\n            padding-bottom: 20px;\n            overflow: hidden;\n        }\n        .sidebar {\n            background-color: red;\n            float: left;\n            width: 200px;\n            height: 500px;\n            margin-right: 10px;\n        }\n        .content {\n            background-color: yellow;\n            float: left;\n            width: 720px;\n            height: 500px;\n        }\n    </style>\n</head>\n\n<body>\n    <div class=\"bodyer\">\n        <div class=\"sidebar\">sidebar</div>\n        <div class=\"content\">content</div>\n    </div>\n</body>\n\n</html>\n```\n\n+ 优点：好理解，左右的间距不取决于sidebar的宽度。\n+ 缺点：sidebar content 要定宽，无法自适应。父级元素要 `bfc`。\n\n#### sidebar:float \n\n```html\n<!DOCTYPE html>\n<html>\n\n<head>\n    <style>\n        .bodyer {\n            background-color: green;\n            padding-bottom: 20px;\n        }\n        .sidebar {\n            background-color: red;\n            float: left;\n            width: 200px;\n            height: 500px;\n        }\n        .content {\n            background-color: yellow;\n            height: 500px;\n            margin-left: 210px;\n        }\n    </style>\n</head>\n\n<body>\n    <div class=\"bodyer\">\n        <div class=\"sidebar\">sidebar</div>\n        <div class=\"content\">content</div>\n    </div>\n</body>\n\n</html>\n```\n\n+ 优点：可以自适应，父级元素无须 `bfc`。\n+ 缺点：左右的间距要根据 sidebar 的宽度来决定。\n\n#### sidebar:float content:bfc\n\n```html\n<!DOCTYPE html>\n<html>\n\n<head>\n    <style>\n        .bodyer {\n            background-color: green;\n            padding-bottom: 20px;\n        }\n        .sidebar {\n            background-color: red;\n            float: left;\n            width: 200px;\n            height: 500px;\n            margin-right: 10px;\n        }\n        .content {\n            background-color: yellow;\n            height: 500px;\n            overflow: auto;\n        }\n    </style>\n</head>\n\n<body>\n    <div class=\"bodyer\">\n        <div class=\"sidebar\">sidebar</div>\n        <div class=\"content\">content</div>\n    </div>\n</body>\n\n</html>\n```\n\n+ 优点：可以自适应，父级元素无须 `bfc`，左右的间距不取决于sidebar的宽度。\n+ 缺点：bfc带的副作用\n\n### 三栏布局\n#### sidebar:float content:bfc\n  \n```html\n<!DOCTYPE html>\n<html>\n\n<head>\n    <style>\n        .fl{\n            float: left;\n            margin-right: 10px;\n        }\n        .fr{\n            float: right;\n            margin-left: 10px;\n        }\n        .bodyer {\n            background-color: green;\n            padding-bottom: 20px;\n        }\n        .sidebar {\n            background-color: red;\n            width: 200px;\n            height: 500px;\n        }\n        .content {\n            background-color: yellow;\n            height: 500px;\n            overflow: auto;\n        }\n    </style>\n</head>\n\n<body>\n    <div class=\"bodyer\">\n        <div class=\"sidebar fl\">sidebar</div>\n        <div class=\"sidebar fr\">sidebar</div>\n        <div class=\"content\">content</div>\n    </div>\n</body>\n\n</html>\n```\n\n+ 优点：可以自适应，父级元素无须 `bfc`，左右的间距不取决于sidebar的宽度。元素、css较少。\n+ 缺点：sidebar会下榻 子元素的顺序有要求\n\n#### 圣杯布局\n\n```html\n<!DOCTYPE html>\n<html>\n\n<head>\n    <style>\n        .fl {\n            float: left;\n            height: 500px;\n        }\n\n        .bodyer {\n            background-color: green;\n            padding-bottom: 20px;\n            overflow: auto;\n            padding: 0 210px;\n        }\n\n        .sidebar {\n            background-color: red;\n            position: relative;\n            width: 200px;\n        }\n\n        .left-sidebar {\n            margin-left: -100%;\n            left: -210px;\n        }\n        .right-sidebar {\n            margin-left: -200px;\n            right: -210px;\n        }\n\n        .content {\n            width: 100%;\n            background-color: yellow;\n        }\n    </style>\n</head>\n\n<body>\n    <div class=\"bodyer\">\n        <div class=\"content fl\">content</div>\n        <div class=\"sidebar fl left-sidebar\">sidebar</div>\n        <div class=\"sidebar fl right-sidebar\">sidebar</div>\n    </div>\n</body>\n\n</html>\n```\n\n+ 优点：可以自适应， 子元素的顺序无要求。\n+ 缺点：sidebar会下榻，左右的间距取决于sidebar的宽度\n\n\n#### 双飞翼布局\n\n```html\n<!DOCTYPE html>\n<html>\n\n<head>\n    <style>\n        .fl {\n            float: left;\n        }\n\n        .bodyer {\n            width: 100%;\n            background-color: green;\n            padding-bottom: 20px;\n        }\n\n        .content {\n            width: 100%;\n        }\n\n        .content-main {\n            margin-left: 210px;\n            margin-right: 210px;\n            background-color: yellow;\n            height: 500px;\n        }\n\n        .sidebar {\n            width: 200px;\n            background-color: red;\n            height: 500px;\n        }\n\n        .left-sidebar {\n            margin-left: -100%;\n        }\n\n        .right-sidebar {\n            margin-left: -200px;\n        }\n    </style>\n</head>\n\n<body>\n    <div class=\"bodyer fl\">\n        <div class=\"content fl\">\n            <div class=\"content-main\">\n                content\n            </div>\n        </div>\n        <div class=\"sidebar left-sidebar fl\">sidebar</div>\n        <div class=\"sidebar right-sidebar fl\">sidebar</div>\n    </div>\n</body>\n\n</html>\n```\n\n+ 优点：可以自适应， 子元素的顺序无要求，塌陷的机会更小。\n+ 缺点：sidebar会下榻，左右的间距取决于sidebar的宽度\n\n\n## 参考\n+ [学习CSS布局](http://zh.learnlayout.com/)\n+ [BFC块格式化上下文](https://developer.mozilla.org/zh-CN/docs/Web/Guide/CSS/Block_formatting_context)\n+ [浮动元素的规则](http://blog.csdn.net/gemingzhu/article/details/51623761) \n\n","slug":"css布局：两栏、三栏，从圣杯到双飞翼","published":1,"updated":"2019-02-20T02:50:38.446Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjsgue0ef000bgpi6uwetdawh","content":"<h2 id=\"常规的垂直布局\"><a href=\"#常规的垂直布局\" class=\"headerlink\" title=\"常规的垂直布局\"></a>常规的垂直布局</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"undefined\"></span><br><span class=\"line\">        .header&#123;</span><br><span class=\"line\">            background-color: red;</span><br><span class=\"line\">            height: 100px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        .bodyer&#123;</span><br><span class=\"line\">            background-color: green;</span><br><span class=\"line\">            height: 500px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        .footer&#123;</span><br><span class=\"line\">            background-color: yellow;</span><br><span class=\"line\">            height: 50px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"header\"</span>&gt;</span></span><br><span class=\"line\">        Hello CSS layout</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span> </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"bodyer\"</span>&gt;</span></span><br><span class=\"line\">        some thing</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span> </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"footer\"</span>&gt;</span>copyright<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<a id=\"more\"></a>\n<p>垂直布局就是这样的简单，因为垂直布局可以充分的利用<a href=\"https://zh.wikipedia.org/wiki/HTML元素#.E5.8D.80.E5.A1.8A.E5.85.83.E7.B4.A0\" target=\"_blank\" rel=\"external\">区块元素</a>的特点就可以实现。</p>\n<h2 id=\"常规的水平布局\"><a href=\"#常规的水平布局\" class=\"headerlink\" title=\"常规的水平布局\"></a>常规的水平布局</h2><h3 id=\"通过inline-block实现（inline与inline-block的区别）\"><a href=\"#通过inline-block实现（inline与inline-block的区别）\" class=\"headerlink\" title=\"通过inline-block实现（inline与inline-block的区别）\"></a>通过inline-block实现（inline与inline-block的区别）</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"undefined\"></span><br><span class=\"line\">        .bodyer &#123;</span><br><span class=\"line\">            background-color: green;</span><br><span class=\"line\">            height: 500px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        .col &#123;</span><br><span class=\"line\">            background-color: red;</span><br><span class=\"line\">            display: inline-block;</span><br><span class=\"line\">            width: 200px;</span><br><span class=\"line\">            height: 200px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"bodyer\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"col\"</span>&gt;</span>0<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"col\"</span>&gt;</span>1<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"col\"</span>&gt;</span>2<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"col\"</span>&gt;</span>3<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"col\"</span>&gt;</span>4<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"col\"</span>&gt;</span>5<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"col\"</span>&gt;</span>6<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"col\"</span>&gt;</span>7<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"col\"</span>&gt;</span>8<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"col\"</span>&gt;</span>9<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"通过float\"><a href=\"#通过float\" class=\"headerlink\" title=\"通过float\"></a>通过float</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"undefined\"></span><br><span class=\"line\">        </span><br><span class=\"line\">        .bodyer &#123;</span><br><span class=\"line\">            background-color: green;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        .col &#123;</span><br><span class=\"line\">            background-color: red;</span><br><span class=\"line\">            float: left;</span><br><span class=\"line\">            width: 200px;</span><br><span class=\"line\">            height: 200px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"bodyer\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">\"col\"</span>&gt;</span>0<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">\"col\"</span>&gt;</span>1<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">\"col\"</span>&gt;</span>2<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">\"col\"</span>&gt;</span>3<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">\"col\"</span>&gt;</span>4<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">\"col\"</span>&gt;</span>5<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">\"col\"</span>&gt;</span>6<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">\"col\"</span>&gt;</span>7<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">\"col\"</span>&gt;</span>8<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">\"col\"</span>&gt;</span>9<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>通过 <code>direction: rtl</code> 我们可以看出来 <code>display: inline-block</code> 只是利用了从左到右的 <code>普通流（normal flow）</code>。</p>\n<h3 id=\"两栏布局\"><a href=\"#两栏布局\" class=\"headerlink\" title=\"两栏布局\"></a>两栏布局</h3><h4 id=\"bodyer-bfc-sidebar-float-content-float\"><a href=\"#bodyer-bfc-sidebar-float-content-float\" class=\"headerlink\" title=\"bodyer:bfc sidebar:float content:float\"></a>bodyer:bfc sidebar:float content:float</h4><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"undefined\"></span><br><span class=\"line\">        .bodyer &#123;</span><br><span class=\"line\">            background-color: green;</span><br><span class=\"line\">            padding-bottom: 20px;</span><br><span class=\"line\">            overflow: hidden;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        .sidebar &#123;</span><br><span class=\"line\">            background-color: red;</span><br><span class=\"line\">            float: left;</span><br><span class=\"line\">            width: 200px;</span><br><span class=\"line\">            height: 500px;</span><br><span class=\"line\">            margin-right: 10px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        .content &#123;</span><br><span class=\"line\">            background-color: yellow;</span><br><span class=\"line\">            float: left;</span><br><span class=\"line\">            width: 720px;</span><br><span class=\"line\">            height: 500px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"bodyer\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"sidebar\"</span>&gt;</span>sidebar<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"content\"</span>&gt;</span>content<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>优点：好理解，左右的间距不取决于sidebar的宽度。</li>\n<li>缺点：sidebar content 要定宽，无法自适应。父级元素要 <code>bfc</code>。</li>\n</ul>\n<h4 id=\"sidebar-float\"><a href=\"#sidebar-float\" class=\"headerlink\" title=\"sidebar:float\"></a>sidebar:float</h4><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"undefined\"></span><br><span class=\"line\">        .bodyer &#123;</span><br><span class=\"line\">            background-color: green;</span><br><span class=\"line\">            padding-bottom: 20px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        .sidebar &#123;</span><br><span class=\"line\">            background-color: red;</span><br><span class=\"line\">            float: left;</span><br><span class=\"line\">            width: 200px;</span><br><span class=\"line\">            height: 500px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        .content &#123;</span><br><span class=\"line\">            background-color: yellow;</span><br><span class=\"line\">            height: 500px;</span><br><span class=\"line\">            margin-left: 210px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"bodyer\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"sidebar\"</span>&gt;</span>sidebar<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"content\"</span>&gt;</span>content<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>优点：可以自适应，父级元素无须 <code>bfc</code>。</li>\n<li>缺点：左右的间距要根据 sidebar 的宽度来决定。</li>\n</ul>\n<h4 id=\"sidebar-float-content-bfc\"><a href=\"#sidebar-float-content-bfc\" class=\"headerlink\" title=\"sidebar:float content:bfc\"></a>sidebar:float content:bfc</h4><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"undefined\"></span><br><span class=\"line\">        .bodyer &#123;</span><br><span class=\"line\">            background-color: green;</span><br><span class=\"line\">            padding-bottom: 20px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        .sidebar &#123;</span><br><span class=\"line\">            background-color: red;</span><br><span class=\"line\">            float: left;</span><br><span class=\"line\">            width: 200px;</span><br><span class=\"line\">            height: 500px;</span><br><span class=\"line\">            margin-right: 10px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        .content &#123;</span><br><span class=\"line\">            background-color: yellow;</span><br><span class=\"line\">            height: 500px;</span><br><span class=\"line\">            overflow: auto;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"bodyer\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"sidebar\"</span>&gt;</span>sidebar<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"content\"</span>&gt;</span>content<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>优点：可以自适应，父级元素无须 <code>bfc</code>，左右的间距不取决于sidebar的宽度。</li>\n<li>缺点：bfc带的副作用</li>\n</ul>\n<h3 id=\"三栏布局\"><a href=\"#三栏布局\" class=\"headerlink\" title=\"三栏布局\"></a>三栏布局</h3><h4 id=\"sidebar-float-content-bfc-1\"><a href=\"#sidebar-float-content-bfc-1\" class=\"headerlink\" title=\"sidebar:float content:bfc\"></a>sidebar:float content:bfc</h4><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"undefined\"></span><br><span class=\"line\">        .fl&#123;</span><br><span class=\"line\">            float: left;</span><br><span class=\"line\">            margin-right: 10px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        .fr&#123;</span><br><span class=\"line\">            float: right;</span><br><span class=\"line\">            margin-left: 10px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        .bodyer &#123;</span><br><span class=\"line\">            background-color: green;</span><br><span class=\"line\">            padding-bottom: 20px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        .sidebar &#123;</span><br><span class=\"line\">            background-color: red;</span><br><span class=\"line\">            width: 200px;</span><br><span class=\"line\">            height: 500px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        .content &#123;</span><br><span class=\"line\">            background-color: yellow;</span><br><span class=\"line\">            height: 500px;</span><br><span class=\"line\">            overflow: auto;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"bodyer\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"sidebar fl\"</span>&gt;</span>sidebar<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"sidebar fr\"</span>&gt;</span>sidebar<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"content\"</span>&gt;</span>content<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>优点：可以自适应，父级元素无须 <code>bfc</code>，左右的间距不取决于sidebar的宽度。元素、css较少。</li>\n<li>缺点：sidebar会下榻 子元素的顺序有要求</li>\n</ul>\n<h4 id=\"圣杯布局\"><a href=\"#圣杯布局\" class=\"headerlink\" title=\"圣杯布局\"></a>圣杯布局</h4><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"undefined\"></span><br><span class=\"line\">        .fl &#123;</span><br><span class=\"line\">            float: left;</span><br><span class=\"line\">            height: 500px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        .bodyer &#123;</span><br><span class=\"line\">            background-color: green;</span><br><span class=\"line\">            padding-bottom: 20px;</span><br><span class=\"line\">            overflow: auto;</span><br><span class=\"line\">            padding: 0 210px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        .sidebar &#123;</span><br><span class=\"line\">            background-color: red;</span><br><span class=\"line\">            position: relative;</span><br><span class=\"line\">            width: 200px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        .left-sidebar &#123;</span><br><span class=\"line\">            margin-left: -100%;</span><br><span class=\"line\">            left: -210px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        .right-sidebar &#123;</span><br><span class=\"line\">            margin-left: -200px;</span><br><span class=\"line\">            right: -210px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        .content &#123;</span><br><span class=\"line\">            width: 100%;</span><br><span class=\"line\">            background-color: yellow;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"bodyer\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"content fl\"</span>&gt;</span>content<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"sidebar fl left-sidebar\"</span>&gt;</span>sidebar<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"sidebar fl right-sidebar\"</span>&gt;</span>sidebar<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>优点：可以自适应， 子元素的顺序无要求。</li>\n<li>缺点：sidebar会下榻，左右的间距取决于sidebar的宽度</li>\n</ul>\n<h4 id=\"双飞翼布局\"><a href=\"#双飞翼布局\" class=\"headerlink\" title=\"双飞翼布局\"></a>双飞翼布局</h4><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"undefined\"></span><br><span class=\"line\">        .fl &#123;</span><br><span class=\"line\">            float: left;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        .bodyer &#123;</span><br><span class=\"line\">            width: 100%;</span><br><span class=\"line\">            background-color: green;</span><br><span class=\"line\">            padding-bottom: 20px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        .content &#123;</span><br><span class=\"line\">            width: 100%;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        .content-main &#123;</span><br><span class=\"line\">            margin-left: 210px;</span><br><span class=\"line\">            margin-right: 210px;</span><br><span class=\"line\">            background-color: yellow;</span><br><span class=\"line\">            height: 500px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        .sidebar &#123;</span><br><span class=\"line\">            width: 200px;</span><br><span class=\"line\">            background-color: red;</span><br><span class=\"line\">            height: 500px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        .left-sidebar &#123;</span><br><span class=\"line\">            margin-left: -100%;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        .right-sidebar &#123;</span><br><span class=\"line\">            margin-left: -200px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"bodyer fl\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"content fl\"</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"content-main\"</span>&gt;</span></span><br><span class=\"line\">                content</span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"sidebar left-sidebar fl\"</span>&gt;</span>sidebar<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"sidebar right-sidebar fl\"</span>&gt;</span>sidebar<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>优点：可以自适应， 子元素的顺序无要求，塌陷的机会更小。</li>\n<li>缺点：sidebar会下榻，左右的间距取决于sidebar的宽度</li>\n</ul>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><ul>\n<li><a href=\"http://zh.learnlayout.com/\" target=\"_blank\" rel=\"external\">学习CSS布局</a></li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/Guide/CSS/Block_formatting_context\" target=\"_blank\" rel=\"external\">BFC块格式化上下文</a></li>\n<li><a href=\"http://blog.csdn.net/gemingzhu/article/details/51623761\" target=\"_blank\" rel=\"external\">浮动元素的规则</a> </li>\n</ul>\n","excerpt":"<h2 id=\"常规的垂直布局\"><a href=\"#常规的垂直布局\" class=\"headerlink\" title=\"常规的垂直布局\"></a>常规的垂直布局</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"undefined\"></span><br><span class=\"line\">        .header&#123;</span><br><span class=\"line\">            background-color: red;</span><br><span class=\"line\">            height: 100px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        .bodyer&#123;</span><br><span class=\"line\">            background-color: green;</span><br><span class=\"line\">            height: 500px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        .footer&#123;</span><br><span class=\"line\">            background-color: yellow;</span><br><span class=\"line\">            height: 50px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"header\"</span>&gt;</span></span><br><span class=\"line\">        Hello CSS layout</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span> </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"bodyer\"</span>&gt;</span></span><br><span class=\"line\">        some thing</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span> </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"footer\"</span>&gt;</span>copyright<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>","more":"<p>垂直布局就是这样的简单，因为垂直布局可以充分的利用<a href=\"https://zh.wikipedia.org/wiki/HTML元素#.E5.8D.80.E5.A1.8A.E5.85.83.E7.B4.A0\">区块元素</a>的特点就可以实现。</p>\n<h2 id=\"常规的水平布局\"><a href=\"#常规的水平布局\" class=\"headerlink\" title=\"常规的水平布局\"></a>常规的水平布局</h2><h3 id=\"通过inline-block实现（inline与inline-block的区别）\"><a href=\"#通过inline-block实现（inline与inline-block的区别）\" class=\"headerlink\" title=\"通过inline-block实现（inline与inline-block的区别）\"></a>通过inline-block实现（inline与inline-block的区别）</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"undefined\"></span><br><span class=\"line\">        .bodyer &#123;</span><br><span class=\"line\">            background-color: green;</span><br><span class=\"line\">            height: 500px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        .col &#123;</span><br><span class=\"line\">            background-color: red;</span><br><span class=\"line\">            display: inline-block;</span><br><span class=\"line\">            width: 200px;</span><br><span class=\"line\">            height: 200px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"bodyer\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"col\"</span>&gt;</span>0<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"col\"</span>&gt;</span>1<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"col\"</span>&gt;</span>2<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"col\"</span>&gt;</span>3<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"col\"</span>&gt;</span>4<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"col\"</span>&gt;</span>5<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"col\"</span>&gt;</span>6<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"col\"</span>&gt;</span>7<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"col\"</span>&gt;</span>8<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"col\"</span>&gt;</span>9<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"通过float\"><a href=\"#通过float\" class=\"headerlink\" title=\"通过float\"></a>通过float</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"undefined\"></span><br><span class=\"line\">        </span><br><span class=\"line\">        .bodyer &#123;</span><br><span class=\"line\">            background-color: green;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        .col &#123;</span><br><span class=\"line\">            background-color: red;</span><br><span class=\"line\">            float: left;</span><br><span class=\"line\">            width: 200px;</span><br><span class=\"line\">            height: 200px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"bodyer\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">\"col\"</span>&gt;</span>0<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">\"col\"</span>&gt;</span>1<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">\"col\"</span>&gt;</span>2<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">\"col\"</span>&gt;</span>3<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">\"col\"</span>&gt;</span>4<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">\"col\"</span>&gt;</span>5<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">\"col\"</span>&gt;</span>6<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">\"col\"</span>&gt;</span>7<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">\"col\"</span>&gt;</span>8<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">\"col\"</span>&gt;</span>9<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>通过 <code>direction: rtl</code> 我们可以看出来 <code>display: inline-block</code> 只是利用了从左到右的 <code>普通流（normal flow）</code>。</p>\n<h3 id=\"两栏布局\"><a href=\"#两栏布局\" class=\"headerlink\" title=\"两栏布局\"></a>两栏布局</h3><h4 id=\"bodyer-bfc-sidebar-float-content-float\"><a href=\"#bodyer-bfc-sidebar-float-content-float\" class=\"headerlink\" title=\"bodyer:bfc sidebar:float content:float\"></a>bodyer:bfc sidebar:float content:float</h4><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"undefined\"></span><br><span class=\"line\">        .bodyer &#123;</span><br><span class=\"line\">            background-color: green;</span><br><span class=\"line\">            padding-bottom: 20px;</span><br><span class=\"line\">            overflow: hidden;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        .sidebar &#123;</span><br><span class=\"line\">            background-color: red;</span><br><span class=\"line\">            float: left;</span><br><span class=\"line\">            width: 200px;</span><br><span class=\"line\">            height: 500px;</span><br><span class=\"line\">            margin-right: 10px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        .content &#123;</span><br><span class=\"line\">            background-color: yellow;</span><br><span class=\"line\">            float: left;</span><br><span class=\"line\">            width: 720px;</span><br><span class=\"line\">            height: 500px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"bodyer\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"sidebar\"</span>&gt;</span>sidebar<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"content\"</span>&gt;</span>content<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>优点：好理解，左右的间距不取决于sidebar的宽度。</li>\n<li>缺点：sidebar content 要定宽，无法自适应。父级元素要 <code>bfc</code>。</li>\n</ul>\n<h4 id=\"sidebar-float\"><a href=\"#sidebar-float\" class=\"headerlink\" title=\"sidebar:float\"></a>sidebar:float</h4><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"undefined\"></span><br><span class=\"line\">        .bodyer &#123;</span><br><span class=\"line\">            background-color: green;</span><br><span class=\"line\">            padding-bottom: 20px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        .sidebar &#123;</span><br><span class=\"line\">            background-color: red;</span><br><span class=\"line\">            float: left;</span><br><span class=\"line\">            width: 200px;</span><br><span class=\"line\">            height: 500px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        .content &#123;</span><br><span class=\"line\">            background-color: yellow;</span><br><span class=\"line\">            height: 500px;</span><br><span class=\"line\">            margin-left: 210px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"bodyer\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"sidebar\"</span>&gt;</span>sidebar<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"content\"</span>&gt;</span>content<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>优点：可以自适应，父级元素无须 <code>bfc</code>。</li>\n<li>缺点：左右的间距要根据 sidebar 的宽度来决定。</li>\n</ul>\n<h4 id=\"sidebar-float-content-bfc\"><a href=\"#sidebar-float-content-bfc\" class=\"headerlink\" title=\"sidebar:float content:bfc\"></a>sidebar:float content:bfc</h4><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"undefined\"></span><br><span class=\"line\">        .bodyer &#123;</span><br><span class=\"line\">            background-color: green;</span><br><span class=\"line\">            padding-bottom: 20px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        .sidebar &#123;</span><br><span class=\"line\">            background-color: red;</span><br><span class=\"line\">            float: left;</span><br><span class=\"line\">            width: 200px;</span><br><span class=\"line\">            height: 500px;</span><br><span class=\"line\">            margin-right: 10px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        .content &#123;</span><br><span class=\"line\">            background-color: yellow;</span><br><span class=\"line\">            height: 500px;</span><br><span class=\"line\">            overflow: auto;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"bodyer\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"sidebar\"</span>&gt;</span>sidebar<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"content\"</span>&gt;</span>content<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>优点：可以自适应，父级元素无须 <code>bfc</code>，左右的间距不取决于sidebar的宽度。</li>\n<li>缺点：bfc带的副作用</li>\n</ul>\n<h3 id=\"三栏布局\"><a href=\"#三栏布局\" class=\"headerlink\" title=\"三栏布局\"></a>三栏布局</h3><h4 id=\"sidebar-float-content-bfc-1\"><a href=\"#sidebar-float-content-bfc-1\" class=\"headerlink\" title=\"sidebar:float content:bfc\"></a>sidebar:float content:bfc</h4><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"undefined\"></span><br><span class=\"line\">        .fl&#123;</span><br><span class=\"line\">            float: left;</span><br><span class=\"line\">            margin-right: 10px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        .fr&#123;</span><br><span class=\"line\">            float: right;</span><br><span class=\"line\">            margin-left: 10px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        .bodyer &#123;</span><br><span class=\"line\">            background-color: green;</span><br><span class=\"line\">            padding-bottom: 20px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        .sidebar &#123;</span><br><span class=\"line\">            background-color: red;</span><br><span class=\"line\">            width: 200px;</span><br><span class=\"line\">            height: 500px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        .content &#123;</span><br><span class=\"line\">            background-color: yellow;</span><br><span class=\"line\">            height: 500px;</span><br><span class=\"line\">            overflow: auto;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"bodyer\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"sidebar fl\"</span>&gt;</span>sidebar<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"sidebar fr\"</span>&gt;</span>sidebar<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"content\"</span>&gt;</span>content<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>优点：可以自适应，父级元素无须 <code>bfc</code>，左右的间距不取决于sidebar的宽度。元素、css较少。</li>\n<li>缺点：sidebar会下榻 子元素的顺序有要求</li>\n</ul>\n<h4 id=\"圣杯布局\"><a href=\"#圣杯布局\" class=\"headerlink\" title=\"圣杯布局\"></a>圣杯布局</h4><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"undefined\"></span><br><span class=\"line\">        .fl &#123;</span><br><span class=\"line\">            float: left;</span><br><span class=\"line\">            height: 500px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        .bodyer &#123;</span><br><span class=\"line\">            background-color: green;</span><br><span class=\"line\">            padding-bottom: 20px;</span><br><span class=\"line\">            overflow: auto;</span><br><span class=\"line\">            padding: 0 210px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        .sidebar &#123;</span><br><span class=\"line\">            background-color: red;</span><br><span class=\"line\">            position: relative;</span><br><span class=\"line\">            width: 200px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        .left-sidebar &#123;</span><br><span class=\"line\">            margin-left: -100%;</span><br><span class=\"line\">            left: -210px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        .right-sidebar &#123;</span><br><span class=\"line\">            margin-left: -200px;</span><br><span class=\"line\">            right: -210px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        .content &#123;</span><br><span class=\"line\">            width: 100%;</span><br><span class=\"line\">            background-color: yellow;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"bodyer\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"content fl\"</span>&gt;</span>content<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"sidebar fl left-sidebar\"</span>&gt;</span>sidebar<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"sidebar fl right-sidebar\"</span>&gt;</span>sidebar<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>优点：可以自适应， 子元素的顺序无要求。</li>\n<li>缺点：sidebar会下榻，左右的间距取决于sidebar的宽度</li>\n</ul>\n<h4 id=\"双飞翼布局\"><a href=\"#双飞翼布局\" class=\"headerlink\" title=\"双飞翼布局\"></a>双飞翼布局</h4><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"undefined\"></span><br><span class=\"line\">        .fl &#123;</span><br><span class=\"line\">            float: left;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        .bodyer &#123;</span><br><span class=\"line\">            width: 100%;</span><br><span class=\"line\">            background-color: green;</span><br><span class=\"line\">            padding-bottom: 20px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        .content &#123;</span><br><span class=\"line\">            width: 100%;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        .content-main &#123;</span><br><span class=\"line\">            margin-left: 210px;</span><br><span class=\"line\">            margin-right: 210px;</span><br><span class=\"line\">            background-color: yellow;</span><br><span class=\"line\">            height: 500px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        .sidebar &#123;</span><br><span class=\"line\">            width: 200px;</span><br><span class=\"line\">            background-color: red;</span><br><span class=\"line\">            height: 500px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        .left-sidebar &#123;</span><br><span class=\"line\">            margin-left: -100%;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        .right-sidebar &#123;</span><br><span class=\"line\">            margin-left: -200px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"bodyer fl\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"content fl\"</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"content-main\"</span>&gt;</span></span><br><span class=\"line\">                content</span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"sidebar left-sidebar fl\"</span>&gt;</span>sidebar<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"sidebar right-sidebar fl\"</span>&gt;</span>sidebar<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>优点：可以自适应， 子元素的顺序无要求，塌陷的机会更小。</li>\n<li>缺点：sidebar会下榻，左右的间距取决于sidebar的宽度</li>\n</ul>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><ul>\n<li><a href=\"http://zh.learnlayout.com/\">学习CSS布局</a></li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/Guide/CSS/Block_formatting_context\">BFC块格式化上下文</a></li>\n<li><a href=\"http://blog.csdn.net/gemingzhu/article/details/51623761\">浮动元素的规则</a> </li>\n</ul>"},{"title":"dva脚手架的demo","date":"2017-12-26T12:52:27.000Z","_content":"\n# dva-demo\n![D.VA](/0/D.Va.jpg)\n## 为什么使用dva\n*  reducer, saga, action 都是分离的，编辑成本高，需要在 reducer, saga, action 之间来回切换\n* 不便于组织业务模型 (或者叫 domain model)，需要复制很多文件。\n* dva是 framework，很明确地告诉你每个部件应该怎么写。\n<!--more-->\n\n```javascript\napp.model({\n  namespace: 'demo',\n  state: {\n  },\n  effects: {\n  },\n  reducers: {\n  },\n});\n```\n\n介绍 model 的 key 与原来的 redux-saga 的关系 ：\n* namespace - 对应 rootReducer 时的 key 值\n* state - 对应 reducer 的 initialState\n* effects - 对应 saga\n* reducers \n\n## 实战项目\n### 文件目录结构\n```bash\n/root\n  ├─ dist/              // 产出目录\n  ├─ mock/              // mock 数据\n  ├─ public/            // 模板和静态资源\n  ├─ src\n  │   ├─ assets/        // 静态资源\n  │   ├─ components/    // 组件\n  │   ├─ models/        // 业务模型\n  │   ├─ routes/        // 页面组件\n  │   ├─ services/      // 服务\n  │   ├─ utils/         // 工具方法\n  │   ├─ index.css      // 样式\n  │   ├─ index.ejs      // spa 模板\n  │   ├─ index.js       // spa 入口\n  │   └─ router.js      // 路由文件\n  ├─ .editorconfig      // 代码风格配置\n  ├─ .eslintrc          // eslint 配置\n  ├─ .gitignore         \n  ├─ .roadhogrc         // roadhog 配置\n  ├─ .roadhogrc.mock.js // roadhog 数据mock\n  └─ package.json       // 项目配置\n```\n### 什么是 roadhog\n![roadhog](/0/roadhog.png)\n\n基于webpack的cli工具，分别用于本地调试和构建，并且提供了特别易用的 mock 功能。\n\n### 代码实战\n1. 安装dva，antd 和 babel-plugin-import\n\n```bash\nnpm install dva-cli -g\n```\n```bash\ndva new dva-quickstart\n```\n```bash\ncd dva-quickstart\nnpm start    \n```\n\n几秒钟后，你会看到以下输出：\n\n```bash\nCompiled successfully!\n\nThe app is running at:\n\n  http://localhost:8000/\n\nNote that the development build is not optimized.\nTo create a production build, use npm run build.\n```\n\n在浏览器里打开 http://localhost:8000 ，你会看到 dva 的欢迎界面。\n\n通过 npm 安装 antd 和 babel-plugin-import 。babel-plugin-import 是用来按需加载 antd 的脚本和样式的。\n\n```bash\nnpm install antd babel-plugin-import --save\n```\n\n编辑 .roadhogrc，使 babel-plugin-import 插件生效。\n\n```diff\n  \"extraBabelPlugins\": [\n-    \"transform-runtime\"\n+    \"transform-runtime\",\n+    [\"import\", { \"libraryName\": \"antd\", \"libraryDirectory\": \"es\", \"style\": \"css\" }]\n  ],\n```\n\n2. 创建page组件\n/root/src/routes/demo/index.js 的代码如下\n\n```JSX\nimport React from 'react';\nimport { connect } from 'dva';\n\nclass Demo extends React.Component {\n    static ROUTE = '/';\n    \n    render() {\n        return (\n            <div>hello</div>\n        );\n    }\n}\n\nexport const DemoClass = Demo;\n\nexport default connect()(Demo);         \n```   \n\n/root/src/router.js 的代码如下\n\n```JSX\nimport React from 'react';\nimport { Router, Route } from 'dva/router';\nimport Demo, { DemoClass } from './routes/Demo';\n\nfunction RouterConfig({ history }) {\n  return (\n    <Router history={history}>\n      <Route path={DemoClass.ROUTE} component={Demo} />\n    </Router>\n  );\n}\n\nexport default RouterConfig;       \n``` \n\n会看到 hello\n\n2. 创建业务模型\n/root/src/models/demo.js 的代码如下\n\n```javascript\nconst namespace = 'demo';\n\nexport default {\n    namespace,\n    state: {\n        showText:'hello demo',\n    },\n    reducers: {\n        overrideStateProps(state, { payload }) {\n            return {\n                ...state,\n                ...payload,\n            };\n        },\n        updateStateProps(state, { payload }) {\n            const { name, value } = payload;\n            return {\n                ...state,\n                ...{ [name]: { ...state[name], ...value } },\n            };\n        },\n\n    },\n    effects: {\n    },\n}\n```\n\n/root/src/index.js 的代码如下\n\n```javascript\nimport dva from 'dva';\nimport './index.css';\n\nconst app = dva();\n\napp.model(require('./models/demo'));\n\napp.router(require('./router'));\n\napp.start('#root');\n```\n\n3. 绑定state \n\n/root/src/routes/demo/index.js 的代码如下\n\n```javascript\nimport React from 'react';\nimport { connect } from 'dva';\n\nclass Demo extends React.Component {\n    static ROUTE = '/';\n\n    render() {\n        const { showText, dispatch } = this.props;\n        return (\n            <div>{showText}</div>\n        );\n    }\n}\n\nexport const DemoClass = Demo;\n\nexport default connect(({ demo }) => ({\n    showText: demo.showText,\n}))(Demo);\n```\n\n4. 添加reduce \n\n/root/src/routes/demo/index.js 的代码如下\n\n```javascript\nimport React from 'react';\nimport { connect } from 'dva';\nimport { Button } from 'antd';\n\nclass Demo extends React.Component {\n    static ROUTE = '/';\n\n    render() {\n        const { showText, dispatch } = this.props;\n        return (\n            <div>\n                <h1>{showText}</h1>\n                <Button\n                    onClick={() => {\n                        dispatch({\n                            type: 'demo/overrideStateProps',\n                            payload: {\n                                showText: showText + 1,\n                            },\n                        });\n                    }}\n                >\n                    点击\n                </Button>\n            </div>\n        );\n    }\n}\n\nexport const DemoClass = Demo;\n\nexport default connect(({ demo }) => ({\n    showText: demo.showText,\n}))(Demo);\n```\n\n/root/src/models/demo.js 的代码如下\n\n```javascript\nconst namespace = 'demo';\n\nexport default {\n    namespace,\n    state: {\n        showText: 0,\n    },\n    reducers: {\n        overrideStateProps(state, { payload }) {\n            return {\n                ...state,\n                ...payload,\n            };\n        },\n        updateStateProps(state, { payload }) {\n            const { name, value } = payload;\n            return {\n                ...state,\n                ...{ [name]: { ...state[name], ...value } },\n            };\n        },\n\n    },\n    effects: {\n    },\n};\n```\n\n5. 添加 effects\n\n/root/src/utils/request.js 的代码如下\n```javascript\nimport fetch from 'dva/fetch';\n\nfunction parseJSON(response) {\n  return response.json();\n}\n\nfunction checkStatus(response) {\n  if (response.status >= 200 && response.status < 300) {\n    return response;\n  }\n\n  const error = new Error(response.statusText);\n  error.response = response;\n  throw error;\n}\n\nexport default function request(url, options) {\n  return fetch(url, options)\n    .then(checkStatus)\n    .then(parseJSON)\n    .then(data)\n    .catch(err => ({ err }));\n}\n```\n\n/root/src/services/Demo.js 的代码如下\n```javascript\nimport request from '../utils/request';\n\nexport default class Demo {\n    static get() {\n        return request('/api/users', { credentials: 'include' });\n    }\n}\n```\n\n/root/src/models/demo.js 的代码如下\n```javascript\nimport Demo from '../services/Demo'\n\nconst namespace = 'demo';\n\nexport default {\n    namespace,\n    state: {\n        showText: 0,\n    },\n    reducers: {\n        overrideStateProps(state, { payload }) {\n            return {\n                ...state,\n                ...payload,\n            };\n        },\n        updateStateProps(state, { payload }) {\n            const { name, value } = payload;\n            return {\n                ...state,\n                ...{ [name]: { ...state[name], ...value } },\n            };\n        },\n\n    },\n    effects: {\n        *get(action, { call }) {\n            const req= yield call(Demo.get);\n            console.log(req);\n        },\n    },\n};\n```","source":"_posts/dva脚手架的demo.md","raw":"---\ntitle: dva脚手架的demo\ndate: 2017-12-26 20:52:27\ntags: ['reduxe','redux-saga','effect','dispatch','reducer']\ncategory: 'coding'\n---\n\n# dva-demo\n![D.VA](/0/D.Va.jpg)\n## 为什么使用dva\n*  reducer, saga, action 都是分离的，编辑成本高，需要在 reducer, saga, action 之间来回切换\n* 不便于组织业务模型 (或者叫 domain model)，需要复制很多文件。\n* dva是 framework，很明确地告诉你每个部件应该怎么写。\n<!--more-->\n\n```javascript\napp.model({\n  namespace: 'demo',\n  state: {\n  },\n  effects: {\n  },\n  reducers: {\n  },\n});\n```\n\n介绍 model 的 key 与原来的 redux-saga 的关系 ：\n* namespace - 对应 rootReducer 时的 key 值\n* state - 对应 reducer 的 initialState\n* effects - 对应 saga\n* reducers \n\n## 实战项目\n### 文件目录结构\n```bash\n/root\n  ├─ dist/              // 产出目录\n  ├─ mock/              // mock 数据\n  ├─ public/            // 模板和静态资源\n  ├─ src\n  │   ├─ assets/        // 静态资源\n  │   ├─ components/    // 组件\n  │   ├─ models/        // 业务模型\n  │   ├─ routes/        // 页面组件\n  │   ├─ services/      // 服务\n  │   ├─ utils/         // 工具方法\n  │   ├─ index.css      // 样式\n  │   ├─ index.ejs      // spa 模板\n  │   ├─ index.js       // spa 入口\n  │   └─ router.js      // 路由文件\n  ├─ .editorconfig      // 代码风格配置\n  ├─ .eslintrc          // eslint 配置\n  ├─ .gitignore         \n  ├─ .roadhogrc         // roadhog 配置\n  ├─ .roadhogrc.mock.js // roadhog 数据mock\n  └─ package.json       // 项目配置\n```\n### 什么是 roadhog\n![roadhog](/0/roadhog.png)\n\n基于webpack的cli工具，分别用于本地调试和构建，并且提供了特别易用的 mock 功能。\n\n### 代码实战\n1. 安装dva，antd 和 babel-plugin-import\n\n```bash\nnpm install dva-cli -g\n```\n```bash\ndva new dva-quickstart\n```\n```bash\ncd dva-quickstart\nnpm start    \n```\n\n几秒钟后，你会看到以下输出：\n\n```bash\nCompiled successfully!\n\nThe app is running at:\n\n  http://localhost:8000/\n\nNote that the development build is not optimized.\nTo create a production build, use npm run build.\n```\n\n在浏览器里打开 http://localhost:8000 ，你会看到 dva 的欢迎界面。\n\n通过 npm 安装 antd 和 babel-plugin-import 。babel-plugin-import 是用来按需加载 antd 的脚本和样式的。\n\n```bash\nnpm install antd babel-plugin-import --save\n```\n\n编辑 .roadhogrc，使 babel-plugin-import 插件生效。\n\n```diff\n  \"extraBabelPlugins\": [\n-    \"transform-runtime\"\n+    \"transform-runtime\",\n+    [\"import\", { \"libraryName\": \"antd\", \"libraryDirectory\": \"es\", \"style\": \"css\" }]\n  ],\n```\n\n2. 创建page组件\n/root/src/routes/demo/index.js 的代码如下\n\n```JSX\nimport React from 'react';\nimport { connect } from 'dva';\n\nclass Demo extends React.Component {\n    static ROUTE = '/';\n    \n    render() {\n        return (\n            <div>hello</div>\n        );\n    }\n}\n\nexport const DemoClass = Demo;\n\nexport default connect()(Demo);         \n```   \n\n/root/src/router.js 的代码如下\n\n```JSX\nimport React from 'react';\nimport { Router, Route } from 'dva/router';\nimport Demo, { DemoClass } from './routes/Demo';\n\nfunction RouterConfig({ history }) {\n  return (\n    <Router history={history}>\n      <Route path={DemoClass.ROUTE} component={Demo} />\n    </Router>\n  );\n}\n\nexport default RouterConfig;       \n``` \n\n会看到 hello\n\n2. 创建业务模型\n/root/src/models/demo.js 的代码如下\n\n```javascript\nconst namespace = 'demo';\n\nexport default {\n    namespace,\n    state: {\n        showText:'hello demo',\n    },\n    reducers: {\n        overrideStateProps(state, { payload }) {\n            return {\n                ...state,\n                ...payload,\n            };\n        },\n        updateStateProps(state, { payload }) {\n            const { name, value } = payload;\n            return {\n                ...state,\n                ...{ [name]: { ...state[name], ...value } },\n            };\n        },\n\n    },\n    effects: {\n    },\n}\n```\n\n/root/src/index.js 的代码如下\n\n```javascript\nimport dva from 'dva';\nimport './index.css';\n\nconst app = dva();\n\napp.model(require('./models/demo'));\n\napp.router(require('./router'));\n\napp.start('#root');\n```\n\n3. 绑定state \n\n/root/src/routes/demo/index.js 的代码如下\n\n```javascript\nimport React from 'react';\nimport { connect } from 'dva';\n\nclass Demo extends React.Component {\n    static ROUTE = '/';\n\n    render() {\n        const { showText, dispatch } = this.props;\n        return (\n            <div>{showText}</div>\n        );\n    }\n}\n\nexport const DemoClass = Demo;\n\nexport default connect(({ demo }) => ({\n    showText: demo.showText,\n}))(Demo);\n```\n\n4. 添加reduce \n\n/root/src/routes/demo/index.js 的代码如下\n\n```javascript\nimport React from 'react';\nimport { connect } from 'dva';\nimport { Button } from 'antd';\n\nclass Demo extends React.Component {\n    static ROUTE = '/';\n\n    render() {\n        const { showText, dispatch } = this.props;\n        return (\n            <div>\n                <h1>{showText}</h1>\n                <Button\n                    onClick={() => {\n                        dispatch({\n                            type: 'demo/overrideStateProps',\n                            payload: {\n                                showText: showText + 1,\n                            },\n                        });\n                    }}\n                >\n                    点击\n                </Button>\n            </div>\n        );\n    }\n}\n\nexport const DemoClass = Demo;\n\nexport default connect(({ demo }) => ({\n    showText: demo.showText,\n}))(Demo);\n```\n\n/root/src/models/demo.js 的代码如下\n\n```javascript\nconst namespace = 'demo';\n\nexport default {\n    namespace,\n    state: {\n        showText: 0,\n    },\n    reducers: {\n        overrideStateProps(state, { payload }) {\n            return {\n                ...state,\n                ...payload,\n            };\n        },\n        updateStateProps(state, { payload }) {\n            const { name, value } = payload;\n            return {\n                ...state,\n                ...{ [name]: { ...state[name], ...value } },\n            };\n        },\n\n    },\n    effects: {\n    },\n};\n```\n\n5. 添加 effects\n\n/root/src/utils/request.js 的代码如下\n```javascript\nimport fetch from 'dva/fetch';\n\nfunction parseJSON(response) {\n  return response.json();\n}\n\nfunction checkStatus(response) {\n  if (response.status >= 200 && response.status < 300) {\n    return response;\n  }\n\n  const error = new Error(response.statusText);\n  error.response = response;\n  throw error;\n}\n\nexport default function request(url, options) {\n  return fetch(url, options)\n    .then(checkStatus)\n    .then(parseJSON)\n    .then(data)\n    .catch(err => ({ err }));\n}\n```\n\n/root/src/services/Demo.js 的代码如下\n```javascript\nimport request from '../utils/request';\n\nexport default class Demo {\n    static get() {\n        return request('/api/users', { credentials: 'include' });\n    }\n}\n```\n\n/root/src/models/demo.js 的代码如下\n```javascript\nimport Demo from '../services/Demo'\n\nconst namespace = 'demo';\n\nexport default {\n    namespace,\n    state: {\n        showText: 0,\n    },\n    reducers: {\n        overrideStateProps(state, { payload }) {\n            return {\n                ...state,\n                ...payload,\n            };\n        },\n        updateStateProps(state, { payload }) {\n            const { name, value } = payload;\n            return {\n                ...state,\n                ...{ [name]: { ...state[name], ...value } },\n            };\n        },\n\n    },\n    effects: {\n        *get(action, { call }) {\n            const req= yield call(Demo.get);\n            console.log(req);\n        },\n    },\n};\n```","slug":"dva脚手架的demo","published":1,"updated":"2019-02-20T02:50:38.457Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjsgue0ei000egpi611alyy5e","content":"<h1 id=\"dva-demo\"><a href=\"#dva-demo\" class=\"headerlink\" title=\"dva-demo\"></a>dva-demo</h1><p><img src=\"/0/D.Va.jpg\" alt=\"D.VA\"></p>\n<h2 id=\"为什么使用dva\"><a href=\"#为什么使用dva\" class=\"headerlink\" title=\"为什么使用dva\"></a>为什么使用dva</h2><ul>\n<li>reducer, saga, action 都是分离的，编辑成本高，需要在 reducer, saga, action 之间来回切换</li>\n<li>不便于组织业务模型 (或者叫 domain model)，需要复制很多文件。</li>\n<li>dva是 framework，很明确地告诉你每个部件应该怎么写。<a id=\"more\"></a>\n</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.model(&#123;</span><br><span class=\"line\">  <span class=\"attr\">namespace</span>: <span class=\"string\">'demo'</span>,</span><br><span class=\"line\">  <span class=\"attr\">state</span>: &#123;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">effects</span>: &#123;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">reducers</span>: &#123;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>介绍 model 的 key 与原来的 redux-saga 的关系 ：</p>\n<ul>\n<li>namespace - 对应 rootReducer 时的 key 值</li>\n<li>state - 对应 reducer 的 initialState</li>\n<li>effects - 对应 saga</li>\n<li>reducers </li>\n</ul>\n<h2 id=\"实战项目\"><a href=\"#实战项目\" class=\"headerlink\" title=\"实战项目\"></a>实战项目</h2><h3 id=\"文件目录结构\"><a href=\"#文件目录结构\" class=\"headerlink\" title=\"文件目录结构\"></a>文件目录结构</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/root</span><br><span class=\"line\">  ├─ dist/              // 产出目录</span><br><span class=\"line\">  ├─ mock/              // mock 数据</span><br><span class=\"line\">  ├─ public/            // 模板和静态资源</span><br><span class=\"line\">  ├─ src</span><br><span class=\"line\">  │   ├─ assets/        // 静态资源</span><br><span class=\"line\">  │   ├─ components/    // 组件</span><br><span class=\"line\">  │   ├─ models/        // 业务模型</span><br><span class=\"line\">  │   ├─ routes/        // 页面组件</span><br><span class=\"line\">  │   ├─ services/      // 服务</span><br><span class=\"line\">  │   ├─ utils/         // 工具方法</span><br><span class=\"line\">  │   ├─ index.css      // 样式</span><br><span class=\"line\">  │   ├─ index.ejs      // spa 模板</span><br><span class=\"line\">  │   ├─ index.js       // spa 入口</span><br><span class=\"line\">  │   └─ router.js      // 路由文件</span><br><span class=\"line\">  ├─ .editorconfig      // 代码风格配置</span><br><span class=\"line\">  ├─ .eslintrc          // eslint 配置</span><br><span class=\"line\">  ├─ .gitignore         </span><br><span class=\"line\">  ├─ .roadhogrc         // roadhog 配置</span><br><span class=\"line\">  ├─ .roadhogrc.mock.js // roadhog 数据mock</span><br><span class=\"line\">  └─ package.json       // 项目配置</span><br></pre></td></tr></table></figure>\n<h3 id=\"什么是-roadhog\"><a href=\"#什么是-roadhog\" class=\"headerlink\" title=\"什么是 roadhog\"></a>什么是 roadhog</h3><p><img src=\"/0/roadhog.png\" alt=\"roadhog\"></p>\n<p>基于webpack的cli工具，分别用于本地调试和构建，并且提供了特别易用的 mock 功能。</p>\n<h3 id=\"代码实战\"><a href=\"#代码实战\" class=\"headerlink\" title=\"代码实战\"></a>代码实战</h3><ol>\n<li>安装dva，antd 和 babel-plugin-import</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install dva-cli -g</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dva new dva-quickstart</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> dva-quickstart</span><br><span class=\"line\">npm start</span><br></pre></td></tr></table></figure>\n<p>几秒钟后，你会看到以下输出：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Compiled successfully!</span><br><span class=\"line\"></span><br><span class=\"line\">The app is running at:</span><br><span class=\"line\"></span><br><span class=\"line\">  http://localhost:8000/</span><br><span class=\"line\"></span><br><span class=\"line\">Note that the development build is not optimized.</span><br><span class=\"line\">To create a production build, use npm run build.</span><br></pre></td></tr></table></figure>\n<p>在浏览器里打开 <a href=\"http://localhost:8000\" target=\"_blank\" rel=\"external\">http://localhost:8000</a> ，你会看到 dva 的欢迎界面。</p>\n<p>通过 npm 安装 antd 和 babel-plugin-import 。babel-plugin-import 是用来按需加载 antd 的脚本和样式的。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install antd babel-plugin-import --save</span><br></pre></td></tr></table></figure>\n<p>编辑 .roadhogrc，使 babel-plugin-import 插件生效。</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  \"extraBabelPlugins\": [</span><br><span class=\"line\"><span class=\"deletion\">-    \"transform-runtime\"</span></span><br><span class=\"line\"><span class=\"addition\">+    \"transform-runtime\",</span></span><br><span class=\"line\"><span class=\"addition\">+    [\"import\", &#123; \"libraryName\": \"antd\", \"libraryDirectory\": \"es\", \"style\": \"css\" &#125;]</span></span><br><span class=\"line\">  ],</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>创建page组件<br>/root/src/routes/demo/index.js 的代码如下</li>\n</ol>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React <span class=\"keyword\">from</span> <span class=\"string\">'react'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; connect &#125; <span class=\"keyword\">from</span> <span class=\"string\">'dva'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Demo</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> ROUTE = <span class=\"string\">'/'</span>;</span><br><span class=\"line\">    </span><br><span class=\"line\">    render() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (</span><br><span class=\"line\">            <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>hello<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">        );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> DemoClass = Demo;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> connect()(Demo);         </span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`   </span><br><span class=\"line\"></span><br><span class=\"line\">/root/src/router.js 的代码如下</span><br><span class=\"line\"></span><br><span class=\"line\">`</span><span class=\"string\">``</span>JSX</span><br><span class=\"line\"><span class=\"keyword\">import</span> React <span class=\"keyword\">from</span> <span class=\"string\">'react'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; Router, Route &#125; <span class=\"keyword\">from</span> <span class=\"string\">'dva/router'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> Demo, &#123; DemoClass &#125; <span class=\"keyword\">from</span> <span class=\"string\">'./routes/Demo'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">RouterConfig</span>(<span class=\"params\">&#123; history &#125;</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">Router</span> <span class=\"attr\">history</span>=<span class=\"string\">&#123;history&#125;</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">Route</span> <span class=\"attr\">path</span>=<span class=\"string\">&#123;DemoClass.ROUTE&#125;</span> <span class=\"attr\">component</span>=<span class=\"string\">&#123;Demo&#125;</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">Router</span>&gt;</span></span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export default RouterConfig;       </span><br><span class=\"line\">``` </span><br><span class=\"line\"></span><br><span class=\"line\">会看到 hello</span><br><span class=\"line\"></span><br><span class=\"line\">2. 创建业务模型</span><br><span class=\"line\">/root/src/models/demo.js 的代码如下</span><br><span class=\"line\"></span><br><span class=\"line\">```javascript</span><br><span class=\"line\">const namespace = 'demo';</span><br><span class=\"line\"></span><br><span class=\"line\">export default &#123;</span><br><span class=\"line\">    namespace,</span><br><span class=\"line\">    state: &#123;</span><br><span class=\"line\">        showText:'hello demo',</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    reducers: &#123;</span><br><span class=\"line\">        overrideStateProps(state, &#123; payload &#125;) &#123;</span><br><span class=\"line\">            return &#123;</span><br><span class=\"line\">                ...state,</span><br><span class=\"line\">                ...payload,</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        updateStateProps(state, &#123; payload &#125;) &#123;</span><br><span class=\"line\">            const &#123; name, value &#125; = payload;</span><br><span class=\"line\">            return &#123;</span><br><span class=\"line\">                ...state,</span><br><span class=\"line\">                ...&#123; [name]: &#123; ...state[name], ...value &#125; &#125;,</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    effects: &#123;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">&#125;</span></span><br></pre></td></tr></table></figure>\n<p>/root/src/index.js 的代码如下</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> dva <span class=\"keyword\">from</span> <span class=\"string\">'dva'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'./index.css'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> app = dva();</span><br><span class=\"line\"></span><br><span class=\"line\">app.model(<span class=\"built_in\">require</span>(<span class=\"string\">'./models/demo'</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">app.router(<span class=\"built_in\">require</span>(<span class=\"string\">'./router'</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">app.start(<span class=\"string\">'#root'</span>);</span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li>绑定state </li>\n</ol>\n<p>/root/src/routes/demo/index.js 的代码如下</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React <span class=\"keyword\">from</span> <span class=\"string\">'react'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; connect &#125; <span class=\"keyword\">from</span> <span class=\"string\">'dva'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Demo</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> ROUTE = <span class=\"string\">'/'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    render() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> &#123; showText, dispatch &#125; = <span class=\"keyword\">this</span>.props;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (</span><br><span class=\"line\">            <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;showText&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">        );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> DemoClass = Demo;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> connect(<span class=\"function\">(<span class=\"params\">&#123; demo &#125;</span>) =&gt;</span> (&#123;</span><br><span class=\"line\">    <span class=\"attr\">showText</span>: demo.showText,</span><br><span class=\"line\">&#125;))(Demo);</span><br></pre></td></tr></table></figure>\n<ol start=\"4\">\n<li>添加reduce </li>\n</ol>\n<p>/root/src/routes/demo/index.js 的代码如下</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React <span class=\"keyword\">from</span> <span class=\"string\">'react'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; connect &#125; <span class=\"keyword\">from</span> <span class=\"string\">'dva'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; Button &#125; <span class=\"keyword\">from</span> <span class=\"string\">'antd'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Demo</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> ROUTE = <span class=\"string\">'/'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    render() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> &#123; showText, dispatch &#125; = <span class=\"keyword\">this</span>.props;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (</span><br><span class=\"line\">            <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>&#123;showText&#125;<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">Button</span></span><br><span class=\"line\">                    <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> &#123;</span><br><span class=\"line\">                        dispatch(&#123;</span><br><span class=\"line\">                            type: 'demo/overrideStateProps',</span><br><span class=\"line\">                            payload: &#123;</span><br><span class=\"line\">                                showText: showText + 1,</span><br><span class=\"line\">                            &#125;,</span><br><span class=\"line\">                        &#125;);</span><br><span class=\"line\">                    &#125;&#125;</span><br><span class=\"line\">                &gt;</span><br><span class=\"line\">                    点击</span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">Button</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">        );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> DemoClass = Demo;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> connect(<span class=\"function\">(<span class=\"params\">&#123; demo &#125;</span>) =&gt;</span> (&#123;</span><br><span class=\"line\">    <span class=\"attr\">showText</span>: demo.showText,</span><br><span class=\"line\">&#125;))(Demo);</span><br></pre></td></tr></table></figure>\n<p>/root/src/models/demo.js 的代码如下</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> namespace = <span class=\"string\">'demo'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">    namespace,</span><br><span class=\"line\">    <span class=\"attr\">state</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">showText</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">reducers</span>: &#123;</span><br><span class=\"line\">        overrideStateProps(state, &#123; payload &#125;) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">                ...state,</span><br><span class=\"line\">                ...payload,</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        updateStateProps(state, &#123; payload &#125;) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> &#123; name, value &#125; = payload;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">                ...state,</span><br><span class=\"line\">                ...&#123; [name]: &#123; ...state[name], ...value &#125; &#125;,</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">effects</span>: &#123;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<ol start=\"5\">\n<li>添加 effects</li>\n</ol>\n<p>/root/src/utils/request.js 的代码如下<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> fetch <span class=\"keyword\">from</span> <span class=\"string\">'dva/fetch'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">parseJSON</span>(<span class=\"params\">response</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> response.json();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">checkStatus</span>(<span class=\"params\">response</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (response.status &gt;= <span class=\"number\">200</span> &amp;&amp; response.status &lt; <span class=\"number\">300</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> response;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> error = <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(response.statusText);</span><br><span class=\"line\">  error.response = response;</span><br><span class=\"line\">  <span class=\"keyword\">throw</span> error;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">request</span>(<span class=\"params\">url, options</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> fetch(url, options)</span><br><span class=\"line\">    .then(checkStatus)</span><br><span class=\"line\">    .then(parseJSON)</span><br><span class=\"line\">    .then(data)</span><br><span class=\"line\">    .catch(<span class=\"function\"><span class=\"params\">err</span> =&gt;</span> (&#123; err &#125;));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>/root/src/services/Demo.js 的代码如下<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> request <span class=\"keyword\">from</span> <span class=\"string\">'../utils/request'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Demo</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> get() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> request(<span class=\"string\">'/api/users'</span>, &#123; <span class=\"attr\">credentials</span>: <span class=\"string\">'include'</span> &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>/root/src/models/demo.js 的代码如下<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> Demo <span class=\"keyword\">from</span> <span class=\"string\">'../services/Demo'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> namespace = <span class=\"string\">'demo'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">    namespace,</span><br><span class=\"line\">    <span class=\"attr\">state</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">showText</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">reducers</span>: &#123;</span><br><span class=\"line\">        overrideStateProps(state, &#123; payload &#125;) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">                ...state,</span><br><span class=\"line\">                ...payload,</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        updateStateProps(state, &#123; payload &#125;) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> &#123; name, value &#125; = payload;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">                ...state,</span><br><span class=\"line\">                ...&#123; [name]: &#123; ...state[name], ...value &#125; &#125;,</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">effects</span>: &#123;</span><br><span class=\"line\">        *get(action, &#123; call &#125;) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> req= <span class=\"keyword\">yield</span> call(Demo.get);</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(req);</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></p>\n","excerpt":"<h1 id=\"dva-demo\"><a href=\"#dva-demo\" class=\"headerlink\" title=\"dva-demo\"></a>dva-demo</h1><p><img src=\"/0/D.Va.jpg\" alt=\"D.VA\"></p>\n<h2 id=\"为什么使用dva\"><a href=\"#为什么使用dva\" class=\"headerlink\" title=\"为什么使用dva\"></a>为什么使用dva</h2><ul>\n<li>reducer, saga, action 都是分离的，编辑成本高，需要在 reducer, saga, action 之间来回切换</li>\n<li>不便于组织业务模型 (或者叫 domain model)，需要复制很多文件。</li>\n<li>dva是 framework，很明确地告诉你每个部件应该怎么写。","more":"</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.model(&#123;</span><br><span class=\"line\">  <span class=\"attr\">namespace</span>: <span class=\"string\">'demo'</span>,</span><br><span class=\"line\">  <span class=\"attr\">state</span>: &#123;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">effects</span>: &#123;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">reducers</span>: &#123;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>介绍 model 的 key 与原来的 redux-saga 的关系 ：</p>\n<ul>\n<li>namespace - 对应 rootReducer 时的 key 值</li>\n<li>state - 对应 reducer 的 initialState</li>\n<li>effects - 对应 saga</li>\n<li>reducers </li>\n</ul>\n<h2 id=\"实战项目\"><a href=\"#实战项目\" class=\"headerlink\" title=\"实战项目\"></a>实战项目</h2><h3 id=\"文件目录结构\"><a href=\"#文件目录结构\" class=\"headerlink\" title=\"文件目录结构\"></a>文件目录结构</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/root</span><br><span class=\"line\">  ├─ dist/              // 产出目录</span><br><span class=\"line\">  ├─ mock/              // mock 数据</span><br><span class=\"line\">  ├─ public/            // 模板和静态资源</span><br><span class=\"line\">  ├─ src</span><br><span class=\"line\">  │   ├─ assets/        // 静态资源</span><br><span class=\"line\">  │   ├─ components/    // 组件</span><br><span class=\"line\">  │   ├─ models/        // 业务模型</span><br><span class=\"line\">  │   ├─ routes/        // 页面组件</span><br><span class=\"line\">  │   ├─ services/      // 服务</span><br><span class=\"line\">  │   ├─ utils/         // 工具方法</span><br><span class=\"line\">  │   ├─ index.css      // 样式</span><br><span class=\"line\">  │   ├─ index.ejs      // spa 模板</span><br><span class=\"line\">  │   ├─ index.js       // spa 入口</span><br><span class=\"line\">  │   └─ router.js      // 路由文件</span><br><span class=\"line\">  ├─ .editorconfig      // 代码风格配置</span><br><span class=\"line\">  ├─ .eslintrc          // eslint 配置</span><br><span class=\"line\">  ├─ .gitignore         </span><br><span class=\"line\">  ├─ .roadhogrc         // roadhog 配置</span><br><span class=\"line\">  ├─ .roadhogrc.mock.js // roadhog 数据mock</span><br><span class=\"line\">  └─ package.json       // 项目配置</span><br></pre></td></tr></table></figure>\n<h3 id=\"什么是-roadhog\"><a href=\"#什么是-roadhog\" class=\"headerlink\" title=\"什么是 roadhog\"></a>什么是 roadhog</h3><p><img src=\"/0/roadhog.png\" alt=\"roadhog\"></p>\n<p>基于webpack的cli工具，分别用于本地调试和构建，并且提供了特别易用的 mock 功能。</p>\n<h3 id=\"代码实战\"><a href=\"#代码实战\" class=\"headerlink\" title=\"代码实战\"></a>代码实战</h3><ol>\n<li>安装dva，antd 和 babel-plugin-import</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install dva-cli -g</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dva new dva-quickstart</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> dva-quickstart</span><br><span class=\"line\">npm start</span><br></pre></td></tr></table></figure>\n<p>几秒钟后，你会看到以下输出：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Compiled successfully!</span><br><span class=\"line\"></span><br><span class=\"line\">The app is running at:</span><br><span class=\"line\"></span><br><span class=\"line\">  http://localhost:8000/</span><br><span class=\"line\"></span><br><span class=\"line\">Note that the development build is not optimized.</span><br><span class=\"line\">To create a production build, use npm run build.</span><br></pre></td></tr></table></figure>\n<p>在浏览器里打开 <a href=\"http://localhost:8000\">http://localhost:8000</a> ，你会看到 dva 的欢迎界面。</p>\n<p>通过 npm 安装 antd 和 babel-plugin-import 。babel-plugin-import 是用来按需加载 antd 的脚本和样式的。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install antd babel-plugin-import --save</span><br></pre></td></tr></table></figure>\n<p>编辑 .roadhogrc，使 babel-plugin-import 插件生效。</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  \"extraBabelPlugins\": [</span><br><span class=\"line\"><span class=\"deletion\">-    \"transform-runtime\"</span></span><br><span class=\"line\"><span class=\"addition\">+    \"transform-runtime\",</span></span><br><span class=\"line\"><span class=\"addition\">+    [\"import\", &#123; \"libraryName\": \"antd\", \"libraryDirectory\": \"es\", \"style\": \"css\" &#125;]</span></span><br><span class=\"line\">  ],</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>创建page组件<br>/root/src/routes/demo/index.js 的代码如下</li>\n</ol>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React <span class=\"keyword\">from</span> <span class=\"string\">'react'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; connect &#125; <span class=\"keyword\">from</span> <span class=\"string\">'dva'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Demo</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> ROUTE = <span class=\"string\">'/'</span>;</span><br><span class=\"line\">    </span><br><span class=\"line\">    render() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (</span><br><span class=\"line\">            <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>hello<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">        );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> DemoClass = Demo;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> connect()(Demo);         </span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">`   </span><br><span class=\"line\"></span><br><span class=\"line\">/root/src/router.js 的代码如下</span><br><span class=\"line\"></span><br><span class=\"line\">`</span><span class=\"string\">``</span>JSX</span><br><span class=\"line\"><span class=\"keyword\">import</span> React <span class=\"keyword\">from</span> <span class=\"string\">'react'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; Router, Route &#125; <span class=\"keyword\">from</span> <span class=\"string\">'dva/router'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> Demo, &#123; DemoClass &#125; <span class=\"keyword\">from</span> <span class=\"string\">'./routes/Demo'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">RouterConfig</span>(<span class=\"params\">&#123; history &#125;</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">Router</span> <span class=\"attr\">history</span>=<span class=\"string\">&#123;history&#125;</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">Route</span> <span class=\"attr\">path</span>=<span class=\"string\">&#123;DemoClass.ROUTE&#125;</span> <span class=\"attr\">component</span>=<span class=\"string\">&#123;Demo&#125;</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">Router</span>&gt;</span></span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export default RouterConfig;       </span><br><span class=\"line\">``` </span><br><span class=\"line\"></span><br><span class=\"line\">会看到 hello</span><br><span class=\"line\"></span><br><span class=\"line\">2. 创建业务模型</span><br><span class=\"line\">/root/src/models/demo.js 的代码如下</span><br><span class=\"line\"></span><br><span class=\"line\">```javascript</span><br><span class=\"line\">const namespace = 'demo';</span><br><span class=\"line\"></span><br><span class=\"line\">export default &#123;</span><br><span class=\"line\">    namespace,</span><br><span class=\"line\">    state: &#123;</span><br><span class=\"line\">        showText:'hello demo',</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    reducers: &#123;</span><br><span class=\"line\">        overrideStateProps(state, &#123; payload &#125;) &#123;</span><br><span class=\"line\">            return &#123;</span><br><span class=\"line\">                ...state,</span><br><span class=\"line\">                ...payload,</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        updateStateProps(state, &#123; payload &#125;) &#123;</span><br><span class=\"line\">            const &#123; name, value &#125; = payload;</span><br><span class=\"line\">            return &#123;</span><br><span class=\"line\">                ...state,</span><br><span class=\"line\">                ...&#123; [name]: &#123; ...state[name], ...value &#125; &#125;,</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    effects: &#123;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">&#125;</span></span><br></pre></td></tr></table></figure>\n<p>/root/src/index.js 的代码如下</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> dva <span class=\"keyword\">from</span> <span class=\"string\">'dva'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'./index.css'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> app = dva();</span><br><span class=\"line\"></span><br><span class=\"line\">app.model(<span class=\"built_in\">require</span>(<span class=\"string\">'./models/demo'</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">app.router(<span class=\"built_in\">require</span>(<span class=\"string\">'./router'</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">app.start(<span class=\"string\">'#root'</span>);</span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li>绑定state </li>\n</ol>\n<p>/root/src/routes/demo/index.js 的代码如下</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React <span class=\"keyword\">from</span> <span class=\"string\">'react'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; connect &#125; <span class=\"keyword\">from</span> <span class=\"string\">'dva'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Demo</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> ROUTE = <span class=\"string\">'/'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    render() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> &#123; showText, dispatch &#125; = <span class=\"keyword\">this</span>.props;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (</span><br><span class=\"line\">            <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;showText&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">        );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> DemoClass = Demo;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> connect(<span class=\"function\">(<span class=\"params\">&#123; demo &#125;</span>) =&gt;</span> (&#123;</span><br><span class=\"line\">    <span class=\"attr\">showText</span>: demo.showText,</span><br><span class=\"line\">&#125;))(Demo);</span><br></pre></td></tr></table></figure>\n<ol start=\"4\">\n<li>添加reduce </li>\n</ol>\n<p>/root/src/routes/demo/index.js 的代码如下</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React <span class=\"keyword\">from</span> <span class=\"string\">'react'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; connect &#125; <span class=\"keyword\">from</span> <span class=\"string\">'dva'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; Button &#125; <span class=\"keyword\">from</span> <span class=\"string\">'antd'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Demo</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> ROUTE = <span class=\"string\">'/'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    render() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> &#123; showText, dispatch &#125; = <span class=\"keyword\">this</span>.props;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (</span><br><span class=\"line\">            <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>&#123;showText&#125;<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">Button</span></span><br><span class=\"line\">                    <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> &#123;</span><br><span class=\"line\">                        dispatch(&#123;</span><br><span class=\"line\">                            type: 'demo/overrideStateProps',</span><br><span class=\"line\">                            payload: &#123;</span><br><span class=\"line\">                                showText: showText + 1,</span><br><span class=\"line\">                            &#125;,</span><br><span class=\"line\">                        &#125;);</span><br><span class=\"line\">                    &#125;&#125;</span><br><span class=\"line\">                &gt;</span><br><span class=\"line\">                    点击</span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">Button</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">        );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> DemoClass = Demo;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> connect(<span class=\"function\">(<span class=\"params\">&#123; demo &#125;</span>) =&gt;</span> (&#123;</span><br><span class=\"line\">    <span class=\"attr\">showText</span>: demo.showText,</span><br><span class=\"line\">&#125;))(Demo);</span><br></pre></td></tr></table></figure>\n<p>/root/src/models/demo.js 的代码如下</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> namespace = <span class=\"string\">'demo'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">    namespace,</span><br><span class=\"line\">    <span class=\"attr\">state</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">showText</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">reducers</span>: &#123;</span><br><span class=\"line\">        overrideStateProps(state, &#123; payload &#125;) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">                ...state,</span><br><span class=\"line\">                ...payload,</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        updateStateProps(state, &#123; payload &#125;) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> &#123; name, value &#125; = payload;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">                ...state,</span><br><span class=\"line\">                ...&#123; [name]: &#123; ...state[name], ...value &#125; &#125;,</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">effects</span>: &#123;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<ol start=\"5\">\n<li>添加 effects</li>\n</ol>\n<p>/root/src/utils/request.js 的代码如下<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> fetch <span class=\"keyword\">from</span> <span class=\"string\">'dva/fetch'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">parseJSON</span>(<span class=\"params\">response</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> response.json();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">checkStatus</span>(<span class=\"params\">response</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (response.status &gt;= <span class=\"number\">200</span> &amp;&amp; response.status &lt; <span class=\"number\">300</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> response;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> error = <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(response.statusText);</span><br><span class=\"line\">  error.response = response;</span><br><span class=\"line\">  <span class=\"keyword\">throw</span> error;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">request</span>(<span class=\"params\">url, options</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> fetch(url, options)</span><br><span class=\"line\">    .then(checkStatus)</span><br><span class=\"line\">    .then(parseJSON)</span><br><span class=\"line\">    .then(data)</span><br><span class=\"line\">    .catch(<span class=\"function\"><span class=\"params\">err</span> =&gt;</span> (&#123; err &#125;));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>/root/src/services/Demo.js 的代码如下<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> request <span class=\"keyword\">from</span> <span class=\"string\">'../utils/request'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Demo</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> get() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> request(<span class=\"string\">'/api/users'</span>, &#123; <span class=\"attr\">credentials</span>: <span class=\"string\">'include'</span> &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>/root/src/models/demo.js 的代码如下<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> Demo <span class=\"keyword\">from</span> <span class=\"string\">'../services/Demo'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> namespace = <span class=\"string\">'demo'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">    namespace,</span><br><span class=\"line\">    <span class=\"attr\">state</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">showText</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">reducers</span>: &#123;</span><br><span class=\"line\">        overrideStateProps(state, &#123; payload &#125;) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">                ...state,</span><br><span class=\"line\">                ...payload,</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        updateStateProps(state, &#123; payload &#125;) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> &#123; name, value &#125; = payload;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">                ...state,</span><br><span class=\"line\">                ...&#123; [name]: &#123; ...state[name], ...value &#125; &#125;,</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">effects</span>: &#123;</span><br><span class=\"line\">        *get(action, &#123; call &#125;) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> req= <span class=\"keyword\">yield</span> call(Demo.get);</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(req);</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></p>"},{"title":"npm对项目依赖包版本管理的机制","date":"2017-12-11T04:00:01.000Z","_content":"\n## semver\n[语义化版本控制规范](https://semver.org/lang/zh-CN/)\n\n版本格式：主版本号.次版本号.修订号，版本号(major, minor, patch)递增规则如下：\n1. 主版本号：当你做了不兼容的 API 修改，\n2. 次版本号：当你做了向下兼容的功能性新增，\n3. 修订号：当你做了向下兼容的问题修正。<!--more-->\n\n\n#### Versions\n版本是指例如 0.4.1、1.2.7、1.2.4-beta.0 这样表示包的特定版本的字符串。\n\n\n#### Ranges\n范围则是对满足特定规则的版本的一种表示，例如 1.2.3-2.3.4、1.x、^0.2、>1.4.0\n\n* `<` 小于某个版\n```json\n{\n    \"babel\": \"<6.5.2\",\n}\n```\n\n* `<=` 小于等于某个版本\n```json\n{\n    \"babel\": \"<=6.5.2\",\n}\n```\n\n* `>` 大于某个版本\n```json\n{\n    \"babel\": \">6.5.2\",\n}\n```\n\n* `>=` 大于等于某个版本\n```json\n{\n    \"babel\": \">=6.5.2\",\n}\n```\n\n* `=` 等于某个版本\n```json\n{\n    \"babel\": \"=6.5.2\",\n}\n```\n\n* `X, x,*` 限定主版本号和次版本号\n>* \\* := >=0.0.0（任何版本满足）\n>* 1.x := >=1.0.0 <2.0.0 (匹配的主要版本)\n>* 1.2.x := >=1.2.0 <1.3.0 (匹配的主要和次要版本)\n>* \"\" (空字符) := * := >=0.0.0\n>* 1 := 1.x.x := >=1.0.0 <2.0.0\n>* 1.2 := 1.2.x := >=1.2.0 <1.3.0\n\n```json\n{\n    \"babel\": \"~6.5.x\",\n}\n```\n\n* `~` 限定主版本号和次版本号\n>* ~1.2.3 := >=1.2.3 <1.(2+1).0 := >=1.2.3 <1.3.0\n>* ~1.2 := >=1.2.0 <1.(2+1).0 := >=1.2.0 <1.3.0 (等同于 1.2.x)\n>* ~1 := >=1.0.0 <(1+1).0.0 := >=1.0.0 <2.0.0 (等同于 1.x)\n>* ~0.2.3 := >=0.2.3 <0.(2+1).0 := >=0.2.3 <0.3.0\n>* ~0.2 := >=0.2.0 <0.(2+1).0 := >=0.2.0 <0.3.0 (等同于 0.2.x)\n>* ~0 := >=0.0.0 <(0+1).0.0 := >=0.0.0 <1.0.0 (等同于 0.x)\n\n```json\n{\n    \"babel\": \"~6.5.2\",\n}\n```\n\n* `^` 允许变化最左边的非零位的版本位\n>* ^1.2.3 := >=1.2.3 <2.0.0\n>* ^0.2.3 := >=0.2.3 <0.3.0\n>* ^0.0.3 := >=0.0.3 <0.0.4\n>* ^1.2.x := >=1.2.0 <2.0.0\n>* ^0.0.x := >=0.0.0 <0.1.0\n>* ^0.0 := >=0.0.0 <0.1.0\n>* ^1.x := >=1.0.0 <2.0.0\n>* ^0.x := >=0.0.0 <1.0.0\n\n```json\n{\n    \"babel\": \"^6.5.2\",\n}\n```\n\n#### npm install 的版本选择策略\n* package.json没有对应包 install 没有限定版本：安装源的最新版本\n* package.json有对应包 install 没有限定版本：package.json根据semver安装版本\n* package.json没有对应包 install 限定版本：安装制定版本 package.json写入以^开头的版本依赖\n* package.json有对应包 install 限定版本：安装制定版本 package.json依据按住改写以^开头的版本依赖","source":"_posts/npm对包版本管理的机制.md","raw":"---\ntitle: npm对项目依赖包版本管理的机制\ndate: 2017-12-11 12:00:01\ntags: ['npm','semver','package','包版本管理']\ncategory: 'coding'\n---\n\n## semver\n[语义化版本控制规范](https://semver.org/lang/zh-CN/)\n\n版本格式：主版本号.次版本号.修订号，版本号(major, minor, patch)递增规则如下：\n1. 主版本号：当你做了不兼容的 API 修改，\n2. 次版本号：当你做了向下兼容的功能性新增，\n3. 修订号：当你做了向下兼容的问题修正。<!--more-->\n\n\n#### Versions\n版本是指例如 0.4.1、1.2.7、1.2.4-beta.0 这样表示包的特定版本的字符串。\n\n\n#### Ranges\n范围则是对满足特定规则的版本的一种表示，例如 1.2.3-2.3.4、1.x、^0.2、>1.4.0\n\n* `<` 小于某个版\n```json\n{\n    \"babel\": \"<6.5.2\",\n}\n```\n\n* `<=` 小于等于某个版本\n```json\n{\n    \"babel\": \"<=6.5.2\",\n}\n```\n\n* `>` 大于某个版本\n```json\n{\n    \"babel\": \">6.5.2\",\n}\n```\n\n* `>=` 大于等于某个版本\n```json\n{\n    \"babel\": \">=6.5.2\",\n}\n```\n\n* `=` 等于某个版本\n```json\n{\n    \"babel\": \"=6.5.2\",\n}\n```\n\n* `X, x,*` 限定主版本号和次版本号\n>* \\* := >=0.0.0（任何版本满足）\n>* 1.x := >=1.0.0 <2.0.0 (匹配的主要版本)\n>* 1.2.x := >=1.2.0 <1.3.0 (匹配的主要和次要版本)\n>* \"\" (空字符) := * := >=0.0.0\n>* 1 := 1.x.x := >=1.0.0 <2.0.0\n>* 1.2 := 1.2.x := >=1.2.0 <1.3.0\n\n```json\n{\n    \"babel\": \"~6.5.x\",\n}\n```\n\n* `~` 限定主版本号和次版本号\n>* ~1.2.3 := >=1.2.3 <1.(2+1).0 := >=1.2.3 <1.3.0\n>* ~1.2 := >=1.2.0 <1.(2+1).0 := >=1.2.0 <1.3.0 (等同于 1.2.x)\n>* ~1 := >=1.0.0 <(1+1).0.0 := >=1.0.0 <2.0.0 (等同于 1.x)\n>* ~0.2.3 := >=0.2.3 <0.(2+1).0 := >=0.2.3 <0.3.0\n>* ~0.2 := >=0.2.0 <0.(2+1).0 := >=0.2.0 <0.3.0 (等同于 0.2.x)\n>* ~0 := >=0.0.0 <(0+1).0.0 := >=0.0.0 <1.0.0 (等同于 0.x)\n\n```json\n{\n    \"babel\": \"~6.5.2\",\n}\n```\n\n* `^` 允许变化最左边的非零位的版本位\n>* ^1.2.3 := >=1.2.3 <2.0.0\n>* ^0.2.3 := >=0.2.3 <0.3.0\n>* ^0.0.3 := >=0.0.3 <0.0.4\n>* ^1.2.x := >=1.2.0 <2.0.0\n>* ^0.0.x := >=0.0.0 <0.1.0\n>* ^0.0 := >=0.0.0 <0.1.0\n>* ^1.x := >=1.0.0 <2.0.0\n>* ^0.x := >=0.0.0 <1.0.0\n\n```json\n{\n    \"babel\": \"^6.5.2\",\n}\n```\n\n#### npm install 的版本选择策略\n* package.json没有对应包 install 没有限定版本：安装源的最新版本\n* package.json有对应包 install 没有限定版本：package.json根据semver安装版本\n* package.json没有对应包 install 限定版本：安装制定版本 package.json写入以^开头的版本依赖\n* package.json有对应包 install 限定版本：安装制定版本 package.json依据按住改写以^开头的版本依赖","slug":"npm对包版本管理的机制","published":1,"updated":"2019-02-20T02:50:38.464Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjsgue0ej000ggpi6yv055zvs","content":"<h2 id=\"semver\"><a href=\"#semver\" class=\"headerlink\" title=\"semver\"></a>semver</h2><p><a href=\"https://semver.org/lang/zh-CN/\" target=\"_blank\" rel=\"external\">语义化版本控制规范</a></p>\n<p>版本格式：主版本号.次版本号.修订号，版本号(major, minor, patch)递增规则如下：</p>\n<ol>\n<li>主版本号：当你做了不兼容的 API 修改，</li>\n<li>次版本号：当你做了向下兼容的功能性新增，</li>\n<li>修订号：当你做了向下兼容的问题修正。<a id=\"more\"></a></li>\n</ol>\n<h4 id=\"Versions\"><a href=\"#Versions\" class=\"headerlink\" title=\"Versions\"></a>Versions</h4><p>版本是指例如 0.4.1、1.2.7、1.2.4-beta.0 这样表示包的特定版本的字符串。</p>\n<h4 id=\"Ranges\"><a href=\"#Ranges\" class=\"headerlink\" title=\"Ranges\"></a>Ranges</h4><p>范围则是对满足特定规则的版本的一种表示，例如 1.2.3-2.3.4、1.x、^0.2、&gt;1.4.0</p>\n<ul>\n<li><p><code>&lt;</code> 小于某个版</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"attr\">\"babel\"</span>: <span class=\"string\">\"&lt;6.5.2\"</span>,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><code>&lt;=</code> 小于等于某个版本</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"attr\">\"babel\"</span>: <span class=\"string\">\"&lt;=6.5.2\"</span>,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><code>&gt;</code> 大于某个版本</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"attr\">\"babel\"</span>: <span class=\"string\">\"&gt;6.5.2\"</span>,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><code>&gt;=</code> 大于等于某个版本</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"attr\">\"babel\"</span>: <span class=\"string\">\"&gt;=6.5.2\"</span>,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><code>=</code> 等于某个版本</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"attr\">\"babel\"</span>: <span class=\"string\">\"=6.5.2\"</span>,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><code>X, x,*</code> 限定主版本号和次版本号</p>\n<blockquote>\n<ul>\n<li>* := &gt;=0.0.0（任何版本满足）</li>\n<li>1.x := &gt;=1.0.0 &lt;2.0.0 (匹配的主要版本)</li>\n<li>1.2.x := &gt;=1.2.0 &lt;1.3.0 (匹配的主要和次要版本)</li>\n<li>“” (空字符) := * := &gt;=0.0.0</li>\n<li>1 := 1.x.x := &gt;=1.0.0 &lt;2.0.0</li>\n<li>1.2 := 1.2.x := &gt;=1.2.0 &lt;1.3.0</li>\n</ul>\n</blockquote>\n</li>\n</ul>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"attr\">\"babel\"</span>: <span class=\"string\">\"~6.5.x\"</span>,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li><code>~</code> 限定主版本号和次版本号<blockquote>\n<ul>\n<li>~1.2.3 := &gt;=1.2.3 &lt;1.(2+1).0 := &gt;=1.2.3 &lt;1.3.0</li>\n<li>~1.2 := &gt;=1.2.0 &lt;1.(2+1).0 := &gt;=1.2.0 &lt;1.3.0 (等同于 1.2.x)</li>\n<li>~1 := &gt;=1.0.0 &lt;(1+1).0.0 := &gt;=1.0.0 &lt;2.0.0 (等同于 1.x)</li>\n<li>~0.2.3 := &gt;=0.2.3 &lt;0.(2+1).0 := &gt;=0.2.3 &lt;0.3.0</li>\n<li>~0.2 := &gt;=0.2.0 &lt;0.(2+1).0 := &gt;=0.2.0 &lt;0.3.0 (等同于 0.2.x)</li>\n<li>~0 := &gt;=0.0.0 &lt;(0+1).0.0 := &gt;=0.0.0 &lt;1.0.0 (等同于 0.x)</li>\n</ul>\n</blockquote>\n</li>\n</ul>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"attr\">\"babel\"</span>: <span class=\"string\">\"~6.5.2\"</span>,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li><code>^</code> 允许变化最左边的非零位的版本位<blockquote>\n<ul>\n<li>^1.2.3 := &gt;=1.2.3 &lt;2.0.0</li>\n<li>^0.2.3 := &gt;=0.2.3 &lt;0.3.0</li>\n<li>^0.0.3 := &gt;=0.0.3 &lt;0.0.4</li>\n<li>^1.2.x := &gt;=1.2.0 &lt;2.0.0</li>\n<li>^0.0.x := &gt;=0.0.0 &lt;0.1.0</li>\n<li>^0.0 := &gt;=0.0.0 &lt;0.1.0</li>\n<li>^1.x := &gt;=1.0.0 &lt;2.0.0</li>\n<li>^0.x := &gt;=0.0.0 &lt;1.0.0</li>\n</ul>\n</blockquote>\n</li>\n</ul>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"attr\">\"babel\"</span>: <span class=\"string\">\"^6.5.2\"</span>,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"npm-install-的版本选择策略\"><a href=\"#npm-install-的版本选择策略\" class=\"headerlink\" title=\"npm install 的版本选择策略\"></a>npm install 的版本选择策略</h4><ul>\n<li>package.json没有对应包 install 没有限定版本：安装源的最新版本</li>\n<li>package.json有对应包 install 没有限定版本：package.json根据semver安装版本</li>\n<li>package.json没有对应包 install 限定版本：安装制定版本 package.json写入以^开头的版本依赖</li>\n<li>package.json有对应包 install 限定版本：安装制定版本 package.json依据按住改写以^开头的版本依赖</li>\n</ul>\n","excerpt":"<h2 id=\"semver\"><a href=\"#semver\" class=\"headerlink\" title=\"semver\"></a>semver</h2><p><a href=\"https://semver.org/lang/zh-CN/\">语义化版本控制规范</a></p>\n<p>版本格式：主版本号.次版本号.修订号，版本号(major, minor, patch)递增规则如下：</p>\n<ol>\n<li>主版本号：当你做了不兼容的 API 修改，</li>\n<li>次版本号：当你做了向下兼容的功能性新增，</li>\n<li>修订号：当你做了向下兼容的问题修正。","more":"</li>\n</ol>\n<h4 id=\"Versions\"><a href=\"#Versions\" class=\"headerlink\" title=\"Versions\"></a>Versions</h4><p>版本是指例如 0.4.1、1.2.7、1.2.4-beta.0 这样表示包的特定版本的字符串。</p>\n<h4 id=\"Ranges\"><a href=\"#Ranges\" class=\"headerlink\" title=\"Ranges\"></a>Ranges</h4><p>范围则是对满足特定规则的版本的一种表示，例如 1.2.3-2.3.4、1.x、^0.2、&gt;1.4.0</p>\n<ul>\n<li><p><code>&lt;</code> 小于某个版</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"attr\">\"babel\"</span>: <span class=\"string\">\"&lt;6.5.2\"</span>,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><code>&lt;=</code> 小于等于某个版本</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"attr\">\"babel\"</span>: <span class=\"string\">\"&lt;=6.5.2\"</span>,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><code>&gt;</code> 大于某个版本</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"attr\">\"babel\"</span>: <span class=\"string\">\"&gt;6.5.2\"</span>,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><code>&gt;=</code> 大于等于某个版本</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"attr\">\"babel\"</span>: <span class=\"string\">\"&gt;=6.5.2\"</span>,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><code>=</code> 等于某个版本</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"attr\">\"babel\"</span>: <span class=\"string\">\"=6.5.2\"</span>,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><code>X, x,*</code> 限定主版本号和次版本号</p>\n<blockquote>\n<ul>\n<li>* := &gt;=0.0.0（任何版本满足）</li>\n<li>1.x := &gt;=1.0.0 &lt;2.0.0 (匹配的主要版本)</li>\n<li>1.2.x := &gt;=1.2.0 &lt;1.3.0 (匹配的主要和次要版本)</li>\n<li>“” (空字符) := * := &gt;=0.0.0</li>\n<li>1 := 1.x.x := &gt;=1.0.0 &lt;2.0.0</li>\n<li>1.2 := 1.2.x := &gt;=1.2.0 &lt;1.3.0</li>\n</ul>\n</blockquote>\n</li>\n</ul>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"attr\">\"babel\"</span>: <span class=\"string\">\"~6.5.x\"</span>,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li><code>~</code> 限定主版本号和次版本号<blockquote>\n<ul>\n<li>~1.2.3 := &gt;=1.2.3 &lt;1.(2+1).0 := &gt;=1.2.3 &lt;1.3.0</li>\n<li>~1.2 := &gt;=1.2.0 &lt;1.(2+1).0 := &gt;=1.2.0 &lt;1.3.0 (等同于 1.2.x)</li>\n<li>~1 := &gt;=1.0.0 &lt;(1+1).0.0 := &gt;=1.0.0 &lt;2.0.0 (等同于 1.x)</li>\n<li>~0.2.3 := &gt;=0.2.3 &lt;0.(2+1).0 := &gt;=0.2.3 &lt;0.3.0</li>\n<li>~0.2 := &gt;=0.2.0 &lt;0.(2+1).0 := &gt;=0.2.0 &lt;0.3.0 (等同于 0.2.x)</li>\n<li>~0 := &gt;=0.0.0 &lt;(0+1).0.0 := &gt;=0.0.0 &lt;1.0.0 (等同于 0.x)</li>\n</ul>\n</blockquote>\n</li>\n</ul>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"attr\">\"babel\"</span>: <span class=\"string\">\"~6.5.2\"</span>,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li><code>^</code> 允许变化最左边的非零位的版本位<blockquote>\n<ul>\n<li>^1.2.3 := &gt;=1.2.3 &lt;2.0.0</li>\n<li>^0.2.3 := &gt;=0.2.3 &lt;0.3.0</li>\n<li>^0.0.3 := &gt;=0.0.3 &lt;0.0.4</li>\n<li>^1.2.x := &gt;=1.2.0 &lt;2.0.0</li>\n<li>^0.0.x := &gt;=0.0.0 &lt;0.1.0</li>\n<li>^0.0 := &gt;=0.0.0 &lt;0.1.0</li>\n<li>^1.x := &gt;=1.0.0 &lt;2.0.0</li>\n<li>^0.x := &gt;=0.0.0 &lt;1.0.0</li>\n</ul>\n</blockquote>\n</li>\n</ul>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"attr\">\"babel\"</span>: <span class=\"string\">\"^6.5.2\"</span>,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"npm-install-的版本选择策略\"><a href=\"#npm-install-的版本选择策略\" class=\"headerlink\" title=\"npm install 的版本选择策略\"></a>npm install 的版本选择策略</h4><ul>\n<li>package.json没有对应包 install 没有限定版本：安装源的最新版本</li>\n<li>package.json有对应包 install 没有限定版本：package.json根据semver安装版本</li>\n<li>package.json没有对应包 install 限定版本：安装制定版本 package.json写入以^开头的版本依赖</li>\n<li>package.json有对应包 install 限定版本：安装制定版本 package.json依据按住改写以^开头的版本依赖</li>\n</ul>"},{"title":"react reducers函数单元测试用例与实践体验","date":"2017-12-16T12:10:40.000Z","_content":"\nreduces函数都是纯函数，主要是传递`payload`来修改`state`\n\n代码都是围绕业务来编写的，这样存在的问题就是伴随业务的变化，代码也要相应的改动。那么对应的单元测试代码也要改动。而且就现在的编写思想来看业务的多少就决定了代码的数量。\n<!--more-->\n```javascript\nreducers: {\n    saveIsSearchCustomerFormLoading(state, { payload }) {\n        return Object.assign({}, state, {\n            isSearchCustomerFormLoading: payload,\n        });\n    },\n    saveSearchCustomerList(state, { payload }) {\n        return Object.assign({}, state, {\n            searchCustomerList: {\n                dataList: payload.data_list.map((customer) => {\n                    return new Customer(customer);\n                }),\n                totalItemCount: payload.total_item_count,\n            },\n        });\n    },\n    updateSearchCustomerParams(state, { payload }) {\n        return Object.assign({}, state, {\n            searchCustomerParams: Object.assign({}, state.searchCustomerParams, payload),\n        });\n    },\n\n\n    saveCreateCustomerForm(state, { payload }) {\n        return Object.assign({}, state, {\n            createCustomerForm: payload,\n        });\n    },\n    saveIsCreateCustomerFormVisible(state, { payload }) {\n        return Object.assign({}, state, {\n            isCreateCustomerFormVisible: payload,\n        });\n    },\n    saveIsCreateCustomerFormLoading(state, { payload }) {\n        return Object.assign({}, state, {\n            isCreateCustomerFormLoading: payload,\n        });\n    },\n    saveCreateCustomerFormData(state, { payload }) {\n        return Object.assign({}, state, {\n            createCustomerFormData: payload,\n        });\n    },\n    updateCreateCustomerFormData(state, { payload }) {\n        return Object.assign({}, state, {\n            createCustomerFormData: Object.assign({}, state.createCustomerFormData, payload),\n        });\n    },\n},\n```\n\n但是观察代码后发现，这些函数主要处理的业务都是对state属性的赋值和扩展，而且reduces又是纯函数，所以对函数的抽象就很有必要，也相对简单。\n\n```javascript\nreducers: {\n saveStateProperty(state, { payload }) {\n        const { name, value } = payload;\n        if (state[name] !== undefined) {\n            return Object.assign({}, state, {\n                [name]: value,\n            });\n        } else {\n            return state\n        }\n    },\n\n updateStateProperty(state, { payload }) {\n        const { name, value } = payload;\n        if (state[name] !== undefined) {\n            return Object.assign({}, state, {\n                [name]: Object.assign({}, state[name], value),\n            });\n        } else {\n            return state\n        }\n    },\n}\n```\n\n主要变为两个函数 saveStateProperty 负责对某个属性的赋值；updateStateProperty：负责对某个属性的扩展；（其实扩展方法就可以实现赋值的方法，但是考虑函数的功能的单纯和参数的简单，还是分为了两个函数）\n\n基于上面的实现那么对于reducers测试就不会随着业务的增长而增长。\n\n测试用例如下\n\n```javascript\ndescribe('reducers', () => {\n    test('saveStateProperty has property as payload\\'s name', () => {\n        expect(app.reducers.saveStateProperty({ test: 'no' }, {\n            payload: {\n                name: 'test',\n                value: 'ok'\n }\n        })).toEqual({ test: 'ok' });\n    });\n\n    test('saveStateProperty has property as payload\\'s name', () => {\n        expect(app.reducers.saveStateProperty({ test: 'no' }, {\n            payload: {\n                name: 'test',\n                value: 'ok'\n }\n        })).not.toEqual({ test: 'no' });\n    });\n\n    test('saveStateProperty with out property as payload\\'s name', () => {\n        expect(app.reducers.saveStateProperty({}, { payload: { name: 'test', value: 'ok' } })).toEqual({});\n    });\n\n    test('saveStateProperty with out property as payload\\'s name', () => {\n        expect(app.reducers.saveStateProperty({}, {\n            payload: {\n                name: 'test',\n                value: 'ok'\n }\n        })).not.toEqual({ test: 'ok' });\n    });\n});\n```\n\n其实effects部分的函数也存在业务代码过多的问题，而且情况更严重。但是副作用函数的不确定性本身就会带来很多的业务分支，所以现在没有想出什么好的办法。\n但是基于控件的使用倒是有一定的规律可行。现在的控件基本就是form的验证处理，modal的显示隐藏，list的处理和筛选，还有详情页的字段显示。可以把这些常用组件有规律的事件做一些封装。","source":"_posts/react-reducers函数单元测试用例与实践体验.md","raw":"---\ntitle: react reducers函数单元测试用例与实践体验\ndate: 2017-12-16 20:10:40\ntags: ['单元测试','unit test','react','reducer']\ncategory: 'coding'\n---\n\nreduces函数都是纯函数，主要是传递`payload`来修改`state`\n\n代码都是围绕业务来编写的，这样存在的问题就是伴随业务的变化，代码也要相应的改动。那么对应的单元测试代码也要改动。而且就现在的编写思想来看业务的多少就决定了代码的数量。\n<!--more-->\n```javascript\nreducers: {\n    saveIsSearchCustomerFormLoading(state, { payload }) {\n        return Object.assign({}, state, {\n            isSearchCustomerFormLoading: payload,\n        });\n    },\n    saveSearchCustomerList(state, { payload }) {\n        return Object.assign({}, state, {\n            searchCustomerList: {\n                dataList: payload.data_list.map((customer) => {\n                    return new Customer(customer);\n                }),\n                totalItemCount: payload.total_item_count,\n            },\n        });\n    },\n    updateSearchCustomerParams(state, { payload }) {\n        return Object.assign({}, state, {\n            searchCustomerParams: Object.assign({}, state.searchCustomerParams, payload),\n        });\n    },\n\n\n    saveCreateCustomerForm(state, { payload }) {\n        return Object.assign({}, state, {\n            createCustomerForm: payload,\n        });\n    },\n    saveIsCreateCustomerFormVisible(state, { payload }) {\n        return Object.assign({}, state, {\n            isCreateCustomerFormVisible: payload,\n        });\n    },\n    saveIsCreateCustomerFormLoading(state, { payload }) {\n        return Object.assign({}, state, {\n            isCreateCustomerFormLoading: payload,\n        });\n    },\n    saveCreateCustomerFormData(state, { payload }) {\n        return Object.assign({}, state, {\n            createCustomerFormData: payload,\n        });\n    },\n    updateCreateCustomerFormData(state, { payload }) {\n        return Object.assign({}, state, {\n            createCustomerFormData: Object.assign({}, state.createCustomerFormData, payload),\n        });\n    },\n},\n```\n\n但是观察代码后发现，这些函数主要处理的业务都是对state属性的赋值和扩展，而且reduces又是纯函数，所以对函数的抽象就很有必要，也相对简单。\n\n```javascript\nreducers: {\n saveStateProperty(state, { payload }) {\n        const { name, value } = payload;\n        if (state[name] !== undefined) {\n            return Object.assign({}, state, {\n                [name]: value,\n            });\n        } else {\n            return state\n        }\n    },\n\n updateStateProperty(state, { payload }) {\n        const { name, value } = payload;\n        if (state[name] !== undefined) {\n            return Object.assign({}, state, {\n                [name]: Object.assign({}, state[name], value),\n            });\n        } else {\n            return state\n        }\n    },\n}\n```\n\n主要变为两个函数 saveStateProperty 负责对某个属性的赋值；updateStateProperty：负责对某个属性的扩展；（其实扩展方法就可以实现赋值的方法，但是考虑函数的功能的单纯和参数的简单，还是分为了两个函数）\n\n基于上面的实现那么对于reducers测试就不会随着业务的增长而增长。\n\n测试用例如下\n\n```javascript\ndescribe('reducers', () => {\n    test('saveStateProperty has property as payload\\'s name', () => {\n        expect(app.reducers.saveStateProperty({ test: 'no' }, {\n            payload: {\n                name: 'test',\n                value: 'ok'\n }\n        })).toEqual({ test: 'ok' });\n    });\n\n    test('saveStateProperty has property as payload\\'s name', () => {\n        expect(app.reducers.saveStateProperty({ test: 'no' }, {\n            payload: {\n                name: 'test',\n                value: 'ok'\n }\n        })).not.toEqual({ test: 'no' });\n    });\n\n    test('saveStateProperty with out property as payload\\'s name', () => {\n        expect(app.reducers.saveStateProperty({}, { payload: { name: 'test', value: 'ok' } })).toEqual({});\n    });\n\n    test('saveStateProperty with out property as payload\\'s name', () => {\n        expect(app.reducers.saveStateProperty({}, {\n            payload: {\n                name: 'test',\n                value: 'ok'\n }\n        })).not.toEqual({ test: 'ok' });\n    });\n});\n```\n\n其实effects部分的函数也存在业务代码过多的问题，而且情况更严重。但是副作用函数的不确定性本身就会带来很多的业务分支，所以现在没有想出什么好的办法。\n但是基于控件的使用倒是有一定的规律可行。现在的控件基本就是form的验证处理，modal的显示隐藏，list的处理和筛选，还有详情页的字段显示。可以把这些常用组件有规律的事件做一些封装。","slug":"react-reducers函数单元测试用例与实践体验","published":1,"updated":"2019-02-20T02:50:38.499Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjsgue0em000jgpi6149iogw1","content":"<p>reduces函数都是纯函数，主要是传递<code>payload</code>来修改<code>state</code></p>\n<p>代码都是围绕业务来编写的，这样存在的问题就是伴随业务的变化，代码也要相应的改动。那么对应的单元测试代码也要改动。而且就现在的编写思想来看业务的多少就决定了代码的数量。<br><a id=\"more\"></a><br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">reducers: &#123;</span><br><span class=\"line\">    saveIsSearchCustomerFormLoading(state, &#123; payload &#125;) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">Object</span>.assign(&#123;&#125;, state, &#123;</span><br><span class=\"line\">            <span class=\"attr\">isSearchCustomerFormLoading</span>: payload,</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    saveSearchCustomerList(state, &#123; payload &#125;) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">Object</span>.assign(&#123;&#125;, state, &#123;</span><br><span class=\"line\">            <span class=\"attr\">searchCustomerList</span>: &#123;</span><br><span class=\"line\">                <span class=\"attr\">dataList</span>: payload.data_list.map(<span class=\"function\">(<span class=\"params\">customer</span>) =&gt;</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Customer(customer);</span><br><span class=\"line\">                &#125;),</span><br><span class=\"line\">                <span class=\"attr\">totalItemCount</span>: payload.total_item_count,</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    updateSearchCustomerParams(state, &#123; payload &#125;) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">Object</span>.assign(&#123;&#125;, state, &#123;</span><br><span class=\"line\">            <span class=\"attr\">searchCustomerParams</span>: <span class=\"built_in\">Object</span>.assign(&#123;&#125;, state.searchCustomerParams, payload),</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    saveCreateCustomerForm(state, &#123; payload &#125;) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">Object</span>.assign(&#123;&#125;, state, &#123;</span><br><span class=\"line\">            <span class=\"attr\">createCustomerForm</span>: payload,</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    saveIsCreateCustomerFormVisible(state, &#123; payload &#125;) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">Object</span>.assign(&#123;&#125;, state, &#123;</span><br><span class=\"line\">            <span class=\"attr\">isCreateCustomerFormVisible</span>: payload,</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    saveIsCreateCustomerFormLoading(state, &#123; payload &#125;) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">Object</span>.assign(&#123;&#125;, state, &#123;</span><br><span class=\"line\">            <span class=\"attr\">isCreateCustomerFormLoading</span>: payload,</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    saveCreateCustomerFormData(state, &#123; payload &#125;) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">Object</span>.assign(&#123;&#125;, state, &#123;</span><br><span class=\"line\">            <span class=\"attr\">createCustomerFormData</span>: payload,</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    updateCreateCustomerFormData(state, &#123; payload &#125;) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">Object</span>.assign(&#123;&#125;, state, &#123;</span><br><span class=\"line\">            <span class=\"attr\">createCustomerFormData</span>: <span class=\"built_in\">Object</span>.assign(&#123;&#125;, state.createCustomerFormData, payload),</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure></p>\n<p>但是观察代码后发现，这些函数主要处理的业务都是对state属性的赋值和扩展，而且reduces又是纯函数，所以对函数的抽象就很有必要，也相对简单。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">reducers: &#123;</span><br><span class=\"line\"> saveStateProperty(state, &#123; payload &#125;) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> &#123; name, value &#125; = payload;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (state[name] !== <span class=\"literal\">undefined</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"built_in\">Object</span>.assign(&#123;&#125;, state, &#123;</span><br><span class=\"line\">                [name]: value,</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> state</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\"> updateStateProperty(state, &#123; payload &#125;) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> &#123; name, value &#125; = payload;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (state[name] !== <span class=\"literal\">undefined</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"built_in\">Object</span>.assign(&#123;&#125;, state, &#123;</span><br><span class=\"line\">                [name]: <span class=\"built_in\">Object</span>.assign(&#123;&#125;, state[name], value),</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> state</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>主要变为两个函数 saveStateProperty 负责对某个属性的赋值；updateStateProperty：负责对某个属性的扩展；（其实扩展方法就可以实现赋值的方法，但是考虑函数的功能的单纯和参数的简单，还是分为了两个函数）</p>\n<p>基于上面的实现那么对于reducers测试就不会随着业务的增长而增长。</p>\n<p>测试用例如下</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">describe(<span class=\"string\">'reducers'</span>, () =&gt; &#123;</span><br><span class=\"line\">    test(<span class=\"string\">'saveStateProperty has property as payload\\'s name'</span>, () =&gt; &#123;</span><br><span class=\"line\">        expect(app.reducers.saveStateProperty(&#123; <span class=\"attr\">test</span>: <span class=\"string\">'no'</span> &#125;, &#123;</span><br><span class=\"line\">            <span class=\"attr\">payload</span>: &#123;</span><br><span class=\"line\">                <span class=\"attr\">name</span>: <span class=\"string\">'test'</span>,</span><br><span class=\"line\">                <span class=\"attr\">value</span>: <span class=\"string\">'ok'</span></span><br><span class=\"line\"> &#125;</span><br><span class=\"line\">        &#125;)).toEqual(&#123; <span class=\"attr\">test</span>: <span class=\"string\">'ok'</span> &#125;);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    test(<span class=\"string\">'saveStateProperty has property as payload\\'s name'</span>, () =&gt; &#123;</span><br><span class=\"line\">        expect(app.reducers.saveStateProperty(&#123; <span class=\"attr\">test</span>: <span class=\"string\">'no'</span> &#125;, &#123;</span><br><span class=\"line\">            <span class=\"attr\">payload</span>: &#123;</span><br><span class=\"line\">                <span class=\"attr\">name</span>: <span class=\"string\">'test'</span>,</span><br><span class=\"line\">                <span class=\"attr\">value</span>: <span class=\"string\">'ok'</span></span><br><span class=\"line\"> &#125;</span><br><span class=\"line\">        &#125;)).not.toEqual(&#123; <span class=\"attr\">test</span>: <span class=\"string\">'no'</span> &#125;);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    test(<span class=\"string\">'saveStateProperty with out property as payload\\'s name'</span>, () =&gt; &#123;</span><br><span class=\"line\">        expect(app.reducers.saveStateProperty(&#123;&#125;, &#123; <span class=\"attr\">payload</span>: &#123; <span class=\"attr\">name</span>: <span class=\"string\">'test'</span>, <span class=\"attr\">value</span>: <span class=\"string\">'ok'</span> &#125; &#125;)).toEqual(&#123;&#125;);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    test(<span class=\"string\">'saveStateProperty with out property as payload\\'s name'</span>, () =&gt; &#123;</span><br><span class=\"line\">        expect(app.reducers.saveStateProperty(&#123;&#125;, &#123;</span><br><span class=\"line\">            <span class=\"attr\">payload</span>: &#123;</span><br><span class=\"line\">                <span class=\"attr\">name</span>: <span class=\"string\">'test'</span>,</span><br><span class=\"line\">                <span class=\"attr\">value</span>: <span class=\"string\">'ok'</span></span><br><span class=\"line\"> &#125;</span><br><span class=\"line\">        &#125;)).not.toEqual(&#123; <span class=\"attr\">test</span>: <span class=\"string\">'ok'</span> &#125;);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>其实effects部分的函数也存在业务代码过多的问题，而且情况更严重。但是副作用函数的不确定性本身就会带来很多的业务分支，所以现在没有想出什么好的办法。<br>但是基于控件的使用倒是有一定的规律可行。现在的控件基本就是form的验证处理，modal的显示隐藏，list的处理和筛选，还有详情页的字段显示。可以把这些常用组件有规律的事件做一些封装。</p>\n","excerpt":"<p>reduces函数都是纯函数，主要是传递<code>payload</code>来修改<code>state</code></p>\n<p>代码都是围绕业务来编写的，这样存在的问题就是伴随业务的变化，代码也要相应的改动。那么对应的单元测试代码也要改动。而且就现在的编写思想来看业务的多少就决定了代码的数量。<br>","more":"<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">reducers: &#123;</span><br><span class=\"line\">    saveIsSearchCustomerFormLoading(state, &#123; payload &#125;) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">Object</span>.assign(&#123;&#125;, state, &#123;</span><br><span class=\"line\">            <span class=\"attr\">isSearchCustomerFormLoading</span>: payload,</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    saveSearchCustomerList(state, &#123; payload &#125;) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">Object</span>.assign(&#123;&#125;, state, &#123;</span><br><span class=\"line\">            <span class=\"attr\">searchCustomerList</span>: &#123;</span><br><span class=\"line\">                <span class=\"attr\">dataList</span>: payload.data_list.map(<span class=\"function\">(<span class=\"params\">customer</span>) =&gt;</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Customer(customer);</span><br><span class=\"line\">                &#125;),</span><br><span class=\"line\">                <span class=\"attr\">totalItemCount</span>: payload.total_item_count,</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    updateSearchCustomerParams(state, &#123; payload &#125;) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">Object</span>.assign(&#123;&#125;, state, &#123;</span><br><span class=\"line\">            <span class=\"attr\">searchCustomerParams</span>: <span class=\"built_in\">Object</span>.assign(&#123;&#125;, state.searchCustomerParams, payload),</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    saveCreateCustomerForm(state, &#123; payload &#125;) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">Object</span>.assign(&#123;&#125;, state, &#123;</span><br><span class=\"line\">            <span class=\"attr\">createCustomerForm</span>: payload,</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    saveIsCreateCustomerFormVisible(state, &#123; payload &#125;) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">Object</span>.assign(&#123;&#125;, state, &#123;</span><br><span class=\"line\">            <span class=\"attr\">isCreateCustomerFormVisible</span>: payload,</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    saveIsCreateCustomerFormLoading(state, &#123; payload &#125;) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">Object</span>.assign(&#123;&#125;, state, &#123;</span><br><span class=\"line\">            <span class=\"attr\">isCreateCustomerFormLoading</span>: payload,</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    saveCreateCustomerFormData(state, &#123; payload &#125;) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">Object</span>.assign(&#123;&#125;, state, &#123;</span><br><span class=\"line\">            <span class=\"attr\">createCustomerFormData</span>: payload,</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    updateCreateCustomerFormData(state, &#123; payload &#125;) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">Object</span>.assign(&#123;&#125;, state, &#123;</span><br><span class=\"line\">            <span class=\"attr\">createCustomerFormData</span>: <span class=\"built_in\">Object</span>.assign(&#123;&#125;, state.createCustomerFormData, payload),</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure></p>\n<p>但是观察代码后发现，这些函数主要处理的业务都是对state属性的赋值和扩展，而且reduces又是纯函数，所以对函数的抽象就很有必要，也相对简单。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">reducers: &#123;</span><br><span class=\"line\"> saveStateProperty(state, &#123; payload &#125;) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> &#123; name, value &#125; = payload;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (state[name] !== <span class=\"literal\">undefined</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"built_in\">Object</span>.assign(&#123;&#125;, state, &#123;</span><br><span class=\"line\">                [name]: value,</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> state</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\"> updateStateProperty(state, &#123; payload &#125;) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> &#123; name, value &#125; = payload;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (state[name] !== <span class=\"literal\">undefined</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"built_in\">Object</span>.assign(&#123;&#125;, state, &#123;</span><br><span class=\"line\">                [name]: <span class=\"built_in\">Object</span>.assign(&#123;&#125;, state[name], value),</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> state</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>主要变为两个函数 saveStateProperty 负责对某个属性的赋值；updateStateProperty：负责对某个属性的扩展；（其实扩展方法就可以实现赋值的方法，但是考虑函数的功能的单纯和参数的简单，还是分为了两个函数）</p>\n<p>基于上面的实现那么对于reducers测试就不会随着业务的增长而增长。</p>\n<p>测试用例如下</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">describe(<span class=\"string\">'reducers'</span>, () =&gt; &#123;</span><br><span class=\"line\">    test(<span class=\"string\">'saveStateProperty has property as payload\\'s name'</span>, () =&gt; &#123;</span><br><span class=\"line\">        expect(app.reducers.saveStateProperty(&#123; <span class=\"attr\">test</span>: <span class=\"string\">'no'</span> &#125;, &#123;</span><br><span class=\"line\">            <span class=\"attr\">payload</span>: &#123;</span><br><span class=\"line\">                <span class=\"attr\">name</span>: <span class=\"string\">'test'</span>,</span><br><span class=\"line\">                <span class=\"attr\">value</span>: <span class=\"string\">'ok'</span></span><br><span class=\"line\"> &#125;</span><br><span class=\"line\">        &#125;)).toEqual(&#123; <span class=\"attr\">test</span>: <span class=\"string\">'ok'</span> &#125;);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    test(<span class=\"string\">'saveStateProperty has property as payload\\'s name'</span>, () =&gt; &#123;</span><br><span class=\"line\">        expect(app.reducers.saveStateProperty(&#123; <span class=\"attr\">test</span>: <span class=\"string\">'no'</span> &#125;, &#123;</span><br><span class=\"line\">            <span class=\"attr\">payload</span>: &#123;</span><br><span class=\"line\">                <span class=\"attr\">name</span>: <span class=\"string\">'test'</span>,</span><br><span class=\"line\">                <span class=\"attr\">value</span>: <span class=\"string\">'ok'</span></span><br><span class=\"line\"> &#125;</span><br><span class=\"line\">        &#125;)).not.toEqual(&#123; <span class=\"attr\">test</span>: <span class=\"string\">'no'</span> &#125;);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    test(<span class=\"string\">'saveStateProperty with out property as payload\\'s name'</span>, () =&gt; &#123;</span><br><span class=\"line\">        expect(app.reducers.saveStateProperty(&#123;&#125;, &#123; <span class=\"attr\">payload</span>: &#123; <span class=\"attr\">name</span>: <span class=\"string\">'test'</span>, <span class=\"attr\">value</span>: <span class=\"string\">'ok'</span> &#125; &#125;)).toEqual(&#123;&#125;);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    test(<span class=\"string\">'saveStateProperty with out property as payload\\'s name'</span>, () =&gt; &#123;</span><br><span class=\"line\">        expect(app.reducers.saveStateProperty(&#123;&#125;, &#123;</span><br><span class=\"line\">            <span class=\"attr\">payload</span>: &#123;</span><br><span class=\"line\">                <span class=\"attr\">name</span>: <span class=\"string\">'test'</span>,</span><br><span class=\"line\">                <span class=\"attr\">value</span>: <span class=\"string\">'ok'</span></span><br><span class=\"line\"> &#125;</span><br><span class=\"line\">        &#125;)).not.toEqual(&#123; <span class=\"attr\">test</span>: <span class=\"string\">'ok'</span> &#125;);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>其实effects部分的函数也存在业务代码过多的问题，而且情况更严重。但是副作用函数的不确定性本身就会带来很多的业务分支，所以现在没有想出什么好的办法。<br>但是基于控件的使用倒是有一定的规律可行。现在的控件基本就是form的验证处理，modal的显示隐藏，list的处理和筛选，还有详情页的字段显示。可以把这些常用组件有规律的事件做一些封装。</p>"},{"title":"shell学习笔记四","date":"2018-02-10T13:43:03.000Z","_content":"shell 命令重新初始化用户的登录会话。当给出该命令时，就会重新设置进程的控制终端的端口特征，并取消对端口的所有访问。然后 shell 命令为用户把进程凭证和环境重新设置为缺省值，并执行用户的初始程序。根据调用进程的登录用户标识建立所有的凭证和环境。\n<!--more-->\n## 文本处理工具\n### sort 行排序\n\n基本命令格式\n```bash\nsort [options] [file(s)] \n```\n\n基本参数 \n* -b   忽略每行前面开始出的空格字符。\n* -c   检查文件是否已经按照顺序排序。\n* -d   排序时，处理英文字母、数字及空格字符外，忽略其他的字符。\n* -f   排序时，将小写字母视为大写字母。\n* -i   排序时，除了040至176之间的ASCII字符外，忽略其他的字符。\n* -m   将几个排序好的文件进行合并。\n* -M   将前面3个字母依照月份的缩写进行排序。\n* -n    依照数值的大小排序。\n* -o<输出文件>   将排序后的结果存入指定的文件。\n* -r   以相反的顺序来排序。\n* -t<分隔字符>   指定排序时所用的栏位分隔字符\n* -k, --key=POS1[,POS2]  指定关键字,可以指定多个关键字\n\n输入\n```bash\nhistory |  sort -k2.1,3.1 # 从第二个字段的第一个字符比较到第三个字段的第一个字符\n```\n\n输出\n```bash\n  488  alert\n   92  apt\n   93  apt -update\n   94  apt --update\n   96  apt update\n   98  apt\n   95  aptupdate\n  109  cat /etc/issue\n  358  cat\n  406  cat file\n```\n\n### uniq 行排序\n作为管道修饰，用于排除重复的记录\n\n基本参数 \n* -c   相同值的计数\n* -d   只显示重复的记录\n* -u   只显示为重复的记录\n\n输入\n```bash\nhistory | awk '{print $2,$3}'| sort -k1.1,2.1\n```\n\n输出\n```bash\n...\nwhoami |\nwhoami |\nwhoami |\n```\n\n输入\n```bashechi\nhistory | awk '{print $2,$3}'| sort -k1.1,2.1 | uniq\n```\n\n输出\n```bash\n...\nwho |\nwhoami\nwhoami |\n```\n\n### wc 计算行数，字数，字符数\nwc命令的功能为统计指定文件中的字节数、字数、行数, 并将统计结果显示输出。\n\n基本参数 \n* -c   统计字节数。  \n* -l   统计行数\n* -w   统计字数\n\n输入\n```bash\ncurl www.baidu.com | wc\n```\n\n输出\n```bash\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n100  2381  100  2381    0     0  26727      0 --:--:-- --:--:-- --:--:-- 27056\n      2     159    2381\n```\n\n输入\n```bash\nwc ./README.md\n```\n\n输出\n```bash\n 467  904 8158 ./README.md\n```\n\n### head 提取开头\n用来显示档案的开头至标准输出中，默认head命令打印其相应文件的开头10行。 \n\n基本参数 \n* -q        隐藏文件名\n* -v        显示文件名\n* -c<字节>  显示字节数\n* -n<行数>  显示的行数\n\n输入\n```bash\nhistory | head -n 5\n```\n\n输出\n```bash\n  1  node -v\n  2  git -v\n  3  git status\n  4  git branch\n  5  cd workspace\n```\n\n输入\n```bash\nhistory | head -n -5 # 负数表示除去后面5行以为的其他内容\n```\n\n### tail 从指定点开始将文件写到标准输出\n命令从指定点开始将文件写到标准输出.使用tail命令的-f选项可以方便的查阅正在改变的日志文件,tail -f filename会把filename里最尾部的内容显示在屏幕上,并且不但刷新,使你看到最新的文件内容. \n\n基本参数 \n* -f 循环读取\n* -q 不显示处理信息\n* -v 显示详细的处理信息\n* -c<数目> 显示的字节数\n* -n<行数> 显示行数\n* --pid=PID 与-f合用,表示在进程ID,PID死掉之后结束. \n* -q, --quiet, --silent 从不输出给出文件名的首部 \n* -s, --sleep-interval=S 与-f合用,表示在每次反复的间隔休眠S秒\n\n输入\n```bash\nhistory | tail -n 5\n```\n\n输出\n```bash\n  754  ll\n  755  cd ~\n  756  cd workspace/shell-test/\n  757  ll\n  758  history | tail\n```\n\n输入\n```bash\nhistory | tail -n +750 # 从750行开始显示到结尾\n```\n\n今天就到这里，下次继续。","source":"_posts/shell学习笔记四.md","raw":"---\ntitle: shell学习笔记四\ndate: 2018-02-10 21:43:03\ntags: ['shell','bash','脚本','终端','命令行']\ncategory: 'coding'\n---\nshell 命令重新初始化用户的登录会话。当给出该命令时，就会重新设置进程的控制终端的端口特征，并取消对端口的所有访问。然后 shell 命令为用户把进程凭证和环境重新设置为缺省值，并执行用户的初始程序。根据调用进程的登录用户标识建立所有的凭证和环境。\n<!--more-->\n## 文本处理工具\n### sort 行排序\n\n基本命令格式\n```bash\nsort [options] [file(s)] \n```\n\n基本参数 \n* -b   忽略每行前面开始出的空格字符。\n* -c   检查文件是否已经按照顺序排序。\n* -d   排序时，处理英文字母、数字及空格字符外，忽略其他的字符。\n* -f   排序时，将小写字母视为大写字母。\n* -i   排序时，除了040至176之间的ASCII字符外，忽略其他的字符。\n* -m   将几个排序好的文件进行合并。\n* -M   将前面3个字母依照月份的缩写进行排序。\n* -n    依照数值的大小排序。\n* -o<输出文件>   将排序后的结果存入指定的文件。\n* -r   以相反的顺序来排序。\n* -t<分隔字符>   指定排序时所用的栏位分隔字符\n* -k, --key=POS1[,POS2]  指定关键字,可以指定多个关键字\n\n输入\n```bash\nhistory |  sort -k2.1,3.1 # 从第二个字段的第一个字符比较到第三个字段的第一个字符\n```\n\n输出\n```bash\n  488  alert\n   92  apt\n   93  apt -update\n   94  apt --update\n   96  apt update\n   98  apt\n   95  aptupdate\n  109  cat /etc/issue\n  358  cat\n  406  cat file\n```\n\n### uniq 行排序\n作为管道修饰，用于排除重复的记录\n\n基本参数 \n* -c   相同值的计数\n* -d   只显示重复的记录\n* -u   只显示为重复的记录\n\n输入\n```bash\nhistory | awk '{print $2,$3}'| sort -k1.1,2.1\n```\n\n输出\n```bash\n...\nwhoami |\nwhoami |\nwhoami |\n```\n\n输入\n```bashechi\nhistory | awk '{print $2,$3}'| sort -k1.1,2.1 | uniq\n```\n\n输出\n```bash\n...\nwho |\nwhoami\nwhoami |\n```\n\n### wc 计算行数，字数，字符数\nwc命令的功能为统计指定文件中的字节数、字数、行数, 并将统计结果显示输出。\n\n基本参数 \n* -c   统计字节数。  \n* -l   统计行数\n* -w   统计字数\n\n输入\n```bash\ncurl www.baidu.com | wc\n```\n\n输出\n```bash\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n100  2381  100  2381    0     0  26727      0 --:--:-- --:--:-- --:--:-- 27056\n      2     159    2381\n```\n\n输入\n```bash\nwc ./README.md\n```\n\n输出\n```bash\n 467  904 8158 ./README.md\n```\n\n### head 提取开头\n用来显示档案的开头至标准输出中，默认head命令打印其相应文件的开头10行。 \n\n基本参数 \n* -q        隐藏文件名\n* -v        显示文件名\n* -c<字节>  显示字节数\n* -n<行数>  显示的行数\n\n输入\n```bash\nhistory | head -n 5\n```\n\n输出\n```bash\n  1  node -v\n  2  git -v\n  3  git status\n  4  git branch\n  5  cd workspace\n```\n\n输入\n```bash\nhistory | head -n -5 # 负数表示除去后面5行以为的其他内容\n```\n\n### tail 从指定点开始将文件写到标准输出\n命令从指定点开始将文件写到标准输出.使用tail命令的-f选项可以方便的查阅正在改变的日志文件,tail -f filename会把filename里最尾部的内容显示在屏幕上,并且不但刷新,使你看到最新的文件内容. \n\n基本参数 \n* -f 循环读取\n* -q 不显示处理信息\n* -v 显示详细的处理信息\n* -c<数目> 显示的字节数\n* -n<行数> 显示行数\n* --pid=PID 与-f合用,表示在进程ID,PID死掉之后结束. \n* -q, --quiet, --silent 从不输出给出文件名的首部 \n* -s, --sleep-interval=S 与-f合用,表示在每次反复的间隔休眠S秒\n\n输入\n```bash\nhistory | tail -n 5\n```\n\n输出\n```bash\n  754  ll\n  755  cd ~\n  756  cd workspace/shell-test/\n  757  ll\n  758  history | tail\n```\n\n输入\n```bash\nhistory | tail -n +750 # 从750行开始显示到结尾\n```\n\n今天就到这里，下次继续。","slug":"shell学习笔记四","published":1,"updated":"2019-02-20T02:50:38.558Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjsgue0eo000lgpi6h8agjzqt","content":"<p>shell 命令重新初始化用户的登录会话。当给出该命令时，就会重新设置进程的控制终端的端口特征，并取消对端口的所有访问。然后 shell 命令为用户把进程凭证和环境重新设置为缺省值，并执行用户的初始程序。根据调用进程的登录用户标识建立所有的凭证和环境。<br><a id=\"more\"></a></p>\n<h2 id=\"文本处理工具\"><a href=\"#文本处理工具\" class=\"headerlink\" title=\"文本处理工具\"></a>文本处理工具</h2><h3 id=\"sort-行排序\"><a href=\"#sort-行排序\" class=\"headerlink\" title=\"sort 行排序\"></a>sort 行排序</h3><p>基本命令格式<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sort [options] [file(s)]</span><br></pre></td></tr></table></figure></p>\n<p>基本参数 </p>\n<ul>\n<li>-b   忽略每行前面开始出的空格字符。</li>\n<li>-c   检查文件是否已经按照顺序排序。</li>\n<li>-d   排序时，处理英文字母、数字及空格字符外，忽略其他的字符。</li>\n<li>-f   排序时，将小写字母视为大写字母。</li>\n<li>-i   排序时，除了040至176之间的ASCII字符外，忽略其他的字符。</li>\n<li>-m   将几个排序好的文件进行合并。</li>\n<li>-M   将前面3个字母依照月份的缩写进行排序。</li>\n<li>-n    依照数值的大小排序。</li>\n<li>-o&lt;输出文件&gt;   将排序后的结果存入指定的文件。</li>\n<li>-r   以相反的顺序来排序。</li>\n<li>-t&lt;分隔字符&gt;   指定排序时所用的栏位分隔字符</li>\n<li>-k, –key=POS1[,POS2]  指定关键字,可以指定多个关键字</li>\n</ul>\n<p>输入<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">history</span> |  sort -k2.1,3.1 <span class=\"comment\"># 从第二个字段的第一个字符比较到第三个字段的第一个字符</span></span><br></pre></td></tr></table></figure></p>\n<p>输出<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">488  alert</span><br><span class=\"line\"> 92  apt</span><br><span class=\"line\"> 93  apt -update</span><br><span class=\"line\"> 94  apt --update</span><br><span class=\"line\"> 96  apt update</span><br><span class=\"line\"> 98  apt</span><br><span class=\"line\"> 95  aptupdate</span><br><span class=\"line\">109  cat /etc/issue</span><br><span class=\"line\">358  cat</span><br><span class=\"line\">406  cat file</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"uniq-行排序\"><a href=\"#uniq-行排序\" class=\"headerlink\" title=\"uniq 行排序\"></a>uniq 行排序</h3><p>作为管道修饰，用于排除重复的记录</p>\n<p>基本参数 </p>\n<ul>\n<li>-c   相同值的计数</li>\n<li>-d   只显示重复的记录</li>\n<li>-u   只显示为重复的记录</li>\n</ul>\n<p>输入<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">history</span> | awk <span class=\"string\">'&#123;print $2,$3&#125;'</span>| sort -k1.1,2.1</span><br></pre></td></tr></table></figure></p>\n<p>输出<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\">whoami |</span><br><span class=\"line\">whoami |</span><br><span class=\"line\">whoami |</span><br></pre></td></tr></table></figure></p>\n<p>输入<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">history | awk &apos;&#123;print $2,$3&#125;&apos;| sort -k1.1,2.1 | uniq</span><br></pre></td></tr></table></figure></p>\n<p>输出<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\">who |</span><br><span class=\"line\">whoami</span><br><span class=\"line\">whoami |</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"wc-计算行数，字数，字符数\"><a href=\"#wc-计算行数，字数，字符数\" class=\"headerlink\" title=\"wc 计算行数，字数，字符数\"></a>wc 计算行数，字数，字符数</h3><p>wc命令的功能为统计指定文件中的字节数、字数、行数, 并将统计结果显示输出。</p>\n<p>基本参数 </p>\n<ul>\n<li>-c   统计字节数。  </li>\n<li>-l   统计行数</li>\n<li>-w   统计字数</li>\n</ul>\n<p>输入<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl www.baidu.com | wc</span><br></pre></td></tr></table></figure></p>\n<p>输出<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class=\"line\">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class=\"line\">100  2381  100  2381    0     0  26727      0 --:--:-- --:--:-- --:--:-- 27056</span><br><span class=\"line\">      2     159    2381</span><br></pre></td></tr></table></figure></p>\n<p>输入<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wc ./README.md</span><br></pre></td></tr></table></figure></p>\n<p>输出<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">467  904 8158 ./README.md</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"head-提取开头\"><a href=\"#head-提取开头\" class=\"headerlink\" title=\"head 提取开头\"></a>head 提取开头</h3><p>用来显示档案的开头至标准输出中，默认head命令打印其相应文件的开头10行。 </p>\n<p>基本参数 </p>\n<ul>\n<li>-q        隐藏文件名</li>\n<li>-v        显示文件名</li>\n<li>-c&lt;字节&gt;  显示字节数</li>\n<li>-n&lt;行数&gt;  显示的行数</li>\n</ul>\n<p>输入<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">history</span> | head -n 5</span><br></pre></td></tr></table></figure></p>\n<p>输出<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1  node -v</span><br><span class=\"line\">2  git -v</span><br><span class=\"line\">3  git status</span><br><span class=\"line\">4  git branch</span><br><span class=\"line\">5  <span class=\"built_in\">cd</span> workspace</span><br></pre></td></tr></table></figure></p>\n<p>输入<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">history</span> | head -n -5 <span class=\"comment\"># 负数表示除去后面5行以为的其他内容</span></span><br></pre></td></tr></table></figure></p>\n<h3 id=\"tail-从指定点开始将文件写到标准输出\"><a href=\"#tail-从指定点开始将文件写到标准输出\" class=\"headerlink\" title=\"tail 从指定点开始将文件写到标准输出\"></a>tail 从指定点开始将文件写到标准输出</h3><p>命令从指定点开始将文件写到标准输出.使用tail命令的-f选项可以方便的查阅正在改变的日志文件,tail -f filename会把filename里最尾部的内容显示在屏幕上,并且不但刷新,使你看到最新的文件内容. </p>\n<p>基本参数 </p>\n<ul>\n<li>-f 循环读取</li>\n<li>-q 不显示处理信息</li>\n<li>-v 显示详细的处理信息</li>\n<li>-c&lt;数目&gt; 显示的字节数</li>\n<li>-n&lt;行数&gt; 显示行数</li>\n<li>–pid=PID 与-f合用,表示在进程ID,PID死掉之后结束. </li>\n<li>-q, –quiet, –silent 从不输出给出文件名的首部 </li>\n<li>-s, –sleep-interval=S 与-f合用,表示在每次反复的间隔休眠S秒</li>\n</ul>\n<p>输入<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">history</span> | tail -n 5</span><br></pre></td></tr></table></figure></p>\n<p>输出<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">754  ll</span><br><span class=\"line\">755  <span class=\"built_in\">cd</span> ~</span><br><span class=\"line\">756  <span class=\"built_in\">cd</span> workspace/shell-test/</span><br><span class=\"line\">757  ll</span><br><span class=\"line\">758  <span class=\"built_in\">history</span> | tail</span><br></pre></td></tr></table></figure></p>\n<p>输入<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">history</span> | tail -n +750 <span class=\"comment\"># 从750行开始显示到结尾</span></span><br></pre></td></tr></table></figure></p>\n<p>今天就到这里，下次继续。</p>\n","excerpt":"<p>shell 命令重新初始化用户的登录会话。当给出该命令时，就会重新设置进程的控制终端的端口特征，并取消对端口的所有访问。然后 shell 命令为用户把进程凭证和环境重新设置为缺省值，并执行用户的初始程序。根据调用进程的登录用户标识建立所有的凭证和环境。<br>","more":"</p>\n<h2 id=\"文本处理工具\"><a href=\"#文本处理工具\" class=\"headerlink\" title=\"文本处理工具\"></a>文本处理工具</h2><h3 id=\"sort-行排序\"><a href=\"#sort-行排序\" class=\"headerlink\" title=\"sort 行排序\"></a>sort 行排序</h3><p>基本命令格式<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sort [options] [file(s)]</span><br></pre></td></tr></table></figure></p>\n<p>基本参数 </p>\n<ul>\n<li>-b   忽略每行前面开始出的空格字符。</li>\n<li>-c   检查文件是否已经按照顺序排序。</li>\n<li>-d   排序时，处理英文字母、数字及空格字符外，忽略其他的字符。</li>\n<li>-f   排序时，将小写字母视为大写字母。</li>\n<li>-i   排序时，除了040至176之间的ASCII字符外，忽略其他的字符。</li>\n<li>-m   将几个排序好的文件进行合并。</li>\n<li>-M   将前面3个字母依照月份的缩写进行排序。</li>\n<li>-n    依照数值的大小排序。</li>\n<li>-o&lt;输出文件&gt;   将排序后的结果存入指定的文件。</li>\n<li>-r   以相反的顺序来排序。</li>\n<li>-t&lt;分隔字符&gt;   指定排序时所用的栏位分隔字符</li>\n<li>-k, –key=POS1[,POS2]  指定关键字,可以指定多个关键字</li>\n</ul>\n<p>输入<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">history</span> |  sort -k2.1,3.1 <span class=\"comment\"># 从第二个字段的第一个字符比较到第三个字段的第一个字符</span></span><br></pre></td></tr></table></figure></p>\n<p>输出<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">488  alert</span><br><span class=\"line\"> 92  apt</span><br><span class=\"line\"> 93  apt -update</span><br><span class=\"line\"> 94  apt --update</span><br><span class=\"line\"> 96  apt update</span><br><span class=\"line\"> 98  apt</span><br><span class=\"line\"> 95  aptupdate</span><br><span class=\"line\">109  cat /etc/issue</span><br><span class=\"line\">358  cat</span><br><span class=\"line\">406  cat file</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"uniq-行排序\"><a href=\"#uniq-行排序\" class=\"headerlink\" title=\"uniq 行排序\"></a>uniq 行排序</h3><p>作为管道修饰，用于排除重复的记录</p>\n<p>基本参数 </p>\n<ul>\n<li>-c   相同值的计数</li>\n<li>-d   只显示重复的记录</li>\n<li>-u   只显示为重复的记录</li>\n</ul>\n<p>输入<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">history</span> | awk <span class=\"string\">'&#123;print $2,$3&#125;'</span>| sort -k1.1,2.1</span><br></pre></td></tr></table></figure></p>\n<p>输出<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\">whoami |</span><br><span class=\"line\">whoami |</span><br><span class=\"line\">whoami |</span><br></pre></td></tr></table></figure></p>\n<p>输入<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">history | awk &apos;&#123;print $2,$3&#125;&apos;| sort -k1.1,2.1 | uniq</span><br></pre></td></tr></table></figure></p>\n<p>输出<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\">who |</span><br><span class=\"line\">whoami</span><br><span class=\"line\">whoami |</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"wc-计算行数，字数，字符数\"><a href=\"#wc-计算行数，字数，字符数\" class=\"headerlink\" title=\"wc 计算行数，字数，字符数\"></a>wc 计算行数，字数，字符数</h3><p>wc命令的功能为统计指定文件中的字节数、字数、行数, 并将统计结果显示输出。</p>\n<p>基本参数 </p>\n<ul>\n<li>-c   统计字节数。  </li>\n<li>-l   统计行数</li>\n<li>-w   统计字数</li>\n</ul>\n<p>输入<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl www.baidu.com | wc</span><br></pre></td></tr></table></figure></p>\n<p>输出<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class=\"line\">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class=\"line\">100  2381  100  2381    0     0  26727      0 --:--:-- --:--:-- --:--:-- 27056</span><br><span class=\"line\">      2     159    2381</span><br></pre></td></tr></table></figure></p>\n<p>输入<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wc ./README.md</span><br></pre></td></tr></table></figure></p>\n<p>输出<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">467  904 8158 ./README.md</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"head-提取开头\"><a href=\"#head-提取开头\" class=\"headerlink\" title=\"head 提取开头\"></a>head 提取开头</h3><p>用来显示档案的开头至标准输出中，默认head命令打印其相应文件的开头10行。 </p>\n<p>基本参数 </p>\n<ul>\n<li>-q        隐藏文件名</li>\n<li>-v        显示文件名</li>\n<li>-c&lt;字节&gt;  显示字节数</li>\n<li>-n&lt;行数&gt;  显示的行数</li>\n</ul>\n<p>输入<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">history</span> | head -n 5</span><br></pre></td></tr></table></figure></p>\n<p>输出<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1  node -v</span><br><span class=\"line\">2  git -v</span><br><span class=\"line\">3  git status</span><br><span class=\"line\">4  git branch</span><br><span class=\"line\">5  <span class=\"built_in\">cd</span> workspace</span><br></pre></td></tr></table></figure></p>\n<p>输入<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">history</span> | head -n -5 <span class=\"comment\"># 负数表示除去后面5行以为的其他内容</span></span><br></pre></td></tr></table></figure></p>\n<h3 id=\"tail-从指定点开始将文件写到标准输出\"><a href=\"#tail-从指定点开始将文件写到标准输出\" class=\"headerlink\" title=\"tail 从指定点开始将文件写到标准输出\"></a>tail 从指定点开始将文件写到标准输出</h3><p>命令从指定点开始将文件写到标准输出.使用tail命令的-f选项可以方便的查阅正在改变的日志文件,tail -f filename会把filename里最尾部的内容显示在屏幕上,并且不但刷新,使你看到最新的文件内容. </p>\n<p>基本参数 </p>\n<ul>\n<li>-f 循环读取</li>\n<li>-q 不显示处理信息</li>\n<li>-v 显示详细的处理信息</li>\n<li>-c&lt;数目&gt; 显示的字节数</li>\n<li>-n&lt;行数&gt; 显示行数</li>\n<li>–pid=PID 与-f合用,表示在进程ID,PID死掉之后结束. </li>\n<li>-q, –quiet, –silent 从不输出给出文件名的首部 </li>\n<li>-s, –sleep-interval=S 与-f合用,表示在每次反复的间隔休眠S秒</li>\n</ul>\n<p>输入<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">history</span> | tail -n 5</span><br></pre></td></tr></table></figure></p>\n<p>输出<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">754  ll</span><br><span class=\"line\">755  <span class=\"built_in\">cd</span> ~</span><br><span class=\"line\">756  <span class=\"built_in\">cd</span> workspace/shell-test/</span><br><span class=\"line\">757  ll</span><br><span class=\"line\">758  <span class=\"built_in\">history</span> | tail</span><br></pre></td></tr></table></figure></p>\n<p>输入<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">history</span> | tail -n +750 <span class=\"comment\"># 从750行开始显示到结尾</span></span><br></pre></td></tr></table></figure></p>\n<p>今天就到这里，下次继续。</p>"},{"title":"shell学习笔记三","date":"2018-01-23T13:46:53.000Z","_content":"\nShell脚本与Windows/Dos下的批处理相似，也就是用各类命令预先放入到一个文件中，方便一次性执行的一个程序文件，主要是方便管理员进行设置或者管理用的。但是它比Windows下的批处理更强大，比用其他编程程序编辑的程序效率更高，它使用了Linux/Unix下的命令。\n<!--more-->\n\n## 字符的操作\n### grep 匹配字符\n输入\n```bash\necho 'string' | grep ^s\n```\n\n输出\n```bash\nstring\n```\n### egrep 扩展 \n\n\n### fgrep 快速 只是匹配文字\n输入\n```bash\necho 'string' | grep ^s\n```\n\n没有输出\n\n### grep 都有什么用\n\n只要是输出就可以匹配 so\n\n* 高亮目录中的 root \n\n```bash\nll | grep root \n``` \n\n### sed 替换字符\n```bash\n# 删除某行      \nsed '1d' textDir                                # 删除第一行 \nsed '$d' textDir                                # 删除最后一行\nsed '1,2d' textDir                              # 删除第一行到第二行\nsed '2,$d' textDir                              # 删除第二行到最后一行\n# 显示某行              \nsed -n '1p' textDir                             # 显示第一行 \nsed -n '$p' textDir                             # 显示最后一行\nsed -n '1,2p' textDir                           # 显示第一行到第二行\nsed -n '2,$p' textDir                           # 显示第二行到最后一行\n# 使用模式进行查询              \nsed -n '/ruby/p' textDir                        #查询包括关键字ruby所在所有行\nsed -n '/\\$/p' textDir                          #查询包括关键字$所在所有行，使用反斜线\\屏蔽特殊含义\n\n# 增加一行或多行字符串                \nsed '1a drink tea' textDir                      #第一行后增加字符串\"drink tea\"\nsed '1,3a drink tea' textDir                    #第一行到第三行后增加字符串\"drink tea\"\nsed '1a drink tea\\nor coffee' textDir           #第一行后增加多行，使用换行符\\n\n# 代替一行或多行       \nsed '1c Hi' textDir                             #第一行代替为Hi\nsed '1,2c Hi' textDir                           #第一行到第二行代替为Hi\n# 替换一行中的某部分 \n# 格式：sed 's/要替换的字符串/新的字符串/g'   （要替换的字符串可以用正则表达式）\nsed -n '/ruby/p' textDir | sed 's/ruby/bird/g'  #替换ruby为bird\n# 插入\nsed -i '$a bye' textDir                         #在文件textDir中最后一行直接输入\"bye\"\n```\n\n### cut 裁剪字符\n\n#### 基本语法格式\n\n```bash\ncut [-bn] [file] \ncut [-c] [file] \ncut [-df] [file]\n```\n\n#### 主要参数\n\n* -b ：以字节为单位进行分割。这些字节位置将忽略多字节字符边界，除非也指定了 -n 标志。\n* -c ：以字符为单位进行分割。\n* -d ：自定义分隔符，默认为制表符。\n* -f  ：与 -d 一起使用，指定显示哪个区域。\n\n```bash\n# 输出第一个字节\nwhoami | cut -b 1 \n```\n\n```bash\n# 输出第一个字符\nwhoami | cut -c 1 \n```\n\n```bash\n# 以 r 为分割符，取第二个元素\nwhoami | cut -d r -f 2 \n```\n\n### join 连接字符\n\n把多个文本的指定字段合并到一行\n\n```bash\n# 1.txt\n1 1\n2 2\n3 3\n```\n\n```bash\n# 2.txt\n1 a \n2 b\n3 c\n```\n\n```bash\njoin 1.txt 2.txt\n```\n```bash\n1 1 a \n2 2 b\n3 3 c\n```\n\n```bash\njoin -o 2.2 1.1 1.txt  2.txt\n```\n```bash\na 1 \nb 2\nc 3\n```\n\n### awk 重新编排字段\n\n```bash\nhistory | awk '{print $1}' \n```\n\n输出\n\n```bahs\n1\n2\n3\n4\n...\nn\n```\n试试看\n\n```bash\nawk -F: '{ printf \"User %s is really %s\\n\", $1, $5 }'  /etc/passwd\n```\n\n今天就到这里，下次继续。","source":"_posts/shell学习笔记三.md","raw":"---\ntitle: shell学习笔记三\ndate: 2018-01-23 21:46:53\ntags: ['shell','bash','脚本','终端','命令行']\ncategory: 'coding'\n---\n\nShell脚本与Windows/Dos下的批处理相似，也就是用各类命令预先放入到一个文件中，方便一次性执行的一个程序文件，主要是方便管理员进行设置或者管理用的。但是它比Windows下的批处理更强大，比用其他编程程序编辑的程序效率更高，它使用了Linux/Unix下的命令。\n<!--more-->\n\n## 字符的操作\n### grep 匹配字符\n输入\n```bash\necho 'string' | grep ^s\n```\n\n输出\n```bash\nstring\n```\n### egrep 扩展 \n\n\n### fgrep 快速 只是匹配文字\n输入\n```bash\necho 'string' | grep ^s\n```\n\n没有输出\n\n### grep 都有什么用\n\n只要是输出就可以匹配 so\n\n* 高亮目录中的 root \n\n```bash\nll | grep root \n``` \n\n### sed 替换字符\n```bash\n# 删除某行      \nsed '1d' textDir                                # 删除第一行 \nsed '$d' textDir                                # 删除最后一行\nsed '1,2d' textDir                              # 删除第一行到第二行\nsed '2,$d' textDir                              # 删除第二行到最后一行\n# 显示某行              \nsed -n '1p' textDir                             # 显示第一行 \nsed -n '$p' textDir                             # 显示最后一行\nsed -n '1,2p' textDir                           # 显示第一行到第二行\nsed -n '2,$p' textDir                           # 显示第二行到最后一行\n# 使用模式进行查询              \nsed -n '/ruby/p' textDir                        #查询包括关键字ruby所在所有行\nsed -n '/\\$/p' textDir                          #查询包括关键字$所在所有行，使用反斜线\\屏蔽特殊含义\n\n# 增加一行或多行字符串                \nsed '1a drink tea' textDir                      #第一行后增加字符串\"drink tea\"\nsed '1,3a drink tea' textDir                    #第一行到第三行后增加字符串\"drink tea\"\nsed '1a drink tea\\nor coffee' textDir           #第一行后增加多行，使用换行符\\n\n# 代替一行或多行       \nsed '1c Hi' textDir                             #第一行代替为Hi\nsed '1,2c Hi' textDir                           #第一行到第二行代替为Hi\n# 替换一行中的某部分 \n# 格式：sed 's/要替换的字符串/新的字符串/g'   （要替换的字符串可以用正则表达式）\nsed -n '/ruby/p' textDir | sed 's/ruby/bird/g'  #替换ruby为bird\n# 插入\nsed -i '$a bye' textDir                         #在文件textDir中最后一行直接输入\"bye\"\n```\n\n### cut 裁剪字符\n\n#### 基本语法格式\n\n```bash\ncut [-bn] [file] \ncut [-c] [file] \ncut [-df] [file]\n```\n\n#### 主要参数\n\n* -b ：以字节为单位进行分割。这些字节位置将忽略多字节字符边界，除非也指定了 -n 标志。\n* -c ：以字符为单位进行分割。\n* -d ：自定义分隔符，默认为制表符。\n* -f  ：与 -d 一起使用，指定显示哪个区域。\n\n```bash\n# 输出第一个字节\nwhoami | cut -b 1 \n```\n\n```bash\n# 输出第一个字符\nwhoami | cut -c 1 \n```\n\n```bash\n# 以 r 为分割符，取第二个元素\nwhoami | cut -d r -f 2 \n```\n\n### join 连接字符\n\n把多个文本的指定字段合并到一行\n\n```bash\n# 1.txt\n1 1\n2 2\n3 3\n```\n\n```bash\n# 2.txt\n1 a \n2 b\n3 c\n```\n\n```bash\njoin 1.txt 2.txt\n```\n```bash\n1 1 a \n2 2 b\n3 3 c\n```\n\n```bash\njoin -o 2.2 1.1 1.txt  2.txt\n```\n```bash\na 1 \nb 2\nc 3\n```\n\n### awk 重新编排字段\n\n```bash\nhistory | awk '{print $1}' \n```\n\n输出\n\n```bahs\n1\n2\n3\n4\n...\nn\n```\n试试看\n\n```bash\nawk -F: '{ printf \"User %s is really %s\\n\", $1, $5 }'  /etc/passwd\n```\n\n今天就到这里，下次继续。","slug":"shell学习笔记三","published":1,"updated":"2019-02-20T02:50:38.548Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjsgue0eq000ogpi6p5g0385v","content":"<p>Shell脚本与Windows/Dos下的批处理相似，也就是用各类命令预先放入到一个文件中，方便一次性执行的一个程序文件，主要是方便管理员进行设置或者管理用的。但是它比Windows下的批处理更强大，比用其他编程程序编辑的程序效率更高，它使用了Linux/Unix下的命令。<br><a id=\"more\"></a></p>\n<h2 id=\"字符的操作\"><a href=\"#字符的操作\" class=\"headerlink\" title=\"字符的操作\"></a>字符的操作</h2><h3 id=\"grep-匹配字符\"><a href=\"#grep-匹配字符\" class=\"headerlink\" title=\"grep 匹配字符\"></a>grep 匹配字符</h3><p>输入<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">'string'</span> | grep ^s</span><br></pre></td></tr></table></figure></p>\n<p>输出<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">string</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"egrep-扩展\"><a href=\"#egrep-扩展\" class=\"headerlink\" title=\"egrep 扩展\"></a>egrep 扩展</h3><h3 id=\"fgrep-快速-只是匹配文字\"><a href=\"#fgrep-快速-只是匹配文字\" class=\"headerlink\" title=\"fgrep 快速 只是匹配文字\"></a>fgrep 快速 只是匹配文字</h3><p>输入<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">'string'</span> | grep ^s</span><br></pre></td></tr></table></figure></p>\n<p>没有输出</p>\n<h3 id=\"grep-都有什么用\"><a href=\"#grep-都有什么用\" class=\"headerlink\" title=\"grep 都有什么用\"></a>grep 都有什么用</h3><p>只要是输出就可以匹配 so</p>\n<ul>\n<li>高亮目录中的 root </li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ll | grep root </span><br><span class=\"line\">``` </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">### sed 替换字符</span></span><br><span class=\"line\">```bash</span><br><span class=\"line\"><span class=\"comment\"># 删除某行      </span></span><br><span class=\"line\">sed <span class=\"string\">'1d'</span> textDir                                <span class=\"comment\"># 删除第一行 </span></span><br><span class=\"line\">sed <span class=\"string\">'$d'</span> textDir                                <span class=\"comment\"># 删除最后一行</span></span><br><span class=\"line\">sed <span class=\"string\">'1,2d'</span> textDir                              <span class=\"comment\"># 删除第一行到第二行</span></span><br><span class=\"line\">sed <span class=\"string\">'2,$d'</span> textDir                              <span class=\"comment\"># 删除第二行到最后一行</span></span><br><span class=\"line\"><span class=\"comment\"># 显示某行              </span></span><br><span class=\"line\">sed -n <span class=\"string\">'1p'</span> textDir                             <span class=\"comment\"># 显示第一行 </span></span><br><span class=\"line\">sed -n <span class=\"string\">'$p'</span> textDir                             <span class=\"comment\"># 显示最后一行</span></span><br><span class=\"line\">sed -n <span class=\"string\">'1,2p'</span> textDir                           <span class=\"comment\"># 显示第一行到第二行</span></span><br><span class=\"line\">sed -n <span class=\"string\">'2,$p'</span> textDir                           <span class=\"comment\"># 显示第二行到最后一行</span></span><br><span class=\"line\"><span class=\"comment\"># 使用模式进行查询              </span></span><br><span class=\"line\">sed -n <span class=\"string\">'/ruby/p'</span> textDir                        <span class=\"comment\">#查询包括关键字ruby所在所有行</span></span><br><span class=\"line\">sed -n <span class=\"string\">'/\\$/p'</span> textDir                          <span class=\"comment\">#查询包括关键字$所在所有行，使用反斜线\\屏蔽特殊含义</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 增加一行或多行字符串                </span></span><br><span class=\"line\">sed <span class=\"string\">'1a drink tea'</span> textDir                      <span class=\"comment\">#第一行后增加字符串\"drink tea\"</span></span><br><span class=\"line\">sed <span class=\"string\">'1,3a drink tea'</span> textDir                    <span class=\"comment\">#第一行到第三行后增加字符串\"drink tea\"</span></span><br><span class=\"line\">sed <span class=\"string\">'1a drink tea\\nor coffee'</span> textDir           <span class=\"comment\">#第一行后增加多行，使用换行符\\n</span></span><br><span class=\"line\"><span class=\"comment\"># 代替一行或多行       </span></span><br><span class=\"line\">sed <span class=\"string\">'1c Hi'</span> textDir                             <span class=\"comment\">#第一行代替为Hi</span></span><br><span class=\"line\">sed <span class=\"string\">'1,2c Hi'</span> textDir                           <span class=\"comment\">#第一行到第二行代替为Hi</span></span><br><span class=\"line\"><span class=\"comment\"># 替换一行中的某部分 </span></span><br><span class=\"line\"><span class=\"comment\"># 格式：sed 's/要替换的字符串/新的字符串/g'   （要替换的字符串可以用正则表达式）</span></span><br><span class=\"line\">sed -n <span class=\"string\">'/ruby/p'</span> textDir | sed <span class=\"string\">'s/ruby/bird/g'</span>  <span class=\"comment\">#替换ruby为bird</span></span><br><span class=\"line\"><span class=\"comment\"># 插入</span></span><br><span class=\"line\">sed -i <span class=\"string\">'$a bye'</span> textDir                         <span class=\"comment\">#在文件textDir中最后一行直接输入\"bye\"</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"cut-裁剪字符\"><a href=\"#cut-裁剪字符\" class=\"headerlink\" title=\"cut 裁剪字符\"></a>cut 裁剪字符</h3><h4 id=\"基本语法格式\"><a href=\"#基本语法格式\" class=\"headerlink\" title=\"基本语法格式\"></a>基本语法格式</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cut [-bn] [file] </span><br><span class=\"line\">cut [-c] [file] </span><br><span class=\"line\">cut [-df] [file]</span><br></pre></td></tr></table></figure>\n<h4 id=\"主要参数\"><a href=\"#主要参数\" class=\"headerlink\" title=\"主要参数\"></a>主要参数</h4><ul>\n<li>-b ：以字节为单位进行分割。这些字节位置将忽略多字节字符边界，除非也指定了 -n 标志。</li>\n<li>-c ：以字符为单位进行分割。</li>\n<li>-d ：自定义分隔符，默认为制表符。</li>\n<li>-f  ：与 -d 一起使用，指定显示哪个区域。</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 输出第一个字节</span></span><br><span class=\"line\">whoami | cut -b 1</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 输出第一个字符</span></span><br><span class=\"line\">whoami | cut -c 1</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 以 r 为分割符，取第二个元素</span></span><br><span class=\"line\">whoami | cut -d r -f 2</span><br></pre></td></tr></table></figure>\n<h3 id=\"join-连接字符\"><a href=\"#join-连接字符\" class=\"headerlink\" title=\"join 连接字符\"></a>join 连接字符</h3><p>把多个文本的指定字段合并到一行</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.txt</span></span><br><span class=\"line\">1 1</span><br><span class=\"line\">2 2</span><br><span class=\"line\">3 3</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 2.txt</span></span><br><span class=\"line\">1 a </span><br><span class=\"line\">2 b</span><br><span class=\"line\">3 c</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">join 1.txt 2.txt</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1 1 a </span><br><span class=\"line\">2 2 b</span><br><span class=\"line\">3 3 c</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">join -o 2.2 1.1 1.txt  2.txt</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a 1 </span><br><span class=\"line\">b 2</span><br><span class=\"line\">c 3</span><br></pre></td></tr></table></figure>\n<h3 id=\"awk-重新编排字段\"><a href=\"#awk-重新编排字段\" class=\"headerlink\" title=\"awk 重新编排字段\"></a>awk 重新编排字段</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">history</span> | awk <span class=\"string\">'&#123;print $1&#125;'</span></span><br></pre></td></tr></table></figure>\n<p>输出</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">...</span><br><span class=\"line\">n</span><br></pre></td></tr></table></figure>\n<p>试试看</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">awk -F: <span class=\"string\">'&#123; printf \"User %s is really %s\\n\", $1, $5 &#125;'</span>  /etc/passwd</span><br></pre></td></tr></table></figure>\n<p>今天就到这里，下次继续。</p>\n","excerpt":"<p>Shell脚本与Windows/Dos下的批处理相似，也就是用各类命令预先放入到一个文件中，方便一次性执行的一个程序文件，主要是方便管理员进行设置或者管理用的。但是它比Windows下的批处理更强大，比用其他编程程序编辑的程序效率更高，它使用了Linux/Unix下的命令。<br>","more":"</p>\n<h2 id=\"字符的操作\"><a href=\"#字符的操作\" class=\"headerlink\" title=\"字符的操作\"></a>字符的操作</h2><h3 id=\"grep-匹配字符\"><a href=\"#grep-匹配字符\" class=\"headerlink\" title=\"grep 匹配字符\"></a>grep 匹配字符</h3><p>输入<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">'string'</span> | grep ^s</span><br></pre></td></tr></table></figure></p>\n<p>输出<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">string</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"egrep-扩展\"><a href=\"#egrep-扩展\" class=\"headerlink\" title=\"egrep 扩展\"></a>egrep 扩展</h3><h3 id=\"fgrep-快速-只是匹配文字\"><a href=\"#fgrep-快速-只是匹配文字\" class=\"headerlink\" title=\"fgrep 快速 只是匹配文字\"></a>fgrep 快速 只是匹配文字</h3><p>输入<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">'string'</span> | grep ^s</span><br></pre></td></tr></table></figure></p>\n<p>没有输出</p>\n<h3 id=\"grep-都有什么用\"><a href=\"#grep-都有什么用\" class=\"headerlink\" title=\"grep 都有什么用\"></a>grep 都有什么用</h3><p>只要是输出就可以匹配 so</p>\n<ul>\n<li>高亮目录中的 root </li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ll | grep root </span><br><span class=\"line\">``` </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">### sed 替换字符</span></span><br><span class=\"line\">```bash</span><br><span class=\"line\"><span class=\"comment\"># 删除某行      </span></span><br><span class=\"line\">sed <span class=\"string\">'1d'</span> textDir                                <span class=\"comment\"># 删除第一行 </span></span><br><span class=\"line\">sed <span class=\"string\">'$d'</span> textDir                                <span class=\"comment\"># 删除最后一行</span></span><br><span class=\"line\">sed <span class=\"string\">'1,2d'</span> textDir                              <span class=\"comment\"># 删除第一行到第二行</span></span><br><span class=\"line\">sed <span class=\"string\">'2,$d'</span> textDir                              <span class=\"comment\"># 删除第二行到最后一行</span></span><br><span class=\"line\"><span class=\"comment\"># 显示某行              </span></span><br><span class=\"line\">sed -n <span class=\"string\">'1p'</span> textDir                             <span class=\"comment\"># 显示第一行 </span></span><br><span class=\"line\">sed -n <span class=\"string\">'$p'</span> textDir                             <span class=\"comment\"># 显示最后一行</span></span><br><span class=\"line\">sed -n <span class=\"string\">'1,2p'</span> textDir                           <span class=\"comment\"># 显示第一行到第二行</span></span><br><span class=\"line\">sed -n <span class=\"string\">'2,$p'</span> textDir                           <span class=\"comment\"># 显示第二行到最后一行</span></span><br><span class=\"line\"><span class=\"comment\"># 使用模式进行查询              </span></span><br><span class=\"line\">sed -n <span class=\"string\">'/ruby/p'</span> textDir                        <span class=\"comment\">#查询包括关键字ruby所在所有行</span></span><br><span class=\"line\">sed -n <span class=\"string\">'/\\$/p'</span> textDir                          <span class=\"comment\">#查询包括关键字$所在所有行，使用反斜线\\屏蔽特殊含义</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 增加一行或多行字符串                </span></span><br><span class=\"line\">sed <span class=\"string\">'1a drink tea'</span> textDir                      <span class=\"comment\">#第一行后增加字符串\"drink tea\"</span></span><br><span class=\"line\">sed <span class=\"string\">'1,3a drink tea'</span> textDir                    <span class=\"comment\">#第一行到第三行后增加字符串\"drink tea\"</span></span><br><span class=\"line\">sed <span class=\"string\">'1a drink tea\\nor coffee'</span> textDir           <span class=\"comment\">#第一行后增加多行，使用换行符\\n</span></span><br><span class=\"line\"><span class=\"comment\"># 代替一行或多行       </span></span><br><span class=\"line\">sed <span class=\"string\">'1c Hi'</span> textDir                             <span class=\"comment\">#第一行代替为Hi</span></span><br><span class=\"line\">sed <span class=\"string\">'1,2c Hi'</span> textDir                           <span class=\"comment\">#第一行到第二行代替为Hi</span></span><br><span class=\"line\"><span class=\"comment\"># 替换一行中的某部分 </span></span><br><span class=\"line\"><span class=\"comment\"># 格式：sed 's/要替换的字符串/新的字符串/g'   （要替换的字符串可以用正则表达式）</span></span><br><span class=\"line\">sed -n <span class=\"string\">'/ruby/p'</span> textDir | sed <span class=\"string\">'s/ruby/bird/g'</span>  <span class=\"comment\">#替换ruby为bird</span></span><br><span class=\"line\"><span class=\"comment\"># 插入</span></span><br><span class=\"line\">sed -i <span class=\"string\">'$a bye'</span> textDir                         <span class=\"comment\">#在文件textDir中最后一行直接输入\"bye\"</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"cut-裁剪字符\"><a href=\"#cut-裁剪字符\" class=\"headerlink\" title=\"cut 裁剪字符\"></a>cut 裁剪字符</h3><h4 id=\"基本语法格式\"><a href=\"#基本语法格式\" class=\"headerlink\" title=\"基本语法格式\"></a>基本语法格式</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cut [-bn] [file] </span><br><span class=\"line\">cut [-c] [file] </span><br><span class=\"line\">cut [-df] [file]</span><br></pre></td></tr></table></figure>\n<h4 id=\"主要参数\"><a href=\"#主要参数\" class=\"headerlink\" title=\"主要参数\"></a>主要参数</h4><ul>\n<li>-b ：以字节为单位进行分割。这些字节位置将忽略多字节字符边界，除非也指定了 -n 标志。</li>\n<li>-c ：以字符为单位进行分割。</li>\n<li>-d ：自定义分隔符，默认为制表符。</li>\n<li>-f  ：与 -d 一起使用，指定显示哪个区域。</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 输出第一个字节</span></span><br><span class=\"line\">whoami | cut -b 1</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 输出第一个字符</span></span><br><span class=\"line\">whoami | cut -c 1</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 以 r 为分割符，取第二个元素</span></span><br><span class=\"line\">whoami | cut -d r -f 2</span><br></pre></td></tr></table></figure>\n<h3 id=\"join-连接字符\"><a href=\"#join-连接字符\" class=\"headerlink\" title=\"join 连接字符\"></a>join 连接字符</h3><p>把多个文本的指定字段合并到一行</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 1.txt</span></span><br><span class=\"line\">1 1</span><br><span class=\"line\">2 2</span><br><span class=\"line\">3 3</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 2.txt</span></span><br><span class=\"line\">1 a </span><br><span class=\"line\">2 b</span><br><span class=\"line\">3 c</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">join 1.txt 2.txt</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1 1 a </span><br><span class=\"line\">2 2 b</span><br><span class=\"line\">3 3 c</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">join -o 2.2 1.1 1.txt  2.txt</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a 1 </span><br><span class=\"line\">b 2</span><br><span class=\"line\">c 3</span><br></pre></td></tr></table></figure>\n<h3 id=\"awk-重新编排字段\"><a href=\"#awk-重新编排字段\" class=\"headerlink\" title=\"awk 重新编排字段\"></a>awk 重新编排字段</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">history</span> | awk <span class=\"string\">'&#123;print $1&#125;'</span></span><br></pre></td></tr></table></figure>\n<p>输出</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">...</span><br><span class=\"line\">n</span><br></pre></td></tr></table></figure>\n<p>试试看</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">awk -F: <span class=\"string\">'&#123; printf \"User %s is really %s\\n\", $1, $5 &#125;'</span>  /etc/passwd</span><br></pre></td></tr></table></figure>\n<p>今天就到这里，下次继续。</p>"},{"title":"webpack 集成(Integrations) 翻译","date":"2017-11-11T02:29:53.000Z","_content":"\n\n首先我们要消除一个常见的误解。webpack 是一个模块打包器(module bundler)（例如，[Browserify](http://browserify.org/) 或 [Brunch](http://brunch.io/)）。它不是一个任务执行器(task runner)（例如，[Make](https://www.gnu.org/software/make/), [Grunt](https://gruntjs.com/) 或者 [Gulp](https://gulpjs.com/) ）。任务执行器就是用来自动化处理常见的开发任务，例如项目的检查(lint)、构建(build)、测试(test)。相对于*打包器(bundler)*，任务执行器则聚焦在偏重上层的问题上面。你可以得益于，使用上层的工具，而将打包部分的问题留给 webpack。\n\n打包器(bundler)帮助您取得准备用于部署的 JavaScript 和样式表，将它们转换为适合浏览器的可用格式。例如，JavaScript 可以[压缩](/plugins/uglifyjs-webpack-plugin)、[拆分 chunk](/guides/code-splitting) 和[懒加载](/guides/lazy-loading)，以提高性能。打包是 web 开发中最重要的挑战之一，解决此问题可以消除开发过程中的大部分痛点。\n\n好消息是，虽然有一些功能重复，但如果以正确的方式处理，任务运行器和模块打包器能够一起协同工作。本指南提供了关于如何将 webpack 与一些流行的任务运行器集成在一起的高度概述。<!--more-->\n\n\n## NPM Scripts\n\n通常 webpack 用户使用 npm [`scripts`](https://docs.npmjs.com/misc/scripts) 来作为任务执行器。这是比较好的开始。然而跨平台支持是一个问题，为此有一些解决方案。许多用户，但不是大多数用户，直接使用 npm `scripts` 和各种级别的 webpack 配置和工具，来应对构建任务。\n\n因此，当 webpack 的核心焦点专注于打包时，有多种扩展可以供你使用，可以将其用于任务运行者常见的工作。集成一个单独的工具会增加复杂度，所以一定要权衡集成前后的利弊。\n\n\n## Grunt\n\n对于那些使用Grunt的人，我们推荐使用 [`grunt-webpack`](https://www.npmjs.com/package/grunt-webpack) 软件包。使用 `grunt-webpack` 你可以运行 webpack或 [webpack-dev-server](https://github.com/webpack/webpack-dev-server) 作为一项任务，访问[模板标签](https://gruntjs.com/api/grunt.template)中的统计信息，拆分开发和生产配置等等。如果您尚未安装 `grunt-webpack` 以及 `webpack` 本身，请首先安装：\n\n``` bash\nnpm i --save-dev grunt-webpack webpack\n```\n\n然后注册一个配置并加载任务：\n\n__Gruntfile.js__\n\n``` js\nconst webpackConfig = require('./webpack.config.js');\n\nmodule.exports = function(grunt) {\n  grunt.initConfig({\n    webpack: {\n      options: {\n        stats: !process.env.NODE_ENV || process.env.NODE_ENV === 'development'\n      },\n      prod: webpackConfig,\n      dev: Object.assign({ watch: true }, webpackConfig)\n    }\n  });\n\n  grunt.loadNpmTasks('grunt-webpack');\n};\n```\n\n获取更多信息，请查看[知识库](https://github.com/webpack-contrib/grunt-webpack)。\n\n\n## Gulp\n\n在 [`webpack-stream`](https://github.com/shama/webpack-stream)包（a.k.a. `gulp-webpack`） 的帮助下，Gulp也可以很方便的完成集成。在这种情况下，不需要单独安装 `webpack` ，因为它是`webpack-stream`的直接依赖：\n\n``` bash\nnpm i --save-dev webpack-stream\n```\n\n只需要把 `webpack`（'webpack-stream'）替换为 `require('webpack-stream')`，并传递一个配置文件就可以了：\n\n__gulpfile.js__\n\n``` js\nvar gulp = require('gulp');\nvar webpack = require('webpack-stream');\ngulp.task('default', function() {\n  return gulp.src('src/entry.js')\n    .pipe(webpack({\n      // 一些配置选项……\n    }))\n    .pipe(gulp.dest('dist/'));\n});\n```\n\n获取更多信息，请查看[知识库](https://github.com/shama/webpack-stream)。\n\n## Mocha\n\n[`mocha-webpack`](https://github.com/zinserjan/mocha-webpack) 可以用来与 Mocha 整合。\n知识库提供了很多关于工具优缺点的细节，但 `mocha-webpack` 还算一个简单的封装，提供与 Mocha 几乎相同的CLI，并提供各种 webpack 功能，如改进了 watch 模式和优化了路径的分析。这里是一个如何安装并使用它来运行测试套件的小例子（在./test中找到）：\n\n``` bash\nnpm i --save-dev webpack mocha mocha-webpack\nmocha-webpack 'test/**/*.js'\n```\n\n获取更多信息，请查看[知识库](https://github.com/zinserjan/mocha-webpack)。\n\n\n## Karma\n\n[`karma-webpack`](https://github.com/webpack-contrib/karma-webpack) 软件包允许您使用webpack预处理 [Karma](http://karma-runner.github.io/1.0/index.html) 中的文件。它也可以使用[`webpack-dev-middleware`](https://github.com/webpack/webpack-dev-middleware)，并允许传递两者的配置。下面是一个简单的例子：\n\n``` bash\nnpm i --save-dev webpack karma karma-webpack\n```\n\n__karma.conf.js__\n\n``` js\nmodule.exports = function(config) {\n  config.set({\n    files: [\n      { pattern: 'test/*_test.js', watched: false },\n      { pattern: 'test/**/*_test.js', watched: false }\n    ],\n    preprocessors: {\n      'test/*_test.js': [ 'webpack' ],\n      'test/**/*_test.js': [ 'webpack' ]\n    },\n    webpack: {\n      // 一些自定义的webpack配置……\n    },\n    webpackMiddleware: {\n      // 一些定制的webpack-dev-middleware配置……\n    }\n  });\n};\n```\n\n获取更多信息，请访问[知识库](https://github.com/webpack-contrib/karma-webpack)。\n","source":"_posts/webpack-集成-Integrations-翻译.md","raw":"---\ntitle: webpack 集成(Integrations) 翻译\ndate: 2017-11-11 10:29:53\ntags: ['webpack','前端','js','javascript','integrations']\ncategory: 'coding'\n---\n\n\n首先我们要消除一个常见的误解。webpack 是一个模块打包器(module bundler)（例如，[Browserify](http://browserify.org/) 或 [Brunch](http://brunch.io/)）。它不是一个任务执行器(task runner)（例如，[Make](https://www.gnu.org/software/make/), [Grunt](https://gruntjs.com/) 或者 [Gulp](https://gulpjs.com/) ）。任务执行器就是用来自动化处理常见的开发任务，例如项目的检查(lint)、构建(build)、测试(test)。相对于*打包器(bundler)*，任务执行器则聚焦在偏重上层的问题上面。你可以得益于，使用上层的工具，而将打包部分的问题留给 webpack。\n\n打包器(bundler)帮助您取得准备用于部署的 JavaScript 和样式表，将它们转换为适合浏览器的可用格式。例如，JavaScript 可以[压缩](/plugins/uglifyjs-webpack-plugin)、[拆分 chunk](/guides/code-splitting) 和[懒加载](/guides/lazy-loading)，以提高性能。打包是 web 开发中最重要的挑战之一，解决此问题可以消除开发过程中的大部分痛点。\n\n好消息是，虽然有一些功能重复，但如果以正确的方式处理，任务运行器和模块打包器能够一起协同工作。本指南提供了关于如何将 webpack 与一些流行的任务运行器集成在一起的高度概述。<!--more-->\n\n\n## NPM Scripts\n\n通常 webpack 用户使用 npm [`scripts`](https://docs.npmjs.com/misc/scripts) 来作为任务执行器。这是比较好的开始。然而跨平台支持是一个问题，为此有一些解决方案。许多用户，但不是大多数用户，直接使用 npm `scripts` 和各种级别的 webpack 配置和工具，来应对构建任务。\n\n因此，当 webpack 的核心焦点专注于打包时，有多种扩展可以供你使用，可以将其用于任务运行者常见的工作。集成一个单独的工具会增加复杂度，所以一定要权衡集成前后的利弊。\n\n\n## Grunt\n\n对于那些使用Grunt的人，我们推荐使用 [`grunt-webpack`](https://www.npmjs.com/package/grunt-webpack) 软件包。使用 `grunt-webpack` 你可以运行 webpack或 [webpack-dev-server](https://github.com/webpack/webpack-dev-server) 作为一项任务，访问[模板标签](https://gruntjs.com/api/grunt.template)中的统计信息，拆分开发和生产配置等等。如果您尚未安装 `grunt-webpack` 以及 `webpack` 本身，请首先安装：\n\n``` bash\nnpm i --save-dev grunt-webpack webpack\n```\n\n然后注册一个配置并加载任务：\n\n__Gruntfile.js__\n\n``` js\nconst webpackConfig = require('./webpack.config.js');\n\nmodule.exports = function(grunt) {\n  grunt.initConfig({\n    webpack: {\n      options: {\n        stats: !process.env.NODE_ENV || process.env.NODE_ENV === 'development'\n      },\n      prod: webpackConfig,\n      dev: Object.assign({ watch: true }, webpackConfig)\n    }\n  });\n\n  grunt.loadNpmTasks('grunt-webpack');\n};\n```\n\n获取更多信息，请查看[知识库](https://github.com/webpack-contrib/grunt-webpack)。\n\n\n## Gulp\n\n在 [`webpack-stream`](https://github.com/shama/webpack-stream)包（a.k.a. `gulp-webpack`） 的帮助下，Gulp也可以很方便的完成集成。在这种情况下，不需要单独安装 `webpack` ，因为它是`webpack-stream`的直接依赖：\n\n``` bash\nnpm i --save-dev webpack-stream\n```\n\n只需要把 `webpack`（'webpack-stream'）替换为 `require('webpack-stream')`，并传递一个配置文件就可以了：\n\n__gulpfile.js__\n\n``` js\nvar gulp = require('gulp');\nvar webpack = require('webpack-stream');\ngulp.task('default', function() {\n  return gulp.src('src/entry.js')\n    .pipe(webpack({\n      // 一些配置选项……\n    }))\n    .pipe(gulp.dest('dist/'));\n});\n```\n\n获取更多信息，请查看[知识库](https://github.com/shama/webpack-stream)。\n\n## Mocha\n\n[`mocha-webpack`](https://github.com/zinserjan/mocha-webpack) 可以用来与 Mocha 整合。\n知识库提供了很多关于工具优缺点的细节，但 `mocha-webpack` 还算一个简单的封装，提供与 Mocha 几乎相同的CLI，并提供各种 webpack 功能，如改进了 watch 模式和优化了路径的分析。这里是一个如何安装并使用它来运行测试套件的小例子（在./test中找到）：\n\n``` bash\nnpm i --save-dev webpack mocha mocha-webpack\nmocha-webpack 'test/**/*.js'\n```\n\n获取更多信息，请查看[知识库](https://github.com/zinserjan/mocha-webpack)。\n\n\n## Karma\n\n[`karma-webpack`](https://github.com/webpack-contrib/karma-webpack) 软件包允许您使用webpack预处理 [Karma](http://karma-runner.github.io/1.0/index.html) 中的文件。它也可以使用[`webpack-dev-middleware`](https://github.com/webpack/webpack-dev-middleware)，并允许传递两者的配置。下面是一个简单的例子：\n\n``` bash\nnpm i --save-dev webpack karma karma-webpack\n```\n\n__karma.conf.js__\n\n``` js\nmodule.exports = function(config) {\n  config.set({\n    files: [\n      { pattern: 'test/*_test.js', watched: false },\n      { pattern: 'test/**/*_test.js', watched: false }\n    ],\n    preprocessors: {\n      'test/*_test.js': [ 'webpack' ],\n      'test/**/*_test.js': [ 'webpack' ]\n    },\n    webpack: {\n      // 一些自定义的webpack配置……\n    },\n    webpackMiddleware: {\n      // 一些定制的webpack-dev-middleware配置……\n    }\n  });\n};\n```\n\n获取更多信息，请访问[知识库](https://github.com/webpack-contrib/karma-webpack)。\n","slug":"webpack-集成-Integrations-翻译","published":1,"updated":"2019-02-20T02:50:38.591Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjsgue0es000rgpi6i92g0drq","content":"<p>首先我们要消除一个常见的误解。webpack 是一个模块打包器(module bundler)（例如，<a href=\"http://browserify.org/\" target=\"_blank\" rel=\"external\">Browserify</a> 或 <a href=\"http://brunch.io/\" target=\"_blank\" rel=\"external\">Brunch</a>）。它不是一个任务执行器(task runner)（例如，<a href=\"https://www.gnu.org/software/make/\" target=\"_blank\" rel=\"external\">Make</a>, <a href=\"https://gruntjs.com/\" target=\"_blank\" rel=\"external\">Grunt</a> 或者 <a href=\"https://gulpjs.com/\" target=\"_blank\" rel=\"external\">Gulp</a> ）。任务执行器就是用来自动化处理常见的开发任务，例如项目的检查(lint)、构建(build)、测试(test)。相对于<em>打包器(bundler)</em>，任务执行器则聚焦在偏重上层的问题上面。你可以得益于，使用上层的工具，而将打包部分的问题留给 webpack。</p>\n<p>打包器(bundler)帮助您取得准备用于部署的 JavaScript 和样式表，将它们转换为适合浏览器的可用格式。例如，JavaScript 可以<a href=\"/plugins/uglifyjs-webpack-plugin\">压缩</a>、<a href=\"/guides/code-splitting\">拆分 chunk</a> 和<a href=\"/guides/lazy-loading\">懒加载</a>，以提高性能。打包是 web 开发中最重要的挑战之一，解决此问题可以消除开发过程中的大部分痛点。</p>\n<p>好消息是，虽然有一些功能重复，但如果以正确的方式处理，任务运行器和模块打包器能够一起协同工作。本指南提供了关于如何将 webpack 与一些流行的任务运行器集成在一起的高度概述。<a id=\"more\"></a></p>\n<h2 id=\"NPM-Scripts\"><a href=\"#NPM-Scripts\" class=\"headerlink\" title=\"NPM Scripts\"></a>NPM Scripts</h2><p>通常 webpack 用户使用 npm <a href=\"https://docs.npmjs.com/misc/scripts\" target=\"_blank\" rel=\"external\"><code>scripts</code></a> 来作为任务执行器。这是比较好的开始。然而跨平台支持是一个问题，为此有一些解决方案。许多用户，但不是大多数用户，直接使用 npm <code>scripts</code> 和各种级别的 webpack 配置和工具，来应对构建任务。</p>\n<p>因此，当 webpack 的核心焦点专注于打包时，有多种扩展可以供你使用，可以将其用于任务运行者常见的工作。集成一个单独的工具会增加复杂度，所以一定要权衡集成前后的利弊。</p>\n<h2 id=\"Grunt\"><a href=\"#Grunt\" class=\"headerlink\" title=\"Grunt\"></a>Grunt</h2><p>对于那些使用Grunt的人，我们推荐使用 <a href=\"https://www.npmjs.com/package/grunt-webpack\" target=\"_blank\" rel=\"external\"><code>grunt-webpack</code></a> 软件包。使用 <code>grunt-webpack</code> 你可以运行 webpack或 <a href=\"https://github.com/webpack/webpack-dev-server\" target=\"_blank\" rel=\"external\">webpack-dev-server</a> 作为一项任务，访问<a href=\"https://gruntjs.com/api/grunt.template\" target=\"_blank\" rel=\"external\">模板标签</a>中的统计信息，拆分开发和生产配置等等。如果您尚未安装 <code>grunt-webpack</code> 以及 <code>webpack</code> 本身，请首先安装：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm i --save-dev grunt-webpack webpack</span><br></pre></td></tr></table></figure>\n<p>然后注册一个配置并加载任务：</p>\n<p><strong>Gruntfile.js</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> webpackConfig = <span class=\"built_in\">require</span>(<span class=\"string\">'./webpack.config.js'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">grunt</span>) </span>&#123;</span><br><span class=\"line\">  grunt.initConfig(&#123;</span><br><span class=\"line\">    <span class=\"attr\">webpack</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">stats</span>: !process.env.NODE_ENV || process.env.NODE_ENV === <span class=\"string\">'development'</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"attr\">prod</span>: webpackConfig,</span><br><span class=\"line\">      <span class=\"attr\">dev</span>: <span class=\"built_in\">Object</span>.assign(&#123; <span class=\"attr\">watch</span>: <span class=\"literal\">true</span> &#125;, webpackConfig)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  grunt.loadNpmTasks(<span class=\"string\">'grunt-webpack'</span>);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>获取更多信息，请查看<a href=\"https://github.com/webpack-contrib/grunt-webpack\" target=\"_blank\" rel=\"external\">知识库</a>。</p>\n<h2 id=\"Gulp\"><a href=\"#Gulp\" class=\"headerlink\" title=\"Gulp\"></a>Gulp</h2><p>在 <a href=\"https://github.com/shama/webpack-stream\" target=\"_blank\" rel=\"external\"><code>webpack-stream</code></a>包（a.k.a. <code>gulp-webpack</code>） 的帮助下，Gulp也可以很方便的完成集成。在这种情况下，不需要单独安装 <code>webpack</code> ，因为它是<code>webpack-stream</code>的直接依赖：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm i --save-dev webpack-stream</span><br></pre></td></tr></table></figure>\n<p>只需要把 <code>webpack</code>（’webpack-stream’）替换为 <code>require(&#39;webpack-stream&#39;)</code>，并传递一个配置文件就可以了：</p>\n<p><strong>gulpfile.js</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> gulp = <span class=\"built_in\">require</span>(<span class=\"string\">'gulp'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> webpack = <span class=\"built_in\">require</span>(<span class=\"string\">'webpack-stream'</span>);</span><br><span class=\"line\">gulp.task(<span class=\"string\">'default'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> gulp.src(<span class=\"string\">'src/entry.js'</span>)</span><br><span class=\"line\">    .pipe(webpack(&#123;</span><br><span class=\"line\">      <span class=\"comment\">// 一些配置选项……</span></span><br><span class=\"line\">    &#125;))</span><br><span class=\"line\">    .pipe(gulp.dest(<span class=\"string\">'dist/'</span>));</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>获取更多信息，请查看<a href=\"https://github.com/shama/webpack-stream\" target=\"_blank\" rel=\"external\">知识库</a>。</p>\n<h2 id=\"Mocha\"><a href=\"#Mocha\" class=\"headerlink\" title=\"Mocha\"></a>Mocha</h2><p><a href=\"https://github.com/zinserjan/mocha-webpack\" target=\"_blank\" rel=\"external\"><code>mocha-webpack</code></a> 可以用来与 Mocha 整合。<br>知识库提供了很多关于工具优缺点的细节，但 <code>mocha-webpack</code> 还算一个简单的封装，提供与 Mocha 几乎相同的CLI，并提供各种 webpack 功能，如改进了 watch 模式和优化了路径的分析。这里是一个如何安装并使用它来运行测试套件的小例子（在./test中找到）：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm i --save-dev webpack mocha mocha-webpack</span><br><span class=\"line\">mocha-webpack <span class=\"string\">'test/**/*.js'</span></span><br></pre></td></tr></table></figure>\n<p>获取更多信息，请查看<a href=\"https://github.com/zinserjan/mocha-webpack\" target=\"_blank\" rel=\"external\">知识库</a>。</p>\n<h2 id=\"Karma\"><a href=\"#Karma\" class=\"headerlink\" title=\"Karma\"></a>Karma</h2><p><a href=\"https://github.com/webpack-contrib/karma-webpack\" target=\"_blank\" rel=\"external\"><code>karma-webpack</code></a> 软件包允许您使用webpack预处理 <a href=\"http://karma-runner.github.io/1.0/index.html\" target=\"_blank\" rel=\"external\">Karma</a> 中的文件。它也可以使用<a href=\"https://github.com/webpack/webpack-dev-middleware\" target=\"_blank\" rel=\"external\"><code>webpack-dev-middleware</code></a>，并允许传递两者的配置。下面是一个简单的例子：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm i --save-dev webpack karma karma-webpack</span><br></pre></td></tr></table></figure>\n<p><strong>karma.conf.js</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">module</span>.exports = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">config</span>) </span>&#123;</span><br><span class=\"line\">  config.set(&#123;</span><br><span class=\"line\">    <span class=\"attr\">files</span>: [</span><br><span class=\"line\">      &#123; <span class=\"attr\">pattern</span>: <span class=\"string\">'test/*_test.js'</span>, <span class=\"attr\">watched</span>: <span class=\"literal\">false</span> &#125;,</span><br><span class=\"line\">      &#123; <span class=\"attr\">pattern</span>: <span class=\"string\">'test/**/*_test.js'</span>, <span class=\"attr\">watched</span>: <span class=\"literal\">false</span> &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"attr\">preprocessors</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">'test/*_test.js'</span>: [ <span class=\"string\">'webpack'</span> ],</span><br><span class=\"line\">      <span class=\"string\">'test/**/*_test.js'</span>: [ <span class=\"string\">'webpack'</span> ]</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">webpack</span>: &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 一些自定义的webpack配置……</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">webpackMiddleware</span>: &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 一些定制的webpack-dev-middleware配置……</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>获取更多信息，请访问<a href=\"https://github.com/webpack-contrib/karma-webpack\" target=\"_blank\" rel=\"external\">知识库</a>。</p>\n","excerpt":"<p>首先我们要消除一个常见的误解。webpack 是一个模块打包器(module bundler)（例如，<a href=\"http://browserify.org/\">Browserify</a> 或 <a href=\"http://brunch.io/\">Brunch</a>）。它不是一个任务执行器(task runner)（例如，<a href=\"https://www.gnu.org/software/make/\">Make</a>, <a href=\"https://gruntjs.com/\">Grunt</a> 或者 <a href=\"https://gulpjs.com/\">Gulp</a> ）。任务执行器就是用来自动化处理常见的开发任务，例如项目的检查(lint)、构建(build)、测试(test)。相对于<em>打包器(bundler)</em>，任务执行器则聚焦在偏重上层的问题上面。你可以得益于，使用上层的工具，而将打包部分的问题留给 webpack。</p>\n<p>打包器(bundler)帮助您取得准备用于部署的 JavaScript 和样式表，将它们转换为适合浏览器的可用格式。例如，JavaScript 可以<a href=\"/plugins/uglifyjs-webpack-plugin\">压缩</a>、<a href=\"/guides/code-splitting\">拆分 chunk</a> 和<a href=\"/guides/lazy-loading\">懒加载</a>，以提高性能。打包是 web 开发中最重要的挑战之一，解决此问题可以消除开发过程中的大部分痛点。</p>\n<p>好消息是，虽然有一些功能重复，但如果以正确的方式处理，任务运行器和模块打包器能够一起协同工作。本指南提供了关于如何将 webpack 与一些流行的任务运行器集成在一起的高度概述。","more":"</p>\n<h2 id=\"NPM-Scripts\"><a href=\"#NPM-Scripts\" class=\"headerlink\" title=\"NPM Scripts\"></a>NPM Scripts</h2><p>通常 webpack 用户使用 npm <a href=\"https://docs.npmjs.com/misc/scripts\"><code>scripts</code></a> 来作为任务执行器。这是比较好的开始。然而跨平台支持是一个问题，为此有一些解决方案。许多用户，但不是大多数用户，直接使用 npm <code>scripts</code> 和各种级别的 webpack 配置和工具，来应对构建任务。</p>\n<p>因此，当 webpack 的核心焦点专注于打包时，有多种扩展可以供你使用，可以将其用于任务运行者常见的工作。集成一个单独的工具会增加复杂度，所以一定要权衡集成前后的利弊。</p>\n<h2 id=\"Grunt\"><a href=\"#Grunt\" class=\"headerlink\" title=\"Grunt\"></a>Grunt</h2><p>对于那些使用Grunt的人，我们推荐使用 <a href=\"https://www.npmjs.com/package/grunt-webpack\"><code>grunt-webpack</code></a> 软件包。使用 <code>grunt-webpack</code> 你可以运行 webpack或 <a href=\"https://github.com/webpack/webpack-dev-server\">webpack-dev-server</a> 作为一项任务，访问<a href=\"https://gruntjs.com/api/grunt.template\">模板标签</a>中的统计信息，拆分开发和生产配置等等。如果您尚未安装 <code>grunt-webpack</code> 以及 <code>webpack</code> 本身，请首先安装：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm i --save-dev grunt-webpack webpack</span><br></pre></td></tr></table></figure>\n<p>然后注册一个配置并加载任务：</p>\n<p><strong>Gruntfile.js</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> webpackConfig = <span class=\"built_in\">require</span>(<span class=\"string\">'./webpack.config.js'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">grunt</span>) </span>&#123;</span><br><span class=\"line\">  grunt.initConfig(&#123;</span><br><span class=\"line\">    <span class=\"attr\">webpack</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">stats</span>: !process.env.NODE_ENV || process.env.NODE_ENV === <span class=\"string\">'development'</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"attr\">prod</span>: webpackConfig,</span><br><span class=\"line\">      <span class=\"attr\">dev</span>: <span class=\"built_in\">Object</span>.assign(&#123; <span class=\"attr\">watch</span>: <span class=\"literal\">true</span> &#125;, webpackConfig)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  grunt.loadNpmTasks(<span class=\"string\">'grunt-webpack'</span>);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>获取更多信息，请查看<a href=\"https://github.com/webpack-contrib/grunt-webpack\">知识库</a>。</p>\n<h2 id=\"Gulp\"><a href=\"#Gulp\" class=\"headerlink\" title=\"Gulp\"></a>Gulp</h2><p>在 <a href=\"https://github.com/shama/webpack-stream\"><code>webpack-stream</code></a>包（a.k.a. <code>gulp-webpack</code>） 的帮助下，Gulp也可以很方便的完成集成。在这种情况下，不需要单独安装 <code>webpack</code> ，因为它是<code>webpack-stream</code>的直接依赖：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm i --save-dev webpack-stream</span><br></pre></td></tr></table></figure>\n<p>只需要把 <code>webpack</code>（’webpack-stream’）替换为 <code>require(&#39;webpack-stream&#39;)</code>，并传递一个配置文件就可以了：</p>\n<p><strong>gulpfile.js</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> gulp = <span class=\"built_in\">require</span>(<span class=\"string\">'gulp'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> webpack = <span class=\"built_in\">require</span>(<span class=\"string\">'webpack-stream'</span>);</span><br><span class=\"line\">gulp.task(<span class=\"string\">'default'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> gulp.src(<span class=\"string\">'src/entry.js'</span>)</span><br><span class=\"line\">    .pipe(webpack(&#123;</span><br><span class=\"line\">      <span class=\"comment\">// 一些配置选项……</span></span><br><span class=\"line\">    &#125;))</span><br><span class=\"line\">    .pipe(gulp.dest(<span class=\"string\">'dist/'</span>));</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>获取更多信息，请查看<a href=\"https://github.com/shama/webpack-stream\">知识库</a>。</p>\n<h2 id=\"Mocha\"><a href=\"#Mocha\" class=\"headerlink\" title=\"Mocha\"></a>Mocha</h2><p><a href=\"https://github.com/zinserjan/mocha-webpack\"><code>mocha-webpack</code></a> 可以用来与 Mocha 整合。<br>知识库提供了很多关于工具优缺点的细节，但 <code>mocha-webpack</code> 还算一个简单的封装，提供与 Mocha 几乎相同的CLI，并提供各种 webpack 功能，如改进了 watch 模式和优化了路径的分析。这里是一个如何安装并使用它来运行测试套件的小例子（在./test中找到）：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm i --save-dev webpack mocha mocha-webpack</span><br><span class=\"line\">mocha-webpack <span class=\"string\">'test/**/*.js'</span></span><br></pre></td></tr></table></figure>\n<p>获取更多信息，请查看<a href=\"https://github.com/zinserjan/mocha-webpack\">知识库</a>。</p>\n<h2 id=\"Karma\"><a href=\"#Karma\" class=\"headerlink\" title=\"Karma\"></a>Karma</h2><p><a href=\"https://github.com/webpack-contrib/karma-webpack\"><code>karma-webpack</code></a> 软件包允许您使用webpack预处理 <a href=\"http://karma-runner.github.io/1.0/index.html\">Karma</a> 中的文件。它也可以使用<a href=\"https://github.com/webpack/webpack-dev-middleware\"><code>webpack-dev-middleware</code></a>，并允许传递两者的配置。下面是一个简单的例子：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm i --save-dev webpack karma karma-webpack</span><br></pre></td></tr></table></figure>\n<p><strong>karma.conf.js</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">module</span>.exports = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">config</span>) </span>&#123;</span><br><span class=\"line\">  config.set(&#123;</span><br><span class=\"line\">    <span class=\"attr\">files</span>: [</span><br><span class=\"line\">      &#123; <span class=\"attr\">pattern</span>: <span class=\"string\">'test/*_test.js'</span>, <span class=\"attr\">watched</span>: <span class=\"literal\">false</span> &#125;,</span><br><span class=\"line\">      &#123; <span class=\"attr\">pattern</span>: <span class=\"string\">'test/**/*_test.js'</span>, <span class=\"attr\">watched</span>: <span class=\"literal\">false</span> &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"attr\">preprocessors</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">'test/*_test.js'</span>: [ <span class=\"string\">'webpack'</span> ],</span><br><span class=\"line\">      <span class=\"string\">'test/**/*_test.js'</span>: [ <span class=\"string\">'webpack'</span> ]</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">webpack</span>: &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 一些自定义的webpack配置……</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">webpackMiddleware</span>: &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 一些定制的webpack-dev-middleware配置……</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>获取更多信息，请访问<a href=\"https://github.com/webpack-contrib/karma-webpack\">知识库</a>。</p>"},{"title":"react通过redux和redux-saga管理状态","date":"2017-12-16T11:53:12.000Z","_content":"## Redux\n### 应用场景\n* 某个组件的状态，需要共享\n* 某个状态需要在任何地方都可以拿到\n* 一个组件需要改变全局状态\n* 一个组件需要改变另一个组件的状态<!--more-->\n### 设计思想\n* Web 应用是一个状态机，视图与状态是一一对应的。(state)\n* 所有的状态，保存在一个对象里面。（store）\n\n![reduxe组件沟通](/0/reducer.png)\n\n组件的动作如果dispatch去调用全局纯函数reducer，reducer来修改全局对象的store里的state，组件重新渲染。\n\n解决了跨组件的状态交互。\n## Redux-saga\n### effect副作用函数（异步函数）\n![effect](/0/effect.png)\n\n* Generator 函数的语法 \n\n```javascript\nfunction* helloWorldGenerator() {\n  yield 'hello';\n  yield 'world';\n  return 'ending';\n}\n\nvar hw = helloWorldGenerator();\n\nhw.next()\n// { value: 'hello', done: false }\n\nhw.next()\n// { value: 'world', done: false }\n\nhw.next()\n// { value: 'ending', done: true }\n\nhw.next()\n// { value: undefined, done: true }\n```\n\n>callback --> Promise then 连死调用 --> Generator yield 函数同步化\n","source":"_posts/react通过redux和redux-saga管理状态.md","raw":"---\ntitle: react通过redux和redux-saga管理状态\ndate: 2017-12-16 19:53:12\ntags: ['reduxe','redux-saga','effect','dispatch','reducer']\ncategory: 'coding'\n---\n## Redux\n### 应用场景\n* 某个组件的状态，需要共享\n* 某个状态需要在任何地方都可以拿到\n* 一个组件需要改变全局状态\n* 一个组件需要改变另一个组件的状态<!--more-->\n### 设计思想\n* Web 应用是一个状态机，视图与状态是一一对应的。(state)\n* 所有的状态，保存在一个对象里面。（store）\n\n![reduxe组件沟通](/0/reducer.png)\n\n组件的动作如果dispatch去调用全局纯函数reducer，reducer来修改全局对象的store里的state，组件重新渲染。\n\n解决了跨组件的状态交互。\n## Redux-saga\n### effect副作用函数（异步函数）\n![effect](/0/effect.png)\n\n* Generator 函数的语法 \n\n```javascript\nfunction* helloWorldGenerator() {\n  yield 'hello';\n  yield 'world';\n  return 'ending';\n}\n\nvar hw = helloWorldGenerator();\n\nhw.next()\n// { value: 'hello', done: false }\n\nhw.next()\n// { value: 'world', done: false }\n\nhw.next()\n// { value: 'ending', done: true }\n\nhw.next()\n// { value: undefined, done: true }\n```\n\n>callback --> Promise then 连死调用 --> Generator yield 函数同步化\n","slug":"react通过redux和redux-saga管理状态","published":1,"updated":"2019-02-20T02:50:38.539Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjsgue0eu000ugpi6lc0j481c","content":"<h2 id=\"Redux\"><a href=\"#Redux\" class=\"headerlink\" title=\"Redux\"></a>Redux</h2><h3 id=\"应用场景\"><a href=\"#应用场景\" class=\"headerlink\" title=\"应用场景\"></a>应用场景</h3><ul>\n<li>某个组件的状态，需要共享</li>\n<li>某个状态需要在任何地方都可以拿到</li>\n<li>一个组件需要改变全局状态</li>\n<li>一个组件需要改变另一个组件的状态<a id=\"more\"></a><h3 id=\"设计思想\"><a href=\"#设计思想\" class=\"headerlink\" title=\"设计思想\"></a>设计思想</h3></li>\n<li>Web 应用是一个状态机，视图与状态是一一对应的。(state)</li>\n<li>所有的状态，保存在一个对象里面。（store）</li>\n</ul>\n<p><img src=\"/0/reducer.png\" alt=\"reduxe组件沟通\"></p>\n<p>组件的动作如果dispatch去调用全局纯函数reducer，reducer来修改全局对象的store里的state，组件重新渲染。</p>\n<p>解决了跨组件的状态交互。</p>\n<h2 id=\"Redux-saga\"><a href=\"#Redux-saga\" class=\"headerlink\" title=\"Redux-saga\"></a>Redux-saga</h2><h3 id=\"effect副作用函数（异步函数）\"><a href=\"#effect副作用函数（异步函数）\" class=\"headerlink\" title=\"effect副作用函数（异步函数）\"></a>effect副作用函数（异步函数）</h3><p><img src=\"/0/effect.png\" alt=\"effect\"></p>\n<ul>\n<li>Generator 函数的语法 </li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span>* <span class=\"title\">helloWorldGenerator</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">yield</span> <span class=\"string\">'hello'</span>;</span><br><span class=\"line\">  <span class=\"keyword\">yield</span> <span class=\"string\">'world'</span>;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"string\">'ending'</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> hw = helloWorldGenerator();</span><br><span class=\"line\"></span><br><span class=\"line\">hw.next()</span><br><span class=\"line\"><span class=\"comment\">// &#123; value: 'hello', done: false &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">hw.next()</span><br><span class=\"line\"><span class=\"comment\">// &#123; value: 'world', done: false &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">hw.next()</span><br><span class=\"line\"><span class=\"comment\">// &#123; value: 'ending', done: true &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">hw.next()</span><br><span class=\"line\"><span class=\"comment\">// &#123; value: undefined, done: true &#125;</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>callback –&gt; Promise then 连死调用 –&gt; Generator yield 函数同步化</p>\n</blockquote>\n","excerpt":"<h2 id=\"Redux\"><a href=\"#Redux\" class=\"headerlink\" title=\"Redux\"></a>Redux</h2><h3 id=\"应用场景\"><a href=\"#应用场景\" class=\"headerlink\" title=\"应用场景\"></a>应用场景</h3><ul>\n<li>某个组件的状态，需要共享</li>\n<li>某个状态需要在任何地方都可以拿到</li>\n<li>一个组件需要改变全局状态</li>\n<li>一个组件需要改变另一个组件的状态","more":"<h3 id=\"设计思想\"><a href=\"#设计思想\" class=\"headerlink\" title=\"设计思想\"></a>设计思想</h3></li>\n<li>Web 应用是一个状态机，视图与状态是一一对应的。(state)</li>\n<li>所有的状态，保存在一个对象里面。（store）</li>\n</ul>\n<p><img src=\"/0/reducer.png\" alt=\"reduxe组件沟通\"></p>\n<p>组件的动作如果dispatch去调用全局纯函数reducer，reducer来修改全局对象的store里的state，组件重新渲染。</p>\n<p>解决了跨组件的状态交互。</p>\n<h2 id=\"Redux-saga\"><a href=\"#Redux-saga\" class=\"headerlink\" title=\"Redux-saga\"></a>Redux-saga</h2><h3 id=\"effect副作用函数（异步函数）\"><a href=\"#effect副作用函数（异步函数）\" class=\"headerlink\" title=\"effect副作用函数（异步函数）\"></a>effect副作用函数（异步函数）</h3><p><img src=\"/0/effect.png\" alt=\"effect\"></p>\n<ul>\n<li>Generator 函数的语法 </li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span>* <span class=\"title\">helloWorldGenerator</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">yield</span> <span class=\"string\">'hello'</span>;</span><br><span class=\"line\">  <span class=\"keyword\">yield</span> <span class=\"string\">'world'</span>;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"string\">'ending'</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> hw = helloWorldGenerator();</span><br><span class=\"line\"></span><br><span class=\"line\">hw.next()</span><br><span class=\"line\"><span class=\"comment\">// &#123; value: 'hello', done: false &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">hw.next()</span><br><span class=\"line\"><span class=\"comment\">// &#123; value: 'world', done: false &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">hw.next()</span><br><span class=\"line\"><span class=\"comment\">// &#123; value: 'ending', done: true &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">hw.next()</span><br><span class=\"line\"><span class=\"comment\">// &#123; value: undefined, done: true &#125;</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>callback –&gt; Promise then 连死调用 –&gt; Generator yield 函数同步化</p>\n</blockquote>"},{"title":"webpack的shimming的翻译","date":"2017-11-03T14:10:04.000Z","_content":"webpack编译器可以理解写入的ES2015模块，CommonJS或AMD的模块。然而，一些第三方库可能会期望全局依赖（例如jQuery的$）。这些库可能还会创建需要导出的全局变量。这些“broken modules”使得shimming发挥了作用。\n\nW> __我们不建议使用全局变量！__ Webpack真正的概念是更多的模块化前端开发。这意味着编写完整包含的隔离模块，而不依赖于隐藏的依赖关系（例如全局变量）。所以请仅在必要时去主要做。\n\n_shimming_ 的另一个使用场景就是，如果您希望使用浏览器的[polyfill](https://en.wikipedia.org/wiki/Polyfill)功能来支持更多的用户。在这种情况下，您可能只想将这些Polyfill提供给需要修补的浏览器（即按需加载）。<!-- more -->\n\n以下文章将介绍这两种用例。\n\nT>为了简单起见，本指南源于“[Getting Started](/guides/getting-started)”中的示例。请确保您在移动之前熟悉该设置。\n\n\n## 垫片全局变量\n\n我们从第一个使用shimming的全局变量的用例开始。在我们做任何事情之前，我们再来看看我们的项目：\n\n__project__\n\n``` diff\nwebpack-demo\n|- package.json\n|- webpack.config.js\n|- /dist\n|- /src\n  |- index.js\n|- /node_modules\n```\n\n记得我们在使用 `lodash` ？为了演示目的，我们假设希望在整个应用程序中lodash要作为全局变量。为此我们可以使用`ProvidePlugin`插件。\n\n[`ProvidePlugin`](/plugins/provide-plugin) 使用WebPACK变量的形式使包可以在每个模块编译通过。 如果WebPACK看到变量被使用，它将在最后一个bundle中引入指定的包。下面我们取消 `import` 改用插件的方式来提供 `lodash`:\n\n__src/index.js__\n\n``` diff\n- import _ from 'lodash';\n-\n  function component() {\n    var element = document.createElement('div');\n\n-   // Lodash, now imported by this script\n    element.innerHTML = _.join(['Hello', 'webpack'], ' ');\n\n    return element;\n  }\n\n  document.body.appendChild(component());\n```\n\n__webpack.config.js__\n\n``` diff\n  const path = require('path');\n\n  module.exports = {\n    entry: './src/index.js',\n    output: {\n      filename: 'bundle.js',\n      path: path.resolve(__dirname, 'dist')\n-   }\n+   },\n+   plugins: [\n+     new webpack.ProvidePlugin({\n+       lodash: 'lodash'\n+     })\n+   ]\n  };\n```\n\n以上就是对webpack的配置...\n\n> 一旦你引用了一次 `lodash`的实例变量，引入`lodash` 包并且提供给需要他的模块。\n\n如果我们运行 build ，我们将看到同样的输出：\n\n``` bash\nTODO: Include output\n```\n我们还可以使用 `ProvidePlugin` 通过使用路径数组（路径数组机构如下：`[module, child, ...children?]`）来配置模块的单个导出。所以让我们想想一下，如果 `lodash` 的 `join` 被调用的时候，我们只需要输出这一个方法：\n So let's imagine we only wanted to provide the `join` method from `lodash` wherever it's invoked:\n\n__src/index.js__\n\n``` diff\n  function component() {\n    var element = document.createElement('div');\n\n-   element.innerHTML = _.join(['Hello', 'webpack'], ' ');\n+   element.innerHTML = join(['Hello', 'webpack'], ' ');\n\n    return element;\n  }\n\n  document.body.appendChild(component());\n```\n\n__webpack.config.js__\n\n``` diff\n  const path = require('path');\n\n  module.exports = {\n    entry: './src/index.js',\n    output: {\n      filename: 'bundle.js',\n      path: path.resolve(__dirname, 'dist')\n    },\n    plugins: [\n      new webpack.ProvidePlugin({\n-       lodash: 'lodash'\n+       join: ['lodash', 'join']\n      })\n    ]\n  };\n```\n\n通过 [Tree Shaking](/guides/tree-shaking) `lodash`库的其他部分将被优雅的舍去。\n\n\n## 局部垫片\n\n一些传统模块依赖于 `window` 对象。更新我们的`index.js`，作为事例：\n\n``` diff\n  function component() {\n    var element = document.createElement('div');\n\n    element.innerHTML = join(['Hello', 'webpack'], ' ');\n+\n+   // Assume we are in the context of `window`\n+   this.alert('Hmmm, this probably isn\\'t a great idea...')\n\n    return element;\n  }\n\n  document.body.appendChild(component());\n```\n现在有一个问题，当模块在CommonJS上下文中执行时，`this` 等于 `module.exports`。在这个事例中我们将使用 [`imports-loader`](/loaders/imports-loader/) 来替换 `this` ：\n\n__webpack.config.js__\n\n``` diff\n  const path = require('path');\n\n  module.exports = {\n    entry: './src/index.js',\n    output: {\n      filename: 'bundle.js',\n      path: path.resolve(__dirname, 'dist')\n    },\n+   module: {\n+     rules: [\n+       {\n+         test: require.resolve('index.js'),\n+         use: 'imports-loader?this=>window'\n+       }\n+     ]\n+   },\n    plugins: [\n      new webpack.ProvidePlugin({\n        join: ['lodash', 'join']\n      })\n    ]\n  };\n```\n\n\n## 全局变量的导出\n\n我们通常会创建一个充满了全局变量的库。我们可以在我们的设置中添加一个小模块来演示这个：\n\n__project__\n\n``` diff\n  webpack-demo\n  |- package.json\n  |- webpack.config.js\n  |- /dist\n  |- /src\n    |- index.js\n+   |- globals.js\n  |- /node_modules\n```\n\n__src/globals.js__\n\n``` js\nvar file = 'blah.txt';\nvar helpers = {\n  test: function() { console.log('test something'); },\n  parse: function() { console.log('parse something'); }\n}\n```\n\n现在，你可能永远不会在自己的代码中如此操作，但是你可能会遇到要使用一下已过时的库，其中包含与上述相似的代码。在这种情况下，我们可以使用 [`exports-loader`](/loaders/exports-loader/) 将该全局变量像一般模块那样导出。例如，将 `file` 导出为 `file`，`helpers.parse` 导出为 `parse`：\n\n__webpack.config.js__\n\n``` diff\n  const path = require('path');\n\n  module.exports = {\n    entry: './src/index.js',\n    output: {\n      filename: 'bundle.js',\n      path: path.resolve(__dirname, 'dist')\n    },\n    module: {\n      rules: [\n        {\n          test: require.resolve('index.js'),\n          use: 'imports-loader?this=>window'\n-       }\n+       },\n+       {\n+         test: require.resolve('globals.js'),\n+         use: 'exports-loader?file,parse=helpers.parse'\n+       }\n      ]\n    },\n    plugins: [\n      new webpack.ProvidePlugin({\n        join: ['lodash', 'join']\n      })\n    ]\n  };\n```\n现在从我们的入口脚本（即 `src/index.js`）中，`import { file, parse } from './globals.js';` 都应该顺利进行。\n\n## 加载腻子\n\n到目前为止，我们讨论的几乎所有内容都与处理传统包有关。我们继续谈谈我们的第二个话题： __腻子__。\n\n有很多方法来加载腻子. 例如，要包括 [`babel-polyfill`](https://babeljs.io/docs/usage/polyfill/)，我们可以简单地：\n\n``` bash\nnpm i --save babel-polyfill\n```\n并`import`它，以便将其包含在我们的主包中：\n\n__src/index.js__\n\n``` diff\n+ import 'babel-polyfill';\n+\n  function component() {\n    var element = document.createElement('div');\n\n    element.innerHTML = join(['Hello', 'webpack'], ' ');\n\n    return element;\n  }\n\n  document.body.appendChild(component());\n```\n\nT>请注意，我们没有将`import`绑定到变量。这是因为腻子只能在其他代码前自行运行。才能允许我们假设某些本机功能存在。\n\n__但是把腻子包括到主包中这种做法并不推荐__，因为这样会让现代浏览器用户下载过多不必要的脚本，降低用户体验。\n\n现在我们删除 `import` 并且添加一个新的腻子 [`whatwg-fetch`](https://github.com/github/fetch) ：\n\n``` bash\nnpm i --save whatwg-fetch\n```\n\n__src/index.js__\n\n``` diff\n- import 'babel-polyfill';\n-\n  function component() {\n    var element = document.createElement('div');\n\n    element.innerHTML = join(['Hello', 'webpack'], ' ');\n\n    return element;\n  }\n\n  document.body.appendChild(component());\n```\n\n__project__\n\n``` diff\n  webpack-demo\n  |- package.json\n  |- webpack.config.js\n  |- /dist\n  |- /src\n    |- index.js\n    |- globals.js\n+   |- polyfills.js\n  |- /node_modules\n```\n\n__src/polyfills.js__\n\n```javascript\nimport 'babel-polyfill';\nimport 'whatwg-fetch';\n```\n\n__webpack.config.js__\n\n``` diff\n  const path = require('path');\n\n  module.exports = {\n-   entry: './src/index.js',\n+   entry: {\n+     polyfills: './src/polyfills.js',\n+     index: './src/index.js'\n+   },\n    output: {\n-     filename: 'bundle.js',\n+     filename: '[name].bundle.js',\n      path: path.resolve(__dirname, 'dist')\n    },\n    module: {\n      rules: [\n        {\n          test: require.resolve('index.js'),\n          use: 'imports-loader?this=>window'\n        },\n        {\n          test: require.resolve('globals.js'),\n          use: 'exports-loader?file,parse=helpers.parse'\n        }\n      ]\n    },\n    plugins: [\n      new webpack.ProvidePlugin({\n        join: ['lodash', 'join']\n      })\n    ]\n  };\n```\n有了这个，我们可以添加逻辑来有条件地加载我们的新的 `polyfills.bundle.js` 文件。您如何做出这一决定取决于您需要支持的技术和浏览器。我们将做一些简单的测试来确定我们的腻子是否需要：\n\n__dist/index.html__\n\n``` diff\n  <html>\n    <head>\n      <title>Getting Started</title>\n+     <script>\n+       var modernBrowser = (\n+         'fetch' in window &&\n+         'assign' in Object\n+       );\n+\n+       if ( !modernBrowser ) {\n+         var scriptElement = document.createElement('script');\n+\n+         scriptElement.async = false;\n+         scriptElement.src = '/polyfills.bundle.js';\n+         document.head.appendChild(scriptElement);\n+       }\n+     </script>\n    </head>\n    <body>\n      <script src=\"index.bundle.js\"></script>\n    </body>\n  </html>\n```\n\nNow we can `fetch` some data within our entry script:\n\n__src/index.js__\n\n``` diff\n  function component() {\n    var element = document.createElement('div');\n\n    element.innerHTML = join(['Hello', 'webpack'], ' ');\n\n    return element;\n  }\n\n  document.body.appendChild(component());\n+\n+ fetch('https://jsonplaceholder.typicode.com/users')\n+   .then(response => response.json())\n+   .then(json => {\n+     console.log('We retrieved some data! AND we\\'re confident it will work on a variety of browser distributions.')\n+     console.log(json)\n+   })\n+   .catch(error => console.error('Something went wrong when fetching this data: ', error))\n```\n\n如果我们运行build，将会生成一个 `polyfills.bundle.js` 文件，并且浏览器中的所有内容都应该顺利运行。请注意，这种设置可能会得到改善，因为这只是解决如何把腻子只提供给真正需要它们的用户的一种方法。\n\n## 进一步的优化\n\n`babel-preset-env` 包则是通过一个 [browserslist](https://github.com/ai/browserslist)来匹配你浏览器，并且转码你浏览器所不支持的的代码。通过`useBuiltIns` 选项进行预设，默认为 `false`，通过 `import` 的方法导入更细粒度的功能来覆盖你的全局 `babel-polyfill`配置：\n\n``` js\nimport 'core-js/modules/es7.string.pad-start';\nimport 'core-js/modules/es7.string.pad-end';\nimport 'core-js/modules/web.timers';\nimport 'core-js/modules/web.immediate';\nimport 'core-js/modules/web.dom.iterable';\n```\n有关详细信息，请参阅[知识库](https://github.com/babel/babel-preset-env)。\n\n\n## Node的内部插件\n\nNode的内部插件，比如 `process` 能够根据您的配置文件直接打腻子，而无需使用任何特殊的loaders或插件。 查看[node配置页面](/configuration/node)，那里有过多的信息和事例。\n\n\n## 其它\n\n在处理传统模块时，还有一些其他工具可以帮助您。\n\n[`script-loader`](/loaders/script-loader/)能够评估你的全局上下文的代码。作用类似于一个 `script` 的标签容器。在这种模式下，每个正常的库都应该工作。`require`、`module` 等等未被定义。\n\nW>当使用 `script-loader` 时，将该模块作为字符串添加到捆绑包中。它不会被 `webpack` 最小化，所以请使用最小化的版本。对于这个加载器添加的库，也么有 `devtool` 支持。\n\n当没有AMD/CommonJS版本的模块，并且您想要包括到 `dist` 中去，你可以在 [`noParse`](/configuration/module/#module-noparse) 中标记这个模块。他将告诉webpack引用这个模块不需要匹配或分析 `require()` 和  `import` 语法。这种做法也用于提高构建性能。\n\nW> 任何需要AST的功能， 例如 `ProvidePlugin`，将不再工作。\n\n最后，有一些模块支持不同的 [模块风格](/concepts/modules)，如AMD，CommonJS和传统。在大多数情况下，他们首先检查 `define`，然后使用一些古怪的代码来导出属性。在这种情况下，可以通过 [`imports-loader`](/loaders/imports-loader/) 设置 `define=>false` 来强制导入CommonJS路径。\n\n***\n\n> 原文：https://webpack.js.org/guides/shimming/\n\n","source":"_posts/webpack的shimming的翻译.md","raw":"---\ntitle: webpack的shimming的翻译\ndate: 2017-11-03 22:10:04\ntags: ['webpack','前端','js','javascript','shimming']\ncategory: 'coding'\n---\nwebpack编译器可以理解写入的ES2015模块，CommonJS或AMD的模块。然而，一些第三方库可能会期望全局依赖（例如jQuery的$）。这些库可能还会创建需要导出的全局变量。这些“broken modules”使得shimming发挥了作用。\n\nW> __我们不建议使用全局变量！__ Webpack真正的概念是更多的模块化前端开发。这意味着编写完整包含的隔离模块，而不依赖于隐藏的依赖关系（例如全局变量）。所以请仅在必要时去主要做。\n\n_shimming_ 的另一个使用场景就是，如果您希望使用浏览器的[polyfill](https://en.wikipedia.org/wiki/Polyfill)功能来支持更多的用户。在这种情况下，您可能只想将这些Polyfill提供给需要修补的浏览器（即按需加载）。<!-- more -->\n\n以下文章将介绍这两种用例。\n\nT>为了简单起见，本指南源于“[Getting Started](/guides/getting-started)”中的示例。请确保您在移动之前熟悉该设置。\n\n\n## 垫片全局变量\n\n我们从第一个使用shimming的全局变量的用例开始。在我们做任何事情之前，我们再来看看我们的项目：\n\n__project__\n\n``` diff\nwebpack-demo\n|- package.json\n|- webpack.config.js\n|- /dist\n|- /src\n  |- index.js\n|- /node_modules\n```\n\n记得我们在使用 `lodash` ？为了演示目的，我们假设希望在整个应用程序中lodash要作为全局变量。为此我们可以使用`ProvidePlugin`插件。\n\n[`ProvidePlugin`](/plugins/provide-plugin) 使用WebPACK变量的形式使包可以在每个模块编译通过。 如果WebPACK看到变量被使用，它将在最后一个bundle中引入指定的包。下面我们取消 `import` 改用插件的方式来提供 `lodash`:\n\n__src/index.js__\n\n``` diff\n- import _ from 'lodash';\n-\n  function component() {\n    var element = document.createElement('div');\n\n-   // Lodash, now imported by this script\n    element.innerHTML = _.join(['Hello', 'webpack'], ' ');\n\n    return element;\n  }\n\n  document.body.appendChild(component());\n```\n\n__webpack.config.js__\n\n``` diff\n  const path = require('path');\n\n  module.exports = {\n    entry: './src/index.js',\n    output: {\n      filename: 'bundle.js',\n      path: path.resolve(__dirname, 'dist')\n-   }\n+   },\n+   plugins: [\n+     new webpack.ProvidePlugin({\n+       lodash: 'lodash'\n+     })\n+   ]\n  };\n```\n\n以上就是对webpack的配置...\n\n> 一旦你引用了一次 `lodash`的实例变量，引入`lodash` 包并且提供给需要他的模块。\n\n如果我们运行 build ，我们将看到同样的输出：\n\n``` bash\nTODO: Include output\n```\n我们还可以使用 `ProvidePlugin` 通过使用路径数组（路径数组机构如下：`[module, child, ...children?]`）来配置模块的单个导出。所以让我们想想一下，如果 `lodash` 的 `join` 被调用的时候，我们只需要输出这一个方法：\n So let's imagine we only wanted to provide the `join` method from `lodash` wherever it's invoked:\n\n__src/index.js__\n\n``` diff\n  function component() {\n    var element = document.createElement('div');\n\n-   element.innerHTML = _.join(['Hello', 'webpack'], ' ');\n+   element.innerHTML = join(['Hello', 'webpack'], ' ');\n\n    return element;\n  }\n\n  document.body.appendChild(component());\n```\n\n__webpack.config.js__\n\n``` diff\n  const path = require('path');\n\n  module.exports = {\n    entry: './src/index.js',\n    output: {\n      filename: 'bundle.js',\n      path: path.resolve(__dirname, 'dist')\n    },\n    plugins: [\n      new webpack.ProvidePlugin({\n-       lodash: 'lodash'\n+       join: ['lodash', 'join']\n      })\n    ]\n  };\n```\n\n通过 [Tree Shaking](/guides/tree-shaking) `lodash`库的其他部分将被优雅的舍去。\n\n\n## 局部垫片\n\n一些传统模块依赖于 `window` 对象。更新我们的`index.js`，作为事例：\n\n``` diff\n  function component() {\n    var element = document.createElement('div');\n\n    element.innerHTML = join(['Hello', 'webpack'], ' ');\n+\n+   // Assume we are in the context of `window`\n+   this.alert('Hmmm, this probably isn\\'t a great idea...')\n\n    return element;\n  }\n\n  document.body.appendChild(component());\n```\n现在有一个问题，当模块在CommonJS上下文中执行时，`this` 等于 `module.exports`。在这个事例中我们将使用 [`imports-loader`](/loaders/imports-loader/) 来替换 `this` ：\n\n__webpack.config.js__\n\n``` diff\n  const path = require('path');\n\n  module.exports = {\n    entry: './src/index.js',\n    output: {\n      filename: 'bundle.js',\n      path: path.resolve(__dirname, 'dist')\n    },\n+   module: {\n+     rules: [\n+       {\n+         test: require.resolve('index.js'),\n+         use: 'imports-loader?this=>window'\n+       }\n+     ]\n+   },\n    plugins: [\n      new webpack.ProvidePlugin({\n        join: ['lodash', 'join']\n      })\n    ]\n  };\n```\n\n\n## 全局变量的导出\n\n我们通常会创建一个充满了全局变量的库。我们可以在我们的设置中添加一个小模块来演示这个：\n\n__project__\n\n``` diff\n  webpack-demo\n  |- package.json\n  |- webpack.config.js\n  |- /dist\n  |- /src\n    |- index.js\n+   |- globals.js\n  |- /node_modules\n```\n\n__src/globals.js__\n\n``` js\nvar file = 'blah.txt';\nvar helpers = {\n  test: function() { console.log('test something'); },\n  parse: function() { console.log('parse something'); }\n}\n```\n\n现在，你可能永远不会在自己的代码中如此操作，但是你可能会遇到要使用一下已过时的库，其中包含与上述相似的代码。在这种情况下，我们可以使用 [`exports-loader`](/loaders/exports-loader/) 将该全局变量像一般模块那样导出。例如，将 `file` 导出为 `file`，`helpers.parse` 导出为 `parse`：\n\n__webpack.config.js__\n\n``` diff\n  const path = require('path');\n\n  module.exports = {\n    entry: './src/index.js',\n    output: {\n      filename: 'bundle.js',\n      path: path.resolve(__dirname, 'dist')\n    },\n    module: {\n      rules: [\n        {\n          test: require.resolve('index.js'),\n          use: 'imports-loader?this=>window'\n-       }\n+       },\n+       {\n+         test: require.resolve('globals.js'),\n+         use: 'exports-loader?file,parse=helpers.parse'\n+       }\n      ]\n    },\n    plugins: [\n      new webpack.ProvidePlugin({\n        join: ['lodash', 'join']\n      })\n    ]\n  };\n```\n现在从我们的入口脚本（即 `src/index.js`）中，`import { file, parse } from './globals.js';` 都应该顺利进行。\n\n## 加载腻子\n\n到目前为止，我们讨论的几乎所有内容都与处理传统包有关。我们继续谈谈我们的第二个话题： __腻子__。\n\n有很多方法来加载腻子. 例如，要包括 [`babel-polyfill`](https://babeljs.io/docs/usage/polyfill/)，我们可以简单地：\n\n``` bash\nnpm i --save babel-polyfill\n```\n并`import`它，以便将其包含在我们的主包中：\n\n__src/index.js__\n\n``` diff\n+ import 'babel-polyfill';\n+\n  function component() {\n    var element = document.createElement('div');\n\n    element.innerHTML = join(['Hello', 'webpack'], ' ');\n\n    return element;\n  }\n\n  document.body.appendChild(component());\n```\n\nT>请注意，我们没有将`import`绑定到变量。这是因为腻子只能在其他代码前自行运行。才能允许我们假设某些本机功能存在。\n\n__但是把腻子包括到主包中这种做法并不推荐__，因为这样会让现代浏览器用户下载过多不必要的脚本，降低用户体验。\n\n现在我们删除 `import` 并且添加一个新的腻子 [`whatwg-fetch`](https://github.com/github/fetch) ：\n\n``` bash\nnpm i --save whatwg-fetch\n```\n\n__src/index.js__\n\n``` diff\n- import 'babel-polyfill';\n-\n  function component() {\n    var element = document.createElement('div');\n\n    element.innerHTML = join(['Hello', 'webpack'], ' ');\n\n    return element;\n  }\n\n  document.body.appendChild(component());\n```\n\n__project__\n\n``` diff\n  webpack-demo\n  |- package.json\n  |- webpack.config.js\n  |- /dist\n  |- /src\n    |- index.js\n    |- globals.js\n+   |- polyfills.js\n  |- /node_modules\n```\n\n__src/polyfills.js__\n\n```javascript\nimport 'babel-polyfill';\nimport 'whatwg-fetch';\n```\n\n__webpack.config.js__\n\n``` diff\n  const path = require('path');\n\n  module.exports = {\n-   entry: './src/index.js',\n+   entry: {\n+     polyfills: './src/polyfills.js',\n+     index: './src/index.js'\n+   },\n    output: {\n-     filename: 'bundle.js',\n+     filename: '[name].bundle.js',\n      path: path.resolve(__dirname, 'dist')\n    },\n    module: {\n      rules: [\n        {\n          test: require.resolve('index.js'),\n          use: 'imports-loader?this=>window'\n        },\n        {\n          test: require.resolve('globals.js'),\n          use: 'exports-loader?file,parse=helpers.parse'\n        }\n      ]\n    },\n    plugins: [\n      new webpack.ProvidePlugin({\n        join: ['lodash', 'join']\n      })\n    ]\n  };\n```\n有了这个，我们可以添加逻辑来有条件地加载我们的新的 `polyfills.bundle.js` 文件。您如何做出这一决定取决于您需要支持的技术和浏览器。我们将做一些简单的测试来确定我们的腻子是否需要：\n\n__dist/index.html__\n\n``` diff\n  <html>\n    <head>\n      <title>Getting Started</title>\n+     <script>\n+       var modernBrowser = (\n+         'fetch' in window &&\n+         'assign' in Object\n+       );\n+\n+       if ( !modernBrowser ) {\n+         var scriptElement = document.createElement('script');\n+\n+         scriptElement.async = false;\n+         scriptElement.src = '/polyfills.bundle.js';\n+         document.head.appendChild(scriptElement);\n+       }\n+     </script>\n    </head>\n    <body>\n      <script src=\"index.bundle.js\"></script>\n    </body>\n  </html>\n```\n\nNow we can `fetch` some data within our entry script:\n\n__src/index.js__\n\n``` diff\n  function component() {\n    var element = document.createElement('div');\n\n    element.innerHTML = join(['Hello', 'webpack'], ' ');\n\n    return element;\n  }\n\n  document.body.appendChild(component());\n+\n+ fetch('https://jsonplaceholder.typicode.com/users')\n+   .then(response => response.json())\n+   .then(json => {\n+     console.log('We retrieved some data! AND we\\'re confident it will work on a variety of browser distributions.')\n+     console.log(json)\n+   })\n+   .catch(error => console.error('Something went wrong when fetching this data: ', error))\n```\n\n如果我们运行build，将会生成一个 `polyfills.bundle.js` 文件，并且浏览器中的所有内容都应该顺利运行。请注意，这种设置可能会得到改善，因为这只是解决如何把腻子只提供给真正需要它们的用户的一种方法。\n\n## 进一步的优化\n\n`babel-preset-env` 包则是通过一个 [browserslist](https://github.com/ai/browserslist)来匹配你浏览器，并且转码你浏览器所不支持的的代码。通过`useBuiltIns` 选项进行预设，默认为 `false`，通过 `import` 的方法导入更细粒度的功能来覆盖你的全局 `babel-polyfill`配置：\n\n``` js\nimport 'core-js/modules/es7.string.pad-start';\nimport 'core-js/modules/es7.string.pad-end';\nimport 'core-js/modules/web.timers';\nimport 'core-js/modules/web.immediate';\nimport 'core-js/modules/web.dom.iterable';\n```\n有关详细信息，请参阅[知识库](https://github.com/babel/babel-preset-env)。\n\n\n## Node的内部插件\n\nNode的内部插件，比如 `process` 能够根据您的配置文件直接打腻子，而无需使用任何特殊的loaders或插件。 查看[node配置页面](/configuration/node)，那里有过多的信息和事例。\n\n\n## 其它\n\n在处理传统模块时，还有一些其他工具可以帮助您。\n\n[`script-loader`](/loaders/script-loader/)能够评估你的全局上下文的代码。作用类似于一个 `script` 的标签容器。在这种模式下，每个正常的库都应该工作。`require`、`module` 等等未被定义。\n\nW>当使用 `script-loader` 时，将该模块作为字符串添加到捆绑包中。它不会被 `webpack` 最小化，所以请使用最小化的版本。对于这个加载器添加的库，也么有 `devtool` 支持。\n\n当没有AMD/CommonJS版本的模块，并且您想要包括到 `dist` 中去，你可以在 [`noParse`](/configuration/module/#module-noparse) 中标记这个模块。他将告诉webpack引用这个模块不需要匹配或分析 `require()` 和  `import` 语法。这种做法也用于提高构建性能。\n\nW> 任何需要AST的功能， 例如 `ProvidePlugin`，将不再工作。\n\n最后，有一些模块支持不同的 [模块风格](/concepts/modules)，如AMD，CommonJS和传统。在大多数情况下，他们首先检查 `define`，然后使用一些古怪的代码来导出属性。在这种情况下，可以通过 [`imports-loader`](/loaders/imports-loader/) 设置 `define=>false` 来强制导入CommonJS路径。\n\n***\n\n> 原文：https://webpack.js.org/guides/shimming/\n\n","slug":"webpack的shimming的翻译","published":1,"updated":"2019-02-20T02:50:38.609Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjsgue0ew000ygpi6cd4vh61n","content":"<p>webpack编译器可以理解写入的ES2015模块，CommonJS或AMD的模块。然而，一些第三方库可能会期望全局依赖（例如jQuery的$）。这些库可能还会创建需要导出的全局变量。这些“broken modules”使得shimming发挥了作用。</p>\n<p>W&gt; <strong>我们不建议使用全局变量！</strong> Webpack真正的概念是更多的模块化前端开发。这意味着编写完整包含的隔离模块，而不依赖于隐藏的依赖关系（例如全局变量）。所以请仅在必要时去主要做。</p>\n<p><em>shimming</em> 的另一个使用场景就是，如果您希望使用浏览器的<a href=\"https://en.wikipedia.org/wiki/Polyfill\" target=\"_blank\" rel=\"external\">polyfill</a>功能来支持更多的用户。在这种情况下，您可能只想将这些Polyfill提供给需要修补的浏览器（即按需加载）。<a id=\"more\"></a></p>\n<p>以下文章将介绍这两种用例。</p>\n<p>T&gt;为了简单起见，本指南源于“<a href=\"/guides/getting-started\">Getting Started</a>”中的示例。请确保您在移动之前熟悉该设置。</p>\n<h2 id=\"垫片全局变量\"><a href=\"#垫片全局变量\" class=\"headerlink\" title=\"垫片全局变量\"></a>垫片全局变量</h2><p>我们从第一个使用shimming的全局变量的用例开始。在我们做任何事情之前，我们再来看看我们的项目：</p>\n<p><strong>project</strong></p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">webpack-demo</span><br><span class=\"line\">|- package.json</span><br><span class=\"line\">|- webpack.config.js</span><br><span class=\"line\">|- /dist</span><br><span class=\"line\">|- /src</span><br><span class=\"line\">  |- index.js</span><br><span class=\"line\">|- /node_modules</span><br></pre></td></tr></table></figure>\n<p>记得我们在使用 <code>lodash</code> ？为了演示目的，我们假设希望在整个应用程序中lodash要作为全局变量。为此我们可以使用<code>ProvidePlugin</code>插件。</p>\n<p><a href=\"/plugins/provide-plugin\"><code>ProvidePlugin</code></a> 使用WebPACK变量的形式使包可以在每个模块编译通过。 如果WebPACK看到变量被使用，它将在最后一个bundle中引入指定的包。下面我们取消 <code>import</code> 改用插件的方式来提供 <code>lodash</code>:</p>\n<p><strong>src/index.js</strong></p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"deletion\">- import _ from 'lodash';</span></span><br><span class=\"line\"><span class=\"deletion\">-</span></span><br><span class=\"line\">  function component() &#123;</span><br><span class=\"line\">    var element = document.createElement('div');</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"deletion\">-   // Lodash, now imported by this script</span></span><br><span class=\"line\">    element.innerHTML = _.join(['Hello', 'webpack'], ' ');</span><br><span class=\"line\"></span><br><span class=\"line\">    return element;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  document.body.appendChild(component());</span><br></pre></td></tr></table></figure>\n<p><strong>webpack.config.js</strong></p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  const path = require('path');</span><br><span class=\"line\"></span><br><span class=\"line\">  module.exports = &#123;</span><br><span class=\"line\">    entry: './src/index.js',</span><br><span class=\"line\">    output: &#123;</span><br><span class=\"line\">      filename: 'bundle.js',</span><br><span class=\"line\">      path: path.resolve(__dirname, 'dist')</span><br><span class=\"line\"><span class=\"deletion\">-   &#125;</span></span><br><span class=\"line\"><span class=\"addition\">+   &#125;,</span></span><br><span class=\"line\"><span class=\"addition\">+   plugins: [</span></span><br><span class=\"line\"><span class=\"addition\">+     new webpack.ProvidePlugin(&#123;</span></span><br><span class=\"line\"><span class=\"addition\">+       lodash: 'lodash'</span></span><br><span class=\"line\"><span class=\"addition\">+     &#125;)</span></span><br><span class=\"line\"><span class=\"addition\">+   ]</span></span><br><span class=\"line\">  &#125;;</span><br></pre></td></tr></table></figure>\n<p>以上就是对webpack的配置…</p>\n<blockquote>\n<p>一旦你引用了一次 <code>lodash</code>的实例变量，引入<code>lodash</code> 包并且提供给需要他的模块。</p>\n</blockquote>\n<p>如果我们运行 build ，我们将看到同样的输出：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">TODO: Include output</span><br></pre></td></tr></table></figure>\n<p>我们还可以使用 <code>ProvidePlugin</code> 通过使用路径数组（路径数组机构如下：<code>[module, child, ...children?]</code>）来配置模块的单个导出。所以让我们想想一下，如果 <code>lodash</code> 的 <code>join</code> 被调用的时候，我们只需要输出这一个方法：<br> So let’s imagine we only wanted to provide the <code>join</code> method from <code>lodash</code> wherever it’s invoked:</p>\n<p><strong>src/index.js</strong></p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  function component() &#123;</span><br><span class=\"line\">    var element = document.createElement('div');</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"deletion\">-   element.innerHTML = _.join(['Hello', 'webpack'], ' ');</span></span><br><span class=\"line\"><span class=\"addition\">+   element.innerHTML = join(['Hello', 'webpack'], ' ');</span></span><br><span class=\"line\"></span><br><span class=\"line\">    return element;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  document.body.appendChild(component());</span><br></pre></td></tr></table></figure>\n<p><strong>webpack.config.js</strong></p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  const path = require('path');</span><br><span class=\"line\"></span><br><span class=\"line\">  module.exports = &#123;</span><br><span class=\"line\">    entry: './src/index.js',</span><br><span class=\"line\">    output: &#123;</span><br><span class=\"line\">      filename: 'bundle.js',</span><br><span class=\"line\">      path: path.resolve(__dirname, 'dist')</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    plugins: [</span><br><span class=\"line\">      new webpack.ProvidePlugin(&#123;</span><br><span class=\"line\"><span class=\"deletion\">-       lodash: 'lodash'</span></span><br><span class=\"line\"><span class=\"addition\">+       join: ['lodash', 'join']</span></span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;;</span><br></pre></td></tr></table></figure>\n<p>通过 <a href=\"/guides/tree-shaking\">Tree Shaking</a> <code>lodash</code>库的其他部分将被优雅的舍去。</p>\n<h2 id=\"局部垫片\"><a href=\"#局部垫片\" class=\"headerlink\" title=\"局部垫片\"></a>局部垫片</h2><p>一些传统模块依赖于 <code>window</code> 对象。更新我们的<code>index.js</code>，作为事例：</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  function component() &#123;</span><br><span class=\"line\">    var element = document.createElement('div');</span><br><span class=\"line\"></span><br><span class=\"line\">    element.innerHTML = join(['Hello', 'webpack'], ' ');</span><br><span class=\"line\"><span class=\"addition\">+</span></span><br><span class=\"line\"><span class=\"addition\">+   // Assume we are in the context of `window`</span></span><br><span class=\"line\"><span class=\"addition\">+   this.alert('Hmmm, this probably isn\\'t a great idea...')</span></span><br><span class=\"line\"></span><br><span class=\"line\">    return element;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  document.body.appendChild(component());</span><br></pre></td></tr></table></figure>\n<p>现在有一个问题，当模块在CommonJS上下文中执行时，<code>this</code> 等于 <code>module.exports</code>。在这个事例中我们将使用 <a href=\"/loaders/imports-loader/\"><code>imports-loader</code></a> 来替换 <code>this</code> ：</p>\n<p><strong>webpack.config.js</strong></p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  const path = require('path');</span><br><span class=\"line\"></span><br><span class=\"line\">  module.exports = &#123;</span><br><span class=\"line\">    entry: './src/index.js',</span><br><span class=\"line\">    output: &#123;</span><br><span class=\"line\">      filename: 'bundle.js',</span><br><span class=\"line\">      path: path.resolve(__dirname, 'dist')</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"><span class=\"addition\">+   module: &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+     rules: [</span></span><br><span class=\"line\"><span class=\"addition\">+       &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+         test: require.resolve('index.js'),</span></span><br><span class=\"line\"><span class=\"addition\">+         use: 'imports-loader?this=&gt;window'</span></span><br><span class=\"line\"><span class=\"addition\">+       &#125;</span></span><br><span class=\"line\"><span class=\"addition\">+     ]</span></span><br><span class=\"line\"><span class=\"addition\">+   &#125;,</span></span><br><span class=\"line\">    plugins: [</span><br><span class=\"line\">      new webpack.ProvidePlugin(&#123;</span><br><span class=\"line\">        join: ['lodash', 'join']</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;;</span><br></pre></td></tr></table></figure>\n<h2 id=\"全局变量的导出\"><a href=\"#全局变量的导出\" class=\"headerlink\" title=\"全局变量的导出\"></a>全局变量的导出</h2><p>我们通常会创建一个充满了全局变量的库。我们可以在我们的设置中添加一个小模块来演示这个：</p>\n<p><strong>project</strong></p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  webpack-demo</span><br><span class=\"line\">  |- package.json</span><br><span class=\"line\">  |- webpack.config.js</span><br><span class=\"line\">  |- /dist</span><br><span class=\"line\">  |- /src</span><br><span class=\"line\">    |- index.js</span><br><span class=\"line\"><span class=\"addition\">+   |- globals.js</span></span><br><span class=\"line\">  |- /node_modules</span><br></pre></td></tr></table></figure>\n<p><strong>src/globals.js</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> file = <span class=\"string\">'blah.txt'</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> helpers = &#123;</span><br><span class=\"line\">  <span class=\"attr\">test</span>: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123; <span class=\"built_in\">console</span>.log(<span class=\"string\">'test something'</span>); &#125;,</span><br><span class=\"line\">  <span class=\"attr\">parse</span>: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123; <span class=\"built_in\">console</span>.log(<span class=\"string\">'parse something'</span>); &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>现在，你可能永远不会在自己的代码中如此操作，但是你可能会遇到要使用一下已过时的库，其中包含与上述相似的代码。在这种情况下，我们可以使用 <a href=\"/loaders/exports-loader/\"><code>exports-loader</code></a> 将该全局变量像一般模块那样导出。例如，将 <code>file</code> 导出为 <code>file</code>，<code>helpers.parse</code> 导出为 <code>parse</code>：</p>\n<p><strong>webpack.config.js</strong></p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  const path = require('path');</span><br><span class=\"line\"></span><br><span class=\"line\">  module.exports = &#123;</span><br><span class=\"line\">    entry: './src/index.js',</span><br><span class=\"line\">    output: &#123;</span><br><span class=\"line\">      filename: 'bundle.js',</span><br><span class=\"line\">      path: path.resolve(__dirname, 'dist')</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    module: &#123;</span><br><span class=\"line\">      rules: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          test: require.resolve('index.js'),</span><br><span class=\"line\">          use: 'imports-loader?this=&gt;window'</span><br><span class=\"line\"><span class=\"deletion\">-       &#125;</span></span><br><span class=\"line\"><span class=\"addition\">+       &#125;,</span></span><br><span class=\"line\"><span class=\"addition\">+       &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+         test: require.resolve('globals.js'),</span></span><br><span class=\"line\"><span class=\"addition\">+         use: 'exports-loader?file,parse=helpers.parse'</span></span><br><span class=\"line\"><span class=\"addition\">+       &#125;</span></span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    plugins: [</span><br><span class=\"line\">      new webpack.ProvidePlugin(&#123;</span><br><span class=\"line\">        join: ['lodash', 'join']</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;;</span><br></pre></td></tr></table></figure>\n<p>现在从我们的入口脚本（即 <code>src/index.js</code>）中，<code>import { file, parse } from &#39;./globals.js&#39;;</code> 都应该顺利进行。</p>\n<h2 id=\"加载腻子\"><a href=\"#加载腻子\" class=\"headerlink\" title=\"加载腻子\"></a>加载腻子</h2><p>到目前为止，我们讨论的几乎所有内容都与处理传统包有关。我们继续谈谈我们的第二个话题： <strong>腻子</strong>。</p>\n<p>有很多方法来加载腻子. 例如，要包括 <a href=\"https://babeljs.io/docs/usage/polyfill/\" target=\"_blank\" rel=\"external\"><code>babel-polyfill</code></a>，我们可以简单地：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm i --save babel-polyfill</span><br></pre></td></tr></table></figure>\n<p>并<code>import</code>它，以便将其包含在我们的主包中：</p>\n<p><strong>src/index.js</strong></p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"addition\">+ import 'babel-polyfill';</span></span><br><span class=\"line\"><span class=\"addition\">+</span></span><br><span class=\"line\">  function component() &#123;</span><br><span class=\"line\">    var element = document.createElement('div');</span><br><span class=\"line\"></span><br><span class=\"line\">    element.innerHTML = join(['Hello', 'webpack'], ' ');</span><br><span class=\"line\"></span><br><span class=\"line\">    return element;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  document.body.appendChild(component());</span><br></pre></td></tr></table></figure>\n<p>T&gt;请注意，我们没有将<code>import</code>绑定到变量。这是因为腻子只能在其他代码前自行运行。才能允许我们假设某些本机功能存在。</p>\n<p><strong>但是把腻子包括到主包中这种做法并不推荐</strong>，因为这样会让现代浏览器用户下载过多不必要的脚本，降低用户体验。</p>\n<p>现在我们删除 <code>import</code> 并且添加一个新的腻子 <a href=\"https://github.com/github/fetch\" target=\"_blank\" rel=\"external\"><code>whatwg-fetch</code></a> ：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm i --save whatwg-fetch</span><br></pre></td></tr></table></figure>\n<p><strong>src/index.js</strong></p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"deletion\">- import 'babel-polyfill';</span></span><br><span class=\"line\"><span class=\"deletion\">-</span></span><br><span class=\"line\">  function component() &#123;</span><br><span class=\"line\">    var element = document.createElement('div');</span><br><span class=\"line\"></span><br><span class=\"line\">    element.innerHTML = join(['Hello', 'webpack'], ' ');</span><br><span class=\"line\"></span><br><span class=\"line\">    return element;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  document.body.appendChild(component());</span><br></pre></td></tr></table></figure>\n<p><strong>project</strong></p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  webpack-demo</span><br><span class=\"line\">  |- package.json</span><br><span class=\"line\">  |- webpack.config.js</span><br><span class=\"line\">  |- /dist</span><br><span class=\"line\">  |- /src</span><br><span class=\"line\">    |- index.js</span><br><span class=\"line\">    |- globals.js</span><br><span class=\"line\"><span class=\"addition\">+   |- polyfills.js</span></span><br><span class=\"line\">  |- /node_modules</span><br></pre></td></tr></table></figure>\n<p><strong>src/polyfills.js</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'babel-polyfill'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'whatwg-fetch'</span>;</span><br></pre></td></tr></table></figure>\n<p><strong>webpack.config.js</strong></p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  const path = require('path');</span><br><span class=\"line\"></span><br><span class=\"line\">  module.exports = &#123;</span><br><span class=\"line\"><span class=\"deletion\">-   entry: './src/index.js',</span></span><br><span class=\"line\"><span class=\"addition\">+   entry: &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+     polyfills: './src/polyfills.js',</span></span><br><span class=\"line\"><span class=\"addition\">+     index: './src/index.js'</span></span><br><span class=\"line\"><span class=\"addition\">+   &#125;,</span></span><br><span class=\"line\">    output: &#123;</span><br><span class=\"line\"><span class=\"deletion\">-     filename: 'bundle.js',</span></span><br><span class=\"line\"><span class=\"addition\">+     filename: '[name].bundle.js',</span></span><br><span class=\"line\">      path: path.resolve(__dirname, 'dist')</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    module: &#123;</span><br><span class=\"line\">      rules: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          test: require.resolve('index.js'),</span><br><span class=\"line\">          use: 'imports-loader?this=&gt;window'</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          test: require.resolve('globals.js'),</span><br><span class=\"line\">          use: 'exports-loader?file,parse=helpers.parse'</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    plugins: [</span><br><span class=\"line\">      new webpack.ProvidePlugin(&#123;</span><br><span class=\"line\">        join: ['lodash', 'join']</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;;</span><br></pre></td></tr></table></figure>\n<p>有了这个，我们可以添加逻辑来有条件地加载我们的新的 <code>polyfills.bundle.js</code> 文件。您如何做出这一决定取决于您需要支持的技术和浏览器。我们将做一些简单的测试来确定我们的腻子是否需要：</p>\n<p><strong>dist/index.html</strong></p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  &lt;html&gt;</span><br><span class=\"line\">    &lt;head&gt;</span><br><span class=\"line\">      &lt;title&gt;Getting Started&lt;/title&gt;</span><br><span class=\"line\"><span class=\"addition\">+     &lt;script&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+       var modernBrowser = (</span></span><br><span class=\"line\"><span class=\"addition\">+         'fetch' in window &amp;&amp;</span></span><br><span class=\"line\"><span class=\"addition\">+         'assign' in Object</span></span><br><span class=\"line\"><span class=\"addition\">+       );</span></span><br><span class=\"line\"><span class=\"addition\">+</span></span><br><span class=\"line\"><span class=\"addition\">+       if ( !modernBrowser ) &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+         var scriptElement = document.createElement('script');</span></span><br><span class=\"line\"><span class=\"addition\">+</span></span><br><span class=\"line\"><span class=\"addition\">+         scriptElement.async = false;</span></span><br><span class=\"line\"><span class=\"addition\">+         scriptElement.src = '/polyfills.bundle.js';</span></span><br><span class=\"line\"><span class=\"addition\">+         document.head.appendChild(scriptElement);</span></span><br><span class=\"line\"><span class=\"addition\">+       &#125;</span></span><br><span class=\"line\"><span class=\"addition\">+     &lt;/script&gt;</span></span><br><span class=\"line\">    &lt;/head&gt;</span><br><span class=\"line\">    &lt;body&gt;</span><br><span class=\"line\">      &lt;script src=\"index.bundle.js\"&gt;&lt;/script&gt;</span><br><span class=\"line\">    &lt;/body&gt;</span><br><span class=\"line\">  &lt;/html&gt;</span><br></pre></td></tr></table></figure>\n<p>Now we can <code>fetch</code> some data within our entry script:</p>\n<p><strong>src/index.js</strong></p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  function component() &#123;</span><br><span class=\"line\">    var element = document.createElement('div');</span><br><span class=\"line\"></span><br><span class=\"line\">    element.innerHTML = join(['Hello', 'webpack'], ' ');</span><br><span class=\"line\"></span><br><span class=\"line\">    return element;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  document.body.appendChild(component());</span><br><span class=\"line\"><span class=\"addition\">+</span></span><br><span class=\"line\"><span class=\"addition\">+ fetch('https://jsonplaceholder.typicode.com/users')</span></span><br><span class=\"line\"><span class=\"addition\">+   .then(response =&gt; response.json())</span></span><br><span class=\"line\"><span class=\"addition\">+   .then(json =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+     console.log('We retrieved some data! AND we\\'re confident it will work on a variety of browser distributions.')</span></span><br><span class=\"line\"><span class=\"addition\">+     console.log(json)</span></span><br><span class=\"line\"><span class=\"addition\">+   &#125;)</span></span><br><span class=\"line\"><span class=\"addition\">+   .catch(error =&gt; console.error('Something went wrong when fetching this data: ', error))</span></span><br></pre></td></tr></table></figure>\n<p>如果我们运行build，将会生成一个 <code>polyfills.bundle.js</code> 文件，并且浏览器中的所有内容都应该顺利运行。请注意，这种设置可能会得到改善，因为这只是解决如何把腻子只提供给真正需要它们的用户的一种方法。</p>\n<h2 id=\"进一步的优化\"><a href=\"#进一步的优化\" class=\"headerlink\" title=\"进一步的优化\"></a>进一步的优化</h2><p><code>babel-preset-env</code> 包则是通过一个 <a href=\"https://github.com/ai/browserslist\" target=\"_blank\" rel=\"external\">browserslist</a>来匹配你浏览器，并且转码你浏览器所不支持的的代码。通过<code>useBuiltIns</code> 选项进行预设，默认为 <code>false</code>，通过 <code>import</code> 的方法导入更细粒度的功能来覆盖你的全局 <code>babel-polyfill</code>配置：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'core-js/modules/es7.string.pad-start'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'core-js/modules/es7.string.pad-end'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'core-js/modules/web.timers'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'core-js/modules/web.immediate'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'core-js/modules/web.dom.iterable'</span>;</span><br></pre></td></tr></table></figure>\n<p>有关详细信息，请参阅<a href=\"https://github.com/babel/babel-preset-env\" target=\"_blank\" rel=\"external\">知识库</a>。</p>\n<h2 id=\"Node的内部插件\"><a href=\"#Node的内部插件\" class=\"headerlink\" title=\"Node的内部插件\"></a>Node的内部插件</h2><p>Node的内部插件，比如 <code>process</code> 能够根据您的配置文件直接打腻子，而无需使用任何特殊的loaders或插件。 查看<a href=\"/configuration/node\">node配置页面</a>，那里有过多的信息和事例。</p>\n<h2 id=\"其它\"><a href=\"#其它\" class=\"headerlink\" title=\"其它\"></a>其它</h2><p>在处理传统模块时，还有一些其他工具可以帮助您。</p>\n<p><a href=\"/loaders/script-loader/\"><code>script-loader</code></a>能够评估你的全局上下文的代码。作用类似于一个 <code>script</code> 的标签容器。在这种模式下，每个正常的库都应该工作。<code>require</code>、<code>module</code> 等等未被定义。</p>\n<p>W&gt;当使用 <code>script-loader</code> 时，将该模块作为字符串添加到捆绑包中。它不会被 <code>webpack</code> 最小化，所以请使用最小化的版本。对于这个加载器添加的库，也么有 <code>devtool</code> 支持。</p>\n<p>当没有AMD/CommonJS版本的模块，并且您想要包括到 <code>dist</code> 中去，你可以在 <a href=\"/configuration/module/#module-noparse\"><code>noParse</code></a> 中标记这个模块。他将告诉webpack引用这个模块不需要匹配或分析 <code>require()</code> 和  <code>import</code> 语法。这种做法也用于提高构建性能。</p>\n<p>W&gt; 任何需要AST的功能， 例如 <code>ProvidePlugin</code>，将不再工作。</p>\n<p>最后，有一些模块支持不同的 <a href=\"/concepts/modules\">模块风格</a>，如AMD，CommonJS和传统。在大多数情况下，他们首先检查 <code>define</code>，然后使用一些古怪的代码来导出属性。在这种情况下，可以通过 <a href=\"/loaders/imports-loader/\"><code>imports-loader</code></a> 设置 <code>define=&gt;false</code> 来强制导入CommonJS路径。</p>\n<hr>\n<blockquote>\n<p>原文：<a href=\"https://webpack.js.org/guides/shimming/\" target=\"_blank\" rel=\"external\">https://webpack.js.org/guides/shimming/</a></p>\n</blockquote>\n","excerpt":"<p>webpack编译器可以理解写入的ES2015模块，CommonJS或AMD的模块。然而，一些第三方库可能会期望全局依赖（例如jQuery的$）。这些库可能还会创建需要导出的全局变量。这些“broken modules”使得shimming发挥了作用。</p>\n<p>W&gt; <strong>我们不建议使用全局变量！</strong> Webpack真正的概念是更多的模块化前端开发。这意味着编写完整包含的隔离模块，而不依赖于隐藏的依赖关系（例如全局变量）。所以请仅在必要时去主要做。</p>\n<p><em>shimming</em> 的另一个使用场景就是，如果您希望使用浏览器的<a href=\"https://en.wikipedia.org/wiki/Polyfill\">polyfill</a>功能来支持更多的用户。在这种情况下，您可能只想将这些Polyfill提供给需要修补的浏览器（即按需加载）。","more":"</p>\n<p>以下文章将介绍这两种用例。</p>\n<p>T&gt;为了简单起见，本指南源于“<a href=\"/guides/getting-started\">Getting Started</a>”中的示例。请确保您在移动之前熟悉该设置。</p>\n<h2 id=\"垫片全局变量\"><a href=\"#垫片全局变量\" class=\"headerlink\" title=\"垫片全局变量\"></a>垫片全局变量</h2><p>我们从第一个使用shimming的全局变量的用例开始。在我们做任何事情之前，我们再来看看我们的项目：</p>\n<p><strong>project</strong></p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">webpack-demo</span><br><span class=\"line\">|- package.json</span><br><span class=\"line\">|- webpack.config.js</span><br><span class=\"line\">|- /dist</span><br><span class=\"line\">|- /src</span><br><span class=\"line\">  |- index.js</span><br><span class=\"line\">|- /node_modules</span><br></pre></td></tr></table></figure>\n<p>记得我们在使用 <code>lodash</code> ？为了演示目的，我们假设希望在整个应用程序中lodash要作为全局变量。为此我们可以使用<code>ProvidePlugin</code>插件。</p>\n<p><a href=\"/plugins/provide-plugin\"><code>ProvidePlugin</code></a> 使用WebPACK变量的形式使包可以在每个模块编译通过。 如果WebPACK看到变量被使用，它将在最后一个bundle中引入指定的包。下面我们取消 <code>import</code> 改用插件的方式来提供 <code>lodash</code>:</p>\n<p><strong>src/index.js</strong></p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"deletion\">- import _ from 'lodash';</span></span><br><span class=\"line\"><span class=\"deletion\">-</span></span><br><span class=\"line\">  function component() &#123;</span><br><span class=\"line\">    var element = document.createElement('div');</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"deletion\">-   // Lodash, now imported by this script</span></span><br><span class=\"line\">    element.innerHTML = _.join(['Hello', 'webpack'], ' ');</span><br><span class=\"line\"></span><br><span class=\"line\">    return element;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  document.body.appendChild(component());</span><br></pre></td></tr></table></figure>\n<p><strong>webpack.config.js</strong></p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  const path = require('path');</span><br><span class=\"line\"></span><br><span class=\"line\">  module.exports = &#123;</span><br><span class=\"line\">    entry: './src/index.js',</span><br><span class=\"line\">    output: &#123;</span><br><span class=\"line\">      filename: 'bundle.js',</span><br><span class=\"line\">      path: path.resolve(__dirname, 'dist')</span><br><span class=\"line\"><span class=\"deletion\">-   &#125;</span></span><br><span class=\"line\"><span class=\"addition\">+   &#125;,</span></span><br><span class=\"line\"><span class=\"addition\">+   plugins: [</span></span><br><span class=\"line\"><span class=\"addition\">+     new webpack.ProvidePlugin(&#123;</span></span><br><span class=\"line\"><span class=\"addition\">+       lodash: 'lodash'</span></span><br><span class=\"line\"><span class=\"addition\">+     &#125;)</span></span><br><span class=\"line\"><span class=\"addition\">+   ]</span></span><br><span class=\"line\">  &#125;;</span><br></pre></td></tr></table></figure>\n<p>以上就是对webpack的配置…</p>\n<blockquote>\n<p>一旦你引用了一次 <code>lodash</code>的实例变量，引入<code>lodash</code> 包并且提供给需要他的模块。</p>\n</blockquote>\n<p>如果我们运行 build ，我们将看到同样的输出：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">TODO: Include output</span><br></pre></td></tr></table></figure>\n<p>我们还可以使用 <code>ProvidePlugin</code> 通过使用路径数组（路径数组机构如下：<code>[module, child, ...children?]</code>）来配置模块的单个导出。所以让我们想想一下，如果 <code>lodash</code> 的 <code>join</code> 被调用的时候，我们只需要输出这一个方法：<br> So let’s imagine we only wanted to provide the <code>join</code> method from <code>lodash</code> wherever it’s invoked:</p>\n<p><strong>src/index.js</strong></p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  function component() &#123;</span><br><span class=\"line\">    var element = document.createElement('div');</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"deletion\">-   element.innerHTML = _.join(['Hello', 'webpack'], ' ');</span></span><br><span class=\"line\"><span class=\"addition\">+   element.innerHTML = join(['Hello', 'webpack'], ' ');</span></span><br><span class=\"line\"></span><br><span class=\"line\">    return element;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  document.body.appendChild(component());</span><br></pre></td></tr></table></figure>\n<p><strong>webpack.config.js</strong></p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  const path = require('path');</span><br><span class=\"line\"></span><br><span class=\"line\">  module.exports = &#123;</span><br><span class=\"line\">    entry: './src/index.js',</span><br><span class=\"line\">    output: &#123;</span><br><span class=\"line\">      filename: 'bundle.js',</span><br><span class=\"line\">      path: path.resolve(__dirname, 'dist')</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    plugins: [</span><br><span class=\"line\">      new webpack.ProvidePlugin(&#123;</span><br><span class=\"line\"><span class=\"deletion\">-       lodash: 'lodash'</span></span><br><span class=\"line\"><span class=\"addition\">+       join: ['lodash', 'join']</span></span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;;</span><br></pre></td></tr></table></figure>\n<p>通过 <a href=\"/guides/tree-shaking\">Tree Shaking</a> <code>lodash</code>库的其他部分将被优雅的舍去。</p>\n<h2 id=\"局部垫片\"><a href=\"#局部垫片\" class=\"headerlink\" title=\"局部垫片\"></a>局部垫片</h2><p>一些传统模块依赖于 <code>window</code> 对象。更新我们的<code>index.js</code>，作为事例：</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  function component() &#123;</span><br><span class=\"line\">    var element = document.createElement('div');</span><br><span class=\"line\"></span><br><span class=\"line\">    element.innerHTML = join(['Hello', 'webpack'], ' ');</span><br><span class=\"line\"><span class=\"addition\">+</span></span><br><span class=\"line\"><span class=\"addition\">+   // Assume we are in the context of `window`</span></span><br><span class=\"line\"><span class=\"addition\">+   this.alert('Hmmm, this probably isn\\'t a great idea...')</span></span><br><span class=\"line\"></span><br><span class=\"line\">    return element;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  document.body.appendChild(component());</span><br></pre></td></tr></table></figure>\n<p>现在有一个问题，当模块在CommonJS上下文中执行时，<code>this</code> 等于 <code>module.exports</code>。在这个事例中我们将使用 <a href=\"/loaders/imports-loader/\"><code>imports-loader</code></a> 来替换 <code>this</code> ：</p>\n<p><strong>webpack.config.js</strong></p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  const path = require('path');</span><br><span class=\"line\"></span><br><span class=\"line\">  module.exports = &#123;</span><br><span class=\"line\">    entry: './src/index.js',</span><br><span class=\"line\">    output: &#123;</span><br><span class=\"line\">      filename: 'bundle.js',</span><br><span class=\"line\">      path: path.resolve(__dirname, 'dist')</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"><span class=\"addition\">+   module: &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+     rules: [</span></span><br><span class=\"line\"><span class=\"addition\">+       &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+         test: require.resolve('index.js'),</span></span><br><span class=\"line\"><span class=\"addition\">+         use: 'imports-loader?this=&gt;window'</span></span><br><span class=\"line\"><span class=\"addition\">+       &#125;</span></span><br><span class=\"line\"><span class=\"addition\">+     ]</span></span><br><span class=\"line\"><span class=\"addition\">+   &#125;,</span></span><br><span class=\"line\">    plugins: [</span><br><span class=\"line\">      new webpack.ProvidePlugin(&#123;</span><br><span class=\"line\">        join: ['lodash', 'join']</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;;</span><br></pre></td></tr></table></figure>\n<h2 id=\"全局变量的导出\"><a href=\"#全局变量的导出\" class=\"headerlink\" title=\"全局变量的导出\"></a>全局变量的导出</h2><p>我们通常会创建一个充满了全局变量的库。我们可以在我们的设置中添加一个小模块来演示这个：</p>\n<p><strong>project</strong></p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  webpack-demo</span><br><span class=\"line\">  |- package.json</span><br><span class=\"line\">  |- webpack.config.js</span><br><span class=\"line\">  |- /dist</span><br><span class=\"line\">  |- /src</span><br><span class=\"line\">    |- index.js</span><br><span class=\"line\"><span class=\"addition\">+   |- globals.js</span></span><br><span class=\"line\">  |- /node_modules</span><br></pre></td></tr></table></figure>\n<p><strong>src/globals.js</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> file = <span class=\"string\">'blah.txt'</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> helpers = &#123;</span><br><span class=\"line\">  <span class=\"attr\">test</span>: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123; <span class=\"built_in\">console</span>.log(<span class=\"string\">'test something'</span>); &#125;,</span><br><span class=\"line\">  <span class=\"attr\">parse</span>: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123; <span class=\"built_in\">console</span>.log(<span class=\"string\">'parse something'</span>); &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>现在，你可能永远不会在自己的代码中如此操作，但是你可能会遇到要使用一下已过时的库，其中包含与上述相似的代码。在这种情况下，我们可以使用 <a href=\"/loaders/exports-loader/\"><code>exports-loader</code></a> 将该全局变量像一般模块那样导出。例如，将 <code>file</code> 导出为 <code>file</code>，<code>helpers.parse</code> 导出为 <code>parse</code>：</p>\n<p><strong>webpack.config.js</strong></p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  const path = require('path');</span><br><span class=\"line\"></span><br><span class=\"line\">  module.exports = &#123;</span><br><span class=\"line\">    entry: './src/index.js',</span><br><span class=\"line\">    output: &#123;</span><br><span class=\"line\">      filename: 'bundle.js',</span><br><span class=\"line\">      path: path.resolve(__dirname, 'dist')</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    module: &#123;</span><br><span class=\"line\">      rules: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          test: require.resolve('index.js'),</span><br><span class=\"line\">          use: 'imports-loader?this=&gt;window'</span><br><span class=\"line\"><span class=\"deletion\">-       &#125;</span></span><br><span class=\"line\"><span class=\"addition\">+       &#125;,</span></span><br><span class=\"line\"><span class=\"addition\">+       &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+         test: require.resolve('globals.js'),</span></span><br><span class=\"line\"><span class=\"addition\">+         use: 'exports-loader?file,parse=helpers.parse'</span></span><br><span class=\"line\"><span class=\"addition\">+       &#125;</span></span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    plugins: [</span><br><span class=\"line\">      new webpack.ProvidePlugin(&#123;</span><br><span class=\"line\">        join: ['lodash', 'join']</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;;</span><br></pre></td></tr></table></figure>\n<p>现在从我们的入口脚本（即 <code>src/index.js</code>）中，<code>import { file, parse } from &#39;./globals.js&#39;;</code> 都应该顺利进行。</p>\n<h2 id=\"加载腻子\"><a href=\"#加载腻子\" class=\"headerlink\" title=\"加载腻子\"></a>加载腻子</h2><p>到目前为止，我们讨论的几乎所有内容都与处理传统包有关。我们继续谈谈我们的第二个话题： <strong>腻子</strong>。</p>\n<p>有很多方法来加载腻子. 例如，要包括 <a href=\"https://babeljs.io/docs/usage/polyfill/\"><code>babel-polyfill</code></a>，我们可以简单地：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm i --save babel-polyfill</span><br></pre></td></tr></table></figure>\n<p>并<code>import</code>它，以便将其包含在我们的主包中：</p>\n<p><strong>src/index.js</strong></p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"addition\">+ import 'babel-polyfill';</span></span><br><span class=\"line\"><span class=\"addition\">+</span></span><br><span class=\"line\">  function component() &#123;</span><br><span class=\"line\">    var element = document.createElement('div');</span><br><span class=\"line\"></span><br><span class=\"line\">    element.innerHTML = join(['Hello', 'webpack'], ' ');</span><br><span class=\"line\"></span><br><span class=\"line\">    return element;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  document.body.appendChild(component());</span><br></pre></td></tr></table></figure>\n<p>T&gt;请注意，我们没有将<code>import</code>绑定到变量。这是因为腻子只能在其他代码前自行运行。才能允许我们假设某些本机功能存在。</p>\n<p><strong>但是把腻子包括到主包中这种做法并不推荐</strong>，因为这样会让现代浏览器用户下载过多不必要的脚本，降低用户体验。</p>\n<p>现在我们删除 <code>import</code> 并且添加一个新的腻子 <a href=\"https://github.com/github/fetch\"><code>whatwg-fetch</code></a> ：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm i --save whatwg-fetch</span><br></pre></td></tr></table></figure>\n<p><strong>src/index.js</strong></p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"deletion\">- import 'babel-polyfill';</span></span><br><span class=\"line\"><span class=\"deletion\">-</span></span><br><span class=\"line\">  function component() &#123;</span><br><span class=\"line\">    var element = document.createElement('div');</span><br><span class=\"line\"></span><br><span class=\"line\">    element.innerHTML = join(['Hello', 'webpack'], ' ');</span><br><span class=\"line\"></span><br><span class=\"line\">    return element;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  document.body.appendChild(component());</span><br></pre></td></tr></table></figure>\n<p><strong>project</strong></p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  webpack-demo</span><br><span class=\"line\">  |- package.json</span><br><span class=\"line\">  |- webpack.config.js</span><br><span class=\"line\">  |- /dist</span><br><span class=\"line\">  |- /src</span><br><span class=\"line\">    |- index.js</span><br><span class=\"line\">    |- globals.js</span><br><span class=\"line\"><span class=\"addition\">+   |- polyfills.js</span></span><br><span class=\"line\">  |- /node_modules</span><br></pre></td></tr></table></figure>\n<p><strong>src/polyfills.js</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'babel-polyfill'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'whatwg-fetch'</span>;</span><br></pre></td></tr></table></figure>\n<p><strong>webpack.config.js</strong></p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  const path = require('path');</span><br><span class=\"line\"></span><br><span class=\"line\">  module.exports = &#123;</span><br><span class=\"line\"><span class=\"deletion\">-   entry: './src/index.js',</span></span><br><span class=\"line\"><span class=\"addition\">+   entry: &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+     polyfills: './src/polyfills.js',</span></span><br><span class=\"line\"><span class=\"addition\">+     index: './src/index.js'</span></span><br><span class=\"line\"><span class=\"addition\">+   &#125;,</span></span><br><span class=\"line\">    output: &#123;</span><br><span class=\"line\"><span class=\"deletion\">-     filename: 'bundle.js',</span></span><br><span class=\"line\"><span class=\"addition\">+     filename: '[name].bundle.js',</span></span><br><span class=\"line\">      path: path.resolve(__dirname, 'dist')</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    module: &#123;</span><br><span class=\"line\">      rules: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          test: require.resolve('index.js'),</span><br><span class=\"line\">          use: 'imports-loader?this=&gt;window'</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          test: require.resolve('globals.js'),</span><br><span class=\"line\">          use: 'exports-loader?file,parse=helpers.parse'</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    plugins: [</span><br><span class=\"line\">      new webpack.ProvidePlugin(&#123;</span><br><span class=\"line\">        join: ['lodash', 'join']</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;;</span><br></pre></td></tr></table></figure>\n<p>有了这个，我们可以添加逻辑来有条件地加载我们的新的 <code>polyfills.bundle.js</code> 文件。您如何做出这一决定取决于您需要支持的技术和浏览器。我们将做一些简单的测试来确定我们的腻子是否需要：</p>\n<p><strong>dist/index.html</strong></p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  &lt;html&gt;</span><br><span class=\"line\">    &lt;head&gt;</span><br><span class=\"line\">      &lt;title&gt;Getting Started&lt;/title&gt;</span><br><span class=\"line\"><span class=\"addition\">+     &lt;script&gt;</span></span><br><span class=\"line\"><span class=\"addition\">+       var modernBrowser = (</span></span><br><span class=\"line\"><span class=\"addition\">+         'fetch' in window &amp;&amp;</span></span><br><span class=\"line\"><span class=\"addition\">+         'assign' in Object</span></span><br><span class=\"line\"><span class=\"addition\">+       );</span></span><br><span class=\"line\"><span class=\"addition\">+</span></span><br><span class=\"line\"><span class=\"addition\">+       if ( !modernBrowser ) &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+         var scriptElement = document.createElement('script');</span></span><br><span class=\"line\"><span class=\"addition\">+</span></span><br><span class=\"line\"><span class=\"addition\">+         scriptElement.async = false;</span></span><br><span class=\"line\"><span class=\"addition\">+         scriptElement.src = '/polyfills.bundle.js';</span></span><br><span class=\"line\"><span class=\"addition\">+         document.head.appendChild(scriptElement);</span></span><br><span class=\"line\"><span class=\"addition\">+       &#125;</span></span><br><span class=\"line\"><span class=\"addition\">+     &lt;/script&gt;</span></span><br><span class=\"line\">    &lt;/head&gt;</span><br><span class=\"line\">    &lt;body&gt;</span><br><span class=\"line\">      &lt;script src=\"index.bundle.js\"&gt;&lt;/script&gt;</span><br><span class=\"line\">    &lt;/body&gt;</span><br><span class=\"line\">  &lt;/html&gt;</span><br></pre></td></tr></table></figure>\n<p>Now we can <code>fetch</code> some data within our entry script:</p>\n<p><strong>src/index.js</strong></p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  function component() &#123;</span><br><span class=\"line\">    var element = document.createElement('div');</span><br><span class=\"line\"></span><br><span class=\"line\">    element.innerHTML = join(['Hello', 'webpack'], ' ');</span><br><span class=\"line\"></span><br><span class=\"line\">    return element;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  document.body.appendChild(component());</span><br><span class=\"line\"><span class=\"addition\">+</span></span><br><span class=\"line\"><span class=\"addition\">+ fetch('https://jsonplaceholder.typicode.com/users')</span></span><br><span class=\"line\"><span class=\"addition\">+   .then(response =&gt; response.json())</span></span><br><span class=\"line\"><span class=\"addition\">+   .then(json =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+     console.log('We retrieved some data! AND we\\'re confident it will work on a variety of browser distributions.')</span></span><br><span class=\"line\"><span class=\"addition\">+     console.log(json)</span></span><br><span class=\"line\"><span class=\"addition\">+   &#125;)</span></span><br><span class=\"line\"><span class=\"addition\">+   .catch(error =&gt; console.error('Something went wrong when fetching this data: ', error))</span></span><br></pre></td></tr></table></figure>\n<p>如果我们运行build，将会生成一个 <code>polyfills.bundle.js</code> 文件，并且浏览器中的所有内容都应该顺利运行。请注意，这种设置可能会得到改善，因为这只是解决如何把腻子只提供给真正需要它们的用户的一种方法。</p>\n<h2 id=\"进一步的优化\"><a href=\"#进一步的优化\" class=\"headerlink\" title=\"进一步的优化\"></a>进一步的优化</h2><p><code>babel-preset-env</code> 包则是通过一个 <a href=\"https://github.com/ai/browserslist\">browserslist</a>来匹配你浏览器，并且转码你浏览器所不支持的的代码。通过<code>useBuiltIns</code> 选项进行预设，默认为 <code>false</code>，通过 <code>import</code> 的方法导入更细粒度的功能来覆盖你的全局 <code>babel-polyfill</code>配置：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'core-js/modules/es7.string.pad-start'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'core-js/modules/es7.string.pad-end'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'core-js/modules/web.timers'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'core-js/modules/web.immediate'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'core-js/modules/web.dom.iterable'</span>;</span><br></pre></td></tr></table></figure>\n<p>有关详细信息，请参阅<a href=\"https://github.com/babel/babel-preset-env\">知识库</a>。</p>\n<h2 id=\"Node的内部插件\"><a href=\"#Node的内部插件\" class=\"headerlink\" title=\"Node的内部插件\"></a>Node的内部插件</h2><p>Node的内部插件，比如 <code>process</code> 能够根据您的配置文件直接打腻子，而无需使用任何特殊的loaders或插件。 查看<a href=\"/configuration/node\">node配置页面</a>，那里有过多的信息和事例。</p>\n<h2 id=\"其它\"><a href=\"#其它\" class=\"headerlink\" title=\"其它\"></a>其它</h2><p>在处理传统模块时，还有一些其他工具可以帮助您。</p>\n<p><a href=\"/loaders/script-loader/\"><code>script-loader</code></a>能够评估你的全局上下文的代码。作用类似于一个 <code>script</code> 的标签容器。在这种模式下，每个正常的库都应该工作。<code>require</code>、<code>module</code> 等等未被定义。</p>\n<p>W&gt;当使用 <code>script-loader</code> 时，将该模块作为字符串添加到捆绑包中。它不会被 <code>webpack</code> 最小化，所以请使用最小化的版本。对于这个加载器添加的库，也么有 <code>devtool</code> 支持。</p>\n<p>当没有AMD/CommonJS版本的模块，并且您想要包括到 <code>dist</code> 中去，你可以在 <a href=\"/configuration/module/#module-noparse\"><code>noParse</code></a> 中标记这个模块。他将告诉webpack引用这个模块不需要匹配或分析 <code>require()</code> 和  <code>import</code> 语法。这种做法也用于提高构建性能。</p>\n<p>W&gt; 任何需要AST的功能， 例如 <code>ProvidePlugin</code>，将不再工作。</p>\n<p>最后，有一些模块支持不同的 <a href=\"/concepts/modules\">模块风格</a>，如AMD，CommonJS和传统。在大多数情况下，他们首先检查 <code>define</code>，然后使用一些古怪的代码来导出属性。在这种情况下，可以通过 <a href=\"/loaders/imports-loader/\"><code>imports-loader</code></a> 设置 <code>define=&gt;false</code> 来强制导入CommonJS路径。</p>\n<hr>\n<blockquote>\n<p>原文：<a href=\"https://webpack.js.org/guides/shimming/\">https://webpack.js.org/guides/shimming/</a></p>\n</blockquote>"},{"title":"react新生命周期替代旧生命周期的最佳实践","date":"2019-02-20T00:17:39.000Z","_content":"## 1. Fiber\n\n很长时间React团队一直致力于实现异步渲染以减少交互的卡顿现象，最后的产物就是Fiber。\n\nFiber的基本原理：\n\n1.把可中断的工作拆分成小任务\n\n2.对正在做的工作调整优先次序、重做、复用上次（做了一半的）成果\n\n3.在父子任务之间从容切换（yield back and forth），以支持React执行过程中的布局刷新\n\n总结：改变原来一次性渲染到结束的不可控的线性栈式数据结构，变为多次渲染可控的小颗粒状的链式数据结构。做到主要的先渲染，耗时渲染可中断，未完成的可继续。\n\n<!--more-->\n\n## 2. 导致问题\n由于渲染的过程是可以中断的异步行为，所以`componentWillMount`、`componentWillReceiveProps`、`componentWillUpdate`会在一次渲染过程中被重复调用，而导致一些问题。react17版本将弃用这些生命周期函数，但是可以使用带`UNSAFE_`的前缀的生命周期函数来替代使用。\n\n## 3. 从传统生命周期迁移\n为了解决上面的问题react引入了两个新的生命周期，`static getDerivedStateFromProps`和`getSnapshotBeforeUpdate`。\n\n### getDerivedStateFromProps\n\n组件实例化以及重新渲染之前会调用这个函数，输出一个对象去更新 state ，或者输出 null 表明组件不需要任何状态更新。与 componentDidUpdate 一起使用，将代替 componentWillReceiveProps。\n\n```javascript\nclass Example extends React.Component {\n  static getDerivedStateFromProps(props, state) {\n    // ...\n  }\n}\n```\n\n### getSnapshotBeforeUpdate\n\n进行变化（例如在更新DOM之前）之前会调用这个函数。此生命周期的返回值将作为第三个参数传递给componentDidUpdate。与 componentDidUpdate 一起使用，将代替 componentWillUpdate。\n\n```javascript\nclass Example extends React.Component {\n  getSnapshotBeforeUpdate(prevProps, prevState) {\n    // ...\n  }\n}\n```\n\n## 4. 事例\n\n### 1. 初始化状态\n\n```javascript\n// 旧代码\nclass ExampleComponent extends React.Component {\n  state = {};\n\n  componentWillMount() {\n    this.setState({\n      currentColor: this.props.defaultColor,\n      palette: 'rgb',\n    });\n  }\n}\n```\n\n```javascript\n// 新代码\nclass ExampleComponent extends React.Component {\n  state = {\n    currentColor: this.props.defaultColor,\n    palette: 'rgb',\n  };\n}\n```\n\n**总结：状态的初始化直接在实例化的时候进行。**\n\n### 2. 远端数据获取\n\n```javascript\n// 旧代码\nclass ExampleComponent extends React.Component {\n  state = {\n    externalData: null,\n  };\n\n  componentWillMount() {\n    this._asyncRequest = loadMyAsyncData().then(\n      externalData => {\n        this._asyncRequest = null;\n        this.setState({externalData});\n      }\n    );\n  }\n\n  componentWillUnmount() {\n    if (this._asyncRequest) {\n      this._asyncRequest.cancel();\n    }\n  }\n\n  render() {\n    if (this.state.externalData === null) {\n      // Render loading state ...\n    } else {\n      // Render real UI ...\n    }\n  }\n}\n```\n\n```javascript\n// 新代码\nclass ExampleComponent extends React.Component {\n  state = {\n    externalData: null,\n  };\n\n  componentDidMount() {\n    this._asyncRequest = loadMyAsyncData().then(\n      externalData => {\n        this._asyncRequest = null;\n        this.setState({externalData});\n      }\n    );\n  }\n\n  componentWillUnmount() {\n    if (this._asyncRequest) {\n      this._asyncRequest.cancel();\n    }\n  }\n\n  render() {\n    if (this.state.externalData === null) {\n      // Render loading state ...\n    } else {\n      // Render real UI ...\n    }\n  }\n}\n```\n\n**总结：componentDidMount中进行数据的请求。**\n\n### 3. 添加事件侦听器（或订阅）\n\n```javascript\n// 旧代码\nclass ExampleComponent extends React.Component {\n  componentWillMount() {\n    this.setState({\n      subscribedValue: this.props.dataSource.value,\n    });\n\n    // 不安全，会导致泄漏\n    this.props.dataSource.subscribe(\n      this.handleSubscriptionChange\n    );\n  }\n\n  componentWillUnmount() {\n    this.props.dataSource.unsubscribe(\n      this.handleSubscriptionChange\n    );\n  }\n\n  handleSubscriptionChange = dataSource => {\n    this.setState({\n      subscribedValue: dataSource.value,\n    });\n  };\n}\n```\n\n```javascript\n// 新代码\nclass ExampleComponent extends React.Component {\n  state = {\n    subscribedValue: this.props.dataSource.value,\n  };\n\n  componentDidMount() {\n    //事件监听器只能在mount之后添加，\n    //因此如果挂载中断或错误，它们不会泄漏。   \n    this.props.dataSource.subscribe(\n      this.handleSubscriptionChange\n    );\n\n    //外部值可能会在渲染和装载之间发生变化\n    //在某些情况下，处理这种情况可能很重要。\n    if (\n      this.state.subscribedValue !==\n      this.props.dataSource.value\n    ) {\n      this.setState({\n        subscribedValue: this.props.dataSource.value,\n      });\n    }\n  }\n\n  componentWillUnmount() {\n    this.props.dataSource.unsubscribe(\n      this.handleSubscriptionChange\n    );\n  }\n\n  handleSubscriptionChange = dataSource => {\n    this.setState({\n      subscribedValue: dataSource.value,\n    });\n  };\n}\n```\n\n**总结：componentDidMount中进行数据的绑定。**\n\n### 4. 基于 props 更新 state\n\n```javascript\n// 旧代码\nclass ExampleComponent extends React.Component {\n  state = {\n    isScrollingDown: false,\n  };\n\n  componentWillReceiveProps(nextProps) {\n    if (this.props.currentRow !== nextProps.currentRow) {\n      this.setState({\n        isScrollingDown:\n          nextProps.currentRow > this.props.currentRow,\n      });\n    }\n  }\n}\n```\n\n```javascript\n// 新代码\nclass ExampleComponent extends React.Component {\n  //在构造函数中初始化状态，\n  //或者使用属性初始值设定项。\n  state = {\n    isScrollingDown: false,\n    lastRow: null,\n  };\n\n  static getDerivedStateFromProps(props, state) {\n    if (props.currentRow !== state.lastRow) {\n      return {\n        isScrollingDown: props.currentRow > state.lastRow,\n        lastRow: props.currentRow,\n      };\n    }\n\n    // 返回null表示状态没有变化。\n    return null;\n  }\n}\n```\n\n**总结：使用 getDerivedStateFromProps 代替 componentWillReceiveProps。用 state 的属性代替 nextProps**\n\n### 5. 调用外部回调\n\n```javascript\n// 旧代码\nclass ExampleComponent extends React.Component {\n  componentWillUpdate(nextProps, nextState) {\n    if (\n      this.state.someStatefulValue !==\n      nextState.someStatefulValue\n    ) {\n      nextProps.onChange(nextState.someStatefulValue);\n    }\n  }\n}\n```\n\n```javascript\n// 新代码\nclass ExampleComponent extends React.Component {\n  componentDidUpdate(prevProps, prevState) {\n    if (\n      this.state.someStatefulValue !==\n      prevState.someStatefulValue\n    ) {\n      this.props.onChange(this.state.someStatefulValue);\n    }\n  }\n}\n```\n\n**总结：用 componentDidUpdate 代替 componentWillUpdate。**\n\n\n### 6. 有副作用的props更新\n\n```javascript\n// 旧代码\nclass ExampleComponent extends React.Component {\n  componentWillReceiveProps(nextProps) {\n    if (this.props.isVisible !== nextProps.isVisible) {\n      logVisibleChange(nextProps.isVisible);\n    }\n  }\n}\n```\n\n```javascript\n// 新代码\nclass ExampleComponent extends React.Component {\n  componentDidUpdate(prevProps, prevState) {\n    if (this.props.isVisible !== prevProps.isVisible) {\n      logVisibleChange(this.props.isVisible);\n    }\n  }\n}\n```\n\n**总结：使用 componentDidUpdate 代替 componentWillReceiveProps。**\n\n### 7. props 改变后请求远端数据\n\n```javascript\n// 旧代码\nclass ExampleComponent extends React.Component {\n  state = {\n    externalData: null,\n  };\n\n  componentDidMount() {\n    this._loadAsyncData(this.props.id);\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (nextProps.id !== this.props.id) {\n      this.setState({externalData: null});\n      this._loadAsyncData(nextProps.id);\n    }\n  }\n\n  componentWillUnmount() {\n    if (this._asyncRequest) {\n      this._asyncRequest.cancel();\n    }\n  }\n\n  render() {\n    if (this.state.externalData === null) {\n      // Render loading state ...\n    } else {\n      // Render real UI ...\n    }\n  }\n\n  _loadAsyncData(id) {\n    this._asyncRequest = loadMyAsyncData(id).then(\n      externalData => {\n        this._asyncRequest = null;\n        this.setState({externalData});\n      }\n    );\n  }\n}\n```\n\n```javascript\n// 新代码\nclass ExampleComponent extends React.Component {\n  state = {\n    externalData: null,\n  };\n\n  static getDerivedStateFromProps(props, state) {\n    //存储prevId状态，以便我们可以比较道具变化的时间。\n    //清除以前加载的数据（因此我们不会渲染陈旧的东西）。\n    if (props.id !== state.prevId) {\n      return {\n        externalData: null,\n        // 代替 prevProps.id\n        prevId: props.id,\n      };\n    }\n\n    // 状态没有改变\n    return null;\n  }\n\n  componentDidMount() {\n    this._loadAsyncData(this.props.id);\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    if (this.state.externalData === null) {\n      this._loadAsyncData(this.props.id);\n    }\n  }\n\n  componentWillUnmount() {\n    if (this._asyncRequest) {\n      this._asyncRequest.cancel();\n    }\n  }\n\n  render() {\n    if (this.state.externalData === null) {\n      // 渲染加载状态...\n    } else {\n      // 渲染UI ...\n    }\n  }\n\n  _loadAsyncData(id) {\n    this._asyncRequest = loadMyAsyncData(id).then(\n      externalData => {\n        this._asyncRequest = null;\n        this.setState({externalData});\n      }\n    );\n  }\n}\n```\n**总结：使用 componentDidUpdate 代替 componentWillReceiveProps，业务的关键状态用state临时保存**\n\n### 7. 在更新之前读取DOM属性\n\n```javascript\n// 旧代码\nclass ScrollingList extends React.Component {\n  listRef = null;\n  previousScrollOffset = null;\n\n  componentWillUpdate(nextProps, nextState) {\n    //我们是否在列表中添加新元素？\n    //捕获滚动位置，以便我们稍后调整滚动。\n    if (this.props.list.length < nextProps.list.length) {\n      this.previousScrollOffset =\n        this.listRef.scrollHeight - this.listRef.scrollTop;\n    }\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    //如果设置了previousScrollOffset，我们刚刚添加了新项目。\n    //调整滚动，以便这些新项目不会将旧项目推出视图。\n    if (this.previousScrollOffset !== null) {\n      this.listRef.scrollTop =\n        this.listRef.scrollHeight -\n        this.previousScrollOffset;\n      this.previousScrollOffset = null;\n    }\n  }\n\n  render() {\n    return (\n      <div ref={this.setListRef}>\n        {/* ...内容... */}\n      </div>\n    );\n  }\n\n  setListRef = ref => {\n    this.listRef = ref;\n  };\n}\n```\n\n```javascript\n// 新代码\nclass ScrollingList extends React.Component {\n  listRef = null;\n\n  getSnapshotBeforeUpdate(prevProps, prevState) {\n    //我们是否在列表中添加新项目？\n    //捕获滚动位置，以便我们稍后调整滚动。\n    if (prevProps.list.length < this.props.list.length) {\n      return (\n        this.listRef.scrollHeight - this.listRef.scrollTop\n      );\n    }\n    return null;\n  }\n\n  componentDidUpdate(prevProps, prevState, snapshot) {\n    //如果我们有快照值，我们刚刚添加了新项目。\n    //调整滚动，以便这些新项目不会将旧项目推出视图。\n    //这里的 snapshot 就是 getSnapshotBeforeUpdate 的返回\n    if (snapshot !== null) {\n      this.listRef.scrollTop =\n        this.listRef.scrollHeight - snapshot;\n    }\n  }\n\n  render() {\n    return (\n      <div ref={this.setListRef}>\n        {/* ...内容... */}\n      </div>\n    );\n  }\n\n  setListRef = ref => {\n    this.listRef = ref;\n  };\n}\n```\n\n**总结：getSnapshotBeforeUpdate 代替 componentDidUpdate**\n\n## 4. 写在最后的总结\n\n### 1. 原来几个含有will的生命周期函数基本上是没有用了，就算用也是用在不触发UI改变的业务上。\n\n### 2. 现在能比较前后状态的生命周期函数只有 componentDidUpdate 和 getSnapshotBeforeUpdate。\n\n### 3. 比较前后状态的能用 componentDidUpdate 解就用 componentDidUpdate 解决。不能满足的用 static getDerivedStateFromProps 来代替。\n\n### 4. 使用 static getDerivedStateFromProps 的要把关键的业务状态添加到 state 里作为 prevProps 的替代","source":"_posts/react新生命周期替代旧生命周期的最佳实践.md","raw":"---\ntitle: react新生命周期替代旧生命周期的最佳实践\ndate: 2019-02-20 08:17:39\ntags: ['react','生命周期','Fiber','getSnapshotBeforeUpdate','getDerivedStateFromProps','最佳实践']\ncategory: 'coding'\n---\n## 1. Fiber\n\n很长时间React团队一直致力于实现异步渲染以减少交互的卡顿现象，最后的产物就是Fiber。\n\nFiber的基本原理：\n\n1.把可中断的工作拆分成小任务\n\n2.对正在做的工作调整优先次序、重做、复用上次（做了一半的）成果\n\n3.在父子任务之间从容切换（yield back and forth），以支持React执行过程中的布局刷新\n\n总结：改变原来一次性渲染到结束的不可控的线性栈式数据结构，变为多次渲染可控的小颗粒状的链式数据结构。做到主要的先渲染，耗时渲染可中断，未完成的可继续。\n\n<!--more-->\n\n## 2. 导致问题\n由于渲染的过程是可以中断的异步行为，所以`componentWillMount`、`componentWillReceiveProps`、`componentWillUpdate`会在一次渲染过程中被重复调用，而导致一些问题。react17版本将弃用这些生命周期函数，但是可以使用带`UNSAFE_`的前缀的生命周期函数来替代使用。\n\n## 3. 从传统生命周期迁移\n为了解决上面的问题react引入了两个新的生命周期，`static getDerivedStateFromProps`和`getSnapshotBeforeUpdate`。\n\n### getDerivedStateFromProps\n\n组件实例化以及重新渲染之前会调用这个函数，输出一个对象去更新 state ，或者输出 null 表明组件不需要任何状态更新。与 componentDidUpdate 一起使用，将代替 componentWillReceiveProps。\n\n```javascript\nclass Example extends React.Component {\n  static getDerivedStateFromProps(props, state) {\n    // ...\n  }\n}\n```\n\n### getSnapshotBeforeUpdate\n\n进行变化（例如在更新DOM之前）之前会调用这个函数。此生命周期的返回值将作为第三个参数传递给componentDidUpdate。与 componentDidUpdate 一起使用，将代替 componentWillUpdate。\n\n```javascript\nclass Example extends React.Component {\n  getSnapshotBeforeUpdate(prevProps, prevState) {\n    // ...\n  }\n}\n```\n\n## 4. 事例\n\n### 1. 初始化状态\n\n```javascript\n// 旧代码\nclass ExampleComponent extends React.Component {\n  state = {};\n\n  componentWillMount() {\n    this.setState({\n      currentColor: this.props.defaultColor,\n      palette: 'rgb',\n    });\n  }\n}\n```\n\n```javascript\n// 新代码\nclass ExampleComponent extends React.Component {\n  state = {\n    currentColor: this.props.defaultColor,\n    palette: 'rgb',\n  };\n}\n```\n\n**总结：状态的初始化直接在实例化的时候进行。**\n\n### 2. 远端数据获取\n\n```javascript\n// 旧代码\nclass ExampleComponent extends React.Component {\n  state = {\n    externalData: null,\n  };\n\n  componentWillMount() {\n    this._asyncRequest = loadMyAsyncData().then(\n      externalData => {\n        this._asyncRequest = null;\n        this.setState({externalData});\n      }\n    );\n  }\n\n  componentWillUnmount() {\n    if (this._asyncRequest) {\n      this._asyncRequest.cancel();\n    }\n  }\n\n  render() {\n    if (this.state.externalData === null) {\n      // Render loading state ...\n    } else {\n      // Render real UI ...\n    }\n  }\n}\n```\n\n```javascript\n// 新代码\nclass ExampleComponent extends React.Component {\n  state = {\n    externalData: null,\n  };\n\n  componentDidMount() {\n    this._asyncRequest = loadMyAsyncData().then(\n      externalData => {\n        this._asyncRequest = null;\n        this.setState({externalData});\n      }\n    );\n  }\n\n  componentWillUnmount() {\n    if (this._asyncRequest) {\n      this._asyncRequest.cancel();\n    }\n  }\n\n  render() {\n    if (this.state.externalData === null) {\n      // Render loading state ...\n    } else {\n      // Render real UI ...\n    }\n  }\n}\n```\n\n**总结：componentDidMount中进行数据的请求。**\n\n### 3. 添加事件侦听器（或订阅）\n\n```javascript\n// 旧代码\nclass ExampleComponent extends React.Component {\n  componentWillMount() {\n    this.setState({\n      subscribedValue: this.props.dataSource.value,\n    });\n\n    // 不安全，会导致泄漏\n    this.props.dataSource.subscribe(\n      this.handleSubscriptionChange\n    );\n  }\n\n  componentWillUnmount() {\n    this.props.dataSource.unsubscribe(\n      this.handleSubscriptionChange\n    );\n  }\n\n  handleSubscriptionChange = dataSource => {\n    this.setState({\n      subscribedValue: dataSource.value,\n    });\n  };\n}\n```\n\n```javascript\n// 新代码\nclass ExampleComponent extends React.Component {\n  state = {\n    subscribedValue: this.props.dataSource.value,\n  };\n\n  componentDidMount() {\n    //事件监听器只能在mount之后添加，\n    //因此如果挂载中断或错误，它们不会泄漏。   \n    this.props.dataSource.subscribe(\n      this.handleSubscriptionChange\n    );\n\n    //外部值可能会在渲染和装载之间发生变化\n    //在某些情况下，处理这种情况可能很重要。\n    if (\n      this.state.subscribedValue !==\n      this.props.dataSource.value\n    ) {\n      this.setState({\n        subscribedValue: this.props.dataSource.value,\n      });\n    }\n  }\n\n  componentWillUnmount() {\n    this.props.dataSource.unsubscribe(\n      this.handleSubscriptionChange\n    );\n  }\n\n  handleSubscriptionChange = dataSource => {\n    this.setState({\n      subscribedValue: dataSource.value,\n    });\n  };\n}\n```\n\n**总结：componentDidMount中进行数据的绑定。**\n\n### 4. 基于 props 更新 state\n\n```javascript\n// 旧代码\nclass ExampleComponent extends React.Component {\n  state = {\n    isScrollingDown: false,\n  };\n\n  componentWillReceiveProps(nextProps) {\n    if (this.props.currentRow !== nextProps.currentRow) {\n      this.setState({\n        isScrollingDown:\n          nextProps.currentRow > this.props.currentRow,\n      });\n    }\n  }\n}\n```\n\n```javascript\n// 新代码\nclass ExampleComponent extends React.Component {\n  //在构造函数中初始化状态，\n  //或者使用属性初始值设定项。\n  state = {\n    isScrollingDown: false,\n    lastRow: null,\n  };\n\n  static getDerivedStateFromProps(props, state) {\n    if (props.currentRow !== state.lastRow) {\n      return {\n        isScrollingDown: props.currentRow > state.lastRow,\n        lastRow: props.currentRow,\n      };\n    }\n\n    // 返回null表示状态没有变化。\n    return null;\n  }\n}\n```\n\n**总结：使用 getDerivedStateFromProps 代替 componentWillReceiveProps。用 state 的属性代替 nextProps**\n\n### 5. 调用外部回调\n\n```javascript\n// 旧代码\nclass ExampleComponent extends React.Component {\n  componentWillUpdate(nextProps, nextState) {\n    if (\n      this.state.someStatefulValue !==\n      nextState.someStatefulValue\n    ) {\n      nextProps.onChange(nextState.someStatefulValue);\n    }\n  }\n}\n```\n\n```javascript\n// 新代码\nclass ExampleComponent extends React.Component {\n  componentDidUpdate(prevProps, prevState) {\n    if (\n      this.state.someStatefulValue !==\n      prevState.someStatefulValue\n    ) {\n      this.props.onChange(this.state.someStatefulValue);\n    }\n  }\n}\n```\n\n**总结：用 componentDidUpdate 代替 componentWillUpdate。**\n\n\n### 6. 有副作用的props更新\n\n```javascript\n// 旧代码\nclass ExampleComponent extends React.Component {\n  componentWillReceiveProps(nextProps) {\n    if (this.props.isVisible !== nextProps.isVisible) {\n      logVisibleChange(nextProps.isVisible);\n    }\n  }\n}\n```\n\n```javascript\n// 新代码\nclass ExampleComponent extends React.Component {\n  componentDidUpdate(prevProps, prevState) {\n    if (this.props.isVisible !== prevProps.isVisible) {\n      logVisibleChange(this.props.isVisible);\n    }\n  }\n}\n```\n\n**总结：使用 componentDidUpdate 代替 componentWillReceiveProps。**\n\n### 7. props 改变后请求远端数据\n\n```javascript\n// 旧代码\nclass ExampleComponent extends React.Component {\n  state = {\n    externalData: null,\n  };\n\n  componentDidMount() {\n    this._loadAsyncData(this.props.id);\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (nextProps.id !== this.props.id) {\n      this.setState({externalData: null});\n      this._loadAsyncData(nextProps.id);\n    }\n  }\n\n  componentWillUnmount() {\n    if (this._asyncRequest) {\n      this._asyncRequest.cancel();\n    }\n  }\n\n  render() {\n    if (this.state.externalData === null) {\n      // Render loading state ...\n    } else {\n      // Render real UI ...\n    }\n  }\n\n  _loadAsyncData(id) {\n    this._asyncRequest = loadMyAsyncData(id).then(\n      externalData => {\n        this._asyncRequest = null;\n        this.setState({externalData});\n      }\n    );\n  }\n}\n```\n\n```javascript\n// 新代码\nclass ExampleComponent extends React.Component {\n  state = {\n    externalData: null,\n  };\n\n  static getDerivedStateFromProps(props, state) {\n    //存储prevId状态，以便我们可以比较道具变化的时间。\n    //清除以前加载的数据（因此我们不会渲染陈旧的东西）。\n    if (props.id !== state.prevId) {\n      return {\n        externalData: null,\n        // 代替 prevProps.id\n        prevId: props.id,\n      };\n    }\n\n    // 状态没有改变\n    return null;\n  }\n\n  componentDidMount() {\n    this._loadAsyncData(this.props.id);\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    if (this.state.externalData === null) {\n      this._loadAsyncData(this.props.id);\n    }\n  }\n\n  componentWillUnmount() {\n    if (this._asyncRequest) {\n      this._asyncRequest.cancel();\n    }\n  }\n\n  render() {\n    if (this.state.externalData === null) {\n      // 渲染加载状态...\n    } else {\n      // 渲染UI ...\n    }\n  }\n\n  _loadAsyncData(id) {\n    this._asyncRequest = loadMyAsyncData(id).then(\n      externalData => {\n        this._asyncRequest = null;\n        this.setState({externalData});\n      }\n    );\n  }\n}\n```\n**总结：使用 componentDidUpdate 代替 componentWillReceiveProps，业务的关键状态用state临时保存**\n\n### 7. 在更新之前读取DOM属性\n\n```javascript\n// 旧代码\nclass ScrollingList extends React.Component {\n  listRef = null;\n  previousScrollOffset = null;\n\n  componentWillUpdate(nextProps, nextState) {\n    //我们是否在列表中添加新元素？\n    //捕获滚动位置，以便我们稍后调整滚动。\n    if (this.props.list.length < nextProps.list.length) {\n      this.previousScrollOffset =\n        this.listRef.scrollHeight - this.listRef.scrollTop;\n    }\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    //如果设置了previousScrollOffset，我们刚刚添加了新项目。\n    //调整滚动，以便这些新项目不会将旧项目推出视图。\n    if (this.previousScrollOffset !== null) {\n      this.listRef.scrollTop =\n        this.listRef.scrollHeight -\n        this.previousScrollOffset;\n      this.previousScrollOffset = null;\n    }\n  }\n\n  render() {\n    return (\n      <div ref={this.setListRef}>\n        {/* ...内容... */}\n      </div>\n    );\n  }\n\n  setListRef = ref => {\n    this.listRef = ref;\n  };\n}\n```\n\n```javascript\n// 新代码\nclass ScrollingList extends React.Component {\n  listRef = null;\n\n  getSnapshotBeforeUpdate(prevProps, prevState) {\n    //我们是否在列表中添加新项目？\n    //捕获滚动位置，以便我们稍后调整滚动。\n    if (prevProps.list.length < this.props.list.length) {\n      return (\n        this.listRef.scrollHeight - this.listRef.scrollTop\n      );\n    }\n    return null;\n  }\n\n  componentDidUpdate(prevProps, prevState, snapshot) {\n    //如果我们有快照值，我们刚刚添加了新项目。\n    //调整滚动，以便这些新项目不会将旧项目推出视图。\n    //这里的 snapshot 就是 getSnapshotBeforeUpdate 的返回\n    if (snapshot !== null) {\n      this.listRef.scrollTop =\n        this.listRef.scrollHeight - snapshot;\n    }\n  }\n\n  render() {\n    return (\n      <div ref={this.setListRef}>\n        {/* ...内容... */}\n      </div>\n    );\n  }\n\n  setListRef = ref => {\n    this.listRef = ref;\n  };\n}\n```\n\n**总结：getSnapshotBeforeUpdate 代替 componentDidUpdate**\n\n## 4. 写在最后的总结\n\n### 1. 原来几个含有will的生命周期函数基本上是没有用了，就算用也是用在不触发UI改变的业务上。\n\n### 2. 现在能比较前后状态的生命周期函数只有 componentDidUpdate 和 getSnapshotBeforeUpdate。\n\n### 3. 比较前后状态的能用 componentDidUpdate 解就用 componentDidUpdate 解决。不能满足的用 static getDerivedStateFromProps 来代替。\n\n### 4. 使用 static getDerivedStateFromProps 的要把关键的业务状态添加到 state 里作为 prevProps 的替代","slug":"react新生命周期替代旧生命周期的最佳实践","published":1,"updated":"2019-02-20T02:50:38.513Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjsgue0ex0011gpi6v9obn9oz","content":"<h2 id=\"1-Fiber\"><a href=\"#1-Fiber\" class=\"headerlink\" title=\"1. Fiber\"></a>1. Fiber</h2><p>很长时间React团队一直致力于实现异步渲染以减少交互的卡顿现象，最后的产物就是Fiber。</p>\n<p>Fiber的基本原理：</p>\n<p>1.把可中断的工作拆分成小任务</p>\n<p>2.对正在做的工作调整优先次序、重做、复用上次（做了一半的）成果</p>\n<p>3.在父子任务之间从容切换（yield back and forth），以支持React执行过程中的布局刷新</p>\n<p>总结：改变原来一次性渲染到结束的不可控的线性栈式数据结构，变为多次渲染可控的小颗粒状的链式数据结构。做到主要的先渲染，耗时渲染可中断，未完成的可继续。</p>\n<a id=\"more\"></a>\n<h2 id=\"2-导致问题\"><a href=\"#2-导致问题\" class=\"headerlink\" title=\"2. 导致问题\"></a>2. 导致问题</h2><p>由于渲染的过程是可以中断的异步行为，所以<code>componentWillMount</code>、<code>componentWillReceiveProps</code>、<code>componentWillUpdate</code>会在一次渲染过程中被重复调用，而导致一些问题。react17版本将弃用这些生命周期函数，但是可以使用带<code>UNSAFE_</code>的前缀的生命周期函数来替代使用。</p>\n<h2 id=\"3-从传统生命周期迁移\"><a href=\"#3-从传统生命周期迁移\" class=\"headerlink\" title=\"3. 从传统生命周期迁移\"></a>3. 从传统生命周期迁移</h2><p>为了解决上面的问题react引入了两个新的生命周期，<code>static getDerivedStateFromProps</code>和<code>getSnapshotBeforeUpdate</code>。</p>\n<h3 id=\"getDerivedStateFromProps\"><a href=\"#getDerivedStateFromProps\" class=\"headerlink\" title=\"getDerivedStateFromProps\"></a>getDerivedStateFromProps</h3><p>组件实例化以及重新渲染之前会调用这个函数，输出一个对象去更新 state ，或者输出 null 表明组件不需要任何状态更新。与 componentDidUpdate 一起使用，将代替 componentWillReceiveProps。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Example</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">static</span> getDerivedStateFromProps(props, state) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"getSnapshotBeforeUpdate\"><a href=\"#getSnapshotBeforeUpdate\" class=\"headerlink\" title=\"getSnapshotBeforeUpdate\"></a>getSnapshotBeforeUpdate</h3><p>进行变化（例如在更新DOM之前）之前会调用这个函数。此生命周期的返回值将作为第三个参数传递给componentDidUpdate。与 componentDidUpdate 一起使用，将代替 componentWillUpdate。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Example</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  getSnapshotBeforeUpdate(prevProps, prevState) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"4-事例\"><a href=\"#4-事例\" class=\"headerlink\" title=\"4. 事例\"></a>4. 事例</h2><h3 id=\"1-初始化状态\"><a href=\"#1-初始化状态\" class=\"headerlink\" title=\"1. 初始化状态\"></a>1. 初始化状态</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 旧代码</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ExampleComponent</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  state = &#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  componentWillMount() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.setState(&#123;</span><br><span class=\"line\">      <span class=\"attr\">currentColor</span>: <span class=\"keyword\">this</span>.props.defaultColor,</span><br><span class=\"line\">      <span class=\"attr\">palette</span>: <span class=\"string\">'rgb'</span>,</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 新代码</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ExampleComponent</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  state = &#123;</span><br><span class=\"line\">    <span class=\"attr\">currentColor</span>: <span class=\"keyword\">this</span>.props.defaultColor,</span><br><span class=\"line\">    <span class=\"attr\">palette</span>: <span class=\"string\">'rgb'</span>,</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><strong>总结：状态的初始化直接在实例化的时候进行。</strong></p>\n<h3 id=\"2-远端数据获取\"><a href=\"#2-远端数据获取\" class=\"headerlink\" title=\"2. 远端数据获取\"></a>2. 远端数据获取</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 旧代码</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ExampleComponent</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  state = &#123;</span><br><span class=\"line\">    <span class=\"attr\">externalData</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  componentWillMount() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>._asyncRequest = loadMyAsyncData().then(</span><br><span class=\"line\">      <span class=\"function\"><span class=\"params\">externalData</span> =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>._asyncRequest = <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.setState(&#123;externalData&#125;);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  componentWillUnmount() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>._asyncRequest) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>._asyncRequest.cancel();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.state.externalData === <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// Render loading state ...</span></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// Render real UI ...</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 新代码</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ExampleComponent</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  state = &#123;</span><br><span class=\"line\">    <span class=\"attr\">externalData</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  componentDidMount() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>._asyncRequest = loadMyAsyncData().then(</span><br><span class=\"line\">      <span class=\"function\"><span class=\"params\">externalData</span> =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>._asyncRequest = <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.setState(&#123;externalData&#125;);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  componentWillUnmount() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>._asyncRequest) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>._asyncRequest.cancel();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.state.externalData === <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// Render loading state ...</span></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// Render real UI ...</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><strong>总结：componentDidMount中进行数据的请求。</strong></p>\n<h3 id=\"3-添加事件侦听器（或订阅）\"><a href=\"#3-添加事件侦听器（或订阅）\" class=\"headerlink\" title=\"3. 添加事件侦听器（或订阅）\"></a>3. 添加事件侦听器（或订阅）</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 旧代码</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ExampleComponent</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  componentWillMount() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.setState(&#123;</span><br><span class=\"line\">      <span class=\"attr\">subscribedValue</span>: <span class=\"keyword\">this</span>.props.dataSource.value,</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 不安全，会导致泄漏</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.props.dataSource.subscribe(</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.handleSubscriptionChange</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  componentWillUnmount() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.props.dataSource.unsubscribe(</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.handleSubscriptionChange</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  handleSubscriptionChange = <span class=\"function\"><span class=\"params\">dataSource</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.setState(&#123;</span><br><span class=\"line\">      <span class=\"attr\">subscribedValue</span>: dataSource.value,</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 新代码</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ExampleComponent</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  state = &#123;</span><br><span class=\"line\">    <span class=\"attr\">subscribedValue</span>: <span class=\"keyword\">this</span>.props.dataSource.value,</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  componentDidMount() &#123;</span><br><span class=\"line\">    <span class=\"comment\">//事件监听器只能在mount之后添加，</span></span><br><span class=\"line\">    <span class=\"comment\">//因此如果挂载中断或错误，它们不会泄漏。   </span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.props.dataSource.subscribe(</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.handleSubscriptionChange</span><br><span class=\"line\">    );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//外部值可能会在渲染和装载之间发生变化</span></span><br><span class=\"line\">    <span class=\"comment\">//在某些情况下，处理这种情况可能很重要。</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.state.subscribedValue !==</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.props.dataSource.value</span><br><span class=\"line\">    ) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.setState(&#123;</span><br><span class=\"line\">        <span class=\"attr\">subscribedValue</span>: <span class=\"keyword\">this</span>.props.dataSource.value,</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  componentWillUnmount() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.props.dataSource.unsubscribe(</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.handleSubscriptionChange</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  handleSubscriptionChange = <span class=\"function\"><span class=\"params\">dataSource</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.setState(&#123;</span><br><span class=\"line\">      <span class=\"attr\">subscribedValue</span>: dataSource.value,</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><strong>总结：componentDidMount中进行数据的绑定。</strong></p>\n<h3 id=\"4-基于-props-更新-state\"><a href=\"#4-基于-props-更新-state\" class=\"headerlink\" title=\"4. 基于 props 更新 state\"></a>4. 基于 props 更新 state</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 旧代码</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ExampleComponent</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  state = &#123;</span><br><span class=\"line\">    <span class=\"attr\">isScrollingDown</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  componentWillReceiveProps(nextProps) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.props.currentRow !== nextProps.currentRow) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.setState(&#123;</span><br><span class=\"line\">        <span class=\"attr\">isScrollingDown</span>:</span><br><span class=\"line\">          nextProps.currentRow &gt; <span class=\"keyword\">this</span>.props.currentRow,</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 新代码</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ExampleComponent</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">//在构造函数中初始化状态，</span></span><br><span class=\"line\">  <span class=\"comment\">//或者使用属性初始值设定项。</span></span><br><span class=\"line\">  state = &#123;</span><br><span class=\"line\">    <span class=\"attr\">isScrollingDown</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    <span class=\"attr\">lastRow</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">static</span> getDerivedStateFromProps(props, state) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (props.currentRow !== state.lastRow) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">        <span class=\"attr\">isScrollingDown</span>: props.currentRow &gt; state.lastRow,</span><br><span class=\"line\">        <span class=\"attr\">lastRow</span>: props.currentRow,</span><br><span class=\"line\">      &#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 返回null表示状态没有变化。</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><strong>总结：使用 getDerivedStateFromProps 代替 componentWillReceiveProps。用 state 的属性代替 nextProps</strong></p>\n<h3 id=\"5-调用外部回调\"><a href=\"#5-调用外部回调\" class=\"headerlink\" title=\"5. 调用外部回调\"></a>5. 调用外部回调</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 旧代码</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ExampleComponent</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  componentWillUpdate(nextProps, nextState) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.state.someStatefulValue !==</span><br><span class=\"line\">      nextState.someStatefulValue</span><br><span class=\"line\">    ) &#123;</span><br><span class=\"line\">      nextProps.onChange(nextState.someStatefulValue);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 新代码</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ExampleComponent</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  componentDidUpdate(prevProps, prevState) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.state.someStatefulValue !==</span><br><span class=\"line\">      prevState.someStatefulValue</span><br><span class=\"line\">    ) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.props.onChange(<span class=\"keyword\">this</span>.state.someStatefulValue);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><strong>总结：用 componentDidUpdate 代替 componentWillUpdate。</strong></p>\n<h3 id=\"6-有副作用的props更新\"><a href=\"#6-有副作用的props更新\" class=\"headerlink\" title=\"6. 有副作用的props更新\"></a>6. 有副作用的props更新</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 旧代码</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ExampleComponent</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  componentWillReceiveProps(nextProps) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.props.isVisible !== nextProps.isVisible) &#123;</span><br><span class=\"line\">      logVisibleChange(nextProps.isVisible);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 新代码</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ExampleComponent</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  componentDidUpdate(prevProps, prevState) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.props.isVisible !== prevProps.isVisible) &#123;</span><br><span class=\"line\">      logVisibleChange(<span class=\"keyword\">this</span>.props.isVisible);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><strong>总结：使用 componentDidUpdate 代替 componentWillReceiveProps。</strong></p>\n<h3 id=\"7-props-改变后请求远端数据\"><a href=\"#7-props-改变后请求远端数据\" class=\"headerlink\" title=\"7. props 改变后请求远端数据\"></a>7. props 改变后请求远端数据</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 旧代码</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ExampleComponent</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  state = &#123;</span><br><span class=\"line\">    <span class=\"attr\">externalData</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  componentDidMount() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>._loadAsyncData(<span class=\"keyword\">this</span>.props.id);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  componentWillReceiveProps(nextProps) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (nextProps.id !== <span class=\"keyword\">this</span>.props.id) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.setState(&#123;<span class=\"attr\">externalData</span>: <span class=\"literal\">null</span>&#125;);</span><br><span class=\"line\">      <span class=\"keyword\">this</span>._loadAsyncData(nextProps.id);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  componentWillUnmount() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>._asyncRequest) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>._asyncRequest.cancel();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.state.externalData === <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// Render loading state ...</span></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// Render real UI ...</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  _loadAsyncData(id) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>._asyncRequest = loadMyAsyncData(id).then(</span><br><span class=\"line\">      <span class=\"function\"><span class=\"params\">externalData</span> =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>._asyncRequest = <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.setState(&#123;externalData&#125;);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 新代码</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ExampleComponent</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  state = &#123;</span><br><span class=\"line\">    <span class=\"attr\">externalData</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">static</span> getDerivedStateFromProps(props, state) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//存储prevId状态，以便我们可以比较道具变化的时间。</span></span><br><span class=\"line\">    <span class=\"comment\">//清除以前加载的数据（因此我们不会渲染陈旧的东西）。</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (props.id !== state.prevId) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">        <span class=\"attr\">externalData</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">        <span class=\"comment\">// 代替 prevProps.id</span></span><br><span class=\"line\">        prevId: props.id,</span><br><span class=\"line\">      &#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 状态没有改变</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  componentDidMount() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>._loadAsyncData(<span class=\"keyword\">this</span>.props.id);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  componentDidUpdate(prevProps, prevState) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.state.externalData === <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>._loadAsyncData(<span class=\"keyword\">this</span>.props.id);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  componentWillUnmount() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>._asyncRequest) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>._asyncRequest.cancel();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.state.externalData === <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 渲染加载状态...</span></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 渲染UI ...</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  _loadAsyncData(id) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>._asyncRequest = loadMyAsyncData(id).then(</span><br><span class=\"line\">      <span class=\"function\"><span class=\"params\">externalData</span> =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>._asyncRequest = <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.setState(&#123;externalData&#125;);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><strong>总结：使用 componentDidUpdate 代替 componentWillReceiveProps，业务的关键状态用state临时保存</strong></p>\n<h3 id=\"7-在更新之前读取DOM属性\"><a href=\"#7-在更新之前读取DOM属性\" class=\"headerlink\" title=\"7. 在更新之前读取DOM属性\"></a>7. 在更新之前读取DOM属性</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 旧代码</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ScrollingList</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  listRef = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  previousScrollOffset = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  componentWillUpdate(nextProps, nextState) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//我们是否在列表中添加新元素？</span></span><br><span class=\"line\">    <span class=\"comment\">//捕获滚动位置，以便我们稍后调整滚动。</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.props.list.length &lt; nextProps.list.length) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.previousScrollOffset =</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.listRef.scrollHeight - <span class=\"keyword\">this</span>.listRef.scrollTop;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  componentDidUpdate(prevProps, prevState) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//如果设置了previousScrollOffset，我们刚刚添加了新项目。</span></span><br><span class=\"line\">    <span class=\"comment\">//调整滚动，以便这些新项目不会将旧项目推出视图。</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.previousScrollOffset !== <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.listRef.scrollTop =</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.listRef.scrollHeight -</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.previousScrollOffset;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.previousScrollOffset = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">ref</span>=<span class=\"string\">&#123;this.setListRef&#125;</span>&gt;</span></span><br><span class=\"line\">        &#123;/* ...内容... */&#125;</span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  setListRef = <span class=\"function\"><span class=\"params\">ref</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.listRef = ref;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 新代码</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ScrollingList</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  listRef = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  getSnapshotBeforeUpdate(prevProps, prevState) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//我们是否在列表中添加新项目？</span></span><br><span class=\"line\">    <span class=\"comment\">//捕获滚动位置，以便我们稍后调整滚动。</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (prevProps.list.length &lt; <span class=\"keyword\">this</span>.props.list.length) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> (</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.listRef.scrollHeight - <span class=\"keyword\">this</span>.listRef.scrollTop</span><br><span class=\"line\">      );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  componentDidUpdate(prevProps, prevState, snapshot) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//如果我们有快照值，我们刚刚添加了新项目。</span></span><br><span class=\"line\">    <span class=\"comment\">//调整滚动，以便这些新项目不会将旧项目推出视图。</span></span><br><span class=\"line\">    <span class=\"comment\">//这里的 snapshot 就是 getSnapshotBeforeUpdate 的返回</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (snapshot !== <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.listRef.scrollTop =</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.listRef.scrollHeight - snapshot;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">ref</span>=<span class=\"string\">&#123;this.setListRef&#125;</span>&gt;</span></span><br><span class=\"line\">        &#123;/* ...内容... */&#125;</span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  setListRef = <span class=\"function\"><span class=\"params\">ref</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.listRef = ref;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><strong>总结：getSnapshotBeforeUpdate 代替 componentDidUpdate</strong></p>\n<h2 id=\"4-写在最后的总结\"><a href=\"#4-写在最后的总结\" class=\"headerlink\" title=\"4. 写在最后的总结\"></a>4. 写在最后的总结</h2><h3 id=\"1-原来几个含有will的生命周期函数基本上是没有用了，就算用也是用在不触发UI改变的业务上。\"><a href=\"#1-原来几个含有will的生命周期函数基本上是没有用了，就算用也是用在不触发UI改变的业务上。\" class=\"headerlink\" title=\"1. 原来几个含有will的生命周期函数基本上是没有用了，就算用也是用在不触发UI改变的业务上。\"></a>1. 原来几个含有will的生命周期函数基本上是没有用了，就算用也是用在不触发UI改变的业务上。</h3><h3 id=\"2-现在能比较前后状态的生命周期函数只有-componentDidUpdate-和-getSnapshotBeforeUpdate。\"><a href=\"#2-现在能比较前后状态的生命周期函数只有-componentDidUpdate-和-getSnapshotBeforeUpdate。\" class=\"headerlink\" title=\"2. 现在能比较前后状态的生命周期函数只有 componentDidUpdate 和 getSnapshotBeforeUpdate。\"></a>2. 现在能比较前后状态的生命周期函数只有 componentDidUpdate 和 getSnapshotBeforeUpdate。</h3><h3 id=\"3-比较前后状态的能用-componentDidUpdate-解就用-componentDidUpdate-解决。不能满足的用-static-getDerivedStateFromProps-来代替。\"><a href=\"#3-比较前后状态的能用-componentDidUpdate-解就用-componentDidUpdate-解决。不能满足的用-static-getDerivedStateFromProps-来代替。\" class=\"headerlink\" title=\"3. 比较前后状态的能用 componentDidUpdate 解就用 componentDidUpdate 解决。不能满足的用 static getDerivedStateFromProps 来代替。\"></a>3. 比较前后状态的能用 componentDidUpdate 解就用 componentDidUpdate 解决。不能满足的用 static getDerivedStateFromProps 来代替。</h3><h3 id=\"4-使用-static-getDerivedStateFromProps-的要把关键的业务状态添加到-state-里作为-prevProps-的替代\"><a href=\"#4-使用-static-getDerivedStateFromProps-的要把关键的业务状态添加到-state-里作为-prevProps-的替代\" class=\"headerlink\" title=\"4. 使用 static getDerivedStateFromProps 的要把关键的业务状态添加到 state 里作为 prevProps 的替代\"></a>4. 使用 static getDerivedStateFromProps 的要把关键的业务状态添加到 state 里作为 prevProps 的替代</h3>","excerpt":"<h2 id=\"1-Fiber\"><a href=\"#1-Fiber\" class=\"headerlink\" title=\"1. Fiber\"></a>1. Fiber</h2><p>很长时间React团队一直致力于实现异步渲染以减少交互的卡顿现象，最后的产物就是Fiber。</p>\n<p>Fiber的基本原理：</p>\n<p>1.把可中断的工作拆分成小任务</p>\n<p>2.对正在做的工作调整优先次序、重做、复用上次（做了一半的）成果</p>\n<p>3.在父子任务之间从容切换（yield back and forth），以支持React执行过程中的布局刷新</p>\n<p>总结：改变原来一次性渲染到结束的不可控的线性栈式数据结构，变为多次渲染可控的小颗粒状的链式数据结构。做到主要的先渲染，耗时渲染可中断，未完成的可继续。</p>","more":"<h2 id=\"2-导致问题\"><a href=\"#2-导致问题\" class=\"headerlink\" title=\"2. 导致问题\"></a>2. 导致问题</h2><p>由于渲染的过程是可以中断的异步行为，所以<code>componentWillMount</code>、<code>componentWillReceiveProps</code>、<code>componentWillUpdate</code>会在一次渲染过程中被重复调用，而导致一些问题。react17版本将弃用这些生命周期函数，但是可以使用带<code>UNSAFE_</code>的前缀的生命周期函数来替代使用。</p>\n<h2 id=\"3-从传统生命周期迁移\"><a href=\"#3-从传统生命周期迁移\" class=\"headerlink\" title=\"3. 从传统生命周期迁移\"></a>3. 从传统生命周期迁移</h2><p>为了解决上面的问题react引入了两个新的生命周期，<code>static getDerivedStateFromProps</code>和<code>getSnapshotBeforeUpdate</code>。</p>\n<h3 id=\"getDerivedStateFromProps\"><a href=\"#getDerivedStateFromProps\" class=\"headerlink\" title=\"getDerivedStateFromProps\"></a>getDerivedStateFromProps</h3><p>组件实例化以及重新渲染之前会调用这个函数，输出一个对象去更新 state ，或者输出 null 表明组件不需要任何状态更新。与 componentDidUpdate 一起使用，将代替 componentWillReceiveProps。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Example</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">static</span> getDerivedStateFromProps(props, state) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"getSnapshotBeforeUpdate\"><a href=\"#getSnapshotBeforeUpdate\" class=\"headerlink\" title=\"getSnapshotBeforeUpdate\"></a>getSnapshotBeforeUpdate</h3><p>进行变化（例如在更新DOM之前）之前会调用这个函数。此生命周期的返回值将作为第三个参数传递给componentDidUpdate。与 componentDidUpdate 一起使用，将代替 componentWillUpdate。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Example</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  getSnapshotBeforeUpdate(prevProps, prevState) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"4-事例\"><a href=\"#4-事例\" class=\"headerlink\" title=\"4. 事例\"></a>4. 事例</h2><h3 id=\"1-初始化状态\"><a href=\"#1-初始化状态\" class=\"headerlink\" title=\"1. 初始化状态\"></a>1. 初始化状态</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 旧代码</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ExampleComponent</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  state = &#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  componentWillMount() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.setState(&#123;</span><br><span class=\"line\">      <span class=\"attr\">currentColor</span>: <span class=\"keyword\">this</span>.props.defaultColor,</span><br><span class=\"line\">      <span class=\"attr\">palette</span>: <span class=\"string\">'rgb'</span>,</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 新代码</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ExampleComponent</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  state = &#123;</span><br><span class=\"line\">    <span class=\"attr\">currentColor</span>: <span class=\"keyword\">this</span>.props.defaultColor,</span><br><span class=\"line\">    <span class=\"attr\">palette</span>: <span class=\"string\">'rgb'</span>,</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><strong>总结：状态的初始化直接在实例化的时候进行。</strong></p>\n<h3 id=\"2-远端数据获取\"><a href=\"#2-远端数据获取\" class=\"headerlink\" title=\"2. 远端数据获取\"></a>2. 远端数据获取</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 旧代码</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ExampleComponent</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  state = &#123;</span><br><span class=\"line\">    <span class=\"attr\">externalData</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  componentWillMount() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>._asyncRequest = loadMyAsyncData().then(</span><br><span class=\"line\">      <span class=\"function\"><span class=\"params\">externalData</span> =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>._asyncRequest = <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.setState(&#123;externalData&#125;);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  componentWillUnmount() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>._asyncRequest) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>._asyncRequest.cancel();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.state.externalData === <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// Render loading state ...</span></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// Render real UI ...</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 新代码</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ExampleComponent</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  state = &#123;</span><br><span class=\"line\">    <span class=\"attr\">externalData</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  componentDidMount() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>._asyncRequest = loadMyAsyncData().then(</span><br><span class=\"line\">      <span class=\"function\"><span class=\"params\">externalData</span> =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>._asyncRequest = <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.setState(&#123;externalData&#125;);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  componentWillUnmount() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>._asyncRequest) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>._asyncRequest.cancel();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.state.externalData === <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// Render loading state ...</span></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// Render real UI ...</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><strong>总结：componentDidMount中进行数据的请求。</strong></p>\n<h3 id=\"3-添加事件侦听器（或订阅）\"><a href=\"#3-添加事件侦听器（或订阅）\" class=\"headerlink\" title=\"3. 添加事件侦听器（或订阅）\"></a>3. 添加事件侦听器（或订阅）</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 旧代码</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ExampleComponent</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  componentWillMount() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.setState(&#123;</span><br><span class=\"line\">      <span class=\"attr\">subscribedValue</span>: <span class=\"keyword\">this</span>.props.dataSource.value,</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 不安全，会导致泄漏</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.props.dataSource.subscribe(</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.handleSubscriptionChange</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  componentWillUnmount() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.props.dataSource.unsubscribe(</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.handleSubscriptionChange</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  handleSubscriptionChange = <span class=\"function\"><span class=\"params\">dataSource</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.setState(&#123;</span><br><span class=\"line\">      <span class=\"attr\">subscribedValue</span>: dataSource.value,</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 新代码</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ExampleComponent</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  state = &#123;</span><br><span class=\"line\">    <span class=\"attr\">subscribedValue</span>: <span class=\"keyword\">this</span>.props.dataSource.value,</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  componentDidMount() &#123;</span><br><span class=\"line\">    <span class=\"comment\">//事件监听器只能在mount之后添加，</span></span><br><span class=\"line\">    <span class=\"comment\">//因此如果挂载中断或错误，它们不会泄漏。   </span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.props.dataSource.subscribe(</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.handleSubscriptionChange</span><br><span class=\"line\">    );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//外部值可能会在渲染和装载之间发生变化</span></span><br><span class=\"line\">    <span class=\"comment\">//在某些情况下，处理这种情况可能很重要。</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.state.subscribedValue !==</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.props.dataSource.value</span><br><span class=\"line\">    ) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.setState(&#123;</span><br><span class=\"line\">        <span class=\"attr\">subscribedValue</span>: <span class=\"keyword\">this</span>.props.dataSource.value,</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  componentWillUnmount() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.props.dataSource.unsubscribe(</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.handleSubscriptionChange</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  handleSubscriptionChange = <span class=\"function\"><span class=\"params\">dataSource</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.setState(&#123;</span><br><span class=\"line\">      <span class=\"attr\">subscribedValue</span>: dataSource.value,</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><strong>总结：componentDidMount中进行数据的绑定。</strong></p>\n<h3 id=\"4-基于-props-更新-state\"><a href=\"#4-基于-props-更新-state\" class=\"headerlink\" title=\"4. 基于 props 更新 state\"></a>4. 基于 props 更新 state</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 旧代码</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ExampleComponent</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  state = &#123;</span><br><span class=\"line\">    <span class=\"attr\">isScrollingDown</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  componentWillReceiveProps(nextProps) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.props.currentRow !== nextProps.currentRow) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.setState(&#123;</span><br><span class=\"line\">        <span class=\"attr\">isScrollingDown</span>:</span><br><span class=\"line\">          nextProps.currentRow &gt; <span class=\"keyword\">this</span>.props.currentRow,</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 新代码</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ExampleComponent</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">//在构造函数中初始化状态，</span></span><br><span class=\"line\">  <span class=\"comment\">//或者使用属性初始值设定项。</span></span><br><span class=\"line\">  state = &#123;</span><br><span class=\"line\">    <span class=\"attr\">isScrollingDown</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    <span class=\"attr\">lastRow</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">static</span> getDerivedStateFromProps(props, state) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (props.currentRow !== state.lastRow) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">        <span class=\"attr\">isScrollingDown</span>: props.currentRow &gt; state.lastRow,</span><br><span class=\"line\">        <span class=\"attr\">lastRow</span>: props.currentRow,</span><br><span class=\"line\">      &#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 返回null表示状态没有变化。</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><strong>总结：使用 getDerivedStateFromProps 代替 componentWillReceiveProps。用 state 的属性代替 nextProps</strong></p>\n<h3 id=\"5-调用外部回调\"><a href=\"#5-调用外部回调\" class=\"headerlink\" title=\"5. 调用外部回调\"></a>5. 调用外部回调</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 旧代码</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ExampleComponent</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  componentWillUpdate(nextProps, nextState) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.state.someStatefulValue !==</span><br><span class=\"line\">      nextState.someStatefulValue</span><br><span class=\"line\">    ) &#123;</span><br><span class=\"line\">      nextProps.onChange(nextState.someStatefulValue);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 新代码</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ExampleComponent</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  componentDidUpdate(prevProps, prevState) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.state.someStatefulValue !==</span><br><span class=\"line\">      prevState.someStatefulValue</span><br><span class=\"line\">    ) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.props.onChange(<span class=\"keyword\">this</span>.state.someStatefulValue);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><strong>总结：用 componentDidUpdate 代替 componentWillUpdate。</strong></p>\n<h3 id=\"6-有副作用的props更新\"><a href=\"#6-有副作用的props更新\" class=\"headerlink\" title=\"6. 有副作用的props更新\"></a>6. 有副作用的props更新</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 旧代码</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ExampleComponent</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  componentWillReceiveProps(nextProps) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.props.isVisible !== nextProps.isVisible) &#123;</span><br><span class=\"line\">      logVisibleChange(nextProps.isVisible);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 新代码</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ExampleComponent</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  componentDidUpdate(prevProps, prevState) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.props.isVisible !== prevProps.isVisible) &#123;</span><br><span class=\"line\">      logVisibleChange(<span class=\"keyword\">this</span>.props.isVisible);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><strong>总结：使用 componentDidUpdate 代替 componentWillReceiveProps。</strong></p>\n<h3 id=\"7-props-改变后请求远端数据\"><a href=\"#7-props-改变后请求远端数据\" class=\"headerlink\" title=\"7. props 改变后请求远端数据\"></a>7. props 改变后请求远端数据</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 旧代码</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ExampleComponent</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  state = &#123;</span><br><span class=\"line\">    <span class=\"attr\">externalData</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  componentDidMount() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>._loadAsyncData(<span class=\"keyword\">this</span>.props.id);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  componentWillReceiveProps(nextProps) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (nextProps.id !== <span class=\"keyword\">this</span>.props.id) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.setState(&#123;<span class=\"attr\">externalData</span>: <span class=\"literal\">null</span>&#125;);</span><br><span class=\"line\">      <span class=\"keyword\">this</span>._loadAsyncData(nextProps.id);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  componentWillUnmount() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>._asyncRequest) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>._asyncRequest.cancel();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.state.externalData === <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// Render loading state ...</span></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// Render real UI ...</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  _loadAsyncData(id) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>._asyncRequest = loadMyAsyncData(id).then(</span><br><span class=\"line\">      <span class=\"function\"><span class=\"params\">externalData</span> =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>._asyncRequest = <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.setState(&#123;externalData&#125;);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 新代码</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ExampleComponent</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  state = &#123;</span><br><span class=\"line\">    <span class=\"attr\">externalData</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">static</span> getDerivedStateFromProps(props, state) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//存储prevId状态，以便我们可以比较道具变化的时间。</span></span><br><span class=\"line\">    <span class=\"comment\">//清除以前加载的数据（因此我们不会渲染陈旧的东西）。</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (props.id !== state.prevId) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">        <span class=\"attr\">externalData</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">        <span class=\"comment\">// 代替 prevProps.id</span></span><br><span class=\"line\">        prevId: props.id,</span><br><span class=\"line\">      &#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 状态没有改变</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  componentDidMount() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>._loadAsyncData(<span class=\"keyword\">this</span>.props.id);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  componentDidUpdate(prevProps, prevState) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.state.externalData === <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>._loadAsyncData(<span class=\"keyword\">this</span>.props.id);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  componentWillUnmount() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>._asyncRequest) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>._asyncRequest.cancel();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.state.externalData === <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 渲染加载状态...</span></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 渲染UI ...</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  _loadAsyncData(id) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>._asyncRequest = loadMyAsyncData(id).then(</span><br><span class=\"line\">      <span class=\"function\"><span class=\"params\">externalData</span> =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>._asyncRequest = <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.setState(&#123;externalData&#125;);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><strong>总结：使用 componentDidUpdate 代替 componentWillReceiveProps，业务的关键状态用state临时保存</strong></p>\n<h3 id=\"7-在更新之前读取DOM属性\"><a href=\"#7-在更新之前读取DOM属性\" class=\"headerlink\" title=\"7. 在更新之前读取DOM属性\"></a>7. 在更新之前读取DOM属性</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 旧代码</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ScrollingList</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  listRef = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  previousScrollOffset = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  componentWillUpdate(nextProps, nextState) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//我们是否在列表中添加新元素？</span></span><br><span class=\"line\">    <span class=\"comment\">//捕获滚动位置，以便我们稍后调整滚动。</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.props.list.length &lt; nextProps.list.length) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.previousScrollOffset =</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.listRef.scrollHeight - <span class=\"keyword\">this</span>.listRef.scrollTop;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  componentDidUpdate(prevProps, prevState) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//如果设置了previousScrollOffset，我们刚刚添加了新项目。</span></span><br><span class=\"line\">    <span class=\"comment\">//调整滚动，以便这些新项目不会将旧项目推出视图。</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.previousScrollOffset !== <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.listRef.scrollTop =</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.listRef.scrollHeight -</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.previousScrollOffset;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.previousScrollOffset = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">ref</span>=<span class=\"string\">&#123;this.setListRef&#125;</span>&gt;</span></span><br><span class=\"line\">        &#123;/* ...内容... */&#125;</span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  setListRef = <span class=\"function\"><span class=\"params\">ref</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.listRef = ref;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 新代码</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ScrollingList</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  listRef = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  getSnapshotBeforeUpdate(prevProps, prevState) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//我们是否在列表中添加新项目？</span></span><br><span class=\"line\">    <span class=\"comment\">//捕获滚动位置，以便我们稍后调整滚动。</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (prevProps.list.length &lt; <span class=\"keyword\">this</span>.props.list.length) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> (</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.listRef.scrollHeight - <span class=\"keyword\">this</span>.listRef.scrollTop</span><br><span class=\"line\">      );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  componentDidUpdate(prevProps, prevState, snapshot) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//如果我们有快照值，我们刚刚添加了新项目。</span></span><br><span class=\"line\">    <span class=\"comment\">//调整滚动，以便这些新项目不会将旧项目推出视图。</span></span><br><span class=\"line\">    <span class=\"comment\">//这里的 snapshot 就是 getSnapshotBeforeUpdate 的返回</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (snapshot !== <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.listRef.scrollTop =</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.listRef.scrollHeight - snapshot;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">ref</span>=<span class=\"string\">&#123;this.setListRef&#125;</span>&gt;</span></span><br><span class=\"line\">        &#123;/* ...内容... */&#125;</span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  setListRef = <span class=\"function\"><span class=\"params\">ref</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.listRef = ref;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><strong>总结：getSnapshotBeforeUpdate 代替 componentDidUpdate</strong></p>\n<h2 id=\"4-写在最后的总结\"><a href=\"#4-写在最后的总结\" class=\"headerlink\" title=\"4. 写在最后的总结\"></a>4. 写在最后的总结</h2><h3 id=\"1-原来几个含有will的生命周期函数基本上是没有用了，就算用也是用在不触发UI改变的业务上。\"><a href=\"#1-原来几个含有will的生命周期函数基本上是没有用了，就算用也是用在不触发UI改变的业务上。\" class=\"headerlink\" title=\"1. 原来几个含有will的生命周期函数基本上是没有用了，就算用也是用在不触发UI改变的业务上。\"></a>1. 原来几个含有will的生命周期函数基本上是没有用了，就算用也是用在不触发UI改变的业务上。</h3><h3 id=\"2-现在能比较前后状态的生命周期函数只有-componentDidUpdate-和-getSnapshotBeforeUpdate。\"><a href=\"#2-现在能比较前后状态的生命周期函数只有-componentDidUpdate-和-getSnapshotBeforeUpdate。\" class=\"headerlink\" title=\"2. 现在能比较前后状态的生命周期函数只有 componentDidUpdate 和 getSnapshotBeforeUpdate。\"></a>2. 现在能比较前后状态的生命周期函数只有 componentDidUpdate 和 getSnapshotBeforeUpdate。</h3><h3 id=\"3-比较前后状态的能用-componentDidUpdate-解就用-componentDidUpdate-解决。不能满足的用-static-getDerivedStateFromProps-来代替。\"><a href=\"#3-比较前后状态的能用-componentDidUpdate-解就用-componentDidUpdate-解决。不能满足的用-static-getDerivedStateFromProps-来代替。\" class=\"headerlink\" title=\"3. 比较前后状态的能用 componentDidUpdate 解就用 componentDidUpdate 解决。不能满足的用 static getDerivedStateFromProps 来代替。\"></a>3. 比较前后状态的能用 componentDidUpdate 解就用 componentDidUpdate 解决。不能满足的用 static getDerivedStateFromProps 来代替。</h3><h3 id=\"4-使用-static-getDerivedStateFromProps-的要把关键的业务状态添加到-state-里作为-prevProps-的替代\"><a href=\"#4-使用-static-getDerivedStateFromProps-的要把关键的业务状态添加到-state-里作为-prevProps-的替代\" class=\"headerlink\" title=\"4. 使用 static getDerivedStateFromProps 的要把关键的业务状态添加到 state 里作为 prevProps 的替代\"></a>4. 使用 static getDerivedStateFromProps 的要把关键的业务状态添加到 state 里作为 prevProps 的替代</h3>"},{"title":"ubuntu安装Jenkins","date":"2017-12-06T11:40:19.000Z","_content":"\n## A. 首先查看是否安装了`JDK`和`JRE`（建议`openjdk-7-jre`和`openjdk-7-jdk`）：\n\n```bash\njava -version\n```\n如果没有安装，执行：\n\n1.更新包指数\n\n```bash\nsudo apt-get update\n```\n\n2.安装Java运行时环境\n\n```bash\nsudo apt-get install default-jre\n```\n\n3.安装JDK\n\n```bash\nsudo apt-get install default-jdk\n```\n<!--more-->\n## B. 下面的步骤是正式安装`Jenkins`：\n1.获取秘钥\n```bash\nwget -q -O - https://pkg.jenkins.io/debian/jenkins-ci.org.key | sudo apt-key add -\n```\n\n2.添加源列表\n```bash\nsudo sh -c 'echo deb http://pkg.jenkins.io/debian-stable binary/ > /etc/apt/sources.list.d/jenkins.list'\n```\n\n3.更新\n```bash\nsudo apt-get update\n```\n\n4.安装\n```bash\nsudo apt-get install jenkins\n```\n\nJenkins服务默认运行在8080端口，如果Jenkins服务不能启动，可以编辑：\n```bash\n/etc/default/jenkins\n```\n替换\n```txt\nHTTP_PORT=8080\n```\n为\n```txt\nHTTP_PORT=8000\n```\n8000为你所希望Jenkins服务的端口\n\n5.打开浏览器输了你的主机ip和Jenkins的服务端口如：192.168.1.22:8080\n\n6.页面会索要一个key，key的地址 `/var/lib/jenkins/secrets/initialAdminPassword`","source":"_posts/ubuntu安装Jenkins.md","raw":"---\ntitle: ubuntu安装Jenkins\ndate: 2017-12-06 19:40:19\ntags: ['CI','持续集成','jenkins','continuous integration','ubuntu']\ncategory: 'coding'\n---\n\n## A. 首先查看是否安装了`JDK`和`JRE`（建议`openjdk-7-jre`和`openjdk-7-jdk`）：\n\n```bash\njava -version\n```\n如果没有安装，执行：\n\n1.更新包指数\n\n```bash\nsudo apt-get update\n```\n\n2.安装Java运行时环境\n\n```bash\nsudo apt-get install default-jre\n```\n\n3.安装JDK\n\n```bash\nsudo apt-get install default-jdk\n```\n<!--more-->\n## B. 下面的步骤是正式安装`Jenkins`：\n1.获取秘钥\n```bash\nwget -q -O - https://pkg.jenkins.io/debian/jenkins-ci.org.key | sudo apt-key add -\n```\n\n2.添加源列表\n```bash\nsudo sh -c 'echo deb http://pkg.jenkins.io/debian-stable binary/ > /etc/apt/sources.list.d/jenkins.list'\n```\n\n3.更新\n```bash\nsudo apt-get update\n```\n\n4.安装\n```bash\nsudo apt-get install jenkins\n```\n\nJenkins服务默认运行在8080端口，如果Jenkins服务不能启动，可以编辑：\n```bash\n/etc/default/jenkins\n```\n替换\n```txt\nHTTP_PORT=8080\n```\n为\n```txt\nHTTP_PORT=8000\n```\n8000为你所希望Jenkins服务的端口\n\n5.打开浏览器输了你的主机ip和Jenkins的服务端口如：192.168.1.22:8080\n\n6.页面会索要一个key，key的地址 `/var/lib/jenkins/secrets/initialAdminPassword`","slug":"ubuntu安装Jenkins","published":1,"updated":"2019-02-20T02:50:38.572Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjsgue0ez0014gpi6i5sjqqly","content":"<h2 id=\"A-首先查看是否安装了JDK和JRE（建议openjdk-7-jre和openjdk-7-jdk）：\"><a href=\"#A-首先查看是否安装了JDK和JRE（建议openjdk-7-jre和openjdk-7-jdk）：\" class=\"headerlink\" title=\"A. 首先查看是否安装了JDK和JRE（建议openjdk-7-jre和openjdk-7-jdk）：\"></a>A. 首先查看是否安装了<code>JDK</code>和<code>JRE</code>（建议<code>openjdk-7-jre</code>和<code>openjdk-7-jdk</code>）：</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">java -version</span><br></pre></td></tr></table></figure>\n<p>如果没有安装，执行：</p>\n<p>1.更新包指数</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get update</span><br></pre></td></tr></table></figure>\n<p>2.安装Java运行时环境</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install default-jre</span><br></pre></td></tr></table></figure>\n<p>3.安装JDK</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install default-jdk</span><br></pre></td></tr></table></figure>\n<a id=\"more\"></a>\n<h2 id=\"B-下面的步骤是正式安装Jenkins：\"><a href=\"#B-下面的步骤是正式安装Jenkins：\" class=\"headerlink\" title=\"B. 下面的步骤是正式安装Jenkins：\"></a>B. 下面的步骤是正式安装<code>Jenkins</code>：</h2><p>1.获取秘钥<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget -q -O - https://pkg.jenkins.io/debian/jenkins-ci.org.key | sudo apt-key add -</span><br></pre></td></tr></table></figure></p>\n<p>2.添加源列表<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo sh -c <span class=\"string\">'echo deb http://pkg.jenkins.io/debian-stable binary/ &gt; /etc/apt/sources.list.d/jenkins.list'</span></span><br></pre></td></tr></table></figure></p>\n<p>3.更新<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get update</span><br></pre></td></tr></table></figure></p>\n<p>4.安装<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install jenkins</span><br></pre></td></tr></table></figure></p>\n<p>Jenkins服务默认运行在8080端口，如果Jenkins服务不能启动，可以编辑：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/etc/default/jenkins</span><br></pre></td></tr></table></figure></p>\n<p>替换<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP_PORT=8080</span><br></pre></td></tr></table></figure></p>\n<p>为<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP_PORT=8000</span><br></pre></td></tr></table></figure></p>\n<p>8000为你所希望Jenkins服务的端口</p>\n<p>5.打开浏览器输了你的主机ip和Jenkins的服务端口如：192.168.1.22:8080</p>\n<p>6.页面会索要一个key，key的地址 <code>/var/lib/jenkins/secrets/initialAdminPassword</code></p>\n","excerpt":"<h2 id=\"A-首先查看是否安装了JDK和JRE（建议openjdk-7-jre和openjdk-7-jdk）：\"><a href=\"#A-首先查看是否安装了JDK和JRE（建议openjdk-7-jre和openjdk-7-jdk）：\" class=\"headerlink\" title=\"A. 首先查看是否安装了JDK和JRE（建议openjdk-7-jre和openjdk-7-jdk）：\"></a>A. 首先查看是否安装了<code>JDK</code>和<code>JRE</code>（建议<code>openjdk-7-jre</code>和<code>openjdk-7-jdk</code>）：</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">java -version</span><br></pre></td></tr></table></figure>\n<p>如果没有安装，执行：</p>\n<p>1.更新包指数</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get update</span><br></pre></td></tr></table></figure>\n<p>2.安装Java运行时环境</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install default-jre</span><br></pre></td></tr></table></figure>\n<p>3.安装JDK</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install default-jdk</span><br></pre></td></tr></table></figure>","more":"<h2 id=\"B-下面的步骤是正式安装Jenkins：\"><a href=\"#B-下面的步骤是正式安装Jenkins：\" class=\"headerlink\" title=\"B. 下面的步骤是正式安装Jenkins：\"></a>B. 下面的步骤是正式安装<code>Jenkins</code>：</h2><p>1.获取秘钥<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget -q -O - https://pkg.jenkins.io/debian/jenkins-ci.org.key | sudo apt-key add -</span><br></pre></td></tr></table></figure></p>\n<p>2.添加源列表<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo sh -c <span class=\"string\">'echo deb http://pkg.jenkins.io/debian-stable binary/ &gt; /etc/apt/sources.list.d/jenkins.list'</span></span><br></pre></td></tr></table></figure></p>\n<p>3.更新<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get update</span><br></pre></td></tr></table></figure></p>\n<p>4.安装<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install jenkins</span><br></pre></td></tr></table></figure></p>\n<p>Jenkins服务默认运行在8080端口，如果Jenkins服务不能启动，可以编辑：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/etc/default/jenkins</span><br></pre></td></tr></table></figure></p>\n<p>替换<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP_PORT=8080</span><br></pre></td></tr></table></figure></p>\n<p>为<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP_PORT=8000</span><br></pre></td></tr></table></figure></p>\n<p>8000为你所希望Jenkins服务的端口</p>\n<p>5.打开浏览器输了你的主机ip和Jenkins的服务端口如：192.168.1.22:8080</p>\n<p>6.页面会索要一个key，key的地址 <code>/var/lib/jenkins/secrets/initialAdminPassword</code></p>"},{"title":"基于nodejs的简单RESTful服务代码","date":"2018-06-04T08:56:20.000Z","_content":"代码很见简单主要是用来练习nodejs的http模块的，随便了解了解RESTful和cURL命令。代码走起……\n<!--more-->\n```javascript\nconst http = require('http');\nconst url = require('url');\n\nconst items = [];\n\nconst server = http.createServer(function (req, res) {\n    const path = url.parse(req.url).pathname;\n    const index = parseInt(path.slice(1), 10);\n    switch (req.method) {\n        case 'POST':\n            let item = '';\n            req.setEncoding('utf8');// 数据设为字符串\n            req.on('data', function (chunk) {// 读入新的数据块就会触发 data 事件 默认是 buffer 字节数组\n                item = item + chunk\n            });\n            req.on('end', function () {// 数据读完了触发 end 事件\n                items.push(item);\n                res.end('OK\\n');\n            });\n            break;\n        case 'GET':\n            let body = items.map((item, index) => {\n                return index + '\\t' + item;\n            }).join('\\n') + '\\n';\n            res.setHeader('Content-Length', Buffer.byteLength(body));\n            res.setHeader('Content-Type', 'text/plain; charset=\"utf8\"');\n            res.end(body);\n            break;\n        case 'DELETE':\n            if (isNaN(index)) {\n                res.statusCode = 400;// 表示无效\n                res.end('Invalid item id');\n            } else if (!items[index]) {\n                res.statusCode = 404;// 表示不存在\n                res.end('item not found');\n            } else {\n                items.splice(index, 1);\n                res.end('OK\\n');\n            }\n            break;\n        case 'PUT':\n            if (isNaN(index)) {\n                res.statusCode = 400;// 表示无效\n                res.end('Invalid item id');\n            } else if (!items[index]) {\n                res.statusCode = 404;// 表示不存在\n                res.end('item not found');\n            } else {\n                let item = '';\n                req.setEncoding('utf8');// 数据设为字符串\n                req.on('data', function (chunk) {// 读入新的数据块就会触发 data 事件 默认是 buffer 字节数组\n                    item = item + chunk\n                });\n                req.on('end', function () {// 数据读完了触发 end 事件\n                    items[index] = item;\n                    res.end('OK\\n');\n                });\n                res.end('OK\\n');\n            }\n            break;\n        default:\n            break;\n    }\n});\nserver.listen(3000);\nconsole.log('server is running');\n```\n\n## 下面说说`RESTful`：\n> `表现层状态转换 (REST)`是一种基于HTTP定义一组约束和属性的架构风格。符合REST架构风格或REST风格的Web服务的Web服务提供了互联网上计算机系统之间的交互操作。符合REST的Web服务允许请求系统通过使用统一和预定义的一组无状态操作来访问和操作文本表示的Web资源。\n\nwiki百科 [`Representational state transfer`](https://en.wikipedia.org/wiki/Representational_state_transfer)\n\n## 下面说说`cURL`：\n > `cURL`是利用URL语法在命令行方式下工作的开源文件传输工具。它被广泛应用在Unix、多种Linux发行版中，并且有DOS和Win32、Win64下的移植版本。\n\nwiki百科 [`cURL`](https://en.wikipedia.org/wiki/CURL)\n\n### 基本语法\n```bash\n# GET\ncurl http://xxxx.xxx\n# POST\ncurl -d 'post something' http://xxxx.xxx\n# DELETE\ncurl -XDELETE http://xxxx.xxx/x\n# PUT\ncurl -XPUT -d 'put something' http://xxxx.xxx/x\n```\n","source":"_posts/基于nodejs的简单RESTful服务代码.md","raw":"---\ntitle: 基于nodejs的简单RESTful服务代码\ndate: 2018-06-04 16:56:20\ntags: ['nodejs','RESTful','http','cURL']\ncategory: 'coding'\n---\n代码很见简单主要是用来练习nodejs的http模块的，随便了解了解RESTful和cURL命令。代码走起……\n<!--more-->\n```javascript\nconst http = require('http');\nconst url = require('url');\n\nconst items = [];\n\nconst server = http.createServer(function (req, res) {\n    const path = url.parse(req.url).pathname;\n    const index = parseInt(path.slice(1), 10);\n    switch (req.method) {\n        case 'POST':\n            let item = '';\n            req.setEncoding('utf8');// 数据设为字符串\n            req.on('data', function (chunk) {// 读入新的数据块就会触发 data 事件 默认是 buffer 字节数组\n                item = item + chunk\n            });\n            req.on('end', function () {// 数据读完了触发 end 事件\n                items.push(item);\n                res.end('OK\\n');\n            });\n            break;\n        case 'GET':\n            let body = items.map((item, index) => {\n                return index + '\\t' + item;\n            }).join('\\n') + '\\n';\n            res.setHeader('Content-Length', Buffer.byteLength(body));\n            res.setHeader('Content-Type', 'text/plain; charset=\"utf8\"');\n            res.end(body);\n            break;\n        case 'DELETE':\n            if (isNaN(index)) {\n                res.statusCode = 400;// 表示无效\n                res.end('Invalid item id');\n            } else if (!items[index]) {\n                res.statusCode = 404;// 表示不存在\n                res.end('item not found');\n            } else {\n                items.splice(index, 1);\n                res.end('OK\\n');\n            }\n            break;\n        case 'PUT':\n            if (isNaN(index)) {\n                res.statusCode = 400;// 表示无效\n                res.end('Invalid item id');\n            } else if (!items[index]) {\n                res.statusCode = 404;// 表示不存在\n                res.end('item not found');\n            } else {\n                let item = '';\n                req.setEncoding('utf8');// 数据设为字符串\n                req.on('data', function (chunk) {// 读入新的数据块就会触发 data 事件 默认是 buffer 字节数组\n                    item = item + chunk\n                });\n                req.on('end', function () {// 数据读完了触发 end 事件\n                    items[index] = item;\n                    res.end('OK\\n');\n                });\n                res.end('OK\\n');\n            }\n            break;\n        default:\n            break;\n    }\n});\nserver.listen(3000);\nconsole.log('server is running');\n```\n\n## 下面说说`RESTful`：\n> `表现层状态转换 (REST)`是一种基于HTTP定义一组约束和属性的架构风格。符合REST架构风格或REST风格的Web服务的Web服务提供了互联网上计算机系统之间的交互操作。符合REST的Web服务允许请求系统通过使用统一和预定义的一组无状态操作来访问和操作文本表示的Web资源。\n\nwiki百科 [`Representational state transfer`](https://en.wikipedia.org/wiki/Representational_state_transfer)\n\n## 下面说说`cURL`：\n > `cURL`是利用URL语法在命令行方式下工作的开源文件传输工具。它被广泛应用在Unix、多种Linux发行版中，并且有DOS和Win32、Win64下的移植版本。\n\nwiki百科 [`cURL`](https://en.wikipedia.org/wiki/CURL)\n\n### 基本语法\n```bash\n# GET\ncurl http://xxxx.xxx\n# POST\ncurl -d 'post something' http://xxxx.xxx\n# DELETE\ncurl -XDELETE http://xxxx.xxx/x\n# PUT\ncurl -XPUT -d 'put something' http://xxxx.xxx/x\n```\n","slug":"基于nodejs的简单RESTful服务代码","published":1,"updated":"2019-02-20T02:50:38.655Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjsgue0f10016gpi6azcidofk","content":"<p>代码很见简单主要是用来练习nodejs的http模块的，随便了解了解RESTful和cURL命令。代码走起……<br><a id=\"more\"></a><br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> http = <span class=\"built_in\">require</span>(<span class=\"string\">'http'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> url = <span class=\"built_in\">require</span>(<span class=\"string\">'url'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> items = [];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> server = http.createServer(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> path = url.parse(req.url).pathname;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> index = <span class=\"built_in\">parseInt</span>(path.slice(<span class=\"number\">1</span>), <span class=\"number\">10</span>);</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (req.method) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">'POST'</span>:</span><br><span class=\"line\">            <span class=\"keyword\">let</span> item = <span class=\"string\">''</span>;</span><br><span class=\"line\">            req.setEncoding(<span class=\"string\">'utf8'</span>);<span class=\"comment\">// 数据设为字符串</span></span><br><span class=\"line\">            req.on(<span class=\"string\">'data'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">chunk</span>) </span>&#123;<span class=\"comment\">// 读入新的数据块就会触发 data 事件 默认是 buffer 字节数组</span></span><br><span class=\"line\">                item = item + chunk</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            req.on(<span class=\"string\">'end'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;<span class=\"comment\">// 数据读完了触发 end 事件</span></span><br><span class=\"line\">                items.push(item);</span><br><span class=\"line\">                res.end(<span class=\"string\">'OK\\n'</span>);</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">'GET'</span>:</span><br><span class=\"line\">            <span class=\"keyword\">let</span> body = items.map(<span class=\"function\">(<span class=\"params\">item, index</span>) =&gt;</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> index + <span class=\"string\">'\\t'</span> + item;</span><br><span class=\"line\">            &#125;).join(<span class=\"string\">'\\n'</span>) + <span class=\"string\">'\\n'</span>;</span><br><span class=\"line\">            res.setHeader(<span class=\"string\">'Content-Length'</span>, Buffer.byteLength(body));</span><br><span class=\"line\">            res.setHeader(<span class=\"string\">'Content-Type'</span>, <span class=\"string\">'text/plain; charset=\"utf8\"'</span>);</span><br><span class=\"line\">            res.end(body);</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">'DELETE'</span>:</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"built_in\">isNaN</span>(index)) &#123;</span><br><span class=\"line\">                res.statusCode = <span class=\"number\">400</span>;<span class=\"comment\">// 表示无效</span></span><br><span class=\"line\">                res.end(<span class=\"string\">'Invalid item id'</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (!items[index]) &#123;</span><br><span class=\"line\">                res.statusCode = <span class=\"number\">404</span>;<span class=\"comment\">// 表示不存在</span></span><br><span class=\"line\">                res.end(<span class=\"string\">'item not found'</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                items.splice(index, <span class=\"number\">1</span>);</span><br><span class=\"line\">                res.end(<span class=\"string\">'OK\\n'</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">'PUT'</span>:</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"built_in\">isNaN</span>(index)) &#123;</span><br><span class=\"line\">                res.statusCode = <span class=\"number\">400</span>;<span class=\"comment\">// 表示无效</span></span><br><span class=\"line\">                res.end(<span class=\"string\">'Invalid item id'</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (!items[index]) &#123;</span><br><span class=\"line\">                res.statusCode = <span class=\"number\">404</span>;<span class=\"comment\">// 表示不存在</span></span><br><span class=\"line\">                res.end(<span class=\"string\">'item not found'</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">let</span> item = <span class=\"string\">''</span>;</span><br><span class=\"line\">                req.setEncoding(<span class=\"string\">'utf8'</span>);<span class=\"comment\">// 数据设为字符串</span></span><br><span class=\"line\">                req.on(<span class=\"string\">'data'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">chunk</span>) </span>&#123;<span class=\"comment\">// 读入新的数据块就会触发 data 事件 默认是 buffer 字节数组</span></span><br><span class=\"line\">                    item = item + chunk</span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\">                req.on(<span class=\"string\">'end'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;<span class=\"comment\">// 数据读完了触发 end 事件</span></span><br><span class=\"line\">                    items[index] = item;</span><br><span class=\"line\">                    res.end(<span class=\"string\">'OK\\n'</span>);</span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\">                res.end(<span class=\"string\">'OK\\n'</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">default</span>:</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">server.listen(<span class=\"number\">3000</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">'server is running'</span>);</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"下面说说RESTful：\"><a href=\"#下面说说RESTful：\" class=\"headerlink\" title=\"下面说说RESTful：\"></a>下面说说<code>RESTful</code>：</h2><blockquote>\n<p><code>表现层状态转换 (REST)</code>是一种基于HTTP定义一组约束和属性的架构风格。符合REST架构风格或REST风格的Web服务的Web服务提供了互联网上计算机系统之间的交互操作。符合REST的Web服务允许请求系统通过使用统一和预定义的一组无状态操作来访问和操作文本表示的Web资源。</p>\n</blockquote>\n<p>wiki百科 <a href=\"https://en.wikipedia.org/wiki/Representational_state_transfer\" target=\"_blank\" rel=\"external\"><code>Representational state transfer</code></a></p>\n<h2 id=\"下面说说cURL：\"><a href=\"#下面说说cURL：\" class=\"headerlink\" title=\"下面说说cURL：\"></a>下面说说<code>cURL</code>：</h2><blockquote>\n<p><code>cURL</code>是利用URL语法在命令行方式下工作的开源文件传输工具。它被广泛应用在Unix、多种Linux发行版中，并且有DOS和Win32、Win64下的移植版本。</p>\n</blockquote>\n<p>wiki百科 <a href=\"https://en.wikipedia.org/wiki/CURL\" target=\"_blank\" rel=\"external\"><code>cURL</code></a></p>\n<h3 id=\"基本语法\"><a href=\"#基本语法\" class=\"headerlink\" title=\"基本语法\"></a>基本语法</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># GET</span></span><br><span class=\"line\">curl http://xxxx.xxx</span><br><span class=\"line\"><span class=\"comment\"># POST</span></span><br><span class=\"line\">curl -d <span class=\"string\">'post something'</span> http://xxxx.xxx</span><br><span class=\"line\"><span class=\"comment\"># DELETE</span></span><br><span class=\"line\">curl -XDELETE http://xxxx.xxx/x</span><br><span class=\"line\"><span class=\"comment\"># PUT</span></span><br><span class=\"line\">curl -XPUT -d <span class=\"string\">'put something'</span> http://xxxx.xxx/x</span><br></pre></td></tr></table></figure>\n","excerpt":"<p>代码很见简单主要是用来练习nodejs的http模块的，随便了解了解RESTful和cURL命令。代码走起……<br>","more":"<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> http = <span class=\"built_in\">require</span>(<span class=\"string\">'http'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> url = <span class=\"built_in\">require</span>(<span class=\"string\">'url'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> items = [];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> server = http.createServer(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> path = url.parse(req.url).pathname;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> index = <span class=\"built_in\">parseInt</span>(path.slice(<span class=\"number\">1</span>), <span class=\"number\">10</span>);</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (req.method) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">'POST'</span>:</span><br><span class=\"line\">            <span class=\"keyword\">let</span> item = <span class=\"string\">''</span>;</span><br><span class=\"line\">            req.setEncoding(<span class=\"string\">'utf8'</span>);<span class=\"comment\">// 数据设为字符串</span></span><br><span class=\"line\">            req.on(<span class=\"string\">'data'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">chunk</span>) </span>&#123;<span class=\"comment\">// 读入新的数据块就会触发 data 事件 默认是 buffer 字节数组</span></span><br><span class=\"line\">                item = item + chunk</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            req.on(<span class=\"string\">'end'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;<span class=\"comment\">// 数据读完了触发 end 事件</span></span><br><span class=\"line\">                items.push(item);</span><br><span class=\"line\">                res.end(<span class=\"string\">'OK\\n'</span>);</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">'GET'</span>:</span><br><span class=\"line\">            <span class=\"keyword\">let</span> body = items.map(<span class=\"function\">(<span class=\"params\">item, index</span>) =&gt;</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> index + <span class=\"string\">'\\t'</span> + item;</span><br><span class=\"line\">            &#125;).join(<span class=\"string\">'\\n'</span>) + <span class=\"string\">'\\n'</span>;</span><br><span class=\"line\">            res.setHeader(<span class=\"string\">'Content-Length'</span>, Buffer.byteLength(body));</span><br><span class=\"line\">            res.setHeader(<span class=\"string\">'Content-Type'</span>, <span class=\"string\">'text/plain; charset=\"utf8\"'</span>);</span><br><span class=\"line\">            res.end(body);</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">'DELETE'</span>:</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"built_in\">isNaN</span>(index)) &#123;</span><br><span class=\"line\">                res.statusCode = <span class=\"number\">400</span>;<span class=\"comment\">// 表示无效</span></span><br><span class=\"line\">                res.end(<span class=\"string\">'Invalid item id'</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (!items[index]) &#123;</span><br><span class=\"line\">                res.statusCode = <span class=\"number\">404</span>;<span class=\"comment\">// 表示不存在</span></span><br><span class=\"line\">                res.end(<span class=\"string\">'item not found'</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                items.splice(index, <span class=\"number\">1</span>);</span><br><span class=\"line\">                res.end(<span class=\"string\">'OK\\n'</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">'PUT'</span>:</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"built_in\">isNaN</span>(index)) &#123;</span><br><span class=\"line\">                res.statusCode = <span class=\"number\">400</span>;<span class=\"comment\">// 表示无效</span></span><br><span class=\"line\">                res.end(<span class=\"string\">'Invalid item id'</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (!items[index]) &#123;</span><br><span class=\"line\">                res.statusCode = <span class=\"number\">404</span>;<span class=\"comment\">// 表示不存在</span></span><br><span class=\"line\">                res.end(<span class=\"string\">'item not found'</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">let</span> item = <span class=\"string\">''</span>;</span><br><span class=\"line\">                req.setEncoding(<span class=\"string\">'utf8'</span>);<span class=\"comment\">// 数据设为字符串</span></span><br><span class=\"line\">                req.on(<span class=\"string\">'data'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">chunk</span>) </span>&#123;<span class=\"comment\">// 读入新的数据块就会触发 data 事件 默认是 buffer 字节数组</span></span><br><span class=\"line\">                    item = item + chunk</span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\">                req.on(<span class=\"string\">'end'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;<span class=\"comment\">// 数据读完了触发 end 事件</span></span><br><span class=\"line\">                    items[index] = item;</span><br><span class=\"line\">                    res.end(<span class=\"string\">'OK\\n'</span>);</span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\">                res.end(<span class=\"string\">'OK\\n'</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">default</span>:</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">server.listen(<span class=\"number\">3000</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">'server is running'</span>);</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"下面说说RESTful：\"><a href=\"#下面说说RESTful：\" class=\"headerlink\" title=\"下面说说RESTful：\"></a>下面说说<code>RESTful</code>：</h2><blockquote>\n<p><code>表现层状态转换 (REST)</code>是一种基于HTTP定义一组约束和属性的架构风格。符合REST架构风格或REST风格的Web服务的Web服务提供了互联网上计算机系统之间的交互操作。符合REST的Web服务允许请求系统通过使用统一和预定义的一组无状态操作来访问和操作文本表示的Web资源。</p>\n</blockquote>\n<p>wiki百科 <a href=\"https://en.wikipedia.org/wiki/Representational_state_transfer\"><code>Representational state transfer</code></a></p>\n<h2 id=\"下面说说cURL：\"><a href=\"#下面说说cURL：\" class=\"headerlink\" title=\"下面说说cURL：\"></a>下面说说<code>cURL</code>：</h2><blockquote>\n<p><code>cURL</code>是利用URL语法在命令行方式下工作的开源文件传输工具。它被广泛应用在Unix、多种Linux发行版中，并且有DOS和Win32、Win64下的移植版本。</p>\n</blockquote>\n<p>wiki百科 <a href=\"https://en.wikipedia.org/wiki/CURL\"><code>cURL</code></a></p>\n<h3 id=\"基本语法\"><a href=\"#基本语法\" class=\"headerlink\" title=\"基本语法\"></a>基本语法</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># GET</span></span><br><span class=\"line\">curl http://xxxx.xxx</span><br><span class=\"line\"><span class=\"comment\"># POST</span></span><br><span class=\"line\">curl -d <span class=\"string\">'post something'</span> http://xxxx.xxx</span><br><span class=\"line\"><span class=\"comment\"># DELETE</span></span><br><span class=\"line\">curl -XDELETE http://xxxx.xxx/x</span><br><span class=\"line\"><span class=\"comment\"># PUT</span></span><br><span class=\"line\">curl -XPUT -d <span class=\"string\">'put something'</span> http://xxxx.xxx/x</span><br></pre></td></tr></table></figure>"},{"title":"webpack的常用插件","date":"2017-11-05T12:29:15.000Z","_content":"\n__project__\n\n``` diff\nhtml-webpack-plugin\n|- package.json\n|- webpack.config.js\n|- /src\n  |- index.js\n  |- style.css\n|- /index.html\n|- /node_modules\n```\n\n<!--more -->\n__index.html__\n``` html\n<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"UTF-8\">\n    <title>hello webpack</title>\n    <meta name=\"description\" content=\"\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n</head>\n<body>\n<script src=\"./dist/index.js\"></script>\n</body>\n</html>\n```\n__package.json__\n\n``` javascript\n{\n  \"name\": \"html-webpack-plugin\",\n  \"version\": \"1.0.0\",\n  \"description\": \"\",\n  \"main\": \"index.js\",\n  \"scripts\": {\n    \"build\": \"webpack --config webpack.config.js\"\n  },\n  \"repository\": {},\n  \"keywords\": [],\n  \"author\": \"\",\n  \"license\": \"ISC\",\n  \"devDependencies\": {\n    \"css-loader\": \"^0.28.7\",\n    \"style-loader\": \"^0.19.0\",\n    \"webpack\": \"^3.8.1\"\n  }\n}\n```\n__webpack.config.js__\n\n``` javascript\nconst path = require('path');\n\nmodule.exports = {\n    entry: {\n        index: './src/index.js',\n    },\n    output: {\n        filename: '[name].js',\n        path: path.resolve(__dirname, 'dist'),\n    },\n    module: {\n        rules: [\n            {\n                test: /\\.css$/,\n                use: [\n                    { loader: 'style-loader' },\n                    {\n                        loader: 'css-loader',\n                        options: {\n                            modules: true\n                        }\n                    }\n                ]\n            }\n        ]\n    }\n};\n```\n\n\n__src/index.js__\n\n``` javascript\nimport style from './style.css';\n\nconst h1 = document.createElement('h1');\nh1.className = style.danger;\nh1.innerHTML = 'hello webpack';\ndocument.body.appendChild(h1);\n```\n\n__src/style.css__\n\n``` css\n.danger{\n    color: red\n}\n```\n\n```bash\nnpm i\nnpm run build\n```\n__extract-text-webpack-plugin__\n\n[extract-text-webpack-plugin](https://doc.webpack-china.org/plugins/extract-text-webpack-plugin/)：从捆绑包或捆绑包中提取文本到单独的文件中。\n\n```bash\nnpm install --save-dev extract-text-webpack-plugin\n```\n\n``` diff \nconst path = require('path');\n+const ExtractTextWebpackPlugin = require('extract-text-webpack-plugin');\n\nmodule.exports = {\n    entry: {\n        index: './src/index.js',\n    },\n    output: {\n        filename: '[name].js',\n        path: path.resolve(__dirname, 'dist'),\n    },\n    module: {\n        rules: [\n-           {\n-               test: /\\.css$/,\n-               use: [\n-                  { loader: 'style-loader' },\n-                  {\n-                       loader: 'css-loader',\n-                       options: {\n-                           modules: true\n-                       }\n-                   }\n-               ]\n-           }\n+           {\n+               test: /\\.css$/,\n+               use: ExtractTextWebpackPlugin.extract({\n+                   fallback: \"style-loader\",\n+                   use: [{\n+                       loader: 'css-loader',\n+                       options: {\n+                           modules: true,\n+                           localIdentName: '[path]_[name]_[local]_[hash:base64:5]'\n+                       }\n+                   }]\n+               })\n+           }\n        ]\n-   }\n+   },\n+plugins: [\n+       new ExtractTextWebpackPlugin(\"style.css\")\n+   ]\n};\n```\n__index.html__\n``` diff\n<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"UTF-8\">\n    <title>hello webpack</title>\n    <meta name=\"description\" content=\"\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n+   <link type=\"text/css\" rel=\"stylesheet\" href=\"./dist/style.css\"/>\n</head>\n<body>\n<script src=\"./dist/index.js\"></script>\n</body>\n</html>\n```\n```bash\nnpm run build\n```\n```javascript\nuse: ExtractTextWebpackPlugin.extract(\n    {\n        fallback: \"style-loader\", // 编译后用什么loader来提取css文件\n        use: \"css-loader\" // 指需要什么样的loader去编译文件,这里由于源文件是.css所以选择css-loader\n    }\n)\n\n```\n__clean-webpack-plugin__\n\n[clean-webpack-plugin](https://www.npmjs.com/package/clean-webpack-plugin)：对目标文件的清理\n\n```bash\nnpm install --save-dev clean-webpack-plugin\n```\n\n``` diff \nconst path = require('path');\nconst ExtractTextWebpackPlugin = require('extract-text-webpack-plugin');\n+const CleanWebpackPlugin = require('clean-webpack-plugin');\n\nmodule.exports = {\n    entry: {\n        index: './src/index.js',\n    },\n    output: {\n        filename: '[name].js',\n        path: path.resolve(__dirname, 'dist'),\n    },\n    module: {\n        rules: [\n           {\n               test: /\\.css$/,\n               use: ExtractTextWebpackPlugin.extract({\n                   fallback: \"style-loader\",\n                   use: [{\n                       loader: 'css-loader',\n                       options: {\n                           modules: true,\n                           localIdentName: '[path]_[name]_[local]_[hash:base64:5]'\n                       }\n                   }]\n               })\n           }\n        ]\n     },\nplugins: [\n+       new CleanWebpackPlugin(['dist']),\n        new ExtractTextWebpackPlugin(\"style.css\")\n    ]\n};\n```\n```bash\nnpm run build\n```\n```javascript\n//参数说明\nnew CleanWebpackPlugin(\n    ['dist/main.*.js','dist/manifest.*.js'],　  //匹配删除的文件\n    {\n        root: __dirname,       　　　　　　　　　　//根目录\n        verbose:  true,        　　　　　　　　　　//开启在控制台输出信息\n        dry:      false        　　　　　　　　　　//启用删除文件\n    }\n)\n```\n\n__html-webpack-plugin__\n[html-webpack-plugin](https://doc.webpack-china.org/plugins/html-webpack-plugin)：简化了HTML文件的创建，以便为您的webpack包提供服务。 这对于在文件名中包含每次会随着变异会发生变化的哈希的webpack bundle尤其有用。\n\n```bash\nnpm install --save-dev html-webpack-plugin\n```\n``` diff \nconst path = require('path');\nconst ExtractTextWebpackPlugin = require('extract-text-webpack-plugin');\nconst CleanWebpackPlugin = require('clean-webpack-plugin');\n+const HtmlWebpackPlugin = require('html-webpack-plugin');\n\nmodule.exports = {\n    entry: {\n        index: './src/index.js',\n    },\n    output: {\n        filename: '[name].js',\n        path: path.resolve(__dirname, 'dist'),\n    },\n    module: {\n        rules: [\n           {\n               test: /\\.css$/,\n               use: ExtractTextWebpackPlugin.extract({\n                   fallback: \"style-loader\",\n                   use: [{\n                       loader: 'css-loader',\n                       options: {\n                           modules: true,\n                           localIdentName: '[path]_[name]_[local]_[hash:base64:5]'\n                       }\n                   }]\n               })\n           }\n        ]\n     },\nplugins: [\n+       new HtmlWebpackPlugin({\n+           filename: 'main.html',\n+           template: './src/template.html',\n+           title: 'Webpack App title from webpack'\n+       }),\n        new CleanWebpackPlugin(['dist']),\n        new ExtractTextWebpackPlugin(\"style.css\")\n    ]\n};\n```\n\n\n__src/template.html__\n\n``` html\n<html>\n  <head>\n    <meta charset=\"UTF-8\">\n    <title><%= htmlWebpackPlugin.options.title %></title>\n  </head>\n  <body></body>\n</html>\n```\n```bash\nnpm run build  \n```\n```javascript\n//参数说明\nnew HtmlWebpackPlugin(\n    {\n        title: 'Webpack App title from webpack', // 用来生成页面的 title 元素\n        filename: 'main.html', // 输出的 HTML 文件名，默认是 index.html, 也可以直接配置带有子目录。\n        template: './src/template.html' // 模板文件路径，支持加载器，比如 html!./index.html\n        inject: 'head', // true | 'head' | 'body' | false  ,注入所有的资源到特定的 template 或者    templateContent 中，如果设置为 true 或者 body，所有的 javascript 资源将被放置到 body 元素的底部，'head' 将放置到 head 元素中。\n        favicon: 'path/to/yourfile.ico', // 添加特定的 favicon 路径到输出的 HTML 文件中。\n        minify: { // {} | false , 传递 html-minifier 选项给 minify 输出\n            removeAttributeQuotes: true // 移除属性的引号\n        },\n        hash: true, // true | false, 如果为 true, 将添加一个唯一的 webpack 编译 hash 到所有包含的脚本和 CSS件，对于解除 cache 很有用。<script type=text/javascript src=bundle.js?22b9692e22e7be37b57e></script>\n        cache: true, // true | false，如果为 true, 这是默认值，仅仅在文件修改之后才会发布文件。\n        showErrors:true, // true | false, 如果为 true, 这是默认值，错误信息会写入到 HTML 页面中\n        chunks: ['chunk1','chunk2'], // 允许只添加某些块 (比如，仅仅 unit test 块)\n        excludeChunks: ['chunk3','chunk4'],// 允许跳过某些块，(比如，跳过单元测试的块)        \n    }\n)\n```\n>参考https://segmentfault.com/a/1190000007294861\n","source":"_posts/webpack的常用插件.md","raw":"---\ntitle: webpack的常用插件\ndate: 2017-11-05 20:29:15\ntags: ['webpack','前端','js','javascript']\ncategory: 'coding'\n---\n\n__project__\n\n``` diff\nhtml-webpack-plugin\n|- package.json\n|- webpack.config.js\n|- /src\n  |- index.js\n  |- style.css\n|- /index.html\n|- /node_modules\n```\n\n<!--more -->\n__index.html__\n``` html\n<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"UTF-8\">\n    <title>hello webpack</title>\n    <meta name=\"description\" content=\"\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n</head>\n<body>\n<script src=\"./dist/index.js\"></script>\n</body>\n</html>\n```\n__package.json__\n\n``` javascript\n{\n  \"name\": \"html-webpack-plugin\",\n  \"version\": \"1.0.0\",\n  \"description\": \"\",\n  \"main\": \"index.js\",\n  \"scripts\": {\n    \"build\": \"webpack --config webpack.config.js\"\n  },\n  \"repository\": {},\n  \"keywords\": [],\n  \"author\": \"\",\n  \"license\": \"ISC\",\n  \"devDependencies\": {\n    \"css-loader\": \"^0.28.7\",\n    \"style-loader\": \"^0.19.0\",\n    \"webpack\": \"^3.8.1\"\n  }\n}\n```\n__webpack.config.js__\n\n``` javascript\nconst path = require('path');\n\nmodule.exports = {\n    entry: {\n        index: './src/index.js',\n    },\n    output: {\n        filename: '[name].js',\n        path: path.resolve(__dirname, 'dist'),\n    },\n    module: {\n        rules: [\n            {\n                test: /\\.css$/,\n                use: [\n                    { loader: 'style-loader' },\n                    {\n                        loader: 'css-loader',\n                        options: {\n                            modules: true\n                        }\n                    }\n                ]\n            }\n        ]\n    }\n};\n```\n\n\n__src/index.js__\n\n``` javascript\nimport style from './style.css';\n\nconst h1 = document.createElement('h1');\nh1.className = style.danger;\nh1.innerHTML = 'hello webpack';\ndocument.body.appendChild(h1);\n```\n\n__src/style.css__\n\n``` css\n.danger{\n    color: red\n}\n```\n\n```bash\nnpm i\nnpm run build\n```\n__extract-text-webpack-plugin__\n\n[extract-text-webpack-plugin](https://doc.webpack-china.org/plugins/extract-text-webpack-plugin/)：从捆绑包或捆绑包中提取文本到单独的文件中。\n\n```bash\nnpm install --save-dev extract-text-webpack-plugin\n```\n\n``` diff \nconst path = require('path');\n+const ExtractTextWebpackPlugin = require('extract-text-webpack-plugin');\n\nmodule.exports = {\n    entry: {\n        index: './src/index.js',\n    },\n    output: {\n        filename: '[name].js',\n        path: path.resolve(__dirname, 'dist'),\n    },\n    module: {\n        rules: [\n-           {\n-               test: /\\.css$/,\n-               use: [\n-                  { loader: 'style-loader' },\n-                  {\n-                       loader: 'css-loader',\n-                       options: {\n-                           modules: true\n-                       }\n-                   }\n-               ]\n-           }\n+           {\n+               test: /\\.css$/,\n+               use: ExtractTextWebpackPlugin.extract({\n+                   fallback: \"style-loader\",\n+                   use: [{\n+                       loader: 'css-loader',\n+                       options: {\n+                           modules: true,\n+                           localIdentName: '[path]_[name]_[local]_[hash:base64:5]'\n+                       }\n+                   }]\n+               })\n+           }\n        ]\n-   }\n+   },\n+plugins: [\n+       new ExtractTextWebpackPlugin(\"style.css\")\n+   ]\n};\n```\n__index.html__\n``` diff\n<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"UTF-8\">\n    <title>hello webpack</title>\n    <meta name=\"description\" content=\"\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n+   <link type=\"text/css\" rel=\"stylesheet\" href=\"./dist/style.css\"/>\n</head>\n<body>\n<script src=\"./dist/index.js\"></script>\n</body>\n</html>\n```\n```bash\nnpm run build\n```\n```javascript\nuse: ExtractTextWebpackPlugin.extract(\n    {\n        fallback: \"style-loader\", // 编译后用什么loader来提取css文件\n        use: \"css-loader\" // 指需要什么样的loader去编译文件,这里由于源文件是.css所以选择css-loader\n    }\n)\n\n```\n__clean-webpack-plugin__\n\n[clean-webpack-plugin](https://www.npmjs.com/package/clean-webpack-plugin)：对目标文件的清理\n\n```bash\nnpm install --save-dev clean-webpack-plugin\n```\n\n``` diff \nconst path = require('path');\nconst ExtractTextWebpackPlugin = require('extract-text-webpack-plugin');\n+const CleanWebpackPlugin = require('clean-webpack-plugin');\n\nmodule.exports = {\n    entry: {\n        index: './src/index.js',\n    },\n    output: {\n        filename: '[name].js',\n        path: path.resolve(__dirname, 'dist'),\n    },\n    module: {\n        rules: [\n           {\n               test: /\\.css$/,\n               use: ExtractTextWebpackPlugin.extract({\n                   fallback: \"style-loader\",\n                   use: [{\n                       loader: 'css-loader',\n                       options: {\n                           modules: true,\n                           localIdentName: '[path]_[name]_[local]_[hash:base64:5]'\n                       }\n                   }]\n               })\n           }\n        ]\n     },\nplugins: [\n+       new CleanWebpackPlugin(['dist']),\n        new ExtractTextWebpackPlugin(\"style.css\")\n    ]\n};\n```\n```bash\nnpm run build\n```\n```javascript\n//参数说明\nnew CleanWebpackPlugin(\n    ['dist/main.*.js','dist/manifest.*.js'],　  //匹配删除的文件\n    {\n        root: __dirname,       　　　　　　　　　　//根目录\n        verbose:  true,        　　　　　　　　　　//开启在控制台输出信息\n        dry:      false        　　　　　　　　　　//启用删除文件\n    }\n)\n```\n\n__html-webpack-plugin__\n[html-webpack-plugin](https://doc.webpack-china.org/plugins/html-webpack-plugin)：简化了HTML文件的创建，以便为您的webpack包提供服务。 这对于在文件名中包含每次会随着变异会发生变化的哈希的webpack bundle尤其有用。\n\n```bash\nnpm install --save-dev html-webpack-plugin\n```\n``` diff \nconst path = require('path');\nconst ExtractTextWebpackPlugin = require('extract-text-webpack-plugin');\nconst CleanWebpackPlugin = require('clean-webpack-plugin');\n+const HtmlWebpackPlugin = require('html-webpack-plugin');\n\nmodule.exports = {\n    entry: {\n        index: './src/index.js',\n    },\n    output: {\n        filename: '[name].js',\n        path: path.resolve(__dirname, 'dist'),\n    },\n    module: {\n        rules: [\n           {\n               test: /\\.css$/,\n               use: ExtractTextWebpackPlugin.extract({\n                   fallback: \"style-loader\",\n                   use: [{\n                       loader: 'css-loader',\n                       options: {\n                           modules: true,\n                           localIdentName: '[path]_[name]_[local]_[hash:base64:5]'\n                       }\n                   }]\n               })\n           }\n        ]\n     },\nplugins: [\n+       new HtmlWebpackPlugin({\n+           filename: 'main.html',\n+           template: './src/template.html',\n+           title: 'Webpack App title from webpack'\n+       }),\n        new CleanWebpackPlugin(['dist']),\n        new ExtractTextWebpackPlugin(\"style.css\")\n    ]\n};\n```\n\n\n__src/template.html__\n\n``` html\n<html>\n  <head>\n    <meta charset=\"UTF-8\">\n    <title><%= htmlWebpackPlugin.options.title %></title>\n  </head>\n  <body></body>\n</html>\n```\n```bash\nnpm run build  \n```\n```javascript\n//参数说明\nnew HtmlWebpackPlugin(\n    {\n        title: 'Webpack App title from webpack', // 用来生成页面的 title 元素\n        filename: 'main.html', // 输出的 HTML 文件名，默认是 index.html, 也可以直接配置带有子目录。\n        template: './src/template.html' // 模板文件路径，支持加载器，比如 html!./index.html\n        inject: 'head', // true | 'head' | 'body' | false  ,注入所有的资源到特定的 template 或者    templateContent 中，如果设置为 true 或者 body，所有的 javascript 资源将被放置到 body 元素的底部，'head' 将放置到 head 元素中。\n        favicon: 'path/to/yourfile.ico', // 添加特定的 favicon 路径到输出的 HTML 文件中。\n        minify: { // {} | false , 传递 html-minifier 选项给 minify 输出\n            removeAttributeQuotes: true // 移除属性的引号\n        },\n        hash: true, // true | false, 如果为 true, 将添加一个唯一的 webpack 编译 hash 到所有包含的脚本和 CSS件，对于解除 cache 很有用。<script type=text/javascript src=bundle.js?22b9692e22e7be37b57e></script>\n        cache: true, // true | false，如果为 true, 这是默认值，仅仅在文件修改之后才会发布文件。\n        showErrors:true, // true | false, 如果为 true, 这是默认值，错误信息会写入到 HTML 页面中\n        chunks: ['chunk1','chunk2'], // 允许只添加某些块 (比如，仅仅 unit test 块)\n        excludeChunks: ['chunk3','chunk4'],// 允许跳过某些块，(比如，跳过单元测试的块)        \n    }\n)\n```\n>参考https://segmentfault.com/a/1190000007294861\n","slug":"webpack的常用插件","published":1,"updated":"2019-02-20T02:50:38.623Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjsgue0f20019gpi61fizu1j8","content":"<p><strong>project</strong></p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">html-webpack-plugin</span><br><span class=\"line\">|- package.json</span><br><span class=\"line\">|- webpack.config.js</span><br><span class=\"line\">|- /src</span><br><span class=\"line\">  |- index.js</span><br><span class=\"line\">  |- style.css</span><br><span class=\"line\">|- /index.html</span><br><span class=\"line\">|- /node_modules</span><br></pre></td></tr></table></figure>\n<a id=\"more\"></a>\n<p><strong>index.html</strong><br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"UTF-8\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>hello webpack<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">\"description\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">\"viewport\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"width=device-width, initial-scale=1\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"./dist/index.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p><strong>package.json</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">\"name\"</span>: <span class=\"string\">\"html-webpack-plugin\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"version\"</span>: <span class=\"string\">\"1.0.0\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"description\"</span>: <span class=\"string\">\"\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"main\"</span>: <span class=\"string\">\"index.js\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"scripts\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">\"build\"</span>: <span class=\"string\">\"webpack --config webpack.config.js\"</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">\"repository\"</span>: &#123;&#125;,</span><br><span class=\"line\">  <span class=\"string\">\"keywords\"</span>: [],</span><br><span class=\"line\">  <span class=\"string\">\"author\"</span>: <span class=\"string\">\"\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"license\"</span>: <span class=\"string\">\"ISC\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"devDependencies\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">\"css-loader\"</span>: <span class=\"string\">\"^0.28.7\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"style-loader\"</span>: <span class=\"string\">\"^0.19.0\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"webpack\"</span>: <span class=\"string\">\"^3.8.1\"</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><strong>webpack.config.js</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">    <span class=\"attr\">entry</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">index</span>: <span class=\"string\">'./src/index.js'</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">output</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">filename</span>: <span class=\"string\">'[name].js'</span>,</span><br><span class=\"line\">        <span class=\"attr\">path</span>: path.resolve(__dirname, <span class=\"string\">'dist'</span>),</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">module</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">rules</span>: [</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.css$/</span>,</span><br><span class=\"line\">                <span class=\"attr\">use</span>: [</span><br><span class=\"line\">                    &#123; <span class=\"attr\">loader</span>: <span class=\"string\">'style-loader'</span> &#125;,</span><br><span class=\"line\">                    &#123;</span><br><span class=\"line\">                        <span class=\"attr\">loader</span>: <span class=\"string\">'css-loader'</span>,</span><br><span class=\"line\">                        <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">                            <span class=\"attr\">modules</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                ]</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p><strong>src/index.js</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> style <span class=\"keyword\">from</span> <span class=\"string\">'./style.css'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> h1 = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'h1'</span>);</span><br><span class=\"line\">h1.className = style.danger;</span><br><span class=\"line\">h1.innerHTML = <span class=\"string\">'hello webpack'</span>;</span><br><span class=\"line\"><span class=\"built_in\">document</span>.body.appendChild(h1);</span><br></pre></td></tr></table></figure>\n<p><strong>src/style.css</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.danger</span>&#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: red</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm i</span><br><span class=\"line\">npm run build</span><br></pre></td></tr></table></figure>\n<p><strong>extract-text-webpack-plugin</strong></p>\n<p><a href=\"https://doc.webpack-china.org/plugins/extract-text-webpack-plugin/\" target=\"_blank\" rel=\"external\">extract-text-webpack-plugin</a>：从捆绑包或捆绑包中提取文本到单独的文件中。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install --save-dev extract-text-webpack-plugin</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const path = require('path');</span><br><span class=\"line\"><span class=\"addition\">+const ExtractTextWebpackPlugin = require('extract-text-webpack-plugin');</span></span><br><span class=\"line\"></span><br><span class=\"line\">module.exports = &#123;</span><br><span class=\"line\">    entry: &#123;</span><br><span class=\"line\">        index: './src/index.js',</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    output: &#123;</span><br><span class=\"line\">        filename: '[name].js',</span><br><span class=\"line\">        path: path.resolve(__dirname, 'dist'),</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    module: &#123;</span><br><span class=\"line\">        rules: [</span><br><span class=\"line\"><span class=\"deletion\">-           &#123;</span></span><br><span class=\"line\"><span class=\"deletion\">-               test: /\\.css$/,</span></span><br><span class=\"line\"><span class=\"deletion\">-               use: [</span></span><br><span class=\"line\"><span class=\"deletion\">-                  &#123; loader: 'style-loader' &#125;,</span></span><br><span class=\"line\"><span class=\"deletion\">-                  &#123;</span></span><br><span class=\"line\"><span class=\"deletion\">-                       loader: 'css-loader',</span></span><br><span class=\"line\"><span class=\"deletion\">-                       options: &#123;</span></span><br><span class=\"line\"><span class=\"deletion\">-                           modules: true</span></span><br><span class=\"line\"><span class=\"deletion\">-                       &#125;</span></span><br><span class=\"line\"><span class=\"deletion\">-                   &#125;</span></span><br><span class=\"line\"><span class=\"deletion\">-               ]</span></span><br><span class=\"line\"><span class=\"deletion\">-           &#125;</span></span><br><span class=\"line\"><span class=\"addition\">+           &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+               test: /\\.css$/,</span></span><br><span class=\"line\"><span class=\"addition\">+               use: ExtractTextWebpackPlugin.extract(&#123;</span></span><br><span class=\"line\"><span class=\"addition\">+                   fallback: \"style-loader\",</span></span><br><span class=\"line\"><span class=\"addition\">+                   use: [&#123;</span></span><br><span class=\"line\"><span class=\"addition\">+                       loader: 'css-loader',</span></span><br><span class=\"line\"><span class=\"addition\">+                       options: &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+                           modules: true,</span></span><br><span class=\"line\"><span class=\"addition\">+                           localIdentName: '[path]_[name]_[local]_[hash:base64:5]'</span></span><br><span class=\"line\"><span class=\"addition\">+                       &#125;</span></span><br><span class=\"line\"><span class=\"addition\">+                   &#125;]</span></span><br><span class=\"line\"><span class=\"addition\">+               &#125;)</span></span><br><span class=\"line\"><span class=\"addition\">+           &#125;</span></span><br><span class=\"line\">        ]</span><br><span class=\"line\"><span class=\"deletion\">-   &#125;</span></span><br><span class=\"line\"><span class=\"addition\">+   &#125;,</span></span><br><span class=\"line\"><span class=\"addition\">+plugins: [</span></span><br><span class=\"line\"><span class=\"addition\">+       new ExtractTextWebpackPlugin(\"style.css\")</span></span><br><span class=\"line\"><span class=\"addition\">+   ]</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p><strong>index.html</strong><br><figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">    &lt;meta charset=\"UTF-8\"&gt;</span><br><span class=\"line\">    &lt;title&gt;hello webpack&lt;/title&gt;</span><br><span class=\"line\">    &lt;meta name=\"description\" content=\"\"&gt;</span><br><span class=\"line\">    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"&gt;</span><br><span class=\"line\"><span class=\"addition\">+   &lt;link type=\"text/css\" rel=\"stylesheet\" href=\"./dist/style.css\"/&gt;</span></span><br><span class=\"line\">&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">&lt;script src=\"./dist/index.js\"&gt;&lt;/script&gt;</span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm run build</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">use: ExtractTextWebpackPlugin.extract(</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"attr\">fallback</span>: <span class=\"string\">\"style-loader\"</span>, <span class=\"comment\">// 编译后用什么loader来提取css文件</span></span><br><span class=\"line\">        use: <span class=\"string\">\"css-loader\"</span> <span class=\"comment\">// 指需要什么样的loader去编译文件,这里由于源文件是.css所以选择css-loader</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n<p><strong>clean-webpack-plugin</strong></p>\n<p><a href=\"https://www.npmjs.com/package/clean-webpack-plugin\" target=\"_blank\" rel=\"external\">clean-webpack-plugin</a>：对目标文件的清理</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install --save-dev clean-webpack-plugin</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const path = require('path');</span><br><span class=\"line\">const ExtractTextWebpackPlugin = require('extract-text-webpack-plugin');</span><br><span class=\"line\"><span class=\"addition\">+const CleanWebpackPlugin = require('clean-webpack-plugin');</span></span><br><span class=\"line\"></span><br><span class=\"line\">module.exports = &#123;</span><br><span class=\"line\">    entry: &#123;</span><br><span class=\"line\">        index: './src/index.js',</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    output: &#123;</span><br><span class=\"line\">        filename: '[name].js',</span><br><span class=\"line\">        path: path.resolve(__dirname, 'dist'),</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    module: &#123;</span><br><span class=\"line\">        rules: [</span><br><span class=\"line\">           &#123;</span><br><span class=\"line\">               test: /\\.css$/,</span><br><span class=\"line\">               use: ExtractTextWebpackPlugin.extract(&#123;</span><br><span class=\"line\">                   fallback: \"style-loader\",</span><br><span class=\"line\">                   use: [&#123;</span><br><span class=\"line\">                       loader: 'css-loader',</span><br><span class=\"line\">                       options: &#123;</span><br><span class=\"line\">                           modules: true,</span><br><span class=\"line\">                           localIdentName: '[path]_[name]_[local]_[hash:base64:5]'</span><br><span class=\"line\">                       &#125;</span><br><span class=\"line\">                   &#125;]</span><br><span class=\"line\">               &#125;)</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">     &#125;,</span><br><span class=\"line\">plugins: [</span><br><span class=\"line\"><span class=\"addition\">+       new CleanWebpackPlugin(['dist']),</span></span><br><span class=\"line\">        new ExtractTextWebpackPlugin(\"style.css\")</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm run build</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//参数说明</span></span><br><span class=\"line\"><span class=\"keyword\">new</span> CleanWebpackPlugin(</span><br><span class=\"line\">    [<span class=\"string\">'dist/main.*.js'</span>,<span class=\"string\">'dist/manifest.*.js'</span>],　  <span class=\"comment\">//匹配删除的文件</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"attr\">root</span>: __dirname,       　　　　　　　　　　<span class=\"comment\">//根目录</span></span><br><span class=\"line\">        verbose:  <span class=\"literal\">true</span>,        　　　　　　　　　　<span class=\"comment\">//开启在控制台输出信息</span></span><br><span class=\"line\">        dry:      <span class=\"literal\">false</span>        　　　　　　　　　　<span class=\"comment\">//启用删除文件</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n<p><strong>html-webpack-plugin</strong><br><a href=\"https://doc.webpack-china.org/plugins/html-webpack-plugin\" target=\"_blank\" rel=\"external\">html-webpack-plugin</a>：简化了HTML文件的创建，以便为您的webpack包提供服务。 这对于在文件名中包含每次会随着变异会发生变化的哈希的webpack bundle尤其有用。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install --save-dev html-webpack-plugin</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const path = require('path');</span><br><span class=\"line\">const ExtractTextWebpackPlugin = require('extract-text-webpack-plugin');</span><br><span class=\"line\">const CleanWebpackPlugin = require('clean-webpack-plugin');</span><br><span class=\"line\"><span class=\"addition\">+const HtmlWebpackPlugin = require('html-webpack-plugin');</span></span><br><span class=\"line\"></span><br><span class=\"line\">module.exports = &#123;</span><br><span class=\"line\">    entry: &#123;</span><br><span class=\"line\">        index: './src/index.js',</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    output: &#123;</span><br><span class=\"line\">        filename: '[name].js',</span><br><span class=\"line\">        path: path.resolve(__dirname, 'dist'),</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    module: &#123;</span><br><span class=\"line\">        rules: [</span><br><span class=\"line\">           &#123;</span><br><span class=\"line\">               test: /\\.css$/,</span><br><span class=\"line\">               use: ExtractTextWebpackPlugin.extract(&#123;</span><br><span class=\"line\">                   fallback: \"style-loader\",</span><br><span class=\"line\">                   use: [&#123;</span><br><span class=\"line\">                       loader: 'css-loader',</span><br><span class=\"line\">                       options: &#123;</span><br><span class=\"line\">                           modules: true,</span><br><span class=\"line\">                           localIdentName: '[path]_[name]_[local]_[hash:base64:5]'</span><br><span class=\"line\">                       &#125;</span><br><span class=\"line\">                   &#125;]</span><br><span class=\"line\">               &#125;)</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">     &#125;,</span><br><span class=\"line\">plugins: [</span><br><span class=\"line\"><span class=\"addition\">+       new HtmlWebpackPlugin(&#123;</span></span><br><span class=\"line\"><span class=\"addition\">+           filename: 'main.html',</span></span><br><span class=\"line\"><span class=\"addition\">+           template: './src/template.html',</span></span><br><span class=\"line\"><span class=\"addition\">+           title: 'Webpack App title from webpack'</span></span><br><span class=\"line\"><span class=\"addition\">+       &#125;),</span></span><br><span class=\"line\">        new CleanWebpackPlugin(['dist']),</span><br><span class=\"line\">        new ExtractTextWebpackPlugin(\"style.css\")</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p><strong>src/template.html</strong></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"UTF-8\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">%=</span> <span class=\"attr\">htmlWebpackPlugin.options.title</span> %&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm run build</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//参数说明</span></span><br><span class=\"line\"><span class=\"keyword\">new</span> HtmlWebpackPlugin(</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"attr\">title</span>: <span class=\"string\">'Webpack App title from webpack'</span>, <span class=\"comment\">// 用来生成页面的 title 元素</span></span><br><span class=\"line\">        filename: <span class=\"string\">'main.html'</span>, <span class=\"comment\">// 输出的 HTML 文件名，默认是 index.html, 也可以直接配置带有子目录。</span></span><br><span class=\"line\">        template: <span class=\"string\">'./src/template.html'</span> <span class=\"comment\">// 模板文件路径，支持加载器，比如 html!./index.html</span></span><br><span class=\"line\">        inject: <span class=\"string\">'head'</span>, <span class=\"comment\">// true | 'head' | 'body' | false  ,注入所有的资源到特定的 template 或者    templateContent 中，如果设置为 true 或者 body，所有的 javascript 资源将被放置到 body 元素的底部，'head' 将放置到 head 元素中。</span></span><br><span class=\"line\">        favicon: <span class=\"string\">'path/to/yourfile.ico'</span>, <span class=\"comment\">// 添加特定的 favicon 路径到输出的 HTML 文件中。</span></span><br><span class=\"line\">        minify: &#123; <span class=\"comment\">// &#123;&#125; | false , 传递 html-minifier 选项给 minify 输出</span></span><br><span class=\"line\">            removeAttributeQuotes: <span class=\"literal\">true</span> <span class=\"comment\">// 移除属性的引号</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"attr\">hash</span>: <span class=\"literal\">true</span>, <span class=\"comment\">// true | false, 如果为 true, 将添加一个唯一的 webpack 编译 hash 到所有包含的脚本和 CSS件，对于解除 cache 很有用。&lt;script type=text/javascript src=bundle.js?22b9692e22e7be37b57e&gt;&lt;/script&gt;</span></span><br><span class=\"line\">        cache: <span class=\"literal\">true</span>, <span class=\"comment\">// true | false，如果为 true, 这是默认值，仅仅在文件修改之后才会发布文件。</span></span><br><span class=\"line\">        showErrors:<span class=\"literal\">true</span>, <span class=\"comment\">// true | false, 如果为 true, 这是默认值，错误信息会写入到 HTML 页面中</span></span><br><span class=\"line\">        chunks: [<span class=\"string\">'chunk1'</span>,<span class=\"string\">'chunk2'</span>], <span class=\"comment\">// 允许只添加某些块 (比如，仅仅 unit test 块)</span></span><br><span class=\"line\">        excludeChunks: [<span class=\"string\">'chunk3'</span>,<span class=\"string\">'chunk4'</span>],<span class=\"comment\">// 允许跳过某些块，(比如，跳过单元测试的块)        </span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>参考<a href=\"https://segmentfault.com/a/1190000007294861\" target=\"_blank\" rel=\"external\">https://segmentfault.com/a/1190000007294861</a></p>\n</blockquote>\n","excerpt":"<p><strong>project</strong></p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">html-webpack-plugin</span><br><span class=\"line\">|- package.json</span><br><span class=\"line\">|- webpack.config.js</span><br><span class=\"line\">|- /src</span><br><span class=\"line\">  |- index.js</span><br><span class=\"line\">  |- style.css</span><br><span class=\"line\">|- /index.html</span><br><span class=\"line\">|- /node_modules</span><br></pre></td></tr></table></figure>","more":"<p><strong>index.html</strong><br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"UTF-8\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>hello webpack<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">\"description\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">\"viewport\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"width=device-width, initial-scale=1\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"./dist/index.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p><strong>package.json</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">\"name\"</span>: <span class=\"string\">\"html-webpack-plugin\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"version\"</span>: <span class=\"string\">\"1.0.0\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"description\"</span>: <span class=\"string\">\"\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"main\"</span>: <span class=\"string\">\"index.js\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"scripts\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">\"build\"</span>: <span class=\"string\">\"webpack --config webpack.config.js\"</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">\"repository\"</span>: &#123;&#125;,</span><br><span class=\"line\">  <span class=\"string\">\"keywords\"</span>: [],</span><br><span class=\"line\">  <span class=\"string\">\"author\"</span>: <span class=\"string\">\"\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"license\"</span>: <span class=\"string\">\"ISC\"</span>,</span><br><span class=\"line\">  <span class=\"string\">\"devDependencies\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">\"css-loader\"</span>: <span class=\"string\">\"^0.28.7\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"style-loader\"</span>: <span class=\"string\">\"^0.19.0\"</span>,</span><br><span class=\"line\">    <span class=\"string\">\"webpack\"</span>: <span class=\"string\">\"^3.8.1\"</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><strong>webpack.config.js</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">    <span class=\"attr\">entry</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">index</span>: <span class=\"string\">'./src/index.js'</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">output</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">filename</span>: <span class=\"string\">'[name].js'</span>,</span><br><span class=\"line\">        <span class=\"attr\">path</span>: path.resolve(__dirname, <span class=\"string\">'dist'</span>),</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">module</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">rules</span>: [</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.css$/</span>,</span><br><span class=\"line\">                <span class=\"attr\">use</span>: [</span><br><span class=\"line\">                    &#123; <span class=\"attr\">loader</span>: <span class=\"string\">'style-loader'</span> &#125;,</span><br><span class=\"line\">                    &#123;</span><br><span class=\"line\">                        <span class=\"attr\">loader</span>: <span class=\"string\">'css-loader'</span>,</span><br><span class=\"line\">                        <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">                            <span class=\"attr\">modules</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                ]</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p><strong>src/index.js</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> style <span class=\"keyword\">from</span> <span class=\"string\">'./style.css'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> h1 = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'h1'</span>);</span><br><span class=\"line\">h1.className = style.danger;</span><br><span class=\"line\">h1.innerHTML = <span class=\"string\">'hello webpack'</span>;</span><br><span class=\"line\"><span class=\"built_in\">document</span>.body.appendChild(h1);</span><br></pre></td></tr></table></figure>\n<p><strong>src/style.css</strong></p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.danger</span>&#123;</span><br><span class=\"line\">    <span class=\"attribute\">color</span>: red</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm i</span><br><span class=\"line\">npm run build</span><br></pre></td></tr></table></figure>\n<p><strong>extract-text-webpack-plugin</strong></p>\n<p><a href=\"https://doc.webpack-china.org/plugins/extract-text-webpack-plugin/\">extract-text-webpack-plugin</a>：从捆绑包或捆绑包中提取文本到单独的文件中。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install --save-dev extract-text-webpack-plugin</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const path = require('path');</span><br><span class=\"line\"><span class=\"addition\">+const ExtractTextWebpackPlugin = require('extract-text-webpack-plugin');</span></span><br><span class=\"line\"></span><br><span class=\"line\">module.exports = &#123;</span><br><span class=\"line\">    entry: &#123;</span><br><span class=\"line\">        index: './src/index.js',</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    output: &#123;</span><br><span class=\"line\">        filename: '[name].js',</span><br><span class=\"line\">        path: path.resolve(__dirname, 'dist'),</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    module: &#123;</span><br><span class=\"line\">        rules: [</span><br><span class=\"line\"><span class=\"deletion\">-           &#123;</span></span><br><span class=\"line\"><span class=\"deletion\">-               test: /\\.css$/,</span></span><br><span class=\"line\"><span class=\"deletion\">-               use: [</span></span><br><span class=\"line\"><span class=\"deletion\">-                  &#123; loader: 'style-loader' &#125;,</span></span><br><span class=\"line\"><span class=\"deletion\">-                  &#123;</span></span><br><span class=\"line\"><span class=\"deletion\">-                       loader: 'css-loader',</span></span><br><span class=\"line\"><span class=\"deletion\">-                       options: &#123;</span></span><br><span class=\"line\"><span class=\"deletion\">-                           modules: true</span></span><br><span class=\"line\"><span class=\"deletion\">-                       &#125;</span></span><br><span class=\"line\"><span class=\"deletion\">-                   &#125;</span></span><br><span class=\"line\"><span class=\"deletion\">-               ]</span></span><br><span class=\"line\"><span class=\"deletion\">-           &#125;</span></span><br><span class=\"line\"><span class=\"addition\">+           &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+               test: /\\.css$/,</span></span><br><span class=\"line\"><span class=\"addition\">+               use: ExtractTextWebpackPlugin.extract(&#123;</span></span><br><span class=\"line\"><span class=\"addition\">+                   fallback: \"style-loader\",</span></span><br><span class=\"line\"><span class=\"addition\">+                   use: [&#123;</span></span><br><span class=\"line\"><span class=\"addition\">+                       loader: 'css-loader',</span></span><br><span class=\"line\"><span class=\"addition\">+                       options: &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+                           modules: true,</span></span><br><span class=\"line\"><span class=\"addition\">+                           localIdentName: '[path]_[name]_[local]_[hash:base64:5]'</span></span><br><span class=\"line\"><span class=\"addition\">+                       &#125;</span></span><br><span class=\"line\"><span class=\"addition\">+                   &#125;]</span></span><br><span class=\"line\"><span class=\"addition\">+               &#125;)</span></span><br><span class=\"line\"><span class=\"addition\">+           &#125;</span></span><br><span class=\"line\">        ]</span><br><span class=\"line\"><span class=\"deletion\">-   &#125;</span></span><br><span class=\"line\"><span class=\"addition\">+   &#125;,</span></span><br><span class=\"line\"><span class=\"addition\">+plugins: [</span></span><br><span class=\"line\"><span class=\"addition\">+       new ExtractTextWebpackPlugin(\"style.css\")</span></span><br><span class=\"line\"><span class=\"addition\">+   ]</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p><strong>index.html</strong><br><figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">    &lt;meta charset=\"UTF-8\"&gt;</span><br><span class=\"line\">    &lt;title&gt;hello webpack&lt;/title&gt;</span><br><span class=\"line\">    &lt;meta name=\"description\" content=\"\"&gt;</span><br><span class=\"line\">    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"&gt;</span><br><span class=\"line\"><span class=\"addition\">+   &lt;link type=\"text/css\" rel=\"stylesheet\" href=\"./dist/style.css\"/&gt;</span></span><br><span class=\"line\">&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">&lt;script src=\"./dist/index.js\"&gt;&lt;/script&gt;</span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm run build</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">use: ExtractTextWebpackPlugin.extract(</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"attr\">fallback</span>: <span class=\"string\">\"style-loader\"</span>, <span class=\"comment\">// 编译后用什么loader来提取css文件</span></span><br><span class=\"line\">        use: <span class=\"string\">\"css-loader\"</span> <span class=\"comment\">// 指需要什么样的loader去编译文件,这里由于源文件是.css所以选择css-loader</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n<p><strong>clean-webpack-plugin</strong></p>\n<p><a href=\"https://www.npmjs.com/package/clean-webpack-plugin\">clean-webpack-plugin</a>：对目标文件的清理</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install --save-dev clean-webpack-plugin</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const path = require('path');</span><br><span class=\"line\">const ExtractTextWebpackPlugin = require('extract-text-webpack-plugin');</span><br><span class=\"line\"><span class=\"addition\">+const CleanWebpackPlugin = require('clean-webpack-plugin');</span></span><br><span class=\"line\"></span><br><span class=\"line\">module.exports = &#123;</span><br><span class=\"line\">    entry: &#123;</span><br><span class=\"line\">        index: './src/index.js',</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    output: &#123;</span><br><span class=\"line\">        filename: '[name].js',</span><br><span class=\"line\">        path: path.resolve(__dirname, 'dist'),</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    module: &#123;</span><br><span class=\"line\">        rules: [</span><br><span class=\"line\">           &#123;</span><br><span class=\"line\">               test: /\\.css$/,</span><br><span class=\"line\">               use: ExtractTextWebpackPlugin.extract(&#123;</span><br><span class=\"line\">                   fallback: \"style-loader\",</span><br><span class=\"line\">                   use: [&#123;</span><br><span class=\"line\">                       loader: 'css-loader',</span><br><span class=\"line\">                       options: &#123;</span><br><span class=\"line\">                           modules: true,</span><br><span class=\"line\">                           localIdentName: '[path]_[name]_[local]_[hash:base64:5]'</span><br><span class=\"line\">                       &#125;</span><br><span class=\"line\">                   &#125;]</span><br><span class=\"line\">               &#125;)</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">     &#125;,</span><br><span class=\"line\">plugins: [</span><br><span class=\"line\"><span class=\"addition\">+       new CleanWebpackPlugin(['dist']),</span></span><br><span class=\"line\">        new ExtractTextWebpackPlugin(\"style.css\")</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm run build</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//参数说明</span></span><br><span class=\"line\"><span class=\"keyword\">new</span> CleanWebpackPlugin(</span><br><span class=\"line\">    [<span class=\"string\">'dist/main.*.js'</span>,<span class=\"string\">'dist/manifest.*.js'</span>],　  <span class=\"comment\">//匹配删除的文件</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"attr\">root</span>: __dirname,       　　　　　　　　　　<span class=\"comment\">//根目录</span></span><br><span class=\"line\">        verbose:  <span class=\"literal\">true</span>,        　　　　　　　　　　<span class=\"comment\">//开启在控制台输出信息</span></span><br><span class=\"line\">        dry:      <span class=\"literal\">false</span>        　　　　　　　　　　<span class=\"comment\">//启用删除文件</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n<p><strong>html-webpack-plugin</strong><br><a href=\"https://doc.webpack-china.org/plugins/html-webpack-plugin\">html-webpack-plugin</a>：简化了HTML文件的创建，以便为您的webpack包提供服务。 这对于在文件名中包含每次会随着变异会发生变化的哈希的webpack bundle尤其有用。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install --save-dev html-webpack-plugin</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const path = require('path');</span><br><span class=\"line\">const ExtractTextWebpackPlugin = require('extract-text-webpack-plugin');</span><br><span class=\"line\">const CleanWebpackPlugin = require('clean-webpack-plugin');</span><br><span class=\"line\"><span class=\"addition\">+const HtmlWebpackPlugin = require('html-webpack-plugin');</span></span><br><span class=\"line\"></span><br><span class=\"line\">module.exports = &#123;</span><br><span class=\"line\">    entry: &#123;</span><br><span class=\"line\">        index: './src/index.js',</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    output: &#123;</span><br><span class=\"line\">        filename: '[name].js',</span><br><span class=\"line\">        path: path.resolve(__dirname, 'dist'),</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    module: &#123;</span><br><span class=\"line\">        rules: [</span><br><span class=\"line\">           &#123;</span><br><span class=\"line\">               test: /\\.css$/,</span><br><span class=\"line\">               use: ExtractTextWebpackPlugin.extract(&#123;</span><br><span class=\"line\">                   fallback: \"style-loader\",</span><br><span class=\"line\">                   use: [&#123;</span><br><span class=\"line\">                       loader: 'css-loader',</span><br><span class=\"line\">                       options: &#123;</span><br><span class=\"line\">                           modules: true,</span><br><span class=\"line\">                           localIdentName: '[path]_[name]_[local]_[hash:base64:5]'</span><br><span class=\"line\">                       &#125;</span><br><span class=\"line\">                   &#125;]</span><br><span class=\"line\">               &#125;)</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">     &#125;,</span><br><span class=\"line\">plugins: [</span><br><span class=\"line\"><span class=\"addition\">+       new HtmlWebpackPlugin(&#123;</span></span><br><span class=\"line\"><span class=\"addition\">+           filename: 'main.html',</span></span><br><span class=\"line\"><span class=\"addition\">+           template: './src/template.html',</span></span><br><span class=\"line\"><span class=\"addition\">+           title: 'Webpack App title from webpack'</span></span><br><span class=\"line\"><span class=\"addition\">+       &#125;),</span></span><br><span class=\"line\">        new CleanWebpackPlugin(['dist']),</span><br><span class=\"line\">        new ExtractTextWebpackPlugin(\"style.css\")</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p><strong>src/template.html</strong></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"UTF-8\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">%=</span> <span class=\"attr\">htmlWebpackPlugin.options.title</span> %&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm run build</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//参数说明</span></span><br><span class=\"line\"><span class=\"keyword\">new</span> HtmlWebpackPlugin(</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"attr\">title</span>: <span class=\"string\">'Webpack App title from webpack'</span>, <span class=\"comment\">// 用来生成页面的 title 元素</span></span><br><span class=\"line\">        filename: <span class=\"string\">'main.html'</span>, <span class=\"comment\">// 输出的 HTML 文件名，默认是 index.html, 也可以直接配置带有子目录。</span></span><br><span class=\"line\">        template: <span class=\"string\">'./src/template.html'</span> <span class=\"comment\">// 模板文件路径，支持加载器，比如 html!./index.html</span></span><br><span class=\"line\">        inject: <span class=\"string\">'head'</span>, <span class=\"comment\">// true | 'head' | 'body' | false  ,注入所有的资源到特定的 template 或者    templateContent 中，如果设置为 true 或者 body，所有的 javascript 资源将被放置到 body 元素的底部，'head' 将放置到 head 元素中。</span></span><br><span class=\"line\">        favicon: <span class=\"string\">'path/to/yourfile.ico'</span>, <span class=\"comment\">// 添加特定的 favicon 路径到输出的 HTML 文件中。</span></span><br><span class=\"line\">        minify: &#123; <span class=\"comment\">// &#123;&#125; | false , 传递 html-minifier 选项给 minify 输出</span></span><br><span class=\"line\">            removeAttributeQuotes: <span class=\"literal\">true</span> <span class=\"comment\">// 移除属性的引号</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"attr\">hash</span>: <span class=\"literal\">true</span>, <span class=\"comment\">// true | false, 如果为 true, 将添加一个唯一的 webpack 编译 hash 到所有包含的脚本和 CSS件，对于解除 cache 很有用。&lt;script type=text/javascript src=bundle.js?22b9692e22e7be37b57e&gt;&lt;/script&gt;</span></span><br><span class=\"line\">        cache: <span class=\"literal\">true</span>, <span class=\"comment\">// true | false，如果为 true, 这是默认值，仅仅在文件修改之后才会发布文件。</span></span><br><span class=\"line\">        showErrors:<span class=\"literal\">true</span>, <span class=\"comment\">// true | false, 如果为 true, 这是默认值，错误信息会写入到 HTML 页面中</span></span><br><span class=\"line\">        chunks: [<span class=\"string\">'chunk1'</span>,<span class=\"string\">'chunk2'</span>], <span class=\"comment\">// 允许只添加某些块 (比如，仅仅 unit test 块)</span></span><br><span class=\"line\">        excludeChunks: [<span class=\"string\">'chunk3'</span>,<span class=\"string\">'chunk4'</span>],<span class=\"comment\">// 允许跳过某些块，(比如，跳过单元测试的块)        </span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>参考<a href=\"https://segmentfault.com/a/1190000007294861\">https://segmentfault.com/a/1190000007294861</a></p>\n</blockquote>"},{"title":"ubuntu16.0.4上python版本切换的问题","date":"2017-12-11T12:53:18.000Z","_content":"事情的经过是这样的：\n> 在安装一个npm项目的时候，终端输出了一行这样的错误\n\n```bash\ngyp verb check python checking for Python executable \"python2\" in the PATH\ngyp verb `which` failed Error: not found: python2\n```\n<!--more-->\n执行\n\n```bash\nwhich python\n```\n\n输出结果\n\n```bash\n/usr/bin/python\n```\n\n看来是版本的问题，\n于是安装python2\n\n```bash \napt-get update     \napt-get install python2.7\n```\n\n终端还是输出了错误\n\n```bash\ngyp verb check python checking for Python executable \"python2\" in the PATH\ngyp verb `which` failed Error: not found: python2\n```\n\n郁闷中，于是打开/usr/bin查看python\n\n```bash\nlrwxrwxrwx 1 root   root          18 Dec  9 17:39 python -> /usr/bin/python3.5*\n```\n\n原来python只是个软连接，执行命令\n\n```bash\nrm /usr/bin/python\nln -s /usr/bin/python2.7 /usr/bin/python \n```\n\n修改软连接，python版本修改成功，npm包顺利安装成功！\n","source":"_posts/ubuntu16-0-4上python版本切换的问题.md","raw":"---\ntitle: ubuntu16.0.4上python版本切换的问题\ndate: 2017-12-11 20:53:18\ntags: ['ubuntu','python','版本','版本管理','切换']\ncategory: 'coding'\n---\n事情的经过是这样的：\n> 在安装一个npm项目的时候，终端输出了一行这样的错误\n\n```bash\ngyp verb check python checking for Python executable \"python2\" in the PATH\ngyp verb `which` failed Error: not found: python2\n```\n<!--more-->\n执行\n\n```bash\nwhich python\n```\n\n输出结果\n\n```bash\n/usr/bin/python\n```\n\n看来是版本的问题，\n于是安装python2\n\n```bash \napt-get update     \napt-get install python2.7\n```\n\n终端还是输出了错误\n\n```bash\ngyp verb check python checking for Python executable \"python2\" in the PATH\ngyp verb `which` failed Error: not found: python2\n```\n\n郁闷中，于是打开/usr/bin查看python\n\n```bash\nlrwxrwxrwx 1 root   root          18 Dec  9 17:39 python -> /usr/bin/python3.5*\n```\n\n原来python只是个软连接，执行命令\n\n```bash\nrm /usr/bin/python\nln -s /usr/bin/python2.7 /usr/bin/python \n```\n\n修改软连接，python版本修改成功，npm包顺利安装成功！\n","slug":"ubuntu16-0-4上python版本切换的问题","published":1,"updated":"2019-02-20T02:50:38.565Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjsgue0f4001bgpi6ulp0s9a4","content":"<p>事情的经过是这样的：</p>\n<blockquote>\n<p>在安装一个npm项目的时候，终端输出了一行这样的错误</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">gyp verb check python checking <span class=\"keyword\">for</span> Python executable <span class=\"string\">\"python2\"</span> <span class=\"keyword\">in</span> the PATH</span><br><span class=\"line\">gyp verb `<span class=\"built_in\">which</span>` failed Error: not found: python2</span><br></pre></td></tr></table></figure>\n<a id=\"more\"></a>\n<p>执行</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">which</span> python</span><br></pre></td></tr></table></figure>\n<p>输出结果</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/usr/bin/python</span><br></pre></td></tr></table></figure>\n<p>看来是版本的问题，<br>于是安装python2</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-get update     </span><br><span class=\"line\">apt-get install python2.7</span><br></pre></td></tr></table></figure>\n<p>终端还是输出了错误</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">gyp verb check python checking <span class=\"keyword\">for</span> Python executable <span class=\"string\">\"python2\"</span> <span class=\"keyword\">in</span> the PATH</span><br><span class=\"line\">gyp verb `<span class=\"built_in\">which</span>` failed Error: not found: python2</span><br></pre></td></tr></table></figure>\n<p>郁闷中，于是打开/usr/bin查看python</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lrwxrwxrwx 1 root   root          18 Dec  9 17:39 python -&gt; /usr/bin/python3.5*</span><br></pre></td></tr></table></figure>\n<p>原来python只是个软连接，执行命令</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rm /usr/bin/python</span><br><span class=\"line\">ln -s /usr/bin/python2.7 /usr/bin/python</span><br></pre></td></tr></table></figure>\n<p>修改软连接，python版本修改成功，npm包顺利安装成功！</p>\n","excerpt":"<p>事情的经过是这样的：</p>\n<blockquote>\n<p>在安装一个npm项目的时候，终端输出了一行这样的错误</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">gyp verb check python checking <span class=\"keyword\">for</span> Python executable <span class=\"string\">\"python2\"</span> <span class=\"keyword\">in</span> the PATH</span><br><span class=\"line\">gyp verb `<span class=\"built_in\">which</span>` failed Error: not found: python2</span><br></pre></td></tr></table></figure>","more":"<p>执行</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">which</span> python</span><br></pre></td></tr></table></figure>\n<p>输出结果</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/usr/bin/python</span><br></pre></td></tr></table></figure>\n<p>看来是版本的问题，<br>于是安装python2</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-get update     </span><br><span class=\"line\">apt-get install python2.7</span><br></pre></td></tr></table></figure>\n<p>终端还是输出了错误</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">gyp verb check python checking <span class=\"keyword\">for</span> Python executable <span class=\"string\">\"python2\"</span> <span class=\"keyword\">in</span> the PATH</span><br><span class=\"line\">gyp verb `<span class=\"built_in\">which</span>` failed Error: not found: python2</span><br></pre></td></tr></table></figure>\n<p>郁闷中，于是打开/usr/bin查看python</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lrwxrwxrwx 1 root   root          18 Dec  9 17:39 python -&gt; /usr/bin/python3.5*</span><br></pre></td></tr></table></figure>\n<p>原来python只是个软连接，执行命令</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rm /usr/bin/python</span><br><span class=\"line\">ln -s /usr/bin/python2.7 /usr/bin/python</span><br></pre></td></tr></table></figure>\n<p>修改软连接，python版本修改成功，npm包顺利安装成功！</p>"},{"title":"使您的JavaScript纯净","date":"2017-11-11T03:06:59.000Z","_content":"\nOnce your website or application goes past a small number of lines, it will inevitably contain bugs of some sort.\n\n一旦您的网站或应用程序达到一定的代码量，它将不可避免地包含某些类型的错误。\n\nThis isn’t specific to JavaScript but is shared by nearly all languages—it’s very tricky, if not impossible, to thoroughly rule out the chance of any bugs in your application.\n\n这不是JavaScript特有的，而是几乎所有的程序语言都面临这个问题 - 这个问题非常棘手，是不是有可能，彻底的排除掉你的程序中出现任何错误的机会。\n\nHowever, that doesn’t mean we can’t take precautions by coding in a way that lessens our vulnerability to bugs.\n\n然而，这并不意味着我们不能通过编码以某种方式采取预防措施，使我们在bugs面前不显得那么脆弱。<!--more-->\n\n## __Pure and impure functions__\n## __纯和不纯的函数__\n\nA pure function is defined as one that doesn’t depend on or modify variables outside of its scope. That’s a bit of a mouthful, so let’s dive into some code for a more practical example.\n\n纯函数定义为不依赖于或修改其范围之外的变量的函数。但看这个定义等于什么也没说，所以让我们来看看一些更实际的例子。\n\n```javascript\nfunction mouseOnLeftSide(mouseX){\n    return mouseX < window.innerWidth / 2;\n}\n\ndocument.onmousemove =function(e) {\n    console.log(mouseOnLeftSide(e.pageX));\n};\n```\n\n`mouseOnLeftSide()` takes an X coordinate and checks to see if it’s less than half the window width—which would place it on the left side. However, `mouseOnLeftSide()` is not a pure function. We know this because within the body of the function, it refers to a value that it wasn’t explicitly given:\n\n`mouseOnLeftSide()`采取X坐标并检查是否小于窗口宽度的一半----以便将其放在左侧。但是，`mouseOnLeftSide()`不是纯函数。我们知道这一点，因为在函数体内，参考值不是一个确定值：\n\n```javascript\nreturn mouseX < window.innerWidth / 2;\n```\n\nThe function is given `mouseX`, but not `window.innerWidth`. This means the function is reaching out to access data it wasn’t given, and hence it’s not pure.\n\n该函数给出了 `mouseX`，但是 `window.innerWidth` 却不明确。这意味着该函数正在访问不确定的数据，因此它是不纯的。\n\n## __The problem with impure functions__\n## __不纯的函数是个问题__\n\nYou might ask why this is an issue—this piece of code works just fine and does the job expected of it. Imagine that you get a bug report from a user that when the window is less than 500 pixels wide the function is incorrect. How do you test this? You’ve got two options:\n\n你也许会问这怎么就是个问题了，代码不就是找到并且做他要做的事就可以了么。你想象一下，当你从某个用户那里得知当窗口小于500像素的时候功能就不正常了。你怎么测试代码？您已经有两个选项：\n\n1.You could manually test by loading up your browser and moving your mouse around until you’ve found the problem.\n\n1.您可以手动测试，通过浏览器加载你的程序，并且移动鼠标。直到你发现的问题。\n\n2.You could write some unit tests (Rebecca Murphey’s Writing Testable JavaScript is a great introduction) to not only track down the bug, but also ensure that it doesn’t happen again.\n\n2.你可以写一些单元测试（Rebecca Murphey写的 可测试性的JavaScript 是一个很好的介绍）不仅跟踪的错误，也确保错误不再发生。\n\nYou could write some unit tests (Rebecca Murphey’s Writing `Testable JavaScript` is a great introduction) to not only track down the bug, but also ensure that it doesn’t happen again.\n\n你可以写一些单元测试（Rebecca Murphey写的 `可测试性的JavaScript` 是一个很好的介绍）不仅跟踪的错误，也确保错误不再发生。\n\nKeen to have a test in place to avoid this bug recurring, we pick the second option and get writing. Now we face a new problem, though: how do we set up our test correctly? We know we need to set up our test with the window width set to less than 500 pixels, but how? The function relies on `window.innerWidth`, and making sure that’s at a particular value is going to be a pain.\n\n热衷有一个测试中的地方，以避免此错误重复，我们选择第二个选项，现在就去写写。现在我们面对了新的问题，虽然：我们怎么才能确保我们的测试是正确的？我们知道这个测试需要一个窗口，而且窗口的宽度要小于500像素。但是怎么做呢？那个函数依赖 `window.innerWidth`，确保他是一个特定的值将会很头疼的。\n\n## __Benefits of pure functions__\n## __纯函数的好处__\n\n#### __SIMPLER TESTING__\n#### __简单的测试__\n\nWith that issue of how to test in mind, imagine we’d instead written the code like so:\n\n记住怎么去测试这个问题，想象一下我们并没有编写下面那样的代码：\n\n```javascript\nfunction mouseOnLeftSide(mouseX, windowWidth) {\n    return mouseX < windowWidth / 2;\n}\n\ndocument.onmousemove = function(e) {\n    console.log(mouseOnLeftSide(e.pageX, window.innerWidth));\n};\n```\n\nThe key difference here is that `mouseOnLeftSide()` now takes two arguments: the mouse X position and the window width. This means that `mouseOnLeftSide()` is now a pure function; all the data it needs it is explicitly given as inputs and it never has to reach out to access any data.\n\n关键不同点 `mouseOnLeftSide()` 函数有两个参数：鼠标X轴的坐标和窗口的宽度。这就表示 `mouseOnLeftSide()` 现在是个纯函数；函数需要的全部数据都能够通过输入明确给出并且没有引入外部的任何数据。\n\nIn terms of functionality, it’s identical to our previous example, but we’ve dramatically improved its maintainability and testability. Now we don’t have to hack around to fake `window.innerWidth` for any tests, but instead just call `mouseOnLeftSide()` with the exact arguments we need:\n\n在功能方面，就和前面的事例展示给我们的一样，但是我们的改善显著的提高了可维护性和可测试性。现在我们不需要为那个 `window.innerWidth` 进行测试，我们只需要调用有明确参数的 `mouseOnLeftSide()`：\n\n```javascript\nmouseOnLeftSide(5, 499) // 确保它的工作原理并且宽度小于500\n```\n\n#### __SELF-DOCUMENTING__\n#### __自记录__\n\nBesides being easier to test, pure functions have other characteristics that make them worth using whenever possible. By their very nature, pure functions are self-documenting. If you know that a function doesn’t reach out of its scope to get data, you know the only data it can possibly touch is passed in as arguments. Consider the following function definition:\n\n除了被更容易测试，纯函数有其他特性使他们值得使用尽可能。因为他们很自然，所以纯函数是自记录。如果函数没有使用自身作用域外的数据，那你可以明确的知道唯一的数据来源是传参。请考虑以下函数定义：\n\n```javascript\nfunction mouseOnLeftSide(mouseX, windowWidth)\n```\n\nYou know that this function deals with two pieces of data, and if the arguments are well named it should be clear what they are. We all have to deal with the pain of revisiting code that’s lain untouched for six months, and being able to regain familiarity with it quickly is a key skill.\n\n你知道这个函数有两个命名明确的数据。我们将在未来大半年的时间里会重温这些代码，能够快速的熟悉他们是个关键技能。\n\n#### __AVOIDING GLOBALS IN FUNCTIONS__\n#### __避免全局函数__\n\nThe problem of global variables is well documented in JavaScript—the language makes it trivial to store data globally where all functions can access it. This is a common source of bugs, too, because anything could have changed the value of a global variable, and hence the function could now behave differently.\n\n在JavaScript中全局变量是很好记录的。语言的特点使得他琐碎的仓储着全局数据，这样所有的函数都可以访问他。这是一切错误的根源，因为任何地方都可以改变全局变量的值，因此函数可能表现出不同的行为。\n\nAn additional property of pure functions is referential transparency. This is a rather complex term with a simple meaning: given the same inputs, the output is always the same. Going back to `mouseOnLeftSide`, let’s look at the first definition we had:\n\n一个额外的属性的引用对于纯函数来说是透明的。这个术语相当复杂，简而言之：给相同的参数，总是会有相同的结果。回去看看 `mouseOnLeftSide` 函数，第一次我们是怎么定义他的：\n\n```javascript\nfunction mouseOnLeftSide(mouseX) {\n    return mouseX < window.innerWidth / 2;\n}\n```\n\nThis function is not referentially transparent. I could call it with the input 5 multiple times, resize the window between calls, and the result would be different every time. This is a slightly contrived example, but functions that return different values even when their inputs are the same are always harder to work with. Reasoning about them is harder because you can’t guarantee their behavior. For the same reason, testing is trickier, because you don’t have full control over the data the function needs.\n\n这个函数是不透明的。无论我调试多少次，每当窗口大小发生变化，函数都会输出不同的结果。这还是一个简单的例子，但是输入相同值却返回不同值的函数总是难以使用的。理解他们更难，因为你不能保证他们的行为。同样的原因，测试很变得棘手，因为你没有完全控制功能需要的数据。\n\nOn the other hand, our improved mouseOnLeftSide function is referentially transparent because all its data comes from inputs and it never reaches outside itself:\n\n另一方面，我们改进的 `mouseOnLeftSide` 函数使其透明，因为它的所有数据都来自于参数，并且它永远不会调用函数外部数据：\n\n```javascript\nfunction mouseOnLeftSide(mouseX, windowWidth) {\n    return mouseX < windowWidth / 2;\n}\n```\n\nYou get referential transparency for free when following the rule of declaring all your data as inputs, and by doing this you eliminate an entire class of bugs around side effects and functions acting unexpectedly. If you have full control over the data, you can hunt down and replicate bugs much more quickly and reliably without chancing the lottery of global variables that could interfere.\n\n遵循将所有数据都由参数声明的规则，你可以很容易获得清晰的参考，这样做可以消除由于副作用函数带来的出人意料的错误。如果你完全控制数据，你可以更快速，更可靠地追踪和复制错误，而无需更改可能会干扰的全局变量。\n\n## __Choosing which functions to make pure__\n## __哪些函数要变为纯函数__\n\nIt’s impossible to have pure functions consistently—there will always be a time when you need to reach out and fetch data, the most common example of which is reaching into the DOM to grab a specific element to interact with. It’s a fact of JavaScript that you’ll have to do this, and you shouldn’t feel bad about reaching outside of your function. Instead, carefully consider if there is a way to structure your code so that impure functions can be isolated. Prevent them from having broad effects throughout your codebase, and try to use pure functions whenever appropriate.\n\n不可能总是使用纯函数的––毕竟需要一个函数来实现获取外部数据，其最常见的例子是DOM特定元素的获取和元素之进行交互。这是JavaScript的一个事实，你必须这样做，你的函数获取外部数据也不要感到不好。相反，请仔细考虑是否有办法构建你的代码，以使不纯的函数被隔离。防止它们在整个代码库中产生广泛的影响，并尽可能适当地使用纯函数。\n\nLet’s take a look at the code below, which grabs an element from the DOM and changes its background color to red:\n\n让我们看看下面的代码，从DOMA中获取一个元素并且把他的背景色改为红色：\n\n```javascript\nfunction changeElementToRed() {\n    var foo = document.getElementById('foo');\n    foo.style.backgroundColor = \"red\";\n}\nchangeElementToRed();\n```\n\nThere are two problems with this piece of code, both solvable by transitioning to a pure function:\n\n这行代码中有两个问题，都可以通过转换为纯函数来解决：\n\nThis function is not reusable at all; it’s directly tied to a specific DOM element. If we wanted to reuse it to change a different element, we couldn’t.\n\n这个函数根本不可复用；它直接绑定到一个特定的DOM元素。如果我们想复用它来改变一个不同的元素，那就不可以了。\n\nThis function is hard to test because it’s not pure. To test it, we would have to create an element with a specific ID rather than any generic element.\n\n这也不是个纯函数所以很难测试，要测试他，我们必须创建一个有特定id的元素而不是一个通用元素。\n\nGiven the two points above, I would rewrite this function to:\n\n就上面讲到的两点，我们需要重写函数：\n\n```javascript\nfunction changeElementToRed(elem) {\n    elem.style.backgroundColor = \"red\";\n}\n\nfunction changeFooToRed() {\n    var foo = document.getElementById('foo');\n    changeElementToRed(foo);\n}\n\nchangeFooToRed();\n```\n\nWe’ve now changed `changeelementtored()` to not be tied to a specific DOM element and to be more generic. At the same time, we’ve made it pure, bringing us all the benefits discussed previously.\n\n我们现在重写了 `changeelementtored()`，他不被捆绑到一个特定的DOM元素变得更通用。这样做，我们使他变得更纯粹，并且都来了我们先前所讨论的好处。\n\nIt’s important to note, though, that I’ve still got some impure code `changeFooToRed()` is impure. You can never avoid this, but it’s about spotting opportunities where turning a function pure would increase its readability, reusability, and testability. By keeping the places where you’re impure to a minimum and creating as many pure, reusable functions as you can, you’ll save yourself a huge amount of pain in the future and write better code.\n\n注意！我们的代码中还有不纯粹的地方，比如 `changeFooToRed()`，就是不纯粹的。在项目中不纯粹的代码是不可避免的，但是我们要尽可能的把他们变得纯粹，因为这样可以提高代码的可读性，可重用性和可测试性。把不纯粹的代码保持在最低限度，并尽可能多的创建可复用的纯粹函数可，您将在以后为自己减少痛苦，并可以编写出更好的代码。\n\n## __Conclusion__\n## __结论__\n\n“Pure functions,” “side effects,” and “referential transparency” are terms usually associated with purely functional languages, but that doesn’t mean we can’t take the principles and apply them to our JavaScript, too. By being mindful of these principles and applying them wisely when your code could benefit from them you’ll gain more reliable, self-documenting codebases that are easier to work with and that break less often. I encourage you to keep this in mind next time you’re writing new code, or even revisiting some existing code. It will take some time to get used to these ideas, but soon you’ll find yourself applying them without even thinking about it. Your fellow developers and your future self will thank you.\n\n“纯函数”，“副作用”和“参照透明度”通常与纯函数式语言相关联，但这并不意味着我们不能将这些原则应用到JavaScript中。通过注意这些原则并合理地应用它们，当你的的代码从中受益时，你将获得更多的可靠性。我鼓励你在下一次写新的代码时参考这些原则，甚至重新审视一些现有的代码。当然习惯这些想法需要一些时间，但很快你会发现自己抛弃原来的顾虑应用它们。你的同事和未来的你会为此感谢你。","source":"_posts/使您的JavaScript纯净.md","raw":"---\ntitle: 使您的JavaScript纯净\ndate: 2017-11-11 11:06:59\ntags: ['pure funtion','纯函数','前端','js','javascript','side effects','副作用']\ncategory: 'coding'\n---\n\nOnce your website or application goes past a small number of lines, it will inevitably contain bugs of some sort.\n\n一旦您的网站或应用程序达到一定的代码量，它将不可避免地包含某些类型的错误。\n\nThis isn’t specific to JavaScript but is shared by nearly all languages—it’s very tricky, if not impossible, to thoroughly rule out the chance of any bugs in your application.\n\n这不是JavaScript特有的，而是几乎所有的程序语言都面临这个问题 - 这个问题非常棘手，是不是有可能，彻底的排除掉你的程序中出现任何错误的机会。\n\nHowever, that doesn’t mean we can’t take precautions by coding in a way that lessens our vulnerability to bugs.\n\n然而，这并不意味着我们不能通过编码以某种方式采取预防措施，使我们在bugs面前不显得那么脆弱。<!--more-->\n\n## __Pure and impure functions__\n## __纯和不纯的函数__\n\nA pure function is defined as one that doesn’t depend on or modify variables outside of its scope. That’s a bit of a mouthful, so let’s dive into some code for a more practical example.\n\n纯函数定义为不依赖于或修改其范围之外的变量的函数。但看这个定义等于什么也没说，所以让我们来看看一些更实际的例子。\n\n```javascript\nfunction mouseOnLeftSide(mouseX){\n    return mouseX < window.innerWidth / 2;\n}\n\ndocument.onmousemove =function(e) {\n    console.log(mouseOnLeftSide(e.pageX));\n};\n```\n\n`mouseOnLeftSide()` takes an X coordinate and checks to see if it’s less than half the window width—which would place it on the left side. However, `mouseOnLeftSide()` is not a pure function. We know this because within the body of the function, it refers to a value that it wasn’t explicitly given:\n\n`mouseOnLeftSide()`采取X坐标并检查是否小于窗口宽度的一半----以便将其放在左侧。但是，`mouseOnLeftSide()`不是纯函数。我们知道这一点，因为在函数体内，参考值不是一个确定值：\n\n```javascript\nreturn mouseX < window.innerWidth / 2;\n```\n\nThe function is given `mouseX`, but not `window.innerWidth`. This means the function is reaching out to access data it wasn’t given, and hence it’s not pure.\n\n该函数给出了 `mouseX`，但是 `window.innerWidth` 却不明确。这意味着该函数正在访问不确定的数据，因此它是不纯的。\n\n## __The problem with impure functions__\n## __不纯的函数是个问题__\n\nYou might ask why this is an issue—this piece of code works just fine and does the job expected of it. Imagine that you get a bug report from a user that when the window is less than 500 pixels wide the function is incorrect. How do you test this? You’ve got two options:\n\n你也许会问这怎么就是个问题了，代码不就是找到并且做他要做的事就可以了么。你想象一下，当你从某个用户那里得知当窗口小于500像素的时候功能就不正常了。你怎么测试代码？您已经有两个选项：\n\n1.You could manually test by loading up your browser and moving your mouse around until you’ve found the problem.\n\n1.您可以手动测试，通过浏览器加载你的程序，并且移动鼠标。直到你发现的问题。\n\n2.You could write some unit tests (Rebecca Murphey’s Writing Testable JavaScript is a great introduction) to not only track down the bug, but also ensure that it doesn’t happen again.\n\n2.你可以写一些单元测试（Rebecca Murphey写的 可测试性的JavaScript 是一个很好的介绍）不仅跟踪的错误，也确保错误不再发生。\n\nYou could write some unit tests (Rebecca Murphey’s Writing `Testable JavaScript` is a great introduction) to not only track down the bug, but also ensure that it doesn’t happen again.\n\n你可以写一些单元测试（Rebecca Murphey写的 `可测试性的JavaScript` 是一个很好的介绍）不仅跟踪的错误，也确保错误不再发生。\n\nKeen to have a test in place to avoid this bug recurring, we pick the second option and get writing. Now we face a new problem, though: how do we set up our test correctly? We know we need to set up our test with the window width set to less than 500 pixels, but how? The function relies on `window.innerWidth`, and making sure that’s at a particular value is going to be a pain.\n\n热衷有一个测试中的地方，以避免此错误重复，我们选择第二个选项，现在就去写写。现在我们面对了新的问题，虽然：我们怎么才能确保我们的测试是正确的？我们知道这个测试需要一个窗口，而且窗口的宽度要小于500像素。但是怎么做呢？那个函数依赖 `window.innerWidth`，确保他是一个特定的值将会很头疼的。\n\n## __Benefits of pure functions__\n## __纯函数的好处__\n\n#### __SIMPLER TESTING__\n#### __简单的测试__\n\nWith that issue of how to test in mind, imagine we’d instead written the code like so:\n\n记住怎么去测试这个问题，想象一下我们并没有编写下面那样的代码：\n\n```javascript\nfunction mouseOnLeftSide(mouseX, windowWidth) {\n    return mouseX < windowWidth / 2;\n}\n\ndocument.onmousemove = function(e) {\n    console.log(mouseOnLeftSide(e.pageX, window.innerWidth));\n};\n```\n\nThe key difference here is that `mouseOnLeftSide()` now takes two arguments: the mouse X position and the window width. This means that `mouseOnLeftSide()` is now a pure function; all the data it needs it is explicitly given as inputs and it never has to reach out to access any data.\n\n关键不同点 `mouseOnLeftSide()` 函数有两个参数：鼠标X轴的坐标和窗口的宽度。这就表示 `mouseOnLeftSide()` 现在是个纯函数；函数需要的全部数据都能够通过输入明确给出并且没有引入外部的任何数据。\n\nIn terms of functionality, it’s identical to our previous example, but we’ve dramatically improved its maintainability and testability. Now we don’t have to hack around to fake `window.innerWidth` for any tests, but instead just call `mouseOnLeftSide()` with the exact arguments we need:\n\n在功能方面，就和前面的事例展示给我们的一样，但是我们的改善显著的提高了可维护性和可测试性。现在我们不需要为那个 `window.innerWidth` 进行测试，我们只需要调用有明确参数的 `mouseOnLeftSide()`：\n\n```javascript\nmouseOnLeftSide(5, 499) // 确保它的工作原理并且宽度小于500\n```\n\n#### __SELF-DOCUMENTING__\n#### __自记录__\n\nBesides being easier to test, pure functions have other characteristics that make them worth using whenever possible. By their very nature, pure functions are self-documenting. If you know that a function doesn’t reach out of its scope to get data, you know the only data it can possibly touch is passed in as arguments. Consider the following function definition:\n\n除了被更容易测试，纯函数有其他特性使他们值得使用尽可能。因为他们很自然，所以纯函数是自记录。如果函数没有使用自身作用域外的数据，那你可以明确的知道唯一的数据来源是传参。请考虑以下函数定义：\n\n```javascript\nfunction mouseOnLeftSide(mouseX, windowWidth)\n```\n\nYou know that this function deals with two pieces of data, and if the arguments are well named it should be clear what they are. We all have to deal with the pain of revisiting code that’s lain untouched for six months, and being able to regain familiarity with it quickly is a key skill.\n\n你知道这个函数有两个命名明确的数据。我们将在未来大半年的时间里会重温这些代码，能够快速的熟悉他们是个关键技能。\n\n#### __AVOIDING GLOBALS IN FUNCTIONS__\n#### __避免全局函数__\n\nThe problem of global variables is well documented in JavaScript—the language makes it trivial to store data globally where all functions can access it. This is a common source of bugs, too, because anything could have changed the value of a global variable, and hence the function could now behave differently.\n\n在JavaScript中全局变量是很好记录的。语言的特点使得他琐碎的仓储着全局数据，这样所有的函数都可以访问他。这是一切错误的根源，因为任何地方都可以改变全局变量的值，因此函数可能表现出不同的行为。\n\nAn additional property of pure functions is referential transparency. This is a rather complex term with a simple meaning: given the same inputs, the output is always the same. Going back to `mouseOnLeftSide`, let’s look at the first definition we had:\n\n一个额外的属性的引用对于纯函数来说是透明的。这个术语相当复杂，简而言之：给相同的参数，总是会有相同的结果。回去看看 `mouseOnLeftSide` 函数，第一次我们是怎么定义他的：\n\n```javascript\nfunction mouseOnLeftSide(mouseX) {\n    return mouseX < window.innerWidth / 2;\n}\n```\n\nThis function is not referentially transparent. I could call it with the input 5 multiple times, resize the window between calls, and the result would be different every time. This is a slightly contrived example, but functions that return different values even when their inputs are the same are always harder to work with. Reasoning about them is harder because you can’t guarantee their behavior. For the same reason, testing is trickier, because you don’t have full control over the data the function needs.\n\n这个函数是不透明的。无论我调试多少次，每当窗口大小发生变化，函数都会输出不同的结果。这还是一个简单的例子，但是输入相同值却返回不同值的函数总是难以使用的。理解他们更难，因为你不能保证他们的行为。同样的原因，测试很变得棘手，因为你没有完全控制功能需要的数据。\n\nOn the other hand, our improved mouseOnLeftSide function is referentially transparent because all its data comes from inputs and it never reaches outside itself:\n\n另一方面，我们改进的 `mouseOnLeftSide` 函数使其透明，因为它的所有数据都来自于参数，并且它永远不会调用函数外部数据：\n\n```javascript\nfunction mouseOnLeftSide(mouseX, windowWidth) {\n    return mouseX < windowWidth / 2;\n}\n```\n\nYou get referential transparency for free when following the rule of declaring all your data as inputs, and by doing this you eliminate an entire class of bugs around side effects and functions acting unexpectedly. If you have full control over the data, you can hunt down and replicate bugs much more quickly and reliably without chancing the lottery of global variables that could interfere.\n\n遵循将所有数据都由参数声明的规则，你可以很容易获得清晰的参考，这样做可以消除由于副作用函数带来的出人意料的错误。如果你完全控制数据，你可以更快速，更可靠地追踪和复制错误，而无需更改可能会干扰的全局变量。\n\n## __Choosing which functions to make pure__\n## __哪些函数要变为纯函数__\n\nIt’s impossible to have pure functions consistently—there will always be a time when you need to reach out and fetch data, the most common example of which is reaching into the DOM to grab a specific element to interact with. It’s a fact of JavaScript that you’ll have to do this, and you shouldn’t feel bad about reaching outside of your function. Instead, carefully consider if there is a way to structure your code so that impure functions can be isolated. Prevent them from having broad effects throughout your codebase, and try to use pure functions whenever appropriate.\n\n不可能总是使用纯函数的––毕竟需要一个函数来实现获取外部数据，其最常见的例子是DOM特定元素的获取和元素之进行交互。这是JavaScript的一个事实，你必须这样做，你的函数获取外部数据也不要感到不好。相反，请仔细考虑是否有办法构建你的代码，以使不纯的函数被隔离。防止它们在整个代码库中产生广泛的影响，并尽可能适当地使用纯函数。\n\nLet’s take a look at the code below, which grabs an element from the DOM and changes its background color to red:\n\n让我们看看下面的代码，从DOMA中获取一个元素并且把他的背景色改为红色：\n\n```javascript\nfunction changeElementToRed() {\n    var foo = document.getElementById('foo');\n    foo.style.backgroundColor = \"red\";\n}\nchangeElementToRed();\n```\n\nThere are two problems with this piece of code, both solvable by transitioning to a pure function:\n\n这行代码中有两个问题，都可以通过转换为纯函数来解决：\n\nThis function is not reusable at all; it’s directly tied to a specific DOM element. If we wanted to reuse it to change a different element, we couldn’t.\n\n这个函数根本不可复用；它直接绑定到一个特定的DOM元素。如果我们想复用它来改变一个不同的元素，那就不可以了。\n\nThis function is hard to test because it’s not pure. To test it, we would have to create an element with a specific ID rather than any generic element.\n\n这也不是个纯函数所以很难测试，要测试他，我们必须创建一个有特定id的元素而不是一个通用元素。\n\nGiven the two points above, I would rewrite this function to:\n\n就上面讲到的两点，我们需要重写函数：\n\n```javascript\nfunction changeElementToRed(elem) {\n    elem.style.backgroundColor = \"red\";\n}\n\nfunction changeFooToRed() {\n    var foo = document.getElementById('foo');\n    changeElementToRed(foo);\n}\n\nchangeFooToRed();\n```\n\nWe’ve now changed `changeelementtored()` to not be tied to a specific DOM element and to be more generic. At the same time, we’ve made it pure, bringing us all the benefits discussed previously.\n\n我们现在重写了 `changeelementtored()`，他不被捆绑到一个特定的DOM元素变得更通用。这样做，我们使他变得更纯粹，并且都来了我们先前所讨论的好处。\n\nIt’s important to note, though, that I’ve still got some impure code `changeFooToRed()` is impure. You can never avoid this, but it’s about spotting opportunities where turning a function pure would increase its readability, reusability, and testability. By keeping the places where you’re impure to a minimum and creating as many pure, reusable functions as you can, you’ll save yourself a huge amount of pain in the future and write better code.\n\n注意！我们的代码中还有不纯粹的地方，比如 `changeFooToRed()`，就是不纯粹的。在项目中不纯粹的代码是不可避免的，但是我们要尽可能的把他们变得纯粹，因为这样可以提高代码的可读性，可重用性和可测试性。把不纯粹的代码保持在最低限度，并尽可能多的创建可复用的纯粹函数可，您将在以后为自己减少痛苦，并可以编写出更好的代码。\n\n## __Conclusion__\n## __结论__\n\n“Pure functions,” “side effects,” and “referential transparency” are terms usually associated with purely functional languages, but that doesn’t mean we can’t take the principles and apply them to our JavaScript, too. By being mindful of these principles and applying them wisely when your code could benefit from them you’ll gain more reliable, self-documenting codebases that are easier to work with and that break less often. I encourage you to keep this in mind next time you’re writing new code, or even revisiting some existing code. It will take some time to get used to these ideas, but soon you’ll find yourself applying them without even thinking about it. Your fellow developers and your future self will thank you.\n\n“纯函数”，“副作用”和“参照透明度”通常与纯函数式语言相关联，但这并不意味着我们不能将这些原则应用到JavaScript中。通过注意这些原则并合理地应用它们，当你的的代码从中受益时，你将获得更多的可靠性。我鼓励你在下一次写新的代码时参考这些原则，甚至重新审视一些现有的代码。当然习惯这些想法需要一些时间，但很快你会发现自己抛弃原来的顾虑应用它们。你的同事和未来的你会为此感谢你。","slug":"使您的JavaScript纯净","published":1,"updated":"2019-02-20T02:50:38.652Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjsgue0f5001egpi6vfqogvi0","content":"<p>Once your website or application goes past a small number of lines, it will inevitably contain bugs of some sort.</p>\n<p>一旦您的网站或应用程序达到一定的代码量，它将不可避免地包含某些类型的错误。</p>\n<p>This isn’t specific to JavaScript but is shared by nearly all languages—it’s very tricky, if not impossible, to thoroughly rule out the chance of any bugs in your application.</p>\n<p>这不是JavaScript特有的，而是几乎所有的程序语言都面临这个问题 - 这个问题非常棘手，是不是有可能，彻底的排除掉你的程序中出现任何错误的机会。</p>\n<p>However, that doesn’t mean we can’t take precautions by coding in a way that lessens our vulnerability to bugs.</p>\n<p>然而，这并不意味着我们不能通过编码以某种方式采取预防措施，使我们在bugs面前不显得那么脆弱。<a id=\"more\"></a></p>\n<h2 id=\"Pure-and-impure-functions\"><a href=\"#Pure-and-impure-functions\" class=\"headerlink\" title=\"Pure and impure functions\"></a><strong>Pure and impure functions</strong></h2><h2 id=\"纯和不纯的函数\"><a href=\"#纯和不纯的函数\" class=\"headerlink\" title=\"纯和不纯的函数\"></a><strong>纯和不纯的函数</strong></h2><p>A pure function is defined as one that doesn’t depend on or modify variables outside of its scope. That’s a bit of a mouthful, so let’s dive into some code for a more practical example.</p>\n<p>纯函数定义为不依赖于或修改其范围之外的变量的函数。但看这个定义等于什么也没说，所以让我们来看看一些更实际的例子。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">mouseOnLeftSide</span>(<span class=\"params\">mouseX</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> mouseX &lt; <span class=\"built_in\">window</span>.innerWidth / <span class=\"number\">2</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">document</span>.onmousemove =<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(mouseOnLeftSide(e.pageX));</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p><code>mouseOnLeftSide()</code> takes an X coordinate and checks to see if it’s less than half the window width—which would place it on the left side. However, <code>mouseOnLeftSide()</code> is not a pure function. We know this because within the body of the function, it refers to a value that it wasn’t explicitly given:</p>\n<p><code>mouseOnLeftSide()</code>采取X坐标并检查是否小于窗口宽度的一半—-以便将其放在左侧。但是，<code>mouseOnLeftSide()</code>不是纯函数。我们知道这一点，因为在函数体内，参考值不是一个确定值：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">return</span> mouseX &lt; <span class=\"built_in\">window</span>.innerWidth / <span class=\"number\">2</span>;</span><br></pre></td></tr></table></figure>\n<p>The function is given <code>mouseX</code>, but not <code>window.innerWidth</code>. This means the function is reaching out to access data it wasn’t given, and hence it’s not pure.</p>\n<p>该函数给出了 <code>mouseX</code>，但是 <code>window.innerWidth</code> 却不明确。这意味着该函数正在访问不确定的数据，因此它是不纯的。</p>\n<h2 id=\"The-problem-with-impure-functions\"><a href=\"#The-problem-with-impure-functions\" class=\"headerlink\" title=\"The problem with impure functions\"></a><strong>The problem with impure functions</strong></h2><h2 id=\"不纯的函数是个问题\"><a href=\"#不纯的函数是个问题\" class=\"headerlink\" title=\"不纯的函数是个问题\"></a><strong>不纯的函数是个问题</strong></h2><p>You might ask why this is an issue—this piece of code works just fine and does the job expected of it. Imagine that you get a bug report from a user that when the window is less than 500 pixels wide the function is incorrect. How do you test this? You’ve got two options:</p>\n<p>你也许会问这怎么就是个问题了，代码不就是找到并且做他要做的事就可以了么。你想象一下，当你从某个用户那里得知当窗口小于500像素的时候功能就不正常了。你怎么测试代码？您已经有两个选项：</p>\n<p>1.You could manually test by loading up your browser and moving your mouse around until you’ve found the problem.</p>\n<p>1.您可以手动测试，通过浏览器加载你的程序，并且移动鼠标。直到你发现的问题。</p>\n<p>2.You could write some unit tests (Rebecca Murphey’s Writing Testable JavaScript is a great introduction) to not only track down the bug, but also ensure that it doesn’t happen again.</p>\n<p>2.你可以写一些单元测试（Rebecca Murphey写的 可测试性的JavaScript 是一个很好的介绍）不仅跟踪的错误，也确保错误不再发生。</p>\n<p>You could write some unit tests (Rebecca Murphey’s Writing <code>Testable JavaScript</code> is a great introduction) to not only track down the bug, but also ensure that it doesn’t happen again.</p>\n<p>你可以写一些单元测试（Rebecca Murphey写的 <code>可测试性的JavaScript</code> 是一个很好的介绍）不仅跟踪的错误，也确保错误不再发生。</p>\n<p>Keen to have a test in place to avoid this bug recurring, we pick the second option and get writing. Now we face a new problem, though: how do we set up our test correctly? We know we need to set up our test with the window width set to less than 500 pixels, but how? The function relies on <code>window.innerWidth</code>, and making sure that’s at a particular value is going to be a pain.</p>\n<p>热衷有一个测试中的地方，以避免此错误重复，我们选择第二个选项，现在就去写写。现在我们面对了新的问题，虽然：我们怎么才能确保我们的测试是正确的？我们知道这个测试需要一个窗口，而且窗口的宽度要小于500像素。但是怎么做呢？那个函数依赖 <code>window.innerWidth</code>，确保他是一个特定的值将会很头疼的。</p>\n<h2 id=\"Benefits-of-pure-functions\"><a href=\"#Benefits-of-pure-functions\" class=\"headerlink\" title=\"Benefits of pure functions\"></a><strong>Benefits of pure functions</strong></h2><h2 id=\"纯函数的好处\"><a href=\"#纯函数的好处\" class=\"headerlink\" title=\"纯函数的好处\"></a><strong>纯函数的好处</strong></h2><h4 id=\"SIMPLER-TESTING\"><a href=\"#SIMPLER-TESTING\" class=\"headerlink\" title=\"SIMPLER TESTING\"></a><strong>SIMPLER TESTING</strong></h4><h4 id=\"简单的测试\"><a href=\"#简单的测试\" class=\"headerlink\" title=\"简单的测试\"></a><strong>简单的测试</strong></h4><p>With that issue of how to test in mind, imagine we’d instead written the code like so:</p>\n<p>记住怎么去测试这个问题，想象一下我们并没有编写下面那样的代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">mouseOnLeftSide</span>(<span class=\"params\">mouseX, windowWidth</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> mouseX &lt; windowWidth / <span class=\"number\">2</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">document</span>.onmousemove = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(mouseOnLeftSide(e.pageX, <span class=\"built_in\">window</span>.innerWidth));</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>The key difference here is that <code>mouseOnLeftSide()</code> now takes two arguments: the mouse X position and the window width. This means that <code>mouseOnLeftSide()</code> is now a pure function; all the data it needs it is explicitly given as inputs and it never has to reach out to access any data.</p>\n<p>关键不同点 <code>mouseOnLeftSide()</code> 函数有两个参数：鼠标X轴的坐标和窗口的宽度。这就表示 <code>mouseOnLeftSide()</code> 现在是个纯函数；函数需要的全部数据都能够通过输入明确给出并且没有引入外部的任何数据。</p>\n<p>In terms of functionality, it’s identical to our previous example, but we’ve dramatically improved its maintainability and testability. Now we don’t have to hack around to fake <code>window.innerWidth</code> for any tests, but instead just call <code>mouseOnLeftSide()</code> with the exact arguments we need:</p>\n<p>在功能方面，就和前面的事例展示给我们的一样，但是我们的改善显著的提高了可维护性和可测试性。现在我们不需要为那个 <code>window.innerWidth</code> 进行测试，我们只需要调用有明确参数的 <code>mouseOnLeftSide()</code>：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mouseOnLeftSide(<span class=\"number\">5</span>, <span class=\"number\">499</span>) <span class=\"comment\">// 确保它的工作原理并且宽度小于500</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"SELF-DOCUMENTING\"><a href=\"#SELF-DOCUMENTING\" class=\"headerlink\" title=\"SELF-DOCUMENTING\"></a><strong>SELF-DOCUMENTING</strong></h4><h4 id=\"自记录\"><a href=\"#自记录\" class=\"headerlink\" title=\"自记录\"></a><strong>自记录</strong></h4><p>Besides being easier to test, pure functions have other characteristics that make them worth using whenever possible. By their very nature, pure functions are self-documenting. If you know that a function doesn’t reach out of its scope to get data, you know the only data it can possibly touch is passed in as arguments. Consider the following function definition:</p>\n<p>除了被更容易测试，纯函数有其他特性使他们值得使用尽可能。因为他们很自然，所以纯函数是自记录。如果函数没有使用自身作用域外的数据，那你可以明确的知道唯一的数据来源是传参。请考虑以下函数定义：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">mouseOnLeftSide</span>(<span class=\"params\">mouseX, windowWidth</span>)</span></span><br></pre></td></tr></table></figure>\n<p>You know that this function deals with two pieces of data, and if the arguments are well named it should be clear what they are. We all have to deal with the pain of revisiting code that’s lain untouched for six months, and being able to regain familiarity with it quickly is a key skill.</p>\n<p>你知道这个函数有两个命名明确的数据。我们将在未来大半年的时间里会重温这些代码，能够快速的熟悉他们是个关键技能。</p>\n<h4 id=\"AVOIDING-GLOBALS-IN-FUNCTIONS\"><a href=\"#AVOIDING-GLOBALS-IN-FUNCTIONS\" class=\"headerlink\" title=\"AVOIDING GLOBALS IN FUNCTIONS\"></a><strong>AVOIDING GLOBALS IN FUNCTIONS</strong></h4><h4 id=\"避免全局函数\"><a href=\"#避免全局函数\" class=\"headerlink\" title=\"避免全局函数\"></a><strong>避免全局函数</strong></h4><p>The problem of global variables is well documented in JavaScript—the language makes it trivial to store data globally where all functions can access it. This is a common source of bugs, too, because anything could have changed the value of a global variable, and hence the function could now behave differently.</p>\n<p>在JavaScript中全局变量是很好记录的。语言的特点使得他琐碎的仓储着全局数据，这样所有的函数都可以访问他。这是一切错误的根源，因为任何地方都可以改变全局变量的值，因此函数可能表现出不同的行为。</p>\n<p>An additional property of pure functions is referential transparency. This is a rather complex term with a simple meaning: given the same inputs, the output is always the same. Going back to <code>mouseOnLeftSide</code>, let’s look at the first definition we had:</p>\n<p>一个额外的属性的引用对于纯函数来说是透明的。这个术语相当复杂，简而言之：给相同的参数，总是会有相同的结果。回去看看 <code>mouseOnLeftSide</code> 函数，第一次我们是怎么定义他的：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">mouseOnLeftSide</span>(<span class=\"params\">mouseX</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> mouseX &lt; <span class=\"built_in\">window</span>.innerWidth / <span class=\"number\">2</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>This function is not referentially transparent. I could call it with the input 5 multiple times, resize the window between calls, and the result would be different every time. This is a slightly contrived example, but functions that return different values even when their inputs are the same are always harder to work with. Reasoning about them is harder because you can’t guarantee their behavior. For the same reason, testing is trickier, because you don’t have full control over the data the function needs.</p>\n<p>这个函数是不透明的。无论我调试多少次，每当窗口大小发生变化，函数都会输出不同的结果。这还是一个简单的例子，但是输入相同值却返回不同值的函数总是难以使用的。理解他们更难，因为你不能保证他们的行为。同样的原因，测试很变得棘手，因为你没有完全控制功能需要的数据。</p>\n<p>On the other hand, our improved mouseOnLeftSide function is referentially transparent because all its data comes from inputs and it never reaches outside itself:</p>\n<p>另一方面，我们改进的 <code>mouseOnLeftSide</code> 函数使其透明，因为它的所有数据都来自于参数，并且它永远不会调用函数外部数据：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">mouseOnLeftSide</span>(<span class=\"params\">mouseX, windowWidth</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> mouseX &lt; windowWidth / <span class=\"number\">2</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>You get referential transparency for free when following the rule of declaring all your data as inputs, and by doing this you eliminate an entire class of bugs around side effects and functions acting unexpectedly. If you have full control over the data, you can hunt down and replicate bugs much more quickly and reliably without chancing the lottery of global variables that could interfere.</p>\n<p>遵循将所有数据都由参数声明的规则，你可以很容易获得清晰的参考，这样做可以消除由于副作用函数带来的出人意料的错误。如果你完全控制数据，你可以更快速，更可靠地追踪和复制错误，而无需更改可能会干扰的全局变量。</p>\n<h2 id=\"Choosing-which-functions-to-make-pure\"><a href=\"#Choosing-which-functions-to-make-pure\" class=\"headerlink\" title=\"Choosing which functions to make pure\"></a><strong>Choosing which functions to make pure</strong></h2><h2 id=\"哪些函数要变为纯函数\"><a href=\"#哪些函数要变为纯函数\" class=\"headerlink\" title=\"哪些函数要变为纯函数\"></a><strong>哪些函数要变为纯函数</strong></h2><p>It’s impossible to have pure functions consistently—there will always be a time when you need to reach out and fetch data, the most common example of which is reaching into the DOM to grab a specific element to interact with. It’s a fact of JavaScript that you’ll have to do this, and you shouldn’t feel bad about reaching outside of your function. Instead, carefully consider if there is a way to structure your code so that impure functions can be isolated. Prevent them from having broad effects throughout your codebase, and try to use pure functions whenever appropriate.</p>\n<p>不可能总是使用纯函数的––毕竟需要一个函数来实现获取外部数据，其最常见的例子是DOM特定元素的获取和元素之进行交互。这是JavaScript的一个事实，你必须这样做，你的函数获取外部数据也不要感到不好。相反，请仔细考虑是否有办法构建你的代码，以使不纯的函数被隔离。防止它们在整个代码库中产生广泛的影响，并尽可能适当地使用纯函数。</p>\n<p>Let’s take a look at the code below, which grabs an element from the DOM and changes its background color to red:</p>\n<p>让我们看看下面的代码，从DOMA中获取一个元素并且把他的背景色改为红色：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">changeElementToRed</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> foo = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'foo'</span>);</span><br><span class=\"line\">    foo.style.backgroundColor = <span class=\"string\">\"red\"</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">changeElementToRed();</span><br></pre></td></tr></table></figure>\n<p>There are two problems with this piece of code, both solvable by transitioning to a pure function:</p>\n<p>这行代码中有两个问题，都可以通过转换为纯函数来解决：</p>\n<p>This function is not reusable at all; it’s directly tied to a specific DOM element. If we wanted to reuse it to change a different element, we couldn’t.</p>\n<p>这个函数根本不可复用；它直接绑定到一个特定的DOM元素。如果我们想复用它来改变一个不同的元素，那就不可以了。</p>\n<p>This function is hard to test because it’s not pure. To test it, we would have to create an element with a specific ID rather than any generic element.</p>\n<p>这也不是个纯函数所以很难测试，要测试他，我们必须创建一个有特定id的元素而不是一个通用元素。</p>\n<p>Given the two points above, I would rewrite this function to:</p>\n<p>就上面讲到的两点，我们需要重写函数：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">changeElementToRed</span>(<span class=\"params\">elem</span>) </span>&#123;</span><br><span class=\"line\">    elem.style.backgroundColor = <span class=\"string\">\"red\"</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">changeFooToRed</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> foo = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'foo'</span>);</span><br><span class=\"line\">    changeElementToRed(foo);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">changeFooToRed();</span><br></pre></td></tr></table></figure>\n<p>We’ve now changed <code>changeelementtored()</code> to not be tied to a specific DOM element and to be more generic. At the same time, we’ve made it pure, bringing us all the benefits discussed previously.</p>\n<p>我们现在重写了 <code>changeelementtored()</code>，他不被捆绑到一个特定的DOM元素变得更通用。这样做，我们使他变得更纯粹，并且都来了我们先前所讨论的好处。</p>\n<p>It’s important to note, though, that I’ve still got some impure code <code>changeFooToRed()</code> is impure. You can never avoid this, but it’s about spotting opportunities where turning a function pure would increase its readability, reusability, and testability. By keeping the places where you’re impure to a minimum and creating as many pure, reusable functions as you can, you’ll save yourself a huge amount of pain in the future and write better code.</p>\n<p>注意！我们的代码中还有不纯粹的地方，比如 <code>changeFooToRed()</code>，就是不纯粹的。在项目中不纯粹的代码是不可避免的，但是我们要尽可能的把他们变得纯粹，因为这样可以提高代码的可读性，可重用性和可测试性。把不纯粹的代码保持在最低限度，并尽可能多的创建可复用的纯粹函数可，您将在以后为自己减少痛苦，并可以编写出更好的代码。</p>\n<h2 id=\"Conclusion\"><a href=\"#Conclusion\" class=\"headerlink\" title=\"Conclusion\"></a><strong>Conclusion</strong></h2><h2 id=\"结论\"><a href=\"#结论\" class=\"headerlink\" title=\"结论\"></a><strong>结论</strong></h2><p>“Pure functions,” “side effects,” and “referential transparency” are terms usually associated with purely functional languages, but that doesn’t mean we can’t take the principles and apply them to our JavaScript, too. By being mindful of these principles and applying them wisely when your code could benefit from them you’ll gain more reliable, self-documenting codebases that are easier to work with and that break less often. I encourage you to keep this in mind next time you’re writing new code, or even revisiting some existing code. It will take some time to get used to these ideas, but soon you’ll find yourself applying them without even thinking about it. Your fellow developers and your future self will thank you.</p>\n<p>“纯函数”，“副作用”和“参照透明度”通常与纯函数式语言相关联，但这并不意味着我们不能将这些原则应用到JavaScript中。通过注意这些原则并合理地应用它们，当你的的代码从中受益时，你将获得更多的可靠性。我鼓励你在下一次写新的代码时参考这些原则，甚至重新审视一些现有的代码。当然习惯这些想法需要一些时间，但很快你会发现自己抛弃原来的顾虑应用它们。你的同事和未来的你会为此感谢你。</p>\n","excerpt":"<p>Once your website or application goes past a small number of lines, it will inevitably contain bugs of some sort.</p>\n<p>一旦您的网站或应用程序达到一定的代码量，它将不可避免地包含某些类型的错误。</p>\n<p>This isn’t specific to JavaScript but is shared by nearly all languages—it’s very tricky, if not impossible, to thoroughly rule out the chance of any bugs in your application.</p>\n<p>这不是JavaScript特有的，而是几乎所有的程序语言都面临这个问题 - 这个问题非常棘手，是不是有可能，彻底的排除掉你的程序中出现任何错误的机会。</p>\n<p>However, that doesn’t mean we can’t take precautions by coding in a way that lessens our vulnerability to bugs.</p>\n<p>然而，这并不意味着我们不能通过编码以某种方式采取预防措施，使我们在bugs面前不显得那么脆弱。","more":"</p>\n<h2 id=\"Pure-and-impure-functions\"><a href=\"#Pure-and-impure-functions\" class=\"headerlink\" title=\"Pure and impure functions\"></a><strong>Pure and impure functions</strong></h2><h2 id=\"纯和不纯的函数\"><a href=\"#纯和不纯的函数\" class=\"headerlink\" title=\"纯和不纯的函数\"></a><strong>纯和不纯的函数</strong></h2><p>A pure function is defined as one that doesn’t depend on or modify variables outside of its scope. That’s a bit of a mouthful, so let’s dive into some code for a more practical example.</p>\n<p>纯函数定义为不依赖于或修改其范围之外的变量的函数。但看这个定义等于什么也没说，所以让我们来看看一些更实际的例子。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">mouseOnLeftSide</span>(<span class=\"params\">mouseX</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> mouseX &lt; <span class=\"built_in\">window</span>.innerWidth / <span class=\"number\">2</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">document</span>.onmousemove =<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(mouseOnLeftSide(e.pageX));</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p><code>mouseOnLeftSide()</code> takes an X coordinate and checks to see if it’s less than half the window width—which would place it on the left side. However, <code>mouseOnLeftSide()</code> is not a pure function. We know this because within the body of the function, it refers to a value that it wasn’t explicitly given:</p>\n<p><code>mouseOnLeftSide()</code>采取X坐标并检查是否小于窗口宽度的一半—-以便将其放在左侧。但是，<code>mouseOnLeftSide()</code>不是纯函数。我们知道这一点，因为在函数体内，参考值不是一个确定值：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">return</span> mouseX &lt; <span class=\"built_in\">window</span>.innerWidth / <span class=\"number\">2</span>;</span><br></pre></td></tr></table></figure>\n<p>The function is given <code>mouseX</code>, but not <code>window.innerWidth</code>. This means the function is reaching out to access data it wasn’t given, and hence it’s not pure.</p>\n<p>该函数给出了 <code>mouseX</code>，但是 <code>window.innerWidth</code> 却不明确。这意味着该函数正在访问不确定的数据，因此它是不纯的。</p>\n<h2 id=\"The-problem-with-impure-functions\"><a href=\"#The-problem-with-impure-functions\" class=\"headerlink\" title=\"The problem with impure functions\"></a><strong>The problem with impure functions</strong></h2><h2 id=\"不纯的函数是个问题\"><a href=\"#不纯的函数是个问题\" class=\"headerlink\" title=\"不纯的函数是个问题\"></a><strong>不纯的函数是个问题</strong></h2><p>You might ask why this is an issue—this piece of code works just fine and does the job expected of it. Imagine that you get a bug report from a user that when the window is less than 500 pixels wide the function is incorrect. How do you test this? You’ve got two options:</p>\n<p>你也许会问这怎么就是个问题了，代码不就是找到并且做他要做的事就可以了么。你想象一下，当你从某个用户那里得知当窗口小于500像素的时候功能就不正常了。你怎么测试代码？您已经有两个选项：</p>\n<p>1.You could manually test by loading up your browser and moving your mouse around until you’ve found the problem.</p>\n<p>1.您可以手动测试，通过浏览器加载你的程序，并且移动鼠标。直到你发现的问题。</p>\n<p>2.You could write some unit tests (Rebecca Murphey’s Writing Testable JavaScript is a great introduction) to not only track down the bug, but also ensure that it doesn’t happen again.</p>\n<p>2.你可以写一些单元测试（Rebecca Murphey写的 可测试性的JavaScript 是一个很好的介绍）不仅跟踪的错误，也确保错误不再发生。</p>\n<p>You could write some unit tests (Rebecca Murphey’s Writing <code>Testable JavaScript</code> is a great introduction) to not only track down the bug, but also ensure that it doesn’t happen again.</p>\n<p>你可以写一些单元测试（Rebecca Murphey写的 <code>可测试性的JavaScript</code> 是一个很好的介绍）不仅跟踪的错误，也确保错误不再发生。</p>\n<p>Keen to have a test in place to avoid this bug recurring, we pick the second option and get writing. Now we face a new problem, though: how do we set up our test correctly? We know we need to set up our test with the window width set to less than 500 pixels, but how? The function relies on <code>window.innerWidth</code>, and making sure that’s at a particular value is going to be a pain.</p>\n<p>热衷有一个测试中的地方，以避免此错误重复，我们选择第二个选项，现在就去写写。现在我们面对了新的问题，虽然：我们怎么才能确保我们的测试是正确的？我们知道这个测试需要一个窗口，而且窗口的宽度要小于500像素。但是怎么做呢？那个函数依赖 <code>window.innerWidth</code>，确保他是一个特定的值将会很头疼的。</p>\n<h2 id=\"Benefits-of-pure-functions\"><a href=\"#Benefits-of-pure-functions\" class=\"headerlink\" title=\"Benefits of pure functions\"></a><strong>Benefits of pure functions</strong></h2><h2 id=\"纯函数的好处\"><a href=\"#纯函数的好处\" class=\"headerlink\" title=\"纯函数的好处\"></a><strong>纯函数的好处</strong></h2><h4 id=\"SIMPLER-TESTING\"><a href=\"#SIMPLER-TESTING\" class=\"headerlink\" title=\"SIMPLER TESTING\"></a><strong>SIMPLER TESTING</strong></h4><h4 id=\"简单的测试\"><a href=\"#简单的测试\" class=\"headerlink\" title=\"简单的测试\"></a><strong>简单的测试</strong></h4><p>With that issue of how to test in mind, imagine we’d instead written the code like so:</p>\n<p>记住怎么去测试这个问题，想象一下我们并没有编写下面那样的代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">mouseOnLeftSide</span>(<span class=\"params\">mouseX, windowWidth</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> mouseX &lt; windowWidth / <span class=\"number\">2</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">document</span>.onmousemove = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(mouseOnLeftSide(e.pageX, <span class=\"built_in\">window</span>.innerWidth));</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>The key difference here is that <code>mouseOnLeftSide()</code> now takes two arguments: the mouse X position and the window width. This means that <code>mouseOnLeftSide()</code> is now a pure function; all the data it needs it is explicitly given as inputs and it never has to reach out to access any data.</p>\n<p>关键不同点 <code>mouseOnLeftSide()</code> 函数有两个参数：鼠标X轴的坐标和窗口的宽度。这就表示 <code>mouseOnLeftSide()</code> 现在是个纯函数；函数需要的全部数据都能够通过输入明确给出并且没有引入外部的任何数据。</p>\n<p>In terms of functionality, it’s identical to our previous example, but we’ve dramatically improved its maintainability and testability. Now we don’t have to hack around to fake <code>window.innerWidth</code> for any tests, but instead just call <code>mouseOnLeftSide()</code> with the exact arguments we need:</p>\n<p>在功能方面，就和前面的事例展示给我们的一样，但是我们的改善显著的提高了可维护性和可测试性。现在我们不需要为那个 <code>window.innerWidth</code> 进行测试，我们只需要调用有明确参数的 <code>mouseOnLeftSide()</code>：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mouseOnLeftSide(<span class=\"number\">5</span>, <span class=\"number\">499</span>) <span class=\"comment\">// 确保它的工作原理并且宽度小于500</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"SELF-DOCUMENTING\"><a href=\"#SELF-DOCUMENTING\" class=\"headerlink\" title=\"SELF-DOCUMENTING\"></a><strong>SELF-DOCUMENTING</strong></h4><h4 id=\"自记录\"><a href=\"#自记录\" class=\"headerlink\" title=\"自记录\"></a><strong>自记录</strong></h4><p>Besides being easier to test, pure functions have other characteristics that make them worth using whenever possible. By their very nature, pure functions are self-documenting. If you know that a function doesn’t reach out of its scope to get data, you know the only data it can possibly touch is passed in as arguments. Consider the following function definition:</p>\n<p>除了被更容易测试，纯函数有其他特性使他们值得使用尽可能。因为他们很自然，所以纯函数是自记录。如果函数没有使用自身作用域外的数据，那你可以明确的知道唯一的数据来源是传参。请考虑以下函数定义：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">mouseOnLeftSide</span>(<span class=\"params\">mouseX, windowWidth</span>)</span></span><br></pre></td></tr></table></figure>\n<p>You know that this function deals with two pieces of data, and if the arguments are well named it should be clear what they are. We all have to deal with the pain of revisiting code that’s lain untouched for six months, and being able to regain familiarity with it quickly is a key skill.</p>\n<p>你知道这个函数有两个命名明确的数据。我们将在未来大半年的时间里会重温这些代码，能够快速的熟悉他们是个关键技能。</p>\n<h4 id=\"AVOIDING-GLOBALS-IN-FUNCTIONS\"><a href=\"#AVOIDING-GLOBALS-IN-FUNCTIONS\" class=\"headerlink\" title=\"AVOIDING GLOBALS IN FUNCTIONS\"></a><strong>AVOIDING GLOBALS IN FUNCTIONS</strong></h4><h4 id=\"避免全局函数\"><a href=\"#避免全局函数\" class=\"headerlink\" title=\"避免全局函数\"></a><strong>避免全局函数</strong></h4><p>The problem of global variables is well documented in JavaScript—the language makes it trivial to store data globally where all functions can access it. This is a common source of bugs, too, because anything could have changed the value of a global variable, and hence the function could now behave differently.</p>\n<p>在JavaScript中全局变量是很好记录的。语言的特点使得他琐碎的仓储着全局数据，这样所有的函数都可以访问他。这是一切错误的根源，因为任何地方都可以改变全局变量的值，因此函数可能表现出不同的行为。</p>\n<p>An additional property of pure functions is referential transparency. This is a rather complex term with a simple meaning: given the same inputs, the output is always the same. Going back to <code>mouseOnLeftSide</code>, let’s look at the first definition we had:</p>\n<p>一个额外的属性的引用对于纯函数来说是透明的。这个术语相当复杂，简而言之：给相同的参数，总是会有相同的结果。回去看看 <code>mouseOnLeftSide</code> 函数，第一次我们是怎么定义他的：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">mouseOnLeftSide</span>(<span class=\"params\">mouseX</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> mouseX &lt; <span class=\"built_in\">window</span>.innerWidth / <span class=\"number\">2</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>This function is not referentially transparent. I could call it with the input 5 multiple times, resize the window between calls, and the result would be different every time. This is a slightly contrived example, but functions that return different values even when their inputs are the same are always harder to work with. Reasoning about them is harder because you can’t guarantee their behavior. For the same reason, testing is trickier, because you don’t have full control over the data the function needs.</p>\n<p>这个函数是不透明的。无论我调试多少次，每当窗口大小发生变化，函数都会输出不同的结果。这还是一个简单的例子，但是输入相同值却返回不同值的函数总是难以使用的。理解他们更难，因为你不能保证他们的行为。同样的原因，测试很变得棘手，因为你没有完全控制功能需要的数据。</p>\n<p>On the other hand, our improved mouseOnLeftSide function is referentially transparent because all its data comes from inputs and it never reaches outside itself:</p>\n<p>另一方面，我们改进的 <code>mouseOnLeftSide</code> 函数使其透明，因为它的所有数据都来自于参数，并且它永远不会调用函数外部数据：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">mouseOnLeftSide</span>(<span class=\"params\">mouseX, windowWidth</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> mouseX &lt; windowWidth / <span class=\"number\">2</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>You get referential transparency for free when following the rule of declaring all your data as inputs, and by doing this you eliminate an entire class of bugs around side effects and functions acting unexpectedly. If you have full control over the data, you can hunt down and replicate bugs much more quickly and reliably without chancing the lottery of global variables that could interfere.</p>\n<p>遵循将所有数据都由参数声明的规则，你可以很容易获得清晰的参考，这样做可以消除由于副作用函数带来的出人意料的错误。如果你完全控制数据，你可以更快速，更可靠地追踪和复制错误，而无需更改可能会干扰的全局变量。</p>\n<h2 id=\"Choosing-which-functions-to-make-pure\"><a href=\"#Choosing-which-functions-to-make-pure\" class=\"headerlink\" title=\"Choosing which functions to make pure\"></a><strong>Choosing which functions to make pure</strong></h2><h2 id=\"哪些函数要变为纯函数\"><a href=\"#哪些函数要变为纯函数\" class=\"headerlink\" title=\"哪些函数要变为纯函数\"></a><strong>哪些函数要变为纯函数</strong></h2><p>It’s impossible to have pure functions consistently—there will always be a time when you need to reach out and fetch data, the most common example of which is reaching into the DOM to grab a specific element to interact with. It’s a fact of JavaScript that you’ll have to do this, and you shouldn’t feel bad about reaching outside of your function. Instead, carefully consider if there is a way to structure your code so that impure functions can be isolated. Prevent them from having broad effects throughout your codebase, and try to use pure functions whenever appropriate.</p>\n<p>不可能总是使用纯函数的––毕竟需要一个函数来实现获取外部数据，其最常见的例子是DOM特定元素的获取和元素之进行交互。这是JavaScript的一个事实，你必须这样做，你的函数获取外部数据也不要感到不好。相反，请仔细考虑是否有办法构建你的代码，以使不纯的函数被隔离。防止它们在整个代码库中产生广泛的影响，并尽可能适当地使用纯函数。</p>\n<p>Let’s take a look at the code below, which grabs an element from the DOM and changes its background color to red:</p>\n<p>让我们看看下面的代码，从DOMA中获取一个元素并且把他的背景色改为红色：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">changeElementToRed</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> foo = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'foo'</span>);</span><br><span class=\"line\">    foo.style.backgroundColor = <span class=\"string\">\"red\"</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">changeElementToRed();</span><br></pre></td></tr></table></figure>\n<p>There are two problems with this piece of code, both solvable by transitioning to a pure function:</p>\n<p>这行代码中有两个问题，都可以通过转换为纯函数来解决：</p>\n<p>This function is not reusable at all; it’s directly tied to a specific DOM element. If we wanted to reuse it to change a different element, we couldn’t.</p>\n<p>这个函数根本不可复用；它直接绑定到一个特定的DOM元素。如果我们想复用它来改变一个不同的元素，那就不可以了。</p>\n<p>This function is hard to test because it’s not pure. To test it, we would have to create an element with a specific ID rather than any generic element.</p>\n<p>这也不是个纯函数所以很难测试，要测试他，我们必须创建一个有特定id的元素而不是一个通用元素。</p>\n<p>Given the two points above, I would rewrite this function to:</p>\n<p>就上面讲到的两点，我们需要重写函数：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">changeElementToRed</span>(<span class=\"params\">elem</span>) </span>&#123;</span><br><span class=\"line\">    elem.style.backgroundColor = <span class=\"string\">\"red\"</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">changeFooToRed</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> foo = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'foo'</span>);</span><br><span class=\"line\">    changeElementToRed(foo);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">changeFooToRed();</span><br></pre></td></tr></table></figure>\n<p>We’ve now changed <code>changeelementtored()</code> to not be tied to a specific DOM element and to be more generic. At the same time, we’ve made it pure, bringing us all the benefits discussed previously.</p>\n<p>我们现在重写了 <code>changeelementtored()</code>，他不被捆绑到一个特定的DOM元素变得更通用。这样做，我们使他变得更纯粹，并且都来了我们先前所讨论的好处。</p>\n<p>It’s important to note, though, that I’ve still got some impure code <code>changeFooToRed()</code> is impure. You can never avoid this, but it’s about spotting opportunities where turning a function pure would increase its readability, reusability, and testability. By keeping the places where you’re impure to a minimum and creating as many pure, reusable functions as you can, you’ll save yourself a huge amount of pain in the future and write better code.</p>\n<p>注意！我们的代码中还有不纯粹的地方，比如 <code>changeFooToRed()</code>，就是不纯粹的。在项目中不纯粹的代码是不可避免的，但是我们要尽可能的把他们变得纯粹，因为这样可以提高代码的可读性，可重用性和可测试性。把不纯粹的代码保持在最低限度，并尽可能多的创建可复用的纯粹函数可，您将在以后为自己减少痛苦，并可以编写出更好的代码。</p>\n<h2 id=\"Conclusion\"><a href=\"#Conclusion\" class=\"headerlink\" title=\"Conclusion\"></a><strong>Conclusion</strong></h2><h2 id=\"结论\"><a href=\"#结论\" class=\"headerlink\" title=\"结论\"></a><strong>结论</strong></h2><p>“Pure functions,” “side effects,” and “referential transparency” are terms usually associated with purely functional languages, but that doesn’t mean we can’t take the principles and apply them to our JavaScript, too. By being mindful of these principles and applying them wisely when your code could benefit from them you’ll gain more reliable, self-documenting codebases that are easier to work with and that break less often. I encourage you to keep this in mind next time you’re writing new code, or even revisiting some existing code. It will take some time to get used to these ideas, but soon you’ll find yourself applying them without even thinking about it. Your fellow developers and your future self will thank you.</p>\n<p>“纯函数”，“副作用”和“参照透明度”通常与纯函数式语言相关联，但这并不意味着我们不能将这些原则应用到JavaScript中。通过注意这些原则并合理地应用它们，当你的的代码从中受益时，你将获得更多的可靠性。我鼓励你在下一次写新的代码时参考这些原则，甚至重新审视一些现有的代码。当然习惯这些想法需要一些时间，但很快你会发现自己抛弃原来的顾虑应用它们。你的同事和未来的你会为此感谢你。</p>"},{"title":"vuepie----基于apicloud的vue混和app开发脚手架","date":"2018-08-19T12:37:27.000Z","_content":"\n![Vuepie logo](https://raw.githubusercontent.com/zjafei/vuepie/master/vuepieLogo.fw.png)\n## 为什么做这个派？\n\n> apicloud是很好的混合app开发框架，原生api支持丰富。但是apicloud只是完成了混合开发的业务，对于具体页面没有实现与nodejs体系的融合，导致了开发人员疲于奔命的开发业务组件。所以如何可以方便的使用npm大量的免费组件，大大降低了业务开发的成本是个问题。`vuepie`就是为解决这个问题而产生的。使用`vuepie`你可以想做常规的vue页面那样去开发apicloud混和app。就是原有apicloud的都在，npm的还可以用。 \n\n<!--more-->\n\n## 安装\n\n### 下载vuepie\n```bash\ngit clone git@github.com:zjafei/vuepie.git\n```\n\n### 安装依赖包\n```bash\nnpm i\n```\n\n### 启动开发环境\n```bash\nnpm start\n```\n\n### 编译产出\n```bash\nnpm run pro\n```\n\n### 真机调试和发布\n> 同步 `dist` 目录下的所有文件即可。\n\n## 脚手架目录结构\n\n```\n/root\n ├─ /dist              // 产出目录\n ├─ /src\n │   ├─ /assets        // 公共静态资源\n │   │   ├─ /css       // 样式文件\n │   │   └─ /images    // 图片文件\n │   ├─ /components    // vue 组件\n │   ├─ /utils         // 工具方法\n │   ├─ /service\n │   │   ├─ index.js   // api 请求\n │   │   └─ mock.js    // 数据 mock\n │   └─ /views         // 工具方法\n │       └─ /namespace // 页面\n ├─ .babelrc           // 代码风格配置\n ├─ .editorconfig      // 代码风格配置\n ├─ .eslintrc          // eslint 配置\n ├─ .gitignore         // git 忽略配置\n ├─ .postcssrc.js      // 样式后处理器配置\n ├─ config.xml         // apicloud app 配置\n ├─ package.json       // 项目配置\n ├─ README.md          // 项目说明\n └─ webpack.config.js  // 产出配置\n```\n## namespace页面目录结构和说明\n```\n/namespace          // 命名空间\n ├─ app.html       // 页面模板（一般不用编辑）\n ├─ app.js         // 入口 js（一般不用编辑）\n └─ app.vue        // 页面业务\n```\n> 一个views目录下namespace目录为命名空间目录，命名空间目录必须有app.html，app.js和app.vue文件，目录会在产出后生成对应namespace.html，namespace.js和namespace.css。例如我有一个如下目录结构的：\n\n```\n/src\n └─ /views\n     └─ /index\n         ├─ app.html\n         ├─ app.js\n         ├─ app.vue\n         └─ /aboutUs\n             ├─ app.html\n             ├─ app.js\n             └─ app.vue\n```\n> 那么执行编译产出后views目录下的文件出结果如下：\n\n```\n/dist\n ├─ /index\n │   ├─ aboutUs.css\n │   ├─ aboutUs.js\n │   └─ aboutUs.html\n ├─ index.css\n ├─ index.js\n └─ index.html\n```\n## 结语\n\n> 欢迎小伙伴们使用。有需求建议和问题尽管提交issue，我尽力修正。当然直接pull request那是更好。","source":"_posts/vuepie----基于apicloud的vue混和app开发脚手架.md","raw":"---\ntitle: vuepie----基于apicloud的vue混和app开发脚手架\ndate: 2018-08-19 20:37:27\ntags: ['vue','apicloud','hybrid app','tools','cli']\ncategory: 'coding'\n---\n\n![Vuepie logo](https://raw.githubusercontent.com/zjafei/vuepie/master/vuepieLogo.fw.png)\n## 为什么做这个派？\n\n> apicloud是很好的混合app开发框架，原生api支持丰富。但是apicloud只是完成了混合开发的业务，对于具体页面没有实现与nodejs体系的融合，导致了开发人员疲于奔命的开发业务组件。所以如何可以方便的使用npm大量的免费组件，大大降低了业务开发的成本是个问题。`vuepie`就是为解决这个问题而产生的。使用`vuepie`你可以想做常规的vue页面那样去开发apicloud混和app。就是原有apicloud的都在，npm的还可以用。 \n\n<!--more-->\n\n## 安装\n\n### 下载vuepie\n```bash\ngit clone git@github.com:zjafei/vuepie.git\n```\n\n### 安装依赖包\n```bash\nnpm i\n```\n\n### 启动开发环境\n```bash\nnpm start\n```\n\n### 编译产出\n```bash\nnpm run pro\n```\n\n### 真机调试和发布\n> 同步 `dist` 目录下的所有文件即可。\n\n## 脚手架目录结构\n\n```\n/root\n ├─ /dist              // 产出目录\n ├─ /src\n │   ├─ /assets        // 公共静态资源\n │   │   ├─ /css       // 样式文件\n │   │   └─ /images    // 图片文件\n │   ├─ /components    // vue 组件\n │   ├─ /utils         // 工具方法\n │   ├─ /service\n │   │   ├─ index.js   // api 请求\n │   │   └─ mock.js    // 数据 mock\n │   └─ /views         // 工具方法\n │       └─ /namespace // 页面\n ├─ .babelrc           // 代码风格配置\n ├─ .editorconfig      // 代码风格配置\n ├─ .eslintrc          // eslint 配置\n ├─ .gitignore         // git 忽略配置\n ├─ .postcssrc.js      // 样式后处理器配置\n ├─ config.xml         // apicloud app 配置\n ├─ package.json       // 项目配置\n ├─ README.md          // 项目说明\n └─ webpack.config.js  // 产出配置\n```\n## namespace页面目录结构和说明\n```\n/namespace          // 命名空间\n ├─ app.html       // 页面模板（一般不用编辑）\n ├─ app.js         // 入口 js（一般不用编辑）\n └─ app.vue        // 页面业务\n```\n> 一个views目录下namespace目录为命名空间目录，命名空间目录必须有app.html，app.js和app.vue文件，目录会在产出后生成对应namespace.html，namespace.js和namespace.css。例如我有一个如下目录结构的：\n\n```\n/src\n └─ /views\n     └─ /index\n         ├─ app.html\n         ├─ app.js\n         ├─ app.vue\n         └─ /aboutUs\n             ├─ app.html\n             ├─ app.js\n             └─ app.vue\n```\n> 那么执行编译产出后views目录下的文件出结果如下：\n\n```\n/dist\n ├─ /index\n │   ├─ aboutUs.css\n │   ├─ aboutUs.js\n │   └─ aboutUs.html\n ├─ index.css\n ├─ index.js\n └─ index.html\n```\n## 结语\n\n> 欢迎小伙伴们使用。有需求建议和问题尽管提交issue，我尽力修正。当然直接pull request那是更好。","slug":"vuepie----基于apicloud的vue混和app开发脚手架","published":1,"updated":"2019-02-20T02:50:38.581Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjsgue0f7001ggpi6par81qzf","content":"<p><img src=\"https://raw.githubusercontent.com/zjafei/vuepie/master/vuepieLogo.fw.png\" alt=\"Vuepie logo\"></p>\n<h2 id=\"为什么做这个派？\"><a href=\"#为什么做这个派？\" class=\"headerlink\" title=\"为什么做这个派？\"></a>为什么做这个派？</h2><blockquote>\n<p>apicloud是很好的混合app开发框架，原生api支持丰富。但是apicloud只是完成了混合开发的业务，对于具体页面没有实现与nodejs体系的融合，导致了开发人员疲于奔命的开发业务组件。所以如何可以方便的使用npm大量的免费组件，大大降低了业务开发的成本是个问题。<code>vuepie</code>就是为解决这个问题而产生的。使用<code>vuepie</code>你可以想做常规的vue页面那样去开发apicloud混和app。就是原有apicloud的都在，npm的还可以用。 </p>\n</blockquote>\n<a id=\"more\"></a>\n<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><h3 id=\"下载vuepie\"><a href=\"#下载vuepie\" class=\"headerlink\" title=\"下载vuepie\"></a>下载vuepie</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">clone</span> git@github.com:zjafei/vuepie.git</span><br></pre></td></tr></table></figure>\n<h3 id=\"安装依赖包\"><a href=\"#安装依赖包\" class=\"headerlink\" title=\"安装依赖包\"></a>安装依赖包</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm i</span><br></pre></td></tr></table></figure>\n<h3 id=\"启动开发环境\"><a href=\"#启动开发环境\" class=\"headerlink\" title=\"启动开发环境\"></a>启动开发环境</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm start</span><br></pre></td></tr></table></figure>\n<h3 id=\"编译产出\"><a href=\"#编译产出\" class=\"headerlink\" title=\"编译产出\"></a>编译产出</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm run pro</span><br></pre></td></tr></table></figure>\n<h3 id=\"真机调试和发布\"><a href=\"#真机调试和发布\" class=\"headerlink\" title=\"真机调试和发布\"></a>真机调试和发布</h3><blockquote>\n<p>同步 <code>dist</code> 目录下的所有文件即可。</p>\n</blockquote>\n<h2 id=\"脚手架目录结构\"><a href=\"#脚手架目录结构\" class=\"headerlink\" title=\"脚手架目录结构\"></a>脚手架目录结构</h2><figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/root</span><br><span class=\"line\"> ├─ /dist              <span class=\"comment\">// 产出目录</span></span><br><span class=\"line\"> ├─ /src</span><br><span class=\"line\"> │   ├─ /assets        <span class=\"comment\">// 公共静态资源</span></span><br><span class=\"line\"> │   │   ├─ /css       <span class=\"comment\">// 样式文件</span></span><br><span class=\"line\"> │   │   └─ /images    <span class=\"comment\">// 图片文件</span></span><br><span class=\"line\"> │   ├─ /components    <span class=\"comment\">// vue 组件</span></span><br><span class=\"line\"> │   ├─ /utils         <span class=\"comment\">// 工具方法</span></span><br><span class=\"line\"> │   ├─ /service</span><br><span class=\"line\"> │   │   ├─ index<span class=\"selector-class\">.js</span>   <span class=\"comment\">// api 请求</span></span><br><span class=\"line\"> │   │   └─ mock<span class=\"selector-class\">.js</span>    <span class=\"comment\">// 数据 mock</span></span><br><span class=\"line\"> │   └─ /views         <span class=\"comment\">// 工具方法</span></span><br><span class=\"line\"> │       └─ /namespace <span class=\"comment\">// 页面</span></span><br><span class=\"line\"> ├─ <span class=\"selector-class\">.babelrc</span>           <span class=\"comment\">// 代码风格配置</span></span><br><span class=\"line\"> ├─ <span class=\"selector-class\">.editorconfig</span>      <span class=\"comment\">// 代码风格配置</span></span><br><span class=\"line\"> ├─ <span class=\"selector-class\">.eslintrc</span>          <span class=\"comment\">// eslint 配置</span></span><br><span class=\"line\"> ├─ <span class=\"selector-class\">.gitignore</span>         <span class=\"comment\">// git 忽略配置</span></span><br><span class=\"line\"> ├─ <span class=\"selector-class\">.postcssrc</span><span class=\"selector-class\">.js</span>      <span class=\"comment\">// 样式后处理器配置</span></span><br><span class=\"line\"> ├─ config<span class=\"selector-class\">.xml</span>         <span class=\"comment\">// apicloud app 配置</span></span><br><span class=\"line\"> ├─ package<span class=\"selector-class\">.json</span>       <span class=\"comment\">// 项目配置</span></span><br><span class=\"line\"> ├─ README<span class=\"selector-class\">.md</span>          <span class=\"comment\">// 项目说明</span></span><br><span class=\"line\"> └─ webpack<span class=\"selector-class\">.config</span><span class=\"selector-class\">.js</span>  <span class=\"comment\">// 产出配置</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"namespace页面目录结构和说明\"><a href=\"#namespace页面目录结构和说明\" class=\"headerlink\" title=\"namespace页面目录结构和说明\"></a>namespace页面目录结构和说明</h2><figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/namespace          <span class=\"comment\">// 命名空间</span></span><br><span class=\"line\"> ├─ app<span class=\"selector-class\">.html</span>       <span class=\"comment\">// 页面模板（一般不用编辑）</span></span><br><span class=\"line\"> ├─ app<span class=\"selector-class\">.js</span>         <span class=\"comment\">// 入口 js（一般不用编辑）</span></span><br><span class=\"line\"> └─ app<span class=\"selector-class\">.vue</span>        <span class=\"comment\">// 页面业务</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>一个views目录下namespace目录为命名空间目录，命名空间目录必须有app.html，app.js和app.vue文件，目录会在产出后生成对应namespace.html，namespace.js和namespace.css。例如我有一个如下目录结构的：</p>\n</blockquote>\n<figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/src</span><br><span class=\"line\"> └─ /views</span><br><span class=\"line\">     └─ /index</span><br><span class=\"line\">         ├─ app<span class=\"selector-class\">.html</span></span><br><span class=\"line\">         ├─ app<span class=\"selector-class\">.js</span></span><br><span class=\"line\">         ├─ app<span class=\"selector-class\">.vue</span></span><br><span class=\"line\">         └─ /aboutUs</span><br><span class=\"line\">             ├─ app<span class=\"selector-class\">.html</span></span><br><span class=\"line\">             ├─ app<span class=\"selector-class\">.js</span></span><br><span class=\"line\">             └─ app.vue</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>那么执行编译产出后views目录下的文件出结果如下：</p>\n</blockquote>\n<figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/dist</span><br><span class=\"line\"> ├─ /index</span><br><span class=\"line\"> │   ├─ aboutUs<span class=\"selector-class\">.css</span></span><br><span class=\"line\"> │   ├─ aboutUs<span class=\"selector-class\">.js</span></span><br><span class=\"line\"> │   └─ aboutUs<span class=\"selector-class\">.html</span></span><br><span class=\"line\"> ├─ index<span class=\"selector-class\">.css</span></span><br><span class=\"line\"> ├─ index<span class=\"selector-class\">.js</span></span><br><span class=\"line\"> └─ index.html</span><br></pre></td></tr></table></figure>\n<h2 id=\"结语\"><a href=\"#结语\" class=\"headerlink\" title=\"结语\"></a>结语</h2><blockquote>\n<p>欢迎小伙伴们使用。有需求建议和问题尽管提交issue，我尽力修正。当然直接pull request那是更好。</p>\n</blockquote>\n","excerpt":"<p><img src=\"https://raw.githubusercontent.com/zjafei/vuepie/master/vuepieLogo.fw.png\" alt=\"Vuepie logo\"></p>\n<h2 id=\"为什么做这个派？\"><a href=\"#为什么做这个派？\" class=\"headerlink\" title=\"为什么做这个派？\"></a>为什么做这个派？</h2><blockquote>\n<p>apicloud是很好的混合app开发框架，原生api支持丰富。但是apicloud只是完成了混合开发的业务，对于具体页面没有实现与nodejs体系的融合，导致了开发人员疲于奔命的开发业务组件。所以如何可以方便的使用npm大量的免费组件，大大降低了业务开发的成本是个问题。<code>vuepie</code>就是为解决这个问题而产生的。使用<code>vuepie</code>你可以想做常规的vue页面那样去开发apicloud混和app。就是原有apicloud的都在，npm的还可以用。 </p>\n</blockquote>","more":"<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><h3 id=\"下载vuepie\"><a href=\"#下载vuepie\" class=\"headerlink\" title=\"下载vuepie\"></a>下载vuepie</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">clone</span> git@github.com:zjafei/vuepie.git</span><br></pre></td></tr></table></figure>\n<h3 id=\"安装依赖包\"><a href=\"#安装依赖包\" class=\"headerlink\" title=\"安装依赖包\"></a>安装依赖包</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm i</span><br></pre></td></tr></table></figure>\n<h3 id=\"启动开发环境\"><a href=\"#启动开发环境\" class=\"headerlink\" title=\"启动开发环境\"></a>启动开发环境</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm start</span><br></pre></td></tr></table></figure>\n<h3 id=\"编译产出\"><a href=\"#编译产出\" class=\"headerlink\" title=\"编译产出\"></a>编译产出</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm run pro</span><br></pre></td></tr></table></figure>\n<h3 id=\"真机调试和发布\"><a href=\"#真机调试和发布\" class=\"headerlink\" title=\"真机调试和发布\"></a>真机调试和发布</h3><blockquote>\n<p>同步 <code>dist</code> 目录下的所有文件即可。</p>\n</blockquote>\n<h2 id=\"脚手架目录结构\"><a href=\"#脚手架目录结构\" class=\"headerlink\" title=\"脚手架目录结构\"></a>脚手架目录结构</h2><figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/root</span><br><span class=\"line\"> ├─ /dist              <span class=\"comment\">// 产出目录</span></span><br><span class=\"line\"> ├─ /src</span><br><span class=\"line\"> │   ├─ /assets        <span class=\"comment\">// 公共静态资源</span></span><br><span class=\"line\"> │   │   ├─ /css       <span class=\"comment\">// 样式文件</span></span><br><span class=\"line\"> │   │   └─ /images    <span class=\"comment\">// 图片文件</span></span><br><span class=\"line\"> │   ├─ /components    <span class=\"comment\">// vue 组件</span></span><br><span class=\"line\"> │   ├─ /utils         <span class=\"comment\">// 工具方法</span></span><br><span class=\"line\"> │   ├─ /service</span><br><span class=\"line\"> │   │   ├─ index<span class=\"selector-class\">.js</span>   <span class=\"comment\">// api 请求</span></span><br><span class=\"line\"> │   │   └─ mock<span class=\"selector-class\">.js</span>    <span class=\"comment\">// 数据 mock</span></span><br><span class=\"line\"> │   └─ /views         <span class=\"comment\">// 工具方法</span></span><br><span class=\"line\"> │       └─ /namespace <span class=\"comment\">// 页面</span></span><br><span class=\"line\"> ├─ <span class=\"selector-class\">.babelrc</span>           <span class=\"comment\">// 代码风格配置</span></span><br><span class=\"line\"> ├─ <span class=\"selector-class\">.editorconfig</span>      <span class=\"comment\">// 代码风格配置</span></span><br><span class=\"line\"> ├─ <span class=\"selector-class\">.eslintrc</span>          <span class=\"comment\">// eslint 配置</span></span><br><span class=\"line\"> ├─ <span class=\"selector-class\">.gitignore</span>         <span class=\"comment\">// git 忽略配置</span></span><br><span class=\"line\"> ├─ <span class=\"selector-class\">.postcssrc</span><span class=\"selector-class\">.js</span>      <span class=\"comment\">// 样式后处理器配置</span></span><br><span class=\"line\"> ├─ config<span class=\"selector-class\">.xml</span>         <span class=\"comment\">// apicloud app 配置</span></span><br><span class=\"line\"> ├─ package<span class=\"selector-class\">.json</span>       <span class=\"comment\">// 项目配置</span></span><br><span class=\"line\"> ├─ README<span class=\"selector-class\">.md</span>          <span class=\"comment\">// 项目说明</span></span><br><span class=\"line\"> └─ webpack<span class=\"selector-class\">.config</span><span class=\"selector-class\">.js</span>  <span class=\"comment\">// 产出配置</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"namespace页面目录结构和说明\"><a href=\"#namespace页面目录结构和说明\" class=\"headerlink\" title=\"namespace页面目录结构和说明\"></a>namespace页面目录结构和说明</h2><figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/namespace          <span class=\"comment\">// 命名空间</span></span><br><span class=\"line\"> ├─ app<span class=\"selector-class\">.html</span>       <span class=\"comment\">// 页面模板（一般不用编辑）</span></span><br><span class=\"line\"> ├─ app<span class=\"selector-class\">.js</span>         <span class=\"comment\">// 入口 js（一般不用编辑）</span></span><br><span class=\"line\"> └─ app<span class=\"selector-class\">.vue</span>        <span class=\"comment\">// 页面业务</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>一个views目录下namespace目录为命名空间目录，命名空间目录必须有app.html，app.js和app.vue文件，目录会在产出后生成对应namespace.html，namespace.js和namespace.css。例如我有一个如下目录结构的：</p>\n</blockquote>\n<figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/src</span><br><span class=\"line\"> └─ /views</span><br><span class=\"line\">     └─ /index</span><br><span class=\"line\">         ├─ app<span class=\"selector-class\">.html</span></span><br><span class=\"line\">         ├─ app<span class=\"selector-class\">.js</span></span><br><span class=\"line\">         ├─ app<span class=\"selector-class\">.vue</span></span><br><span class=\"line\">         └─ /aboutUs</span><br><span class=\"line\">             ├─ app<span class=\"selector-class\">.html</span></span><br><span class=\"line\">             ├─ app<span class=\"selector-class\">.js</span></span><br><span class=\"line\">             └─ app.vue</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>那么执行编译产出后views目录下的文件出结果如下：</p>\n</blockquote>\n<figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/dist</span><br><span class=\"line\"> ├─ /index</span><br><span class=\"line\"> │   ├─ aboutUs<span class=\"selector-class\">.css</span></span><br><span class=\"line\"> │   ├─ aboutUs<span class=\"selector-class\">.js</span></span><br><span class=\"line\"> │   └─ aboutUs<span class=\"selector-class\">.html</span></span><br><span class=\"line\"> ├─ index<span class=\"selector-class\">.css</span></span><br><span class=\"line\"> ├─ index<span class=\"selector-class\">.js</span></span><br><span class=\"line\"> └─ index.html</span><br></pre></td></tr></table></figure>\n<h2 id=\"结语\"><a href=\"#结语\" class=\"headerlink\" title=\"结语\"></a>结语</h2><blockquote>\n<p>欢迎小伙伴们使用。有需求建议和问题尽管提交issue，我尽力修正。当然直接pull request那是更好。</p>\n</blockquote>"},{"title":"高阶组件：react应用设计模式","date":"2017-11-12T02:22:09.000Z","_content":"\nIn this article we will discuss how to use Higher Order Components to keep your React applications tidy, well structured and easy to maintain. We’ll discuss how pure functions keep code clean and how these same principles can be applied to React components.\n在这片文章里我们将讨论任何使用高阶组件保持你的react应用整洁，结构合理，易于维护。纯函数是如何保持代码整洁并且如何将这些原则应用到react组件中。<!--more-->\n\n## __Pure Functions__ \n## __纯函数__\n\nA function is considered pure if it adheres to the following properties:\n\n如果一个函数遵循以下几个规则那么他就是纯函数：\n\n+ All the data it deals with are declared as arguments\n+ 函数处理的数据都是作为参数传递给函数。\n\n+ It does not mutate data it was given or any other data (these are often referred to as side effects).\n+ 他不接受不确定的数据或者任何其他数据（他们通常是副作用的）。\n\n+ Given the same input, it will always return the same output.\n+ 同样的输入，函数将得到同样的输出。\n\nFor example, the add function below is pure:\n\n举个例子，下面的add函数就是个纯函数：\n\n```javascript\nfunction add(x, y) {\n    return x + y;\n}\n```\nHowever, the function badAdd below is impure:\n\n下面badadd就是不是纯函数：\n```javascript\nvar y = 2;\n\nfunction badAdd(x) {\n    return x + y;\n} \n```\nThis function is not pure because it references data that it hasn’t directly been given. As a result, it’s possible to call this function with the same input and get different output:\n\n这个函数之所以不是纯函数是因为他所引用的数据不是直接给予的（不是通过参数传递，而是直接引用了外部全局变量。）。所以当你输入相同的数据时候可能得到不一样的输出。\n```javascript\nvar y = 2;\n\nbadAdd(3) // 5\n\ny = 3;\n\nbadAdd(3) // 6\n```\nTo read more about pure functions you can read “An introduction to reasonably pure programming” by Mark Brown.\n\n要了解更多关于纯函数的内容，你可以阅读一下Mark Brown写的“An introduction to reasonably pure programming”。\n\n## __Higher Order Functions__ \n## __高阶函数__\n\nA higher order function is a function that when called, returns another function. Often they also take a function as an argument, but this is not required for a function to be considered higher order.\n\n高阶函数的定义是，当一个函数被调用他将输出另一个函数。有时他们把函数作为参数，但是这个不是高阶函数的必要条件。\n\nLet’s say we have our `add` function from above, and we want to write some code so that when we call it we log the result to the `console` before returning the result. We’re unable to edit the `add` function, so instead we can create a new function:\n\n让我们再来看看前面说过的 `add` 函数，我们希望他在返回结果前，`console` 一下结果。我们不能改变 `add` 函数，所以我们要创建一个新函数来替代他：\n\n```javascript\nfunction addAndLog(x, y) {\n    var result = add(x, y);\n    console.log('Result', result);\n    return result;\n}\n```\nWe decide that logging results of functions is useful, and now we want to do the same with a subtract function. Rather than duplicate the above, we could write a higher order function that can take a function and return a new function that calls the given function and logs the result before then returning it:\n\n我们显示函数的记录结果是有用的，现在我们要对减法函数做同样的事情。而不是复制上述内容，我们可以编写一个更高阶的函数，它可以执行一个函数接受函数作为参数，被调用的函数会返回结果和显示记录，函数则会返回新的函数。\n\n```javascript\nfunction logAndReturn(func) {\n    return function() {\n        var args = Array.prototype.slice.call(arguments);\n        var result = func.apply(null, args);\n        console.log('Result', result);\n        return result;\n    }\n}\n```\n\nNow we can take this function `and` use it to add logging to add and `subtract`:\n\n现在我们可以使用这个函数为 `add` 和 `subtract` 函数添加显示记录：\n\n```javascript\nvar addAndLog = logAndReturn(add);\n\naddAndLog(4, 4) // 8 is returned, ‘Result 8’ is logged\n\nvar subtractAndLog = logAndReturn(subtract);\n\nsubtractAndLog(4, 3) // 1 is returned, ‘Result 1’ is logged;\n```\n`logAndReturn` is a HOF because it takes a function as its argument and returns a new function that we can call. These are really useful for wrapping existing functions that you can’t change in behavior. For more information on this, check M. David Green’s article “Higher-Order Functions in JavaScript which goes into much more detail on the subject.\n\n`logAndReturn` 就是一个高阶函数因为他接受一个函数作为参数，并且返回一个函数被我们调用。封装且不改变现有函数的内部实现是非常有用的。希望了解更多相关内容可以去看看M. David Green写的 “Higher-Order Functions in JavaScript”。\n\nAdditionally you can check out this CodePen, which shows the above code in action.\n\n另外你可以去CodePen，那里有上面说到的代码。\n\n## __Higher Order Components__ \n\n## __高阶组件__\n\nMoving into React land, we can use the same logic as above to take existing React components and give them some extra behaviours.\n\n现在我们讨论讨论React，上面讲到的逻辑我们同样可以在React组件上使用，以赋予他们更多的行为。\n\nIn this section we’re going to use React Router, the de facto routing solution for React. If you’d like to get started with the library I highly recommend the React Router Tutorial on GitHub.\n\n在这节我们将使用React Router，这个是React的路由解决方案。如果你开始使用库，我强烈建议你使用GitHub上的React Router Tutorial。\n\n## __React Router’s Link component React__\n\n## __路由链接组件__\n\nReact Router provides a `<Link>` component that is used to link between pages in a React application. One of the properties that this `<Link>` component takes is `activeClassName`. When a `<Link>` has this property and it is currently active (the user is on a URL that the link points to), the component will be given this class, enabling the developer to style it.\n\nReact 路由提供 `<Link>` 用于链接React应用里的页面。`<Link>` 组件其中一个属性是 `activeClassName`。当 `<Link>` 组件处于活动状态时使用了这个属性（用户经过链接时候的意思），组件将使用这个样类名，以便开发人员能够对其样式进行美化。\n\nThis is a really useful feature, and in our hypothetical application we decide that we always want to use this property. However, after doing so we quickly discover that this is making all our `<Link>` components very verbose:\n\n这是一个非常有用的功能，在我们假设的应用程序中，我们决定我们总是使用这个属性。然而，很快我们会发现这会使 `<Link>` 组件变得臃肿：\n\n```html\n<Link to=\"/\" activeClassName=\"active-link\"> Home </Link>\n<Link to=\"/about\" activeClassName=\"active-link\"> About</Link>\n<Link to=\"/contact\" activeClassName=\"active-link\"> Contact</Link>\n```\nNotice that we are having to repeat the class name property every time. Not only does this make our components verbose, it also means that if we decide to change the class name we’ve got to do it in a lot of places.\n\n注意我们每次都必须重复使用那个类的属性名。这不仅使我们的组件臃肿，这也意味着如果我们决定改变类名，我们必须在很多地方进行修改。\n\nInstead, we can write a component that wraps the `<Link>` component:\n\n替换，我们要写一个组件去封装 `<Link>` 组件：\n\n```javascript\nvar AppLink=React.createClass({\n    render:function(){\n        return(\n            <Link to={this.props.to} activeClassName=\"active-link\">\n                {this.props.children}\n            </Link>;\n        );\n    }\n});\n```\n\nAnd now we can use this component, which tidies up our links:\n\n现在我们可以使用这个组件来整合我们的链接：\n\n```html\n<AppLink to=\"/\">Home</AppLink>\n<AppLink to=\"/about\">About</AppLink>\n<AppLink to=\"/contact\">Contact</AppLink>\n```\n\nIn the React ecosystem these components are known as higher order components because they take an existing component and manipulate it slightly without changing the existing component. You can also think of these as wrapper components, but you’ll find them commonly referred to as higher order components in React-based content.\n\n在React生态系统中，这些组件被称为高阶组件，因为他们采用现有组件并对他们进行封装，但是并没有更改现有组件。你也可以将他们视为封装组件，但你会发现他们通常被称为 `React-based` 内容中的高阶组件。\n\n## __Functional, Stateless Components__\n## __函数式无状态组件__\n\nReact 0.14 introduced support for functional, stateless components. These are components that have the following characteristics:\n\nReact0.14开始提供函数式无状态组件，函数式无状态组件具有以下特点：\n\n+ They do not have any state.\n\n+ 他们没有state\n\n+ They do not use any React lifecycle methods (such as componentWillMount()).\n\n+ 他们无法使用React生命周期函数（比如 componentWillMount()）\n\n+ They only define the render method and nothing more.\n\n+ 他们只定义了 render 方法，没有其他的了。\n\nWhen a component adheres to the above, we can define it as a function, rather than using React.createClass (or class App extends React.Component if you’re using ES2015 classes). For example, the two expressions below both produce the same component:\n\n当一个组件遵守上述内容时，我们可以将其定义为一个函数，而不是使用React.createClass（如果你使用了 ES2015  classes 你也可以使用class 来扩展你的React 组件）。下面的两个表达式产生相同的组件：\n\n```javascript\nvar App = React.createClass({\n    render: function() {\n        return <p>My name is { this.props.name }</p>;\n    };\n});\n\nvar App = function(props) {\n    return <p>My name is { props.name }</p>;\n};\n```\n\nIn the functional, stateless component instead of referring to this.props we’re instead passed props as an argument. You can read more about this on the React documentation.\n\n在函数式无状态组件中，不是引用this.props，而是将props用作参数。React文档有更多介绍。\n\nBecause higher order components often wrap an existing component you’ll often find you can define them as a functional component. For the rest of this article I’ll do that whenever possible.\n\n因为更高阶的组件通常会封装一个现有的组件，所以您经常会发现可以将它们定义为函数组件。在本文的其余部分，我将尽可能地这样做。\n\n## __Better Higher Order Components__\n## __更好的高阶组件__\n\nThe above component works, but we can do much better. The AppLink component that we created isn’t quite fit for purpose.\n\n我们不只局限于组件可以正常运行，我们希望做的更好。我们创建的 `AppLink` 组件就不太适合。\n\n## __Accepting multiple properties__\n## __接受多个参数__\n\nThe `<AppLink>` component expects two properties:\n\n`<AppLink>` 组件估计会有两个参数：\n+ this.props.to which is the URL the link should take the user to\n+ this.props.to 表示链接让用户访问的URL\n\n+ this.props.children which is the text shown to the user\n+ this.props.children 表示显示的文本\n\nHowever, the `<Link>` component accepts many more properties, and there might be a time when you want to pass extra properties along with the two above which we nearly always want to pass. We haven’t made `<AppLink>` very extensible by hard coding the exact properties we need.\n\n当然，`<Link>` 组件可以接受更多发属性，有时我们只是想组件允许传递额外的属性以及上述的两个属性。我们并没有通过代码属性让 `<AppLink>` 有很高的扩展性。\n\n## __The JSX spread__\n## __JSX 传递__\n\nJSX, the HTML-like syntax we use to define React elements, supports the spread operator for passing an object to a component as properties. For example, the code samples below achieve the same thing:\n\nJSX，一种类似于HTML的语法用于定义React组件，支持扩展操作符将对象作为属性传递给组件。例如，下面的代码示例实现了同样的事情：\n\n```javascript\nvar props={a:1,b:2};\n<Foo a={props.a }b={props.b} />\n\n<Foo {...props} />\n```\n\nUsing `{...props}` spreads each key in the object and passes it to `Foo` as an individual property.\n\n使用 `{... props}` 扩展对象中的每个键，并将其作为单个属性传递给 `Foo`。\n\nWe can make use of this trick with `<AppLink>` so we support any arbitrary property that `<Link>` supports. By doing this we also future proof ourselves; if `<Link>` adds any new properties in the future our wrapper component will already support them. While we’re at it, I’m also going to change  `AppLink` to be a functional component.\n\n我们可以利用 `<AppLink>` 这个技巧，让我们支持 `<Link>` 支持的任意属性。通这样做，我们也将来证明自己；如果 `<Link>` 在将来添加任何新的属性，我们的包装器组件将已经支持它们。在我们这样做的时候，我同时要将 `AppLink` 改成函数式组件。\n\n```javascript\nvar AppLink = function(props){\n    return <Link {...props} activeClassName=\"active-link\" />;\n}\n```\n\nNow <Link> will accept any properties and pass them through. Note that we also can use the self closing form instead of explicitly referencing {props.children} in-between the <Link> tags. React allows children to be passed as a regular prop or as child elements of a component between the opening and closing tag.\n\n现在将接受任何属性并传递它们。请注意，我们还可以使用笔和标签，而不是在标签之间传递{props.children}。React允许 children 作为常规 prop 或作为在开始和结束标签之间的组件的子元素进行传递。\n\n## __Property ordering in React__\n## __React中属性的排序__\n\nImagine that for one specific link on your page, you have to use a different activeClassName. You try passing it into <AppLink>, since we pass all properties through:\n\n想象一下，对于页面上的一个特定链接，你必须使用不同的 activeClassName。尝试将其传递到 <AppLink> 中，我们通过以下方式传递所有属性： \n\n```jsx\n<AppLink to=“/special-link” activeClassName=“special-active” >\n    Special Secret Link\n</AppLink>\n```\n\nHowever, this doesn’t work. The reason is because of the ordering of properties when we render the `<Link>` component:\n\n但是，这不行。渲染 `<Link>` 组件时属性的顺序：\n\n```jsx\nreturn < Link {...props} activeClassName=\"active-link\" />;\n```\n\nWhen you have the same property multiple times in a React component, the last declaration wins. This means that our last `activeClassName=\"active-link\"` declaration will always win, since it’s placed after `{...this.props}`. To fix this we can reorder the properties so we spread this.props last. This means that we set sensible defaults that we’d like to use, but the user can override them if they really need to:\n\n当您在React组件中多次具有相同的属性时，最后一个会被使用。这就意味着放在 `{...this.props}` 后面的 `activeClassName=\"active-link\"` 会被使用。我们可以把 this.props 放在最后来解决这个问题。这意味着如果用户真的需要我们可以设置一些想要合理的默认值，但是这些默认值是可以被覆盖：\n\n```jsx\nreturn <Link activeClassName=\"active-link\" {...props} />;\n```\n\nBy creating higher order components that wrap existing ones but with additional behavior, we keep our code base clean and defend against future changes by not repeating properties and keeping their values in just one place.\n\n通过创建一个逛街组件可以使现有的组件得到额外的功能，我们尽量保持我们的代码简洁，并且通过不重复的属性来应对未来的变化，同时把他们的值保存在一个地方。\n\n## __Higher Order Component Creators__\n## __高阶组件创造者__\n\nOften you’ll have a number of components that you’ll need to wrap in the same behavior. This is very similar to earlier in this article when we wrapped `add` and `subtract` to add logging to them.\n\n通常你需要给很多组件添加同样的方法。这就和我们前面说到的给 `add` 函数和 `subtract` 函数添加显示输出一样。\n\nLet’s imagine in your application you have an object that contains information on the current user who is authenticated on the system. You need some of your React components to be able to access this information, but rather than blindly making it accessible for every component you want to be more strict about which components receive the information.\n\n让我们想象一下，在你的应用程序中，你有一个对象，其中包含关于系统进行身份验证的当前用户的信息。你需要你的 React 组件可以访问这些信息，而不是盲目地使每个组件都可以访问，你更希望严格地控制哪些组件接收信息。\n\nThe way to solve this is to create a function that we can call with a React component. The function will then return a new React component that will render the given component but with an extra property which will give it access to the user information.\n\n解决的方法就是我们可以创建一个函数去调用一个 React 组件。函数会返回一个可以访问用户信息并且把原来组件进行渲染的新 React 组件。\n\nThat sounds pretty complicated, but it’s made more straightforward with some code:\n\n听起来很复杂，但是通过一些代码就可以很简洁了：\n\n```javascript\nfunction wrapWithUser(Component){\n    // information that we don’t want everything to access\n    // 收限制的用户信息\n    var secretUserInfo = {\n        name:'Jack Franklin',\n        favouriteColour:'blue'\n    };\n\n    // return a newly generated React component\n    // using a functional, stateless component\n    // 返回一个新的 React 组件\n    // 使用一个无状态函数式组件\n    return function(props){\n        // pass in the user variable as a property, along with\n        // all the other props that we might be given\n        // 用户信息作为属性进行传递\n        // 其他属性我们可以自定义\n        return <Component user={secretUserInfo} {...props} />\n    }\n}\n```\n\nThe function takes a React component (which is easy to spot given React components have to have capital letters at the beginning) and returns a new function that will render the component it was given with an extra property of user, which is set to the `secretUserInfo`.\n\n函数通过一个React组件（自定义的React组件必须有大写字母开头）并返回一个新的函数，它将使用设置在 `secretUserInfo` 里的用户的属性来渲染那个组件。\n\nNow let’s take a component, `<AppHeader>`, which wants access to this information so it can display the logged in user:\n\n现在我们有一个 `<AppHeader>` 组件需要这些信息，以便把登陆的用户信息展示出来：\n\n```javascript\nvar AppHeader=function(props){\n    if(props.user){\n        return <p>Logged in as {props.user.name} </p>;\n    } else {\n        return <p>You need to login</p>;\n    }\n}\n```\n\nThe final step is to connect this component up so it is given `this.props.user`. We can create a new component by passing this one into our `wrapWithUser` function.\n\n最后一步是将此组件连接起来，我们可以通过 `wrapWithUser` 函数创建新的组件，以便把 `this.props.user` 传递给他。\n\n```javascript\nvar ConnectedAppHeader = wrapWithUser(AppHeader);\n```\n\nWe now have a `<ConnectedAppHeader>` component that can be rendered, and will have access to the `user` object.\n\n现在我们有了 `<ConnectedAppHeader>` 组件可以访问 `user` 对象，并且渲染原来的组件。\n\nI chose to call the component `ConnectedAppHeader` because I think of it as being connected with some extra piece of data that not every component is given access to.\n\n我给这个组件起名叫 `ConnectedAppHeader` 因为他传递了一些不希望所有组件都可以使用的额外数据。\n\nThis pattern is very common in __React__ libraries, particularly in __Redux__, so being aware of how it works and the reasons it’s being used will help you as your application grows and you rely on other third party libraries that use this approach.\n\n这种模式在 __React__ 库中非常常见，特别是在 __Redux__ 中，知道你依赖的第三方库是如何工作的，它被使用的原因将帮助你随着你的应用程序一起成长。\n\n## __Conclusion__\n## __结论__\n\nThis article has shown how, by applying principles of functional programming such as pure functions and higher order components to React, you can create a codebase that’s easier to maintain and work with on a daily basis.\n\n这篇文章即将结束，通过应用诸如纯函数和更高阶函数的函数式编程的原理应用到React，您可以创建一个更容易维护和使用的代码库。\n\nBy creating higher order components you’re able to keep data defined in only one place, making refactoring easier. Higher order function creators enable you to keep most data private and only expose pieces of data to the components that really need it. By doing this you make it obvious which components are using which bits of data, and as your application grows you’ll find this beneficial.\n\n通过创建更高阶的组件，你只能将数据定义在一个位置，使重构更容易。更高阶的函数创建者使你能够将大部分数据保留为私有，并且仅将数据片段暴露给真正需要的组件。通过这样做，你可以清楚地知道哪些组件正在使用哪些数据，并且随着应用程序的发展，你会发现这是有益的。","source":"_posts/高阶组件：react应用设计模式.md","raw":"---\ntitle: 高阶组件：react应用设计模式\ndate: 2017-11-12 10:22:09\ntags: ['pure funtion','纯函数','前端','js','javascript','side effects','副作用','react','组件','高阶组件','Higher Order Components']\ncategory: 'coding'\n---\n\nIn this article we will discuss how to use Higher Order Components to keep your React applications tidy, well structured and easy to maintain. We’ll discuss how pure functions keep code clean and how these same principles can be applied to React components.\n在这片文章里我们将讨论任何使用高阶组件保持你的react应用整洁，结构合理，易于维护。纯函数是如何保持代码整洁并且如何将这些原则应用到react组件中。<!--more-->\n\n## __Pure Functions__ \n## __纯函数__\n\nA function is considered pure if it adheres to the following properties:\n\n如果一个函数遵循以下几个规则那么他就是纯函数：\n\n+ All the data it deals with are declared as arguments\n+ 函数处理的数据都是作为参数传递给函数。\n\n+ It does not mutate data it was given or any other data (these are often referred to as side effects).\n+ 他不接受不确定的数据或者任何其他数据（他们通常是副作用的）。\n\n+ Given the same input, it will always return the same output.\n+ 同样的输入，函数将得到同样的输出。\n\nFor example, the add function below is pure:\n\n举个例子，下面的add函数就是个纯函数：\n\n```javascript\nfunction add(x, y) {\n    return x + y;\n}\n```\nHowever, the function badAdd below is impure:\n\n下面badadd就是不是纯函数：\n```javascript\nvar y = 2;\n\nfunction badAdd(x) {\n    return x + y;\n} \n```\nThis function is not pure because it references data that it hasn’t directly been given. As a result, it’s possible to call this function with the same input and get different output:\n\n这个函数之所以不是纯函数是因为他所引用的数据不是直接给予的（不是通过参数传递，而是直接引用了外部全局变量。）。所以当你输入相同的数据时候可能得到不一样的输出。\n```javascript\nvar y = 2;\n\nbadAdd(3) // 5\n\ny = 3;\n\nbadAdd(3) // 6\n```\nTo read more about pure functions you can read “An introduction to reasonably pure programming” by Mark Brown.\n\n要了解更多关于纯函数的内容，你可以阅读一下Mark Brown写的“An introduction to reasonably pure programming”。\n\n## __Higher Order Functions__ \n## __高阶函数__\n\nA higher order function is a function that when called, returns another function. Often they also take a function as an argument, but this is not required for a function to be considered higher order.\n\n高阶函数的定义是，当一个函数被调用他将输出另一个函数。有时他们把函数作为参数，但是这个不是高阶函数的必要条件。\n\nLet’s say we have our `add` function from above, and we want to write some code so that when we call it we log the result to the `console` before returning the result. We’re unable to edit the `add` function, so instead we can create a new function:\n\n让我们再来看看前面说过的 `add` 函数，我们希望他在返回结果前，`console` 一下结果。我们不能改变 `add` 函数，所以我们要创建一个新函数来替代他：\n\n```javascript\nfunction addAndLog(x, y) {\n    var result = add(x, y);\n    console.log('Result', result);\n    return result;\n}\n```\nWe decide that logging results of functions is useful, and now we want to do the same with a subtract function. Rather than duplicate the above, we could write a higher order function that can take a function and return a new function that calls the given function and logs the result before then returning it:\n\n我们显示函数的记录结果是有用的，现在我们要对减法函数做同样的事情。而不是复制上述内容，我们可以编写一个更高阶的函数，它可以执行一个函数接受函数作为参数，被调用的函数会返回结果和显示记录，函数则会返回新的函数。\n\n```javascript\nfunction logAndReturn(func) {\n    return function() {\n        var args = Array.prototype.slice.call(arguments);\n        var result = func.apply(null, args);\n        console.log('Result', result);\n        return result;\n    }\n}\n```\n\nNow we can take this function `and` use it to add logging to add and `subtract`:\n\n现在我们可以使用这个函数为 `add` 和 `subtract` 函数添加显示记录：\n\n```javascript\nvar addAndLog = logAndReturn(add);\n\naddAndLog(4, 4) // 8 is returned, ‘Result 8’ is logged\n\nvar subtractAndLog = logAndReturn(subtract);\n\nsubtractAndLog(4, 3) // 1 is returned, ‘Result 1’ is logged;\n```\n`logAndReturn` is a HOF because it takes a function as its argument and returns a new function that we can call. These are really useful for wrapping existing functions that you can’t change in behavior. For more information on this, check M. David Green’s article “Higher-Order Functions in JavaScript which goes into much more detail on the subject.\n\n`logAndReturn` 就是一个高阶函数因为他接受一个函数作为参数，并且返回一个函数被我们调用。封装且不改变现有函数的内部实现是非常有用的。希望了解更多相关内容可以去看看M. David Green写的 “Higher-Order Functions in JavaScript”。\n\nAdditionally you can check out this CodePen, which shows the above code in action.\n\n另外你可以去CodePen，那里有上面说到的代码。\n\n## __Higher Order Components__ \n\n## __高阶组件__\n\nMoving into React land, we can use the same logic as above to take existing React components and give them some extra behaviours.\n\n现在我们讨论讨论React，上面讲到的逻辑我们同样可以在React组件上使用，以赋予他们更多的行为。\n\nIn this section we’re going to use React Router, the de facto routing solution for React. If you’d like to get started with the library I highly recommend the React Router Tutorial on GitHub.\n\n在这节我们将使用React Router，这个是React的路由解决方案。如果你开始使用库，我强烈建议你使用GitHub上的React Router Tutorial。\n\n## __React Router’s Link component React__\n\n## __路由链接组件__\n\nReact Router provides a `<Link>` component that is used to link between pages in a React application. One of the properties that this `<Link>` component takes is `activeClassName`. When a `<Link>` has this property and it is currently active (the user is on a URL that the link points to), the component will be given this class, enabling the developer to style it.\n\nReact 路由提供 `<Link>` 用于链接React应用里的页面。`<Link>` 组件其中一个属性是 `activeClassName`。当 `<Link>` 组件处于活动状态时使用了这个属性（用户经过链接时候的意思），组件将使用这个样类名，以便开发人员能够对其样式进行美化。\n\nThis is a really useful feature, and in our hypothetical application we decide that we always want to use this property. However, after doing so we quickly discover that this is making all our `<Link>` components very verbose:\n\n这是一个非常有用的功能，在我们假设的应用程序中，我们决定我们总是使用这个属性。然而，很快我们会发现这会使 `<Link>` 组件变得臃肿：\n\n```html\n<Link to=\"/\" activeClassName=\"active-link\"> Home </Link>\n<Link to=\"/about\" activeClassName=\"active-link\"> About</Link>\n<Link to=\"/contact\" activeClassName=\"active-link\"> Contact</Link>\n```\nNotice that we are having to repeat the class name property every time. Not only does this make our components verbose, it also means that if we decide to change the class name we’ve got to do it in a lot of places.\n\n注意我们每次都必须重复使用那个类的属性名。这不仅使我们的组件臃肿，这也意味着如果我们决定改变类名，我们必须在很多地方进行修改。\n\nInstead, we can write a component that wraps the `<Link>` component:\n\n替换，我们要写一个组件去封装 `<Link>` 组件：\n\n```javascript\nvar AppLink=React.createClass({\n    render:function(){\n        return(\n            <Link to={this.props.to} activeClassName=\"active-link\">\n                {this.props.children}\n            </Link>;\n        );\n    }\n});\n```\n\nAnd now we can use this component, which tidies up our links:\n\n现在我们可以使用这个组件来整合我们的链接：\n\n```html\n<AppLink to=\"/\">Home</AppLink>\n<AppLink to=\"/about\">About</AppLink>\n<AppLink to=\"/contact\">Contact</AppLink>\n```\n\nIn the React ecosystem these components are known as higher order components because they take an existing component and manipulate it slightly without changing the existing component. You can also think of these as wrapper components, but you’ll find them commonly referred to as higher order components in React-based content.\n\n在React生态系统中，这些组件被称为高阶组件，因为他们采用现有组件并对他们进行封装，但是并没有更改现有组件。你也可以将他们视为封装组件，但你会发现他们通常被称为 `React-based` 内容中的高阶组件。\n\n## __Functional, Stateless Components__\n## __函数式无状态组件__\n\nReact 0.14 introduced support for functional, stateless components. These are components that have the following characteristics:\n\nReact0.14开始提供函数式无状态组件，函数式无状态组件具有以下特点：\n\n+ They do not have any state.\n\n+ 他们没有state\n\n+ They do not use any React lifecycle methods (such as componentWillMount()).\n\n+ 他们无法使用React生命周期函数（比如 componentWillMount()）\n\n+ They only define the render method and nothing more.\n\n+ 他们只定义了 render 方法，没有其他的了。\n\nWhen a component adheres to the above, we can define it as a function, rather than using React.createClass (or class App extends React.Component if you’re using ES2015 classes). For example, the two expressions below both produce the same component:\n\n当一个组件遵守上述内容时，我们可以将其定义为一个函数，而不是使用React.createClass（如果你使用了 ES2015  classes 你也可以使用class 来扩展你的React 组件）。下面的两个表达式产生相同的组件：\n\n```javascript\nvar App = React.createClass({\n    render: function() {\n        return <p>My name is { this.props.name }</p>;\n    };\n});\n\nvar App = function(props) {\n    return <p>My name is { props.name }</p>;\n};\n```\n\nIn the functional, stateless component instead of referring to this.props we’re instead passed props as an argument. You can read more about this on the React documentation.\n\n在函数式无状态组件中，不是引用this.props，而是将props用作参数。React文档有更多介绍。\n\nBecause higher order components often wrap an existing component you’ll often find you can define them as a functional component. For the rest of this article I’ll do that whenever possible.\n\n因为更高阶的组件通常会封装一个现有的组件，所以您经常会发现可以将它们定义为函数组件。在本文的其余部分，我将尽可能地这样做。\n\n## __Better Higher Order Components__\n## __更好的高阶组件__\n\nThe above component works, but we can do much better. The AppLink component that we created isn’t quite fit for purpose.\n\n我们不只局限于组件可以正常运行，我们希望做的更好。我们创建的 `AppLink` 组件就不太适合。\n\n## __Accepting multiple properties__\n## __接受多个参数__\n\nThe `<AppLink>` component expects two properties:\n\n`<AppLink>` 组件估计会有两个参数：\n+ this.props.to which is the URL the link should take the user to\n+ this.props.to 表示链接让用户访问的URL\n\n+ this.props.children which is the text shown to the user\n+ this.props.children 表示显示的文本\n\nHowever, the `<Link>` component accepts many more properties, and there might be a time when you want to pass extra properties along with the two above which we nearly always want to pass. We haven’t made `<AppLink>` very extensible by hard coding the exact properties we need.\n\n当然，`<Link>` 组件可以接受更多发属性，有时我们只是想组件允许传递额外的属性以及上述的两个属性。我们并没有通过代码属性让 `<AppLink>` 有很高的扩展性。\n\n## __The JSX spread__\n## __JSX 传递__\n\nJSX, the HTML-like syntax we use to define React elements, supports the spread operator for passing an object to a component as properties. For example, the code samples below achieve the same thing:\n\nJSX，一种类似于HTML的语法用于定义React组件，支持扩展操作符将对象作为属性传递给组件。例如，下面的代码示例实现了同样的事情：\n\n```javascript\nvar props={a:1,b:2};\n<Foo a={props.a }b={props.b} />\n\n<Foo {...props} />\n```\n\nUsing `{...props}` spreads each key in the object and passes it to `Foo` as an individual property.\n\n使用 `{... props}` 扩展对象中的每个键，并将其作为单个属性传递给 `Foo`。\n\nWe can make use of this trick with `<AppLink>` so we support any arbitrary property that `<Link>` supports. By doing this we also future proof ourselves; if `<Link>` adds any new properties in the future our wrapper component will already support them. While we’re at it, I’m also going to change  `AppLink` to be a functional component.\n\n我们可以利用 `<AppLink>` 这个技巧，让我们支持 `<Link>` 支持的任意属性。通这样做，我们也将来证明自己；如果 `<Link>` 在将来添加任何新的属性，我们的包装器组件将已经支持它们。在我们这样做的时候，我同时要将 `AppLink` 改成函数式组件。\n\n```javascript\nvar AppLink = function(props){\n    return <Link {...props} activeClassName=\"active-link\" />;\n}\n```\n\nNow <Link> will accept any properties and pass them through. Note that we also can use the self closing form instead of explicitly referencing {props.children} in-between the <Link> tags. React allows children to be passed as a regular prop or as child elements of a component between the opening and closing tag.\n\n现在将接受任何属性并传递它们。请注意，我们还可以使用笔和标签，而不是在标签之间传递{props.children}。React允许 children 作为常规 prop 或作为在开始和结束标签之间的组件的子元素进行传递。\n\n## __Property ordering in React__\n## __React中属性的排序__\n\nImagine that for one specific link on your page, you have to use a different activeClassName. You try passing it into <AppLink>, since we pass all properties through:\n\n想象一下，对于页面上的一个特定链接，你必须使用不同的 activeClassName。尝试将其传递到 <AppLink> 中，我们通过以下方式传递所有属性： \n\n```jsx\n<AppLink to=“/special-link” activeClassName=“special-active” >\n    Special Secret Link\n</AppLink>\n```\n\nHowever, this doesn’t work. The reason is because of the ordering of properties when we render the `<Link>` component:\n\n但是，这不行。渲染 `<Link>` 组件时属性的顺序：\n\n```jsx\nreturn < Link {...props} activeClassName=\"active-link\" />;\n```\n\nWhen you have the same property multiple times in a React component, the last declaration wins. This means that our last `activeClassName=\"active-link\"` declaration will always win, since it’s placed after `{...this.props}`. To fix this we can reorder the properties so we spread this.props last. This means that we set sensible defaults that we’d like to use, but the user can override them if they really need to:\n\n当您在React组件中多次具有相同的属性时，最后一个会被使用。这就意味着放在 `{...this.props}` 后面的 `activeClassName=\"active-link\"` 会被使用。我们可以把 this.props 放在最后来解决这个问题。这意味着如果用户真的需要我们可以设置一些想要合理的默认值，但是这些默认值是可以被覆盖：\n\n```jsx\nreturn <Link activeClassName=\"active-link\" {...props} />;\n```\n\nBy creating higher order components that wrap existing ones but with additional behavior, we keep our code base clean and defend against future changes by not repeating properties and keeping their values in just one place.\n\n通过创建一个逛街组件可以使现有的组件得到额外的功能，我们尽量保持我们的代码简洁，并且通过不重复的属性来应对未来的变化，同时把他们的值保存在一个地方。\n\n## __Higher Order Component Creators__\n## __高阶组件创造者__\n\nOften you’ll have a number of components that you’ll need to wrap in the same behavior. This is very similar to earlier in this article when we wrapped `add` and `subtract` to add logging to them.\n\n通常你需要给很多组件添加同样的方法。这就和我们前面说到的给 `add` 函数和 `subtract` 函数添加显示输出一样。\n\nLet’s imagine in your application you have an object that contains information on the current user who is authenticated on the system. You need some of your React components to be able to access this information, but rather than blindly making it accessible for every component you want to be more strict about which components receive the information.\n\n让我们想象一下，在你的应用程序中，你有一个对象，其中包含关于系统进行身份验证的当前用户的信息。你需要你的 React 组件可以访问这些信息，而不是盲目地使每个组件都可以访问，你更希望严格地控制哪些组件接收信息。\n\nThe way to solve this is to create a function that we can call with a React component. The function will then return a new React component that will render the given component but with an extra property which will give it access to the user information.\n\n解决的方法就是我们可以创建一个函数去调用一个 React 组件。函数会返回一个可以访问用户信息并且把原来组件进行渲染的新 React 组件。\n\nThat sounds pretty complicated, but it’s made more straightforward with some code:\n\n听起来很复杂，但是通过一些代码就可以很简洁了：\n\n```javascript\nfunction wrapWithUser(Component){\n    // information that we don’t want everything to access\n    // 收限制的用户信息\n    var secretUserInfo = {\n        name:'Jack Franklin',\n        favouriteColour:'blue'\n    };\n\n    // return a newly generated React component\n    // using a functional, stateless component\n    // 返回一个新的 React 组件\n    // 使用一个无状态函数式组件\n    return function(props){\n        // pass in the user variable as a property, along with\n        // all the other props that we might be given\n        // 用户信息作为属性进行传递\n        // 其他属性我们可以自定义\n        return <Component user={secretUserInfo} {...props} />\n    }\n}\n```\n\nThe function takes a React component (which is easy to spot given React components have to have capital letters at the beginning) and returns a new function that will render the component it was given with an extra property of user, which is set to the `secretUserInfo`.\n\n函数通过一个React组件（自定义的React组件必须有大写字母开头）并返回一个新的函数，它将使用设置在 `secretUserInfo` 里的用户的属性来渲染那个组件。\n\nNow let’s take a component, `<AppHeader>`, which wants access to this information so it can display the logged in user:\n\n现在我们有一个 `<AppHeader>` 组件需要这些信息，以便把登陆的用户信息展示出来：\n\n```javascript\nvar AppHeader=function(props){\n    if(props.user){\n        return <p>Logged in as {props.user.name} </p>;\n    } else {\n        return <p>You need to login</p>;\n    }\n}\n```\n\nThe final step is to connect this component up so it is given `this.props.user`. We can create a new component by passing this one into our `wrapWithUser` function.\n\n最后一步是将此组件连接起来，我们可以通过 `wrapWithUser` 函数创建新的组件，以便把 `this.props.user` 传递给他。\n\n```javascript\nvar ConnectedAppHeader = wrapWithUser(AppHeader);\n```\n\nWe now have a `<ConnectedAppHeader>` component that can be rendered, and will have access to the `user` object.\n\n现在我们有了 `<ConnectedAppHeader>` 组件可以访问 `user` 对象，并且渲染原来的组件。\n\nI chose to call the component `ConnectedAppHeader` because I think of it as being connected with some extra piece of data that not every component is given access to.\n\n我给这个组件起名叫 `ConnectedAppHeader` 因为他传递了一些不希望所有组件都可以使用的额外数据。\n\nThis pattern is very common in __React__ libraries, particularly in __Redux__, so being aware of how it works and the reasons it’s being used will help you as your application grows and you rely on other third party libraries that use this approach.\n\n这种模式在 __React__ 库中非常常见，特别是在 __Redux__ 中，知道你依赖的第三方库是如何工作的，它被使用的原因将帮助你随着你的应用程序一起成长。\n\n## __Conclusion__\n## __结论__\n\nThis article has shown how, by applying principles of functional programming such as pure functions and higher order components to React, you can create a codebase that’s easier to maintain and work with on a daily basis.\n\n这篇文章即将结束，通过应用诸如纯函数和更高阶函数的函数式编程的原理应用到React，您可以创建一个更容易维护和使用的代码库。\n\nBy creating higher order components you’re able to keep data defined in only one place, making refactoring easier. Higher order function creators enable you to keep most data private and only expose pieces of data to the components that really need it. By doing this you make it obvious which components are using which bits of data, and as your application grows you’ll find this beneficial.\n\n通过创建更高阶的组件，你只能将数据定义在一个位置，使重构更容易。更高阶的函数创建者使你能够将大部分数据保留为私有，并且仅将数据片段暴露给真正需要的组件。通过这样做，你可以清楚地知道哪些组件正在使用哪些数据，并且随着应用程序的发展，你会发现这是有益的。","slug":"高阶组件：react应用设计模式","published":1,"updated":"2019-02-20T02:50:38.671Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjsgue0f8001igpi66jp72ug9","content":"<p>In this article we will discuss how to use Higher Order Components to keep your React applications tidy, well structured and easy to maintain. We’ll discuss how pure functions keep code clean and how these same principles can be applied to React components.<br>在这片文章里我们将讨论任何使用高阶组件保持你的react应用整洁，结构合理，易于维护。纯函数是如何保持代码整洁并且如何将这些原则应用到react组件中。<a id=\"more\"></a></p>\n<h2 id=\"Pure-Functions\"><a href=\"#Pure-Functions\" class=\"headerlink\" title=\"Pure Functions\"></a><strong>Pure Functions</strong></h2><h2 id=\"纯函数\"><a href=\"#纯函数\" class=\"headerlink\" title=\"纯函数\"></a><strong>纯函数</strong></h2><p>A function is considered pure if it adheres to the following properties:</p>\n<p>如果一个函数遵循以下几个规则那么他就是纯函数：</p>\n<ul>\n<li>All the data it deals with are declared as arguments</li>\n<li><p>函数处理的数据都是作为参数传递给函数。</p>\n</li>\n<li><p>It does not mutate data it was given or any other data (these are often referred to as side effects).</p>\n</li>\n<li><p>他不接受不确定的数据或者任何其他数据（他们通常是副作用的）。</p>\n</li>\n<li><p>Given the same input, it will always return the same output.</p>\n</li>\n<li>同样的输入，函数将得到同样的输出。</li>\n</ul>\n<p>For example, the add function below is pure:</p>\n<p>举个例子，下面的add函数就是个纯函数：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">add</span>(<span class=\"params\">x, y</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> x + y;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>However, the function badAdd below is impure:</p>\n<p>下面badadd就是不是纯函数：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> y = <span class=\"number\">2</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">badAdd</span>(<span class=\"params\">x</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> x + y;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>This function is not pure because it references data that it hasn’t directly been given. As a result, it’s possible to call this function with the same input and get different output:</p>\n<p>这个函数之所以不是纯函数是因为他所引用的数据不是直接给予的（不是通过参数传递，而是直接引用了外部全局变量。）。所以当你输入相同的数据时候可能得到不一样的输出。<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> y = <span class=\"number\">2</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">badAdd(<span class=\"number\">3</span>) <span class=\"comment\">// 5</span></span><br><span class=\"line\"></span><br><span class=\"line\">y = <span class=\"number\">3</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">badAdd(<span class=\"number\">3</span>) <span class=\"comment\">// 6</span></span><br></pre></td></tr></table></figure></p>\n<p>To read more about pure functions you can read “An introduction to reasonably pure programming” by Mark Brown.</p>\n<p>要了解更多关于纯函数的内容，你可以阅读一下Mark Brown写的“An introduction to reasonably pure programming”。</p>\n<h2 id=\"Higher-Order-Functions\"><a href=\"#Higher-Order-Functions\" class=\"headerlink\" title=\"Higher Order Functions\"></a><strong>Higher Order Functions</strong></h2><h2 id=\"高阶函数\"><a href=\"#高阶函数\" class=\"headerlink\" title=\"高阶函数\"></a><strong>高阶函数</strong></h2><p>A higher order function is a function that when called, returns another function. Often they also take a function as an argument, but this is not required for a function to be considered higher order.</p>\n<p>高阶函数的定义是，当一个函数被调用他将输出另一个函数。有时他们把函数作为参数，但是这个不是高阶函数的必要条件。</p>\n<p>Let’s say we have our <code>add</code> function from above, and we want to write some code so that when we call it we log the result to the <code>console</code> before returning the result. We’re unable to edit the <code>add</code> function, so instead we can create a new function:</p>\n<p>让我们再来看看前面说过的 <code>add</code> 函数，我们希望他在返回结果前，<code>console</code> 一下结果。我们不能改变 <code>add</code> 函数，所以我们要创建一个新函数来替代他：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">addAndLog</span>(<span class=\"params\">x, y</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> result = add(x, y);</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'Result'</span>, result);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>We decide that logging results of functions is useful, and now we want to do the same with a subtract function. Rather than duplicate the above, we could write a higher order function that can take a function and return a new function that calls the given function and logs the result before then returning it:</p>\n<p>我们显示函数的记录结果是有用的，现在我们要对减法函数做同样的事情。而不是复制上述内容，我们可以编写一个更高阶的函数，它可以执行一个函数接受函数作为参数，被调用的函数会返回结果和显示记录，函数则会返回新的函数。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">logAndReturn</span>(<span class=\"params\">func</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> args = <span class=\"built_in\">Array</span>.prototype.slice.call(<span class=\"built_in\">arguments</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> result = func.apply(<span class=\"literal\">null</span>, args);</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'Result'</span>, result);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Now we can take this function <code>and</code> use it to add logging to add and <code>subtract</code>:</p>\n<p>现在我们可以使用这个函数为 <code>add</code> 和 <code>subtract</code> 函数添加显示记录：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> addAndLog = logAndReturn(add);</span><br><span class=\"line\"></span><br><span class=\"line\">addAndLog(<span class=\"number\">4</span>, <span class=\"number\">4</span>) <span class=\"comment\">// 8 is returned, ‘Result 8’ is logged</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> subtractAndLog = logAndReturn(subtract);</span><br><span class=\"line\"></span><br><span class=\"line\">subtractAndLog(<span class=\"number\">4</span>, <span class=\"number\">3</span>) <span class=\"comment\">// 1 is returned, ‘Result 1’ is logged;</span></span><br></pre></td></tr></table></figure>\n<p><code>logAndReturn</code> is a HOF because it takes a function as its argument and returns a new function that we can call. These are really useful for wrapping existing functions that you can’t change in behavior. For more information on this, check M. David Green’s article “Higher-Order Functions in JavaScript which goes into much more detail on the subject.</p>\n<p><code>logAndReturn</code> 就是一个高阶函数因为他接受一个函数作为参数，并且返回一个函数被我们调用。封装且不改变现有函数的内部实现是非常有用的。希望了解更多相关内容可以去看看M. David Green写的 “Higher-Order Functions in JavaScript”。</p>\n<p>Additionally you can check out this CodePen, which shows the above code in action.</p>\n<p>另外你可以去CodePen，那里有上面说到的代码。</p>\n<h2 id=\"Higher-Order-Components\"><a href=\"#Higher-Order-Components\" class=\"headerlink\" title=\"Higher Order Components\"></a><strong>Higher Order Components</strong></h2><h2 id=\"高阶组件\"><a href=\"#高阶组件\" class=\"headerlink\" title=\"高阶组件\"></a><strong>高阶组件</strong></h2><p>Moving into React land, we can use the same logic as above to take existing React components and give them some extra behaviours.</p>\n<p>现在我们讨论讨论React，上面讲到的逻辑我们同样可以在React组件上使用，以赋予他们更多的行为。</p>\n<p>In this section we’re going to use React Router, the de facto routing solution for React. If you’d like to get started with the library I highly recommend the React Router Tutorial on GitHub.</p>\n<p>在这节我们将使用React Router，这个是React的路由解决方案。如果你开始使用库，我强烈建议你使用GitHub上的React Router Tutorial。</p>\n<h2 id=\"React-Router’s-Link-component-React\"><a href=\"#React-Router’s-Link-component-React\" class=\"headerlink\" title=\"React Router’s Link component React\"></a><strong>React Router’s Link component React</strong></h2><h2 id=\"路由链接组件\"><a href=\"#路由链接组件\" class=\"headerlink\" title=\"路由链接组件\"></a><strong>路由链接组件</strong></h2><p>React Router provides a <code>&lt;Link&gt;</code> component that is used to link between pages in a React application. One of the properties that this <code>&lt;Link&gt;</code> component takes is <code>activeClassName</code>. When a <code>&lt;Link&gt;</code> has this property and it is currently active (the user is on a URL that the link points to), the component will be given this class, enabling the developer to style it.</p>\n<p>React 路由提供 <code>&lt;Link&gt;</code> 用于链接React应用里的页面。<code>&lt;Link&gt;</code> 组件其中一个属性是 <code>activeClassName</code>。当 <code>&lt;Link&gt;</code> 组件处于活动状态时使用了这个属性（用户经过链接时候的意思），组件将使用这个样类名，以便开发人员能够对其样式进行美化。</p>\n<p>This is a really useful feature, and in our hypothetical application we decide that we always want to use this property. However, after doing so we quickly discover that this is making all our <code>&lt;Link&gt;</code> components very verbose:</p>\n<p>这是一个非常有用的功能，在我们假设的应用程序中，我们决定我们总是使用这个属性。然而，很快我们会发现这会使 <code>&lt;Link&gt;</code> 组件变得臃肿：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Link</span> <span class=\"attr\">to</span>=<span class=\"string\">\"/\"</span> <span class=\"attr\">activeClassName</span>=<span class=\"string\">\"active-link\"</span>&gt;</span> Home <span class=\"tag\">&lt;/<span class=\"name\">Link</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Link</span> <span class=\"attr\">to</span>=<span class=\"string\">\"/about\"</span> <span class=\"attr\">activeClassName</span>=<span class=\"string\">\"active-link\"</span>&gt;</span> About<span class=\"tag\">&lt;/<span class=\"name\">Link</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Link</span> <span class=\"attr\">to</span>=<span class=\"string\">\"/contact\"</span> <span class=\"attr\">activeClassName</span>=<span class=\"string\">\"active-link\"</span>&gt;</span> Contact<span class=\"tag\">&lt;/<span class=\"name\">Link</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>Notice that we are having to repeat the class name property every time. Not only does this make our components verbose, it also means that if we decide to change the class name we’ve got to do it in a lot of places.</p>\n<p>注意我们每次都必须重复使用那个类的属性名。这不仅使我们的组件臃肿，这也意味着如果我们决定改变类名，我们必须在很多地方进行修改。</p>\n<p>Instead, we can write a component that wraps the <code>&lt;Link&gt;</code> component:</p>\n<p>替换，我们要写一个组件去封装 <code>&lt;Link&gt;</code> 组件：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> AppLink=React.createClass(&#123;</span><br><span class=\"line\">    <span class=\"attr\">render</span>:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>(</span><br><span class=\"line\">            <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">Link</span> <span class=\"attr\">to</span>=<span class=\"string\">&#123;this.props.to&#125;</span> <span class=\"attr\">activeClassName</span>=<span class=\"string\">\"active-link\"</span>&gt;</span></span><br><span class=\"line\">                &#123;this.props.children&#125;</span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">Link</span>&gt;</span></span>;</span><br><span class=\"line\">        );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>And now we can use this component, which tidies up our links:</p>\n<p>现在我们可以使用这个组件来整合我们的链接：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">AppLink</span> <span class=\"attr\">to</span>=<span class=\"string\">\"/\"</span>&gt;</span>Home<span class=\"tag\">&lt;/<span class=\"name\">AppLink</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">AppLink</span> <span class=\"attr\">to</span>=<span class=\"string\">\"/about\"</span>&gt;</span>About<span class=\"tag\">&lt;/<span class=\"name\">AppLink</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">AppLink</span> <span class=\"attr\">to</span>=<span class=\"string\">\"/contact\"</span>&gt;</span>Contact<span class=\"tag\">&lt;/<span class=\"name\">AppLink</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>In the React ecosystem these components are known as higher order components because they take an existing component and manipulate it slightly without changing the existing component. You can also think of these as wrapper components, but you’ll find them commonly referred to as higher order components in React-based content.</p>\n<p>在React生态系统中，这些组件被称为高阶组件，因为他们采用现有组件并对他们进行封装，但是并没有更改现有组件。你也可以将他们视为封装组件，但你会发现他们通常被称为 <code>React-based</code> 内容中的高阶组件。</p>\n<h2 id=\"Functional-Stateless-Components\"><a href=\"#Functional-Stateless-Components\" class=\"headerlink\" title=\"Functional, Stateless Components\"></a><strong>Functional, Stateless Components</strong></h2><h2 id=\"函数式无状态组件\"><a href=\"#函数式无状态组件\" class=\"headerlink\" title=\"函数式无状态组件\"></a><strong>函数式无状态组件</strong></h2><p>React 0.14 introduced support for functional, stateless components. These are components that have the following characteristics:</p>\n<p>React0.14开始提供函数式无状态组件，函数式无状态组件具有以下特点：</p>\n<ul>\n<li><p>They do not have any state.</p>\n</li>\n<li><p>他们没有state</p>\n</li>\n<li><p>They do not use any React lifecycle methods (such as componentWillMount()).</p>\n</li>\n<li><p>他们无法使用React生命周期函数（比如 componentWillMount()）</p>\n</li>\n<li><p>They only define the render method and nothing more.</p>\n</li>\n<li><p>他们只定义了 render 方法，没有其他的了。</p>\n</li>\n</ul>\n<p>When a component adheres to the above, we can define it as a function, rather than using React.createClass (or class App extends React.Component if you’re using ES2015 classes). For example, the two expressions below both produce the same component:</p>\n<p>当一个组件遵守上述内容时，我们可以将其定义为一个函数，而不是使用React.createClass（如果你使用了 ES2015  classes 你也可以使用class 来扩展你的React 组件）。下面的两个表达式产生相同的组件：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> App = React.createClass(&#123;</span><br><span class=\"line\">    <span class=\"attr\">render</span>: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>My name is &#123; this.props.name &#125;<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span>;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> App = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">props</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>My name is &#123; props.name &#125;<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span>;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>In the functional, stateless component instead of referring to this.props we’re instead passed props as an argument. You can read more about this on the React documentation.</p>\n<p>在函数式无状态组件中，不是引用this.props，而是将props用作参数。React文档有更多介绍。</p>\n<p>Because higher order components often wrap an existing component you’ll often find you can define them as a functional component. For the rest of this article I’ll do that whenever possible.</p>\n<p>因为更高阶的组件通常会封装一个现有的组件，所以您经常会发现可以将它们定义为函数组件。在本文的其余部分，我将尽可能地这样做。</p>\n<h2 id=\"Better-Higher-Order-Components\"><a href=\"#Better-Higher-Order-Components\" class=\"headerlink\" title=\"Better Higher Order Components\"></a><strong>Better Higher Order Components</strong></h2><h2 id=\"更好的高阶组件\"><a href=\"#更好的高阶组件\" class=\"headerlink\" title=\"更好的高阶组件\"></a><strong>更好的高阶组件</strong></h2><p>The above component works, but we can do much better. The AppLink component that we created isn’t quite fit for purpose.</p>\n<p>我们不只局限于组件可以正常运行，我们希望做的更好。我们创建的 <code>AppLink</code> 组件就不太适合。</p>\n<h2 id=\"Accepting-multiple-properties\"><a href=\"#Accepting-multiple-properties\" class=\"headerlink\" title=\"Accepting multiple properties\"></a><strong>Accepting multiple properties</strong></h2><h2 id=\"接受多个参数\"><a href=\"#接受多个参数\" class=\"headerlink\" title=\"接受多个参数\"></a><strong>接受多个参数</strong></h2><p>The <code>&lt;AppLink&gt;</code> component expects two properties:</p>\n<p><code>&lt;AppLink&gt;</code> 组件估计会有两个参数：</p>\n<ul>\n<li>this.props.to which is the URL the link should take the user to</li>\n<li><p>this.props.to 表示链接让用户访问的URL</p>\n</li>\n<li><p>this.props.children which is the text shown to the user</p>\n</li>\n<li>this.props.children 表示显示的文本</li>\n</ul>\n<p>However, the <code>&lt;Link&gt;</code> component accepts many more properties, and there might be a time when you want to pass extra properties along with the two above which we nearly always want to pass. We haven’t made <code>&lt;AppLink&gt;</code> very extensible by hard coding the exact properties we need.</p>\n<p>当然，<code>&lt;Link&gt;</code> 组件可以接受更多发属性，有时我们只是想组件允许传递额外的属性以及上述的两个属性。我们并没有通过代码属性让 <code>&lt;AppLink&gt;</code> 有很高的扩展性。</p>\n<h2 id=\"The-JSX-spread\"><a href=\"#The-JSX-spread\" class=\"headerlink\" title=\"The JSX spread\"></a><strong>The JSX spread</strong></h2><h2 id=\"JSX-传递\"><a href=\"#JSX-传递\" class=\"headerlink\" title=\"JSX 传递\"></a><strong>JSX 传递</strong></h2><p>JSX, the HTML-like syntax we use to define React elements, supports the spread operator for passing an object to a component as properties. For example, the code samples below achieve the same thing:</p>\n<p>JSX，一种类似于HTML的语法用于定义React组件，支持扩展操作符将对象作为属性传递给组件。例如，下面的代码示例实现了同样的事情：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> props=&#123;<span class=\"attr\">a</span>:<span class=\"number\">1</span>,<span class=\"attr\">b</span>:<span class=\"number\">2</span>&#125;;</span><br><span class=\"line\">&lt;Foo a=&#123;props.a &#125;b=&#123;props.b&#125; /&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;Foo &#123;...props&#125; /&gt;</span><br></pre></td></tr></table></figure>\n<p>Using <code>{...props}</code> spreads each key in the object and passes it to <code>Foo</code> as an individual property.</p>\n<p>使用 <code>{... props}</code> 扩展对象中的每个键，并将其作为单个属性传递给 <code>Foo</code>。</p>\n<p>We can make use of this trick with <code>&lt;AppLink&gt;</code> so we support any arbitrary property that <code>&lt;Link&gt;</code> supports. By doing this we also future proof ourselves; if <code>&lt;Link&gt;</code> adds any new properties in the future our wrapper component will already support them. While we’re at it, I’m also going to change  <code>AppLink</code> to be a functional component.</p>\n<p>我们可以利用 <code>&lt;AppLink&gt;</code> 这个技巧，让我们支持 <code>&lt;Link&gt;</code> 支持的任意属性。通这样做，我们也将来证明自己；如果 <code>&lt;Link&gt;</code> 在将来添加任何新的属性，我们的包装器组件将已经支持它们。在我们这样做的时候，我同时要将 <code>AppLink</code> 改成函数式组件。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> AppLink = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">props</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">Link</span> &#123;<span class=\"attr\">...props</span>&#125; <span class=\"attr\">activeClassName</span>=<span class=\"string\">\"active-link\"</span> /&gt;</span>;</span><br><span class=\"line\">&#125;</span></span><br></pre></td></tr></table></figure>\n<p>Now <link> will accept any properties and pass them through. Note that we also can use the self closing form instead of explicitly referencing {props.children} in-between the <link> tags. React allows children to be passed as a regular prop or as child elements of a component between the opening and closing tag.</p>\n<p>现在将接受任何属性并传递它们。请注意，我们还可以使用笔和标签，而不是在标签之间传递{props.children}。React允许 children 作为常规 prop 或作为在开始和结束标签之间的组件的子元素进行传递。</p>\n<h2 id=\"Property-ordering-in-React\"><a href=\"#Property-ordering-in-React\" class=\"headerlink\" title=\"Property ordering in React\"></a><strong>Property ordering in React</strong></h2><h2 id=\"React中属性的排序\"><a href=\"#React中属性的排序\" class=\"headerlink\" title=\"React中属性的排序\"></a><strong>React中属性的排序</strong></h2><p>Imagine that for one specific link on your page, you have to use a different activeClassName. You try passing it into <applink>, since we pass all properties through:</applink></p>\n<p>想象一下，对于页面上的一个特定链接，你必须使用不同的 activeClassName。尝试将其传递到 <applink> 中，我们通过以下方式传递所有属性： </applink></p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;AppLink to=“/special-link” activeClassName=“special-active” &gt;</span><br><span class=\"line\">    Special Secret Link</span><br><span class=\"line\">&lt;<span class=\"regexp\">/AppLink&gt;</span></span><br></pre></td></tr></table></figure>\n<p>However, this doesn’t work. The reason is because of the ordering of properties when we render the <code>&lt;Link&gt;</code> component:</p>\n<p>但是，这不行。渲染 <code>&lt;Link&gt;</code> 组件时属性的顺序：</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt; <span class=\"attr\">Link</span> &#123;<span class=\"attr\">...props</span>&#125; <span class=\"attr\">activeClassName</span>=<span class=\"string\">\"active-link\"</span> /&gt;</span>;</span></span><br></pre></td></tr></table></figure>\n<p>When you have the same property multiple times in a React component, the last declaration wins. This means that our last <code>activeClassName=&quot;active-link&quot;</code> declaration will always win, since it’s placed after <code>{...this.props}</code>. To fix this we can reorder the properties so we spread this.props last. This means that we set sensible defaults that we’d like to use, but the user can override them if they really need to:</p>\n<p>当您在React组件中多次具有相同的属性时，最后一个会被使用。这就意味着放在 <code>{...this.props}</code> 后面的 <code>activeClassName=&quot;active-link&quot;</code> 会被使用。我们可以把 this.props 放在最后来解决这个问题。这意味着如果用户真的需要我们可以设置一些想要合理的默认值，但是这些默认值是可以被覆盖：</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">Link</span> <span class=\"attr\">activeClassName</span>=<span class=\"string\">\"active-link\"</span> &#123;<span class=\"attr\">...props</span>&#125; /&gt;</span>;</span></span><br></pre></td></tr></table></figure>\n<p>By creating higher order components that wrap existing ones but with additional behavior, we keep our code base clean and defend against future changes by not repeating properties and keeping their values in just one place.</p>\n<p>通过创建一个逛街组件可以使现有的组件得到额外的功能，我们尽量保持我们的代码简洁，并且通过不重复的属性来应对未来的变化，同时把他们的值保存在一个地方。</p>\n<h2 id=\"Higher-Order-Component-Creators\"><a href=\"#Higher-Order-Component-Creators\" class=\"headerlink\" title=\"Higher Order Component Creators\"></a><strong>Higher Order Component Creators</strong></h2><h2 id=\"高阶组件创造者\"><a href=\"#高阶组件创造者\" class=\"headerlink\" title=\"高阶组件创造者\"></a><strong>高阶组件创造者</strong></h2><p>Often you’ll have a number of components that you’ll need to wrap in the same behavior. This is very similar to earlier in this article when we wrapped <code>add</code> and <code>subtract</code> to add logging to them.</p>\n<p>通常你需要给很多组件添加同样的方法。这就和我们前面说到的给 <code>add</code> 函数和 <code>subtract</code> 函数添加显示输出一样。</p>\n<p>Let’s imagine in your application you have an object that contains information on the current user who is authenticated on the system. You need some of your React components to be able to access this information, but rather than blindly making it accessible for every component you want to be more strict about which components receive the information.</p>\n<p>让我们想象一下，在你的应用程序中，你有一个对象，其中包含关于系统进行身份验证的当前用户的信息。你需要你的 React 组件可以访问这些信息，而不是盲目地使每个组件都可以访问，你更希望严格地控制哪些组件接收信息。</p>\n<p>The way to solve this is to create a function that we can call with a React component. The function will then return a new React component that will render the given component but with an extra property which will give it access to the user information.</p>\n<p>解决的方法就是我们可以创建一个函数去调用一个 React 组件。函数会返回一个可以访问用户信息并且把原来组件进行渲染的新 React 组件。</p>\n<p>That sounds pretty complicated, but it’s made more straightforward with some code:</p>\n<p>听起来很复杂，但是通过一些代码就可以很简洁了：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">wrapWithUser</span>(<span class=\"params\">Component</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// information that we don’t want everything to access</span></span><br><span class=\"line\">    <span class=\"comment\">// 收限制的用户信息</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> secretUserInfo = &#123;</span><br><span class=\"line\">        <span class=\"attr\">name</span>:<span class=\"string\">'Jack Franklin'</span>,</span><br><span class=\"line\">        <span class=\"attr\">favouriteColour</span>:<span class=\"string\">'blue'</span></span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// return a newly generated React component</span></span><br><span class=\"line\">    <span class=\"comment\">// using a functional, stateless component</span></span><br><span class=\"line\">    <span class=\"comment\">// 返回一个新的 React 组件</span></span><br><span class=\"line\">    <span class=\"comment\">// 使用一个无状态函数式组件</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">props</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// pass in the user variable as a property, along with</span></span><br><span class=\"line\">        <span class=\"comment\">// all the other props that we might be given</span></span><br><span class=\"line\">        <span class=\"comment\">// 用户信息作为属性进行传递</span></span><br><span class=\"line\">        <span class=\"comment\">// 其他属性我们可以自定义</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">Component</span> <span class=\"attr\">user</span>=<span class=\"string\">&#123;secretUserInfo&#125;</span> &#123;<span class=\"attr\">...props</span>&#125; /&gt;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span></span><br></pre></td></tr></table></figure>\n<p>The function takes a React component (which is easy to spot given React components have to have capital letters at the beginning) and returns a new function that will render the component it was given with an extra property of user, which is set to the <code>secretUserInfo</code>.</p>\n<p>函数通过一个React组件（自定义的React组件必须有大写字母开头）并返回一个新的函数，它将使用设置在 <code>secretUserInfo</code> 里的用户的属性来渲染那个组件。</p>\n<p>Now let’s take a component, <code>&lt;AppHeader&gt;</code>, which wants access to this information so it can display the logged in user:</p>\n<p>现在我们有一个 <code>&lt;AppHeader&gt;</code> 组件需要这些信息，以便把登陆的用户信息展示出来：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> AppHeader=<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">props</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(props.user)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>Logged in as &#123;props.user.name&#125; <span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>You need to login<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>The final step is to connect this component up so it is given <code>this.props.user</code>. We can create a new component by passing this one into our <code>wrapWithUser</code> function.</p>\n<p>最后一步是将此组件连接起来，我们可以通过 <code>wrapWithUser</code> 函数创建新的组件，以便把 <code>this.props.user</code> 传递给他。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> ConnectedAppHeader = wrapWithUser(AppHeader);</span><br></pre></td></tr></table></figure>\n<p>We now have a <code>&lt;ConnectedAppHeader&gt;</code> component that can be rendered, and will have access to the <code>user</code> object.</p>\n<p>现在我们有了 <code>&lt;ConnectedAppHeader&gt;</code> 组件可以访问 <code>user</code> 对象，并且渲染原来的组件。</p>\n<p>I chose to call the component <code>ConnectedAppHeader</code> because I think of it as being connected with some extra piece of data that not every component is given access to.</p>\n<p>我给这个组件起名叫 <code>ConnectedAppHeader</code> 因为他传递了一些不希望所有组件都可以使用的额外数据。</p>\n<p>This pattern is very common in <strong>React</strong> libraries, particularly in <strong>Redux</strong>, so being aware of how it works and the reasons it’s being used will help you as your application grows and you rely on other third party libraries that use this approach.</p>\n<p>这种模式在 <strong>React</strong> 库中非常常见，特别是在 <strong>Redux</strong> 中，知道你依赖的第三方库是如何工作的，它被使用的原因将帮助你随着你的应用程序一起成长。</p>\n<h2 id=\"Conclusion\"><a href=\"#Conclusion\" class=\"headerlink\" title=\"Conclusion\"></a><strong>Conclusion</strong></h2><h2 id=\"结论\"><a href=\"#结论\" class=\"headerlink\" title=\"结论\"></a><strong>结论</strong></h2><p>This article has shown how, by applying principles of functional programming such as pure functions and higher order components to React, you can create a codebase that’s easier to maintain and work with on a daily basis.</p>\n<p>这篇文章即将结束，通过应用诸如纯函数和更高阶函数的函数式编程的原理应用到React，您可以创建一个更容易维护和使用的代码库。</p>\n<p>By creating higher order components you’re able to keep data defined in only one place, making refactoring easier. Higher order function creators enable you to keep most data private and only expose pieces of data to the components that really need it. By doing this you make it obvious which components are using which bits of data, and as your application grows you’ll find this beneficial.</p>\n<p>通过创建更高阶的组件，你只能将数据定义在一个位置，使重构更容易。更高阶的函数创建者使你能够将大部分数据保留为私有，并且仅将数据片段暴露给真正需要的组件。通过这样做，你可以清楚地知道哪些组件正在使用哪些数据，并且随着应用程序的发展，你会发现这是有益的。</p>\n","excerpt":"<p>In this article we will discuss how to use Higher Order Components to keep your React applications tidy, well structured and easy to maintain. We’ll discuss how pure functions keep code clean and how these same principles can be applied to React components.<br>在这片文章里我们将讨论任何使用高阶组件保持你的react应用整洁，结构合理，易于维护。纯函数是如何保持代码整洁并且如何将这些原则应用到react组件中。","more":"</p>\n<h2 id=\"Pure-Functions\"><a href=\"#Pure-Functions\" class=\"headerlink\" title=\"Pure Functions\"></a><strong>Pure Functions</strong></h2><h2 id=\"纯函数\"><a href=\"#纯函数\" class=\"headerlink\" title=\"纯函数\"></a><strong>纯函数</strong></h2><p>A function is considered pure if it adheres to the following properties:</p>\n<p>如果一个函数遵循以下几个规则那么他就是纯函数：</p>\n<ul>\n<li>All the data it deals with are declared as arguments</li>\n<li><p>函数处理的数据都是作为参数传递给函数。</p>\n</li>\n<li><p>It does not mutate data it was given or any other data (these are often referred to as side effects).</p>\n</li>\n<li><p>他不接受不确定的数据或者任何其他数据（他们通常是副作用的）。</p>\n</li>\n<li><p>Given the same input, it will always return the same output.</p>\n</li>\n<li>同样的输入，函数将得到同样的输出。</li>\n</ul>\n<p>For example, the add function below is pure:</p>\n<p>举个例子，下面的add函数就是个纯函数：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">add</span>(<span class=\"params\">x, y</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> x + y;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>However, the function badAdd below is impure:</p>\n<p>下面badadd就是不是纯函数：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> y = <span class=\"number\">2</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">badAdd</span>(<span class=\"params\">x</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> x + y;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>This function is not pure because it references data that it hasn’t directly been given. As a result, it’s possible to call this function with the same input and get different output:</p>\n<p>这个函数之所以不是纯函数是因为他所引用的数据不是直接给予的（不是通过参数传递，而是直接引用了外部全局变量。）。所以当你输入相同的数据时候可能得到不一样的输出。<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> y = <span class=\"number\">2</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">badAdd(<span class=\"number\">3</span>) <span class=\"comment\">// 5</span></span><br><span class=\"line\"></span><br><span class=\"line\">y = <span class=\"number\">3</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">badAdd(<span class=\"number\">3</span>) <span class=\"comment\">// 6</span></span><br></pre></td></tr></table></figure></p>\n<p>To read more about pure functions you can read “An introduction to reasonably pure programming” by Mark Brown.</p>\n<p>要了解更多关于纯函数的内容，你可以阅读一下Mark Brown写的“An introduction to reasonably pure programming”。</p>\n<h2 id=\"Higher-Order-Functions\"><a href=\"#Higher-Order-Functions\" class=\"headerlink\" title=\"Higher Order Functions\"></a><strong>Higher Order Functions</strong></h2><h2 id=\"高阶函数\"><a href=\"#高阶函数\" class=\"headerlink\" title=\"高阶函数\"></a><strong>高阶函数</strong></h2><p>A higher order function is a function that when called, returns another function. Often they also take a function as an argument, but this is not required for a function to be considered higher order.</p>\n<p>高阶函数的定义是，当一个函数被调用他将输出另一个函数。有时他们把函数作为参数，但是这个不是高阶函数的必要条件。</p>\n<p>Let’s say we have our <code>add</code> function from above, and we want to write some code so that when we call it we log the result to the <code>console</code> before returning the result. We’re unable to edit the <code>add</code> function, so instead we can create a new function:</p>\n<p>让我们再来看看前面说过的 <code>add</code> 函数，我们希望他在返回结果前，<code>console</code> 一下结果。我们不能改变 <code>add</code> 函数，所以我们要创建一个新函数来替代他：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">addAndLog</span>(<span class=\"params\">x, y</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> result = add(x, y);</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'Result'</span>, result);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>We decide that logging results of functions is useful, and now we want to do the same with a subtract function. Rather than duplicate the above, we could write a higher order function that can take a function and return a new function that calls the given function and logs the result before then returning it:</p>\n<p>我们显示函数的记录结果是有用的，现在我们要对减法函数做同样的事情。而不是复制上述内容，我们可以编写一个更高阶的函数，它可以执行一个函数接受函数作为参数，被调用的函数会返回结果和显示记录，函数则会返回新的函数。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">logAndReturn</span>(<span class=\"params\">func</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> args = <span class=\"built_in\">Array</span>.prototype.slice.call(<span class=\"built_in\">arguments</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> result = func.apply(<span class=\"literal\">null</span>, args);</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'Result'</span>, result);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Now we can take this function <code>and</code> use it to add logging to add and <code>subtract</code>:</p>\n<p>现在我们可以使用这个函数为 <code>add</code> 和 <code>subtract</code> 函数添加显示记录：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> addAndLog = logAndReturn(add);</span><br><span class=\"line\"></span><br><span class=\"line\">addAndLog(<span class=\"number\">4</span>, <span class=\"number\">4</span>) <span class=\"comment\">// 8 is returned, ‘Result 8’ is logged</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> subtractAndLog = logAndReturn(subtract);</span><br><span class=\"line\"></span><br><span class=\"line\">subtractAndLog(<span class=\"number\">4</span>, <span class=\"number\">3</span>) <span class=\"comment\">// 1 is returned, ‘Result 1’ is logged;</span></span><br></pre></td></tr></table></figure>\n<p><code>logAndReturn</code> is a HOF because it takes a function as its argument and returns a new function that we can call. These are really useful for wrapping existing functions that you can’t change in behavior. For more information on this, check M. David Green’s article “Higher-Order Functions in JavaScript which goes into much more detail on the subject.</p>\n<p><code>logAndReturn</code> 就是一个高阶函数因为他接受一个函数作为参数，并且返回一个函数被我们调用。封装且不改变现有函数的内部实现是非常有用的。希望了解更多相关内容可以去看看M. David Green写的 “Higher-Order Functions in JavaScript”。</p>\n<p>Additionally you can check out this CodePen, which shows the above code in action.</p>\n<p>另外你可以去CodePen，那里有上面说到的代码。</p>\n<h2 id=\"Higher-Order-Components\"><a href=\"#Higher-Order-Components\" class=\"headerlink\" title=\"Higher Order Components\"></a><strong>Higher Order Components</strong></h2><h2 id=\"高阶组件\"><a href=\"#高阶组件\" class=\"headerlink\" title=\"高阶组件\"></a><strong>高阶组件</strong></h2><p>Moving into React land, we can use the same logic as above to take existing React components and give them some extra behaviours.</p>\n<p>现在我们讨论讨论React，上面讲到的逻辑我们同样可以在React组件上使用，以赋予他们更多的行为。</p>\n<p>In this section we’re going to use React Router, the de facto routing solution for React. If you’d like to get started with the library I highly recommend the React Router Tutorial on GitHub.</p>\n<p>在这节我们将使用React Router，这个是React的路由解决方案。如果你开始使用库，我强烈建议你使用GitHub上的React Router Tutorial。</p>\n<h2 id=\"React-Router’s-Link-component-React\"><a href=\"#React-Router’s-Link-component-React\" class=\"headerlink\" title=\"React Router’s Link component React\"></a><strong>React Router’s Link component React</strong></h2><h2 id=\"路由链接组件\"><a href=\"#路由链接组件\" class=\"headerlink\" title=\"路由链接组件\"></a><strong>路由链接组件</strong></h2><p>React Router provides a <code>&lt;Link&gt;</code> component that is used to link between pages in a React application. One of the properties that this <code>&lt;Link&gt;</code> component takes is <code>activeClassName</code>. When a <code>&lt;Link&gt;</code> has this property and it is currently active (the user is on a URL that the link points to), the component will be given this class, enabling the developer to style it.</p>\n<p>React 路由提供 <code>&lt;Link&gt;</code> 用于链接React应用里的页面。<code>&lt;Link&gt;</code> 组件其中一个属性是 <code>activeClassName</code>。当 <code>&lt;Link&gt;</code> 组件处于活动状态时使用了这个属性（用户经过链接时候的意思），组件将使用这个样类名，以便开发人员能够对其样式进行美化。</p>\n<p>This is a really useful feature, and in our hypothetical application we decide that we always want to use this property. However, after doing so we quickly discover that this is making all our <code>&lt;Link&gt;</code> components very verbose:</p>\n<p>这是一个非常有用的功能，在我们假设的应用程序中，我们决定我们总是使用这个属性。然而，很快我们会发现这会使 <code>&lt;Link&gt;</code> 组件变得臃肿：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Link</span> <span class=\"attr\">to</span>=<span class=\"string\">\"/\"</span> <span class=\"attr\">activeClassName</span>=<span class=\"string\">\"active-link\"</span>&gt;</span> Home <span class=\"tag\">&lt;/<span class=\"name\">Link</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Link</span> <span class=\"attr\">to</span>=<span class=\"string\">\"/about\"</span> <span class=\"attr\">activeClassName</span>=<span class=\"string\">\"active-link\"</span>&gt;</span> About<span class=\"tag\">&lt;/<span class=\"name\">Link</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Link</span> <span class=\"attr\">to</span>=<span class=\"string\">\"/contact\"</span> <span class=\"attr\">activeClassName</span>=<span class=\"string\">\"active-link\"</span>&gt;</span> Contact<span class=\"tag\">&lt;/<span class=\"name\">Link</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>Notice that we are having to repeat the class name property every time. Not only does this make our components verbose, it also means that if we decide to change the class name we’ve got to do it in a lot of places.</p>\n<p>注意我们每次都必须重复使用那个类的属性名。这不仅使我们的组件臃肿，这也意味着如果我们决定改变类名，我们必须在很多地方进行修改。</p>\n<p>Instead, we can write a component that wraps the <code>&lt;Link&gt;</code> component:</p>\n<p>替换，我们要写一个组件去封装 <code>&lt;Link&gt;</code> 组件：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> AppLink=React.createClass(&#123;</span><br><span class=\"line\">    <span class=\"attr\">render</span>:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>(</span><br><span class=\"line\">            <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">Link</span> <span class=\"attr\">to</span>=<span class=\"string\">&#123;this.props.to&#125;</span> <span class=\"attr\">activeClassName</span>=<span class=\"string\">\"active-link\"</span>&gt;</span></span><br><span class=\"line\">                &#123;this.props.children&#125;</span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">Link</span>&gt;</span></span>;</span><br><span class=\"line\">        );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>And now we can use this component, which tidies up our links:</p>\n<p>现在我们可以使用这个组件来整合我们的链接：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">AppLink</span> <span class=\"attr\">to</span>=<span class=\"string\">\"/\"</span>&gt;</span>Home<span class=\"tag\">&lt;/<span class=\"name\">AppLink</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">AppLink</span> <span class=\"attr\">to</span>=<span class=\"string\">\"/about\"</span>&gt;</span>About<span class=\"tag\">&lt;/<span class=\"name\">AppLink</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">AppLink</span> <span class=\"attr\">to</span>=<span class=\"string\">\"/contact\"</span>&gt;</span>Contact<span class=\"tag\">&lt;/<span class=\"name\">AppLink</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>In the React ecosystem these components are known as higher order components because they take an existing component and manipulate it slightly without changing the existing component. You can also think of these as wrapper components, but you’ll find them commonly referred to as higher order components in React-based content.</p>\n<p>在React生态系统中，这些组件被称为高阶组件，因为他们采用现有组件并对他们进行封装，但是并没有更改现有组件。你也可以将他们视为封装组件，但你会发现他们通常被称为 <code>React-based</code> 内容中的高阶组件。</p>\n<h2 id=\"Functional-Stateless-Components\"><a href=\"#Functional-Stateless-Components\" class=\"headerlink\" title=\"Functional, Stateless Components\"></a><strong>Functional, Stateless Components</strong></h2><h2 id=\"函数式无状态组件\"><a href=\"#函数式无状态组件\" class=\"headerlink\" title=\"函数式无状态组件\"></a><strong>函数式无状态组件</strong></h2><p>React 0.14 introduced support for functional, stateless components. These are components that have the following characteristics:</p>\n<p>React0.14开始提供函数式无状态组件，函数式无状态组件具有以下特点：</p>\n<ul>\n<li><p>They do not have any state.</p>\n</li>\n<li><p>他们没有state</p>\n</li>\n<li><p>They do not use any React lifecycle methods (such as componentWillMount()).</p>\n</li>\n<li><p>他们无法使用React生命周期函数（比如 componentWillMount()）</p>\n</li>\n<li><p>They only define the render method and nothing more.</p>\n</li>\n<li><p>他们只定义了 render 方法，没有其他的了。</p>\n</li>\n</ul>\n<p>When a component adheres to the above, we can define it as a function, rather than using React.createClass (or class App extends React.Component if you’re using ES2015 classes). For example, the two expressions below both produce the same component:</p>\n<p>当一个组件遵守上述内容时，我们可以将其定义为一个函数，而不是使用React.createClass（如果你使用了 ES2015  classes 你也可以使用class 来扩展你的React 组件）。下面的两个表达式产生相同的组件：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> App = React.createClass(&#123;</span><br><span class=\"line\">    <span class=\"attr\">render</span>: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>My name is &#123; this.props.name &#125;<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span>;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> App = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">props</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>My name is &#123; props.name &#125;<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span>;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>In the functional, stateless component instead of referring to this.props we’re instead passed props as an argument. You can read more about this on the React documentation.</p>\n<p>在函数式无状态组件中，不是引用this.props，而是将props用作参数。React文档有更多介绍。</p>\n<p>Because higher order components often wrap an existing component you’ll often find you can define them as a functional component. For the rest of this article I’ll do that whenever possible.</p>\n<p>因为更高阶的组件通常会封装一个现有的组件，所以您经常会发现可以将它们定义为函数组件。在本文的其余部分，我将尽可能地这样做。</p>\n<h2 id=\"Better-Higher-Order-Components\"><a href=\"#Better-Higher-Order-Components\" class=\"headerlink\" title=\"Better Higher Order Components\"></a><strong>Better Higher Order Components</strong></h2><h2 id=\"更好的高阶组件\"><a href=\"#更好的高阶组件\" class=\"headerlink\" title=\"更好的高阶组件\"></a><strong>更好的高阶组件</strong></h2><p>The above component works, but we can do much better. The AppLink component that we created isn’t quite fit for purpose.</p>\n<p>我们不只局限于组件可以正常运行，我们希望做的更好。我们创建的 <code>AppLink</code> 组件就不太适合。</p>\n<h2 id=\"Accepting-multiple-properties\"><a href=\"#Accepting-multiple-properties\" class=\"headerlink\" title=\"Accepting multiple properties\"></a><strong>Accepting multiple properties</strong></h2><h2 id=\"接受多个参数\"><a href=\"#接受多个参数\" class=\"headerlink\" title=\"接受多个参数\"></a><strong>接受多个参数</strong></h2><p>The <code>&lt;AppLink&gt;</code> component expects two properties:</p>\n<p><code>&lt;AppLink&gt;</code> 组件估计会有两个参数：</p>\n<ul>\n<li>this.props.to which is the URL the link should take the user to</li>\n<li><p>this.props.to 表示链接让用户访问的URL</p>\n</li>\n<li><p>this.props.children which is the text shown to the user</p>\n</li>\n<li>this.props.children 表示显示的文本</li>\n</ul>\n<p>However, the <code>&lt;Link&gt;</code> component accepts many more properties, and there might be a time when you want to pass extra properties along with the two above which we nearly always want to pass. We haven’t made <code>&lt;AppLink&gt;</code> very extensible by hard coding the exact properties we need.</p>\n<p>当然，<code>&lt;Link&gt;</code> 组件可以接受更多发属性，有时我们只是想组件允许传递额外的属性以及上述的两个属性。我们并没有通过代码属性让 <code>&lt;AppLink&gt;</code> 有很高的扩展性。</p>\n<h2 id=\"The-JSX-spread\"><a href=\"#The-JSX-spread\" class=\"headerlink\" title=\"The JSX spread\"></a><strong>The JSX spread</strong></h2><h2 id=\"JSX-传递\"><a href=\"#JSX-传递\" class=\"headerlink\" title=\"JSX 传递\"></a><strong>JSX 传递</strong></h2><p>JSX, the HTML-like syntax we use to define React elements, supports the spread operator for passing an object to a component as properties. For example, the code samples below achieve the same thing:</p>\n<p>JSX，一种类似于HTML的语法用于定义React组件，支持扩展操作符将对象作为属性传递给组件。例如，下面的代码示例实现了同样的事情：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> props=&#123;<span class=\"attr\">a</span>:<span class=\"number\">1</span>,<span class=\"attr\">b</span>:<span class=\"number\">2</span>&#125;;</span><br><span class=\"line\">&lt;Foo a=&#123;props.a &#125;b=&#123;props.b&#125; /&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;Foo &#123;...props&#125; /&gt;</span><br></pre></td></tr></table></figure>\n<p>Using <code>{...props}</code> spreads each key in the object and passes it to <code>Foo</code> as an individual property.</p>\n<p>使用 <code>{... props}</code> 扩展对象中的每个键，并将其作为单个属性传递给 <code>Foo</code>。</p>\n<p>We can make use of this trick with <code>&lt;AppLink&gt;</code> so we support any arbitrary property that <code>&lt;Link&gt;</code> supports. By doing this we also future proof ourselves; if <code>&lt;Link&gt;</code> adds any new properties in the future our wrapper component will already support them. While we’re at it, I’m also going to change  <code>AppLink</code> to be a functional component.</p>\n<p>我们可以利用 <code>&lt;AppLink&gt;</code> 这个技巧，让我们支持 <code>&lt;Link&gt;</code> 支持的任意属性。通这样做，我们也将来证明自己；如果 <code>&lt;Link&gt;</code> 在将来添加任何新的属性，我们的包装器组件将已经支持它们。在我们这样做的时候，我同时要将 <code>AppLink</code> 改成函数式组件。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> AppLink = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">props</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">Link</span> &#123;<span class=\"attr\">...props</span>&#125; <span class=\"attr\">activeClassName</span>=<span class=\"string\">\"active-link\"</span> /&gt;</span>;</span><br><span class=\"line\">&#125;</span></span><br></pre></td></tr></table></figure>\n<p>Now <Link> will accept any properties and pass them through. Note that we also can use the self closing form instead of explicitly referencing {props.children} in-between the <Link> tags. React allows children to be passed as a regular prop or as child elements of a component between the opening and closing tag.</p>\n<p>现在将接受任何属性并传递它们。请注意，我们还可以使用笔和标签，而不是在标签之间传递{props.children}。React允许 children 作为常规 prop 或作为在开始和结束标签之间的组件的子元素进行传递。</p>\n<h2 id=\"Property-ordering-in-React\"><a href=\"#Property-ordering-in-React\" class=\"headerlink\" title=\"Property ordering in React\"></a><strong>Property ordering in React</strong></h2><h2 id=\"React中属性的排序\"><a href=\"#React中属性的排序\" class=\"headerlink\" title=\"React中属性的排序\"></a><strong>React中属性的排序</strong></h2><p>Imagine that for one specific link on your page, you have to use a different activeClassName. You try passing it into <AppLink>, since we pass all properties through:</p>\n<p>想象一下，对于页面上的一个特定链接，你必须使用不同的 activeClassName。尝试将其传递到 <AppLink> 中，我们通过以下方式传递所有属性： </p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;AppLink to=“/special-link” activeClassName=“special-active” &gt;</span><br><span class=\"line\">    Special Secret Link</span><br><span class=\"line\">&lt;<span class=\"regexp\">/AppLink&gt;</span></span><br></pre></td></tr></table></figure>\n<p>However, this doesn’t work. The reason is because of the ordering of properties when we render the <code>&lt;Link&gt;</code> component:</p>\n<p>但是，这不行。渲染 <code>&lt;Link&gt;</code> 组件时属性的顺序：</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt; <span class=\"attr\">Link</span> &#123;<span class=\"attr\">...props</span>&#125; <span class=\"attr\">activeClassName</span>=<span class=\"string\">\"active-link\"</span> /&gt;</span>;</span></span><br></pre></td></tr></table></figure>\n<p>When you have the same property multiple times in a React component, the last declaration wins. This means that our last <code>activeClassName=&quot;active-link&quot;</code> declaration will always win, since it’s placed after <code>{...this.props}</code>. To fix this we can reorder the properties so we spread this.props last. This means that we set sensible defaults that we’d like to use, but the user can override them if they really need to:</p>\n<p>当您在React组件中多次具有相同的属性时，最后一个会被使用。这就意味着放在 <code>{...this.props}</code> 后面的 <code>activeClassName=&quot;active-link&quot;</code> 会被使用。我们可以把 this.props 放在最后来解决这个问题。这意味着如果用户真的需要我们可以设置一些想要合理的默认值，但是这些默认值是可以被覆盖：</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">Link</span> <span class=\"attr\">activeClassName</span>=<span class=\"string\">\"active-link\"</span> &#123;<span class=\"attr\">...props</span>&#125; /&gt;</span>;</span></span><br></pre></td></tr></table></figure>\n<p>By creating higher order components that wrap existing ones but with additional behavior, we keep our code base clean and defend against future changes by not repeating properties and keeping their values in just one place.</p>\n<p>通过创建一个逛街组件可以使现有的组件得到额外的功能，我们尽量保持我们的代码简洁，并且通过不重复的属性来应对未来的变化，同时把他们的值保存在一个地方。</p>\n<h2 id=\"Higher-Order-Component-Creators\"><a href=\"#Higher-Order-Component-Creators\" class=\"headerlink\" title=\"Higher Order Component Creators\"></a><strong>Higher Order Component Creators</strong></h2><h2 id=\"高阶组件创造者\"><a href=\"#高阶组件创造者\" class=\"headerlink\" title=\"高阶组件创造者\"></a><strong>高阶组件创造者</strong></h2><p>Often you’ll have a number of components that you’ll need to wrap in the same behavior. This is very similar to earlier in this article when we wrapped <code>add</code> and <code>subtract</code> to add logging to them.</p>\n<p>通常你需要给很多组件添加同样的方法。这就和我们前面说到的给 <code>add</code> 函数和 <code>subtract</code> 函数添加显示输出一样。</p>\n<p>Let’s imagine in your application you have an object that contains information on the current user who is authenticated on the system. You need some of your React components to be able to access this information, but rather than blindly making it accessible for every component you want to be more strict about which components receive the information.</p>\n<p>让我们想象一下，在你的应用程序中，你有一个对象，其中包含关于系统进行身份验证的当前用户的信息。你需要你的 React 组件可以访问这些信息，而不是盲目地使每个组件都可以访问，你更希望严格地控制哪些组件接收信息。</p>\n<p>The way to solve this is to create a function that we can call with a React component. The function will then return a new React component that will render the given component but with an extra property which will give it access to the user information.</p>\n<p>解决的方法就是我们可以创建一个函数去调用一个 React 组件。函数会返回一个可以访问用户信息并且把原来组件进行渲染的新 React 组件。</p>\n<p>That sounds pretty complicated, but it’s made more straightforward with some code:</p>\n<p>听起来很复杂，但是通过一些代码就可以很简洁了：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">wrapWithUser</span>(<span class=\"params\">Component</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// information that we don’t want everything to access</span></span><br><span class=\"line\">    <span class=\"comment\">// 收限制的用户信息</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> secretUserInfo = &#123;</span><br><span class=\"line\">        <span class=\"attr\">name</span>:<span class=\"string\">'Jack Franklin'</span>,</span><br><span class=\"line\">        <span class=\"attr\">favouriteColour</span>:<span class=\"string\">'blue'</span></span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// return a newly generated React component</span></span><br><span class=\"line\">    <span class=\"comment\">// using a functional, stateless component</span></span><br><span class=\"line\">    <span class=\"comment\">// 返回一个新的 React 组件</span></span><br><span class=\"line\">    <span class=\"comment\">// 使用一个无状态函数式组件</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">props</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// pass in the user variable as a property, along with</span></span><br><span class=\"line\">        <span class=\"comment\">// all the other props that we might be given</span></span><br><span class=\"line\">        <span class=\"comment\">// 用户信息作为属性进行传递</span></span><br><span class=\"line\">        <span class=\"comment\">// 其他属性我们可以自定义</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">Component</span> <span class=\"attr\">user</span>=<span class=\"string\">&#123;secretUserInfo&#125;</span> &#123;<span class=\"attr\">...props</span>&#125; /&gt;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span></span><br></pre></td></tr></table></figure>\n<p>The function takes a React component (which is easy to spot given React components have to have capital letters at the beginning) and returns a new function that will render the component it was given with an extra property of user, which is set to the <code>secretUserInfo</code>.</p>\n<p>函数通过一个React组件（自定义的React组件必须有大写字母开头）并返回一个新的函数，它将使用设置在 <code>secretUserInfo</code> 里的用户的属性来渲染那个组件。</p>\n<p>Now let’s take a component, <code>&lt;AppHeader&gt;</code>, which wants access to this information so it can display the logged in user:</p>\n<p>现在我们有一个 <code>&lt;AppHeader&gt;</code> 组件需要这些信息，以便把登陆的用户信息展示出来：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> AppHeader=<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">props</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(props.user)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>Logged in as &#123;props.user.name&#125; <span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>You need to login<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>The final step is to connect this component up so it is given <code>this.props.user</code>. We can create a new component by passing this one into our <code>wrapWithUser</code> function.</p>\n<p>最后一步是将此组件连接起来，我们可以通过 <code>wrapWithUser</code> 函数创建新的组件，以便把 <code>this.props.user</code> 传递给他。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> ConnectedAppHeader = wrapWithUser(AppHeader);</span><br></pre></td></tr></table></figure>\n<p>We now have a <code>&lt;ConnectedAppHeader&gt;</code> component that can be rendered, and will have access to the <code>user</code> object.</p>\n<p>现在我们有了 <code>&lt;ConnectedAppHeader&gt;</code> 组件可以访问 <code>user</code> 对象，并且渲染原来的组件。</p>\n<p>I chose to call the component <code>ConnectedAppHeader</code> because I think of it as being connected with some extra piece of data that not every component is given access to.</p>\n<p>我给这个组件起名叫 <code>ConnectedAppHeader</code> 因为他传递了一些不希望所有组件都可以使用的额外数据。</p>\n<p>This pattern is very common in <strong>React</strong> libraries, particularly in <strong>Redux</strong>, so being aware of how it works and the reasons it’s being used will help you as your application grows and you rely on other third party libraries that use this approach.</p>\n<p>这种模式在 <strong>React</strong> 库中非常常见，特别是在 <strong>Redux</strong> 中，知道你依赖的第三方库是如何工作的，它被使用的原因将帮助你随着你的应用程序一起成长。</p>\n<h2 id=\"Conclusion\"><a href=\"#Conclusion\" class=\"headerlink\" title=\"Conclusion\"></a><strong>Conclusion</strong></h2><h2 id=\"结论\"><a href=\"#结论\" class=\"headerlink\" title=\"结论\"></a><strong>结论</strong></h2><p>This article has shown how, by applying principles of functional programming such as pure functions and higher order components to React, you can create a codebase that’s easier to maintain and work with on a daily basis.</p>\n<p>这篇文章即将结束，通过应用诸如纯函数和更高阶函数的函数式编程的原理应用到React，您可以创建一个更容易维护和使用的代码库。</p>\n<p>By creating higher order components you’re able to keep data defined in only one place, making refactoring easier. Higher order function creators enable you to keep most data private and only expose pieces of data to the components that really need it. By doing this you make it obvious which components are using which bits of data, and as your application grows you’ll find this beneficial.</p>\n<p>通过创建更高阶的组件，你只能将数据定义在一个位置，使重构更容易。更高阶的函数创建者使你能够将大部分数据保留为私有，并且仅将数据片段暴露给真正需要的组件。通过这样做，你可以清楚地知道哪些组件正在使用哪些数据，并且随着应用程序的发展，你会发现这是有益的。</p>"},{"title":"从高阶函数到高阶组件","date":"2017-11-15T01:33:02.000Z","_content":"## 纯函数([https://zh.wikipedia.org/wiki/纯函数](https://zh.wikipedia.org/wiki/%E7%BA%AF%E5%87%BD%E6%95%B0))\n如果一个函数遵循以下几个规则那么他就是纯函数：\n+ 函数处理的数据都是通过参数传递给函数。\n+ 他不接受不确定的数据或者任何其他数据（他们通常是[副作用](https://zh.wikipedia.org/wiki/函数副作用)的）。\n+ 同样的输入，函数将得到同样的输出。\n\n纯函数的好处主要有几点：\n+ 无状态。线程安全。不需要线程同步。\n+ `纯函数相互调用组装起来的函数，还是纯函数`。\n+ 应用程序或者运行环境（Runtime）可以对纯函数的运算结果进行缓存，运算加快速度。<!--more-->\n\n例子：\n```javascript\n//纯函数\nfunction add(x, y) {\n    return x + y;\n}\n```\n```javascript\n//不是纯函数\nvar y = 2;\n\nfunction badAdd(x) {\n    return x + y;\n} \n```\n\n## 高阶函数([https://zh.wikipedia.org/wiki/高阶函数](https://zh.wikipedia.org/wiki/%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0))\n在数学和计算机科学中，高阶函数是至少满足下列一个条件的函数：\n+ 接受一个或多个函数作为输入\n+ 输出一个函数\n\n例子：\n```javascript\nfunction addition(x, y) {\n    return X + Y;\n}\n```\n业务发生改变需要console，addition不能修改，因为你不知道add都用在了哪里，你的修改会对现有代码参数什么样的后果。于是有了下面的结果：\n```javascript\nfunction additionAndLog(x, y) {\n    var result = addition(x, y);\n    console.log('Result', result);\n    return result;\n}\n```\n由于你的修改没有对现有代码产生不好的影响，所以减法、乘法、除法都要做console的添加：\n```javascript\nfunction subtractionAndLog(x, y) {\n    var result = subtraction(x, y);\n    console.log('Result', result);\n    return result;\n}\n```\n```javascript\nfunction multiplicationAndLog(x, y) {\n    var result = multiplication(x, y);\n    console.log('Result', result);\n    return result;\n}\n```\n```javascript\nfunction divisionAndLog(x, y) {\n    var result = division(x, y);\n    console.log('Result', result);\n    return result;\n}\n```\n由于你的修改没有对现有代码产生不好的影响，所以n个函数都要做console的添加！！！\n改变思路：\n\n```javascript\nfunction logAndReturn(func) {\n    return function() {\n        var args = Array.prototype.slice.call(arguments)\n        // arguments是个类数组 {0:42, 1:52, 2:63, length:3}\n        // Array的实例的slice给arguments使用\n        var result = func.apply(null, args);\n        // Function.apply(obj,args)能接受两个参数：\n        // obj: 这个对象将代替Function类中的this对象\n        // args： 这是个数组，它将作为参数传递给Function类\n        // function Person(name,age){\n        //     this.name=name;\n        //     this.age=age;\n        //     this.sayhello=function(){alert(\"hello\")//};\n        // } \n        // function Student(name,age,grade,school){\n        //     Person.apply(this,arguments);\n        //     this.grade=grade;\n        //     this.school=school;\n        // } \n        console.log('Result', result);\n        return result;\n    }\n}\n\nconst additionAndLog =  logAndReturn(addition);\nconst subtractionAndLog =  logAndReturn(subtraction);\nconst multiplicationAndLog =  logAndReturn(multiplication);\nconst divisionAndLog =  logAndReturn(division);\n```\n## 高阶组件\n一个路由组件的例子：\n```html\n<Link to=\"/\" activeClassName=\"active-link\"> Home </Link>\n<Link to=\"/about\" activeClassName=\"active-link\"> About</Link>\n<Link to=\"/contact\" activeClassName=\"active-link\"> Contact</Link>\n```\n初步优化，提取相同的代码：\n```javascript\nvar AppLink=React.createClass({\n    render:function(){\n        return(\n            <Link to={this.props.to} activeClassName=\"active-link\">\n                {this.props.children}\n            </Link>;\n        );\n    }\n});\n```\n改变现在的路由组件：\n```html\n<AppLink to=\"/\">Home</AppLink>\n<AppLink to=\"/about\">About</AppLink>\n<AppLink to=\"/contact\">Contact</AppLink>\n```\n进一步优化，对props的覆盖控制：\n```javascript\n//高阶组件覆盖，强调统一\nvar AppLink=React.createClass({\n    render:function(){\n        const {children, props} = this.props;\n        return(\n            <Link {...props} activeClassName=\"active-link\">\n                {children}\n            </Link>;\n        );\n    }\n});\n\n//调用组件覆盖，强调默认值和定制化\nvar AppLink=React.createClass({\n    render:function(){\n        const {children, props} = this.props;\n        return(\n            <Link activeClassName=\"active-link\" {...props}>\n                {children}\n            </Link>;\n        );\n    }\n});\n```\n## SAAS项目的应用实例-----<AuthControl>权限控制组件\n\n```Javascript\nclass AuthControl extends React.Component {\n    render() {\n        const { roles, userRoles, deniedAuth, children } = this.props;\n\n        if (_.intersection(roles, userRoles).length === 0) {\n            if (deniedAuth !== undefined) {\n                return deniedAuth;\n            }\n            return null;\n        } else {\n            return (children);\n        }\n    }\n}\n\nAuthControl.propTypes = {\n    roles: React.PropTypes.array.isRequired,\n    userRoles: React.PropTypes.array.isRequired,\n    children: React.PropTypes.element,\n    deniedAuth: React.PropTypes.element,\n};\n\n<AuthControl\n    roles={['admin']} \n    userRoles={[‘user’]}\n    deniedAuth={<div>没有权限</div>}\n>\n    <div>有权限</div>\n</AuthControl>\n```\n## 结论\n通过将纯函数和高阶函数的函数式编程的原理应用到React，您可以创建一个更容易维护和使用的代码库。","source":"_posts/从高阶函数到高阶组件.md","raw":"---\ntitle: 从高阶函数到高阶组件\ndate: 2017-11-15 09:33:02\ntags: ['前端','js','javascript','react','高阶函数','纯函数','高阶组件']\ncategory: 'coding'\n---\n## 纯函数([https://zh.wikipedia.org/wiki/纯函数](https://zh.wikipedia.org/wiki/%E7%BA%AF%E5%87%BD%E6%95%B0))\n如果一个函数遵循以下几个规则那么他就是纯函数：\n+ 函数处理的数据都是通过参数传递给函数。\n+ 他不接受不确定的数据或者任何其他数据（他们通常是[副作用](https://zh.wikipedia.org/wiki/函数副作用)的）。\n+ 同样的输入，函数将得到同样的输出。\n\n纯函数的好处主要有几点：\n+ 无状态。线程安全。不需要线程同步。\n+ `纯函数相互调用组装起来的函数，还是纯函数`。\n+ 应用程序或者运行环境（Runtime）可以对纯函数的运算结果进行缓存，运算加快速度。<!--more-->\n\n例子：\n```javascript\n//纯函数\nfunction add(x, y) {\n    return x + y;\n}\n```\n```javascript\n//不是纯函数\nvar y = 2;\n\nfunction badAdd(x) {\n    return x + y;\n} \n```\n\n## 高阶函数([https://zh.wikipedia.org/wiki/高阶函数](https://zh.wikipedia.org/wiki/%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0))\n在数学和计算机科学中，高阶函数是至少满足下列一个条件的函数：\n+ 接受一个或多个函数作为输入\n+ 输出一个函数\n\n例子：\n```javascript\nfunction addition(x, y) {\n    return X + Y;\n}\n```\n业务发生改变需要console，addition不能修改，因为你不知道add都用在了哪里，你的修改会对现有代码参数什么样的后果。于是有了下面的结果：\n```javascript\nfunction additionAndLog(x, y) {\n    var result = addition(x, y);\n    console.log('Result', result);\n    return result;\n}\n```\n由于你的修改没有对现有代码产生不好的影响，所以减法、乘法、除法都要做console的添加：\n```javascript\nfunction subtractionAndLog(x, y) {\n    var result = subtraction(x, y);\n    console.log('Result', result);\n    return result;\n}\n```\n```javascript\nfunction multiplicationAndLog(x, y) {\n    var result = multiplication(x, y);\n    console.log('Result', result);\n    return result;\n}\n```\n```javascript\nfunction divisionAndLog(x, y) {\n    var result = division(x, y);\n    console.log('Result', result);\n    return result;\n}\n```\n由于你的修改没有对现有代码产生不好的影响，所以n个函数都要做console的添加！！！\n改变思路：\n\n```javascript\nfunction logAndReturn(func) {\n    return function() {\n        var args = Array.prototype.slice.call(arguments)\n        // arguments是个类数组 {0:42, 1:52, 2:63, length:3}\n        // Array的实例的slice给arguments使用\n        var result = func.apply(null, args);\n        // Function.apply(obj,args)能接受两个参数：\n        // obj: 这个对象将代替Function类中的this对象\n        // args： 这是个数组，它将作为参数传递给Function类\n        // function Person(name,age){\n        //     this.name=name;\n        //     this.age=age;\n        //     this.sayhello=function(){alert(\"hello\")//};\n        // } \n        // function Student(name,age,grade,school){\n        //     Person.apply(this,arguments);\n        //     this.grade=grade;\n        //     this.school=school;\n        // } \n        console.log('Result', result);\n        return result;\n    }\n}\n\nconst additionAndLog =  logAndReturn(addition);\nconst subtractionAndLog =  logAndReturn(subtraction);\nconst multiplicationAndLog =  logAndReturn(multiplication);\nconst divisionAndLog =  logAndReturn(division);\n```\n## 高阶组件\n一个路由组件的例子：\n```html\n<Link to=\"/\" activeClassName=\"active-link\"> Home </Link>\n<Link to=\"/about\" activeClassName=\"active-link\"> About</Link>\n<Link to=\"/contact\" activeClassName=\"active-link\"> Contact</Link>\n```\n初步优化，提取相同的代码：\n```javascript\nvar AppLink=React.createClass({\n    render:function(){\n        return(\n            <Link to={this.props.to} activeClassName=\"active-link\">\n                {this.props.children}\n            </Link>;\n        );\n    }\n});\n```\n改变现在的路由组件：\n```html\n<AppLink to=\"/\">Home</AppLink>\n<AppLink to=\"/about\">About</AppLink>\n<AppLink to=\"/contact\">Contact</AppLink>\n```\n进一步优化，对props的覆盖控制：\n```javascript\n//高阶组件覆盖，强调统一\nvar AppLink=React.createClass({\n    render:function(){\n        const {children, props} = this.props;\n        return(\n            <Link {...props} activeClassName=\"active-link\">\n                {children}\n            </Link>;\n        );\n    }\n});\n\n//调用组件覆盖，强调默认值和定制化\nvar AppLink=React.createClass({\n    render:function(){\n        const {children, props} = this.props;\n        return(\n            <Link activeClassName=\"active-link\" {...props}>\n                {children}\n            </Link>;\n        );\n    }\n});\n```\n## SAAS项目的应用实例-----<AuthControl>权限控制组件\n\n```Javascript\nclass AuthControl extends React.Component {\n    render() {\n        const { roles, userRoles, deniedAuth, children } = this.props;\n\n        if (_.intersection(roles, userRoles).length === 0) {\n            if (deniedAuth !== undefined) {\n                return deniedAuth;\n            }\n            return null;\n        } else {\n            return (children);\n        }\n    }\n}\n\nAuthControl.propTypes = {\n    roles: React.PropTypes.array.isRequired,\n    userRoles: React.PropTypes.array.isRequired,\n    children: React.PropTypes.element,\n    deniedAuth: React.PropTypes.element,\n};\n\n<AuthControl\n    roles={['admin']} \n    userRoles={[‘user’]}\n    deniedAuth={<div>没有权限</div>}\n>\n    <div>有权限</div>\n</AuthControl>\n```\n## 结论\n通过将纯函数和高阶函数的函数式编程的原理应用到React，您可以创建一个更容易维护和使用的代码库。","slug":"从高阶函数到高阶组件","published":1,"updated":"2019-02-20T02:50:38.638Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjsgue0fa001mgpi6wbrcfeu3","content":"<h2 id=\"纯函数-https-zh-wikipedia-org-wiki-纯函数\"><a href=\"#纯函数-https-zh-wikipedia-org-wiki-纯函数\" class=\"headerlink\" title=\"纯函数(https://zh.wikipedia.org/wiki/纯函数)\"></a>纯函数(<a href=\"https://zh.wikipedia.org/wiki/%E7%BA%AF%E5%87%BD%E6%95%B0\" target=\"_blank\" rel=\"external\">https://zh.wikipedia.org/wiki/纯函数</a>)</h2><p>如果一个函数遵循以下几个规则那么他就是纯函数：</p>\n<ul>\n<li>函数处理的数据都是通过参数传递给函数。</li>\n<li>他不接受不确定的数据或者任何其他数据（他们通常是<a href=\"https://zh.wikipedia.org/wiki/函数副作用\" target=\"_blank\" rel=\"external\">副作用</a>的）。</li>\n<li>同样的输入，函数将得到同样的输出。</li>\n</ul>\n<p>纯函数的好处主要有几点：</p>\n<ul>\n<li>无状态。线程安全。不需要线程同步。</li>\n<li><code>纯函数相互调用组装起来的函数，还是纯函数</code>。</li>\n<li>应用程序或者运行环境（Runtime）可以对纯函数的运算结果进行缓存，运算加快速度。<a id=\"more\"></a></li>\n</ul>\n<p>例子：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//纯函数</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">add</span>(<span class=\"params\">x, y</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> x + y;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//不是纯函数</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> y = <span class=\"number\">2</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">badAdd</span>(<span class=\"params\">x</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> x + y;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"高阶函数-https-zh-wikipedia-org-wiki-高阶函数\"><a href=\"#高阶函数-https-zh-wikipedia-org-wiki-高阶函数\" class=\"headerlink\" title=\"高阶函数(https://zh.wikipedia.org/wiki/高阶函数)\"></a>高阶函数(<a href=\"https://zh.wikipedia.org/wiki/%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0\" target=\"_blank\" rel=\"external\">https://zh.wikipedia.org/wiki/高阶函数</a>)</h2><p>在数学和计算机科学中，高阶函数是至少满足下列一个条件的函数：</p>\n<ul>\n<li>接受一个或多个函数作为输入</li>\n<li>输出一个函数</li>\n</ul>\n<p>例子：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">addition</span>(<span class=\"params\">x, y</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> X + Y;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>业务发生改变需要console，addition不能修改，因为你不知道add都用在了哪里，你的修改会对现有代码参数什么样的后果。于是有了下面的结果：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">additionAndLog</span>(<span class=\"params\">x, y</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> result = addition(x, y);</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'Result'</span>, result);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>由于你的修改没有对现有代码产生不好的影响，所以减法、乘法、除法都要做console的添加：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">subtractionAndLog</span>(<span class=\"params\">x, y</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> result = subtraction(x, y);</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'Result'</span>, result);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">multiplicationAndLog</span>(<span class=\"params\">x, y</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> result = multiplication(x, y);</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'Result'</span>, result);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">divisionAndLog</span>(<span class=\"params\">x, y</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> result = division(x, y);</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'Result'</span>, result);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>由于你的修改没有对现有代码产生不好的影响，所以n个函数都要做console的添加！！！<br>改变思路：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">logAndReturn</span>(<span class=\"params\">func</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> args = <span class=\"built_in\">Array</span>.prototype.slice.call(<span class=\"built_in\">arguments</span>)</span><br><span class=\"line\">        <span class=\"comment\">// arguments是个类数组 &#123;0:42, 1:52, 2:63, length:3&#125;</span></span><br><span class=\"line\">        <span class=\"comment\">// Array的实例的slice给arguments使用</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> result = func.apply(<span class=\"literal\">null</span>, args);</span><br><span class=\"line\">        <span class=\"comment\">// Function.apply(obj,args)能接受两个参数：</span></span><br><span class=\"line\">        <span class=\"comment\">// obj: 这个对象将代替Function类中的this对象</span></span><br><span class=\"line\">        <span class=\"comment\">// args： 这是个数组，它将作为参数传递给Function类</span></span><br><span class=\"line\">        <span class=\"comment\">// function Person(name,age)&#123;</span></span><br><span class=\"line\">        <span class=\"comment\">//     this.name=name;</span></span><br><span class=\"line\">        <span class=\"comment\">//     this.age=age;</span></span><br><span class=\"line\">        <span class=\"comment\">//     this.sayhello=function()&#123;alert(\"hello\")//&#125;;</span></span><br><span class=\"line\">        <span class=\"comment\">// &#125; </span></span><br><span class=\"line\">        <span class=\"comment\">// function Student(name,age,grade,school)&#123;</span></span><br><span class=\"line\">        <span class=\"comment\">//     Person.apply(this,arguments);</span></span><br><span class=\"line\">        <span class=\"comment\">//     this.grade=grade;</span></span><br><span class=\"line\">        <span class=\"comment\">//     this.school=school;</span></span><br><span class=\"line\">        <span class=\"comment\">// &#125; </span></span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'Result'</span>, result);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> additionAndLog =  logAndReturn(addition);</span><br><span class=\"line\"><span class=\"keyword\">const</span> subtractionAndLog =  logAndReturn(subtraction);</span><br><span class=\"line\"><span class=\"keyword\">const</span> multiplicationAndLog =  logAndReturn(multiplication);</span><br><span class=\"line\"><span class=\"keyword\">const</span> divisionAndLog =  logAndReturn(division);</span><br></pre></td></tr></table></figure>\n<h2 id=\"高阶组件\"><a href=\"#高阶组件\" class=\"headerlink\" title=\"高阶组件\"></a>高阶组件</h2><p>一个路由组件的例子：<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Link</span> <span class=\"attr\">to</span>=<span class=\"string\">\"/\"</span> <span class=\"attr\">activeClassName</span>=<span class=\"string\">\"active-link\"</span>&gt;</span> Home <span class=\"tag\">&lt;/<span class=\"name\">Link</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Link</span> <span class=\"attr\">to</span>=<span class=\"string\">\"/about\"</span> <span class=\"attr\">activeClassName</span>=<span class=\"string\">\"active-link\"</span>&gt;</span> About<span class=\"tag\">&lt;/<span class=\"name\">Link</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Link</span> <span class=\"attr\">to</span>=<span class=\"string\">\"/contact\"</span> <span class=\"attr\">activeClassName</span>=<span class=\"string\">\"active-link\"</span>&gt;</span> Contact<span class=\"tag\">&lt;/<span class=\"name\">Link</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p>初步优化，提取相同的代码：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> AppLink=React.createClass(&#123;</span><br><span class=\"line\">    <span class=\"attr\">render</span>:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>(</span><br><span class=\"line\">            <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">Link</span> <span class=\"attr\">to</span>=<span class=\"string\">&#123;this.props.to&#125;</span> <span class=\"attr\">activeClassName</span>=<span class=\"string\">\"active-link\"</span>&gt;</span></span><br><span class=\"line\">                &#123;this.props.children&#125;</span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">Link</span>&gt;</span></span>;</span><br><span class=\"line\">        );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>改变现在的路由组件：<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">AppLink</span> <span class=\"attr\">to</span>=<span class=\"string\">\"/\"</span>&gt;</span>Home<span class=\"tag\">&lt;/<span class=\"name\">AppLink</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">AppLink</span> <span class=\"attr\">to</span>=<span class=\"string\">\"/about\"</span>&gt;</span>About<span class=\"tag\">&lt;/<span class=\"name\">AppLink</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">AppLink</span> <span class=\"attr\">to</span>=<span class=\"string\">\"/contact\"</span>&gt;</span>Contact<span class=\"tag\">&lt;/<span class=\"name\">AppLink</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p>进一步优化，对props的覆盖控制：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//高阶组件覆盖，强调统一</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> AppLink=React.createClass(&#123;</span><br><span class=\"line\">    <span class=\"attr\">render</span>:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> &#123;children, props&#125; = <span class=\"keyword\">this</span>.props;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>(</span><br><span class=\"line\">            <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">Link</span> &#123;<span class=\"attr\">...props</span>&#125; <span class=\"attr\">activeClassName</span>=<span class=\"string\">\"active-link\"</span>&gt;</span></span><br><span class=\"line\">                &#123;children&#125;</span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">Link</span>&gt;</span></span>;</span><br><span class=\"line\">        );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//调用组件覆盖，强调默认值和定制化</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> AppLink=React.createClass(&#123;</span><br><span class=\"line\">    <span class=\"attr\">render</span>:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> &#123;children, props&#125; = <span class=\"keyword\">this</span>.props;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>(</span><br><span class=\"line\">            <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">Link</span> <span class=\"attr\">activeClassName</span>=<span class=\"string\">\"active-link\"</span> &#123;<span class=\"attr\">...props</span>&#125;&gt;</span></span><br><span class=\"line\">                &#123;children&#125;</span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">Link</span>&gt;</span></span>;</span><br><span class=\"line\">        );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"SAAS项目的应用实例—–权限控制组件\"><a href=\"#SAAS项目的应用实例—–权限控制组件\" class=\"headerlink\" title=\"SAAS项目的应用实例—–权限控制组件\"></a>SAAS项目的应用实例—–<authcontrol>权限控制组件</authcontrol></h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AuthControl</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">    render() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> &#123; roles, userRoles, deniedAuth, children &#125; = <span class=\"keyword\">this</span>.props;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (_.intersection(roles, userRoles).length === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (deniedAuth !== <span class=\"literal\">undefined</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> deniedAuth;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> (children);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">AuthControl.propTypes = &#123;</span><br><span class=\"line\">    <span class=\"attr\">roles</span>: React.PropTypes.array.isRequired,</span><br><span class=\"line\">    <span class=\"attr\">userRoles</span>: React.PropTypes.array.isRequired,</span><br><span class=\"line\">    <span class=\"attr\">children</span>: React.PropTypes.element,</span><br><span class=\"line\">    <span class=\"attr\">deniedAuth</span>: React.PropTypes.element,</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">AuthControl</span></span><br><span class=\"line\">    <span class=\"attr\">roles</span>=<span class=\"string\">&#123;[</span>'<span class=\"attr\">admin</span>']&#125; </span><br><span class=\"line\">    <span class=\"attr\">userRoles</span>=<span class=\"string\">&#123;[‘user’]&#125;</span></span><br><span class=\"line\">    <span class=\"attr\">deniedAuth</span>=<span class=\"string\">&#123;</span>&lt;<span class=\"attr\">div</span>&gt;</span>没有权限<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span>&#125;</span><br><span class=\"line\">&gt;</span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>有权限<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">AuthControl</span>&gt;</span></span></span><br></pre></td></tr></table></figure>\n<h2 id=\"结论\"><a href=\"#结论\" class=\"headerlink\" title=\"结论\"></a>结论</h2><p>通过将纯函数和高阶函数的函数式编程的原理应用到React，您可以创建一个更容易维护和使用的代码库。</p>\n","excerpt":"<h2 id=\"纯函数-https-zh-wikipedia-org-wiki-纯函数\"><a href=\"#纯函数-https-zh-wikipedia-org-wiki-纯函数\" class=\"headerlink\" title=\"纯函数(https://zh.wikipedia.org/wiki/纯函数)\"></a>纯函数(<a href=\"https://zh.wikipedia.org/wiki/%E7%BA%AF%E5%87%BD%E6%95%B0\">https://zh.wikipedia.org/wiki/纯函数</a>)</h2><p>如果一个函数遵循以下几个规则那么他就是纯函数：</p>\n<ul>\n<li>函数处理的数据都是通过参数传递给函数。</li>\n<li>他不接受不确定的数据或者任何其他数据（他们通常是<a href=\"https://zh.wikipedia.org/wiki/函数副作用\">副作用</a>的）。</li>\n<li>同样的输入，函数将得到同样的输出。</li>\n</ul>\n<p>纯函数的好处主要有几点：</p>\n<ul>\n<li>无状态。线程安全。不需要线程同步。</li>\n<li><code>纯函数相互调用组装起来的函数，还是纯函数</code>。</li>\n<li>应用程序或者运行环境（Runtime）可以对纯函数的运算结果进行缓存，运算加快速度。","more":"</li>\n</ul>\n<p>例子：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//纯函数</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">add</span>(<span class=\"params\">x, y</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> x + y;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//不是纯函数</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> y = <span class=\"number\">2</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">badAdd</span>(<span class=\"params\">x</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> x + y;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"高阶函数-https-zh-wikipedia-org-wiki-高阶函数\"><a href=\"#高阶函数-https-zh-wikipedia-org-wiki-高阶函数\" class=\"headerlink\" title=\"高阶函数(https://zh.wikipedia.org/wiki/高阶函数)\"></a>高阶函数(<a href=\"https://zh.wikipedia.org/wiki/%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0\">https://zh.wikipedia.org/wiki/高阶函数</a>)</h2><p>在数学和计算机科学中，高阶函数是至少满足下列一个条件的函数：</p>\n<ul>\n<li>接受一个或多个函数作为输入</li>\n<li>输出一个函数</li>\n</ul>\n<p>例子：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">addition</span>(<span class=\"params\">x, y</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> X + Y;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>业务发生改变需要console，addition不能修改，因为你不知道add都用在了哪里，你的修改会对现有代码参数什么样的后果。于是有了下面的结果：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">additionAndLog</span>(<span class=\"params\">x, y</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> result = addition(x, y);</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'Result'</span>, result);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>由于你的修改没有对现有代码产生不好的影响，所以减法、乘法、除法都要做console的添加：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">subtractionAndLog</span>(<span class=\"params\">x, y</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> result = subtraction(x, y);</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'Result'</span>, result);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">multiplicationAndLog</span>(<span class=\"params\">x, y</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> result = multiplication(x, y);</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'Result'</span>, result);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">divisionAndLog</span>(<span class=\"params\">x, y</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> result = division(x, y);</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'Result'</span>, result);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>由于你的修改没有对现有代码产生不好的影响，所以n个函数都要做console的添加！！！<br>改变思路：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">logAndReturn</span>(<span class=\"params\">func</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> args = <span class=\"built_in\">Array</span>.prototype.slice.call(<span class=\"built_in\">arguments</span>)</span><br><span class=\"line\">        <span class=\"comment\">// arguments是个类数组 &#123;0:42, 1:52, 2:63, length:3&#125;</span></span><br><span class=\"line\">        <span class=\"comment\">// Array的实例的slice给arguments使用</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> result = func.apply(<span class=\"literal\">null</span>, args);</span><br><span class=\"line\">        <span class=\"comment\">// Function.apply(obj,args)能接受两个参数：</span></span><br><span class=\"line\">        <span class=\"comment\">// obj: 这个对象将代替Function类中的this对象</span></span><br><span class=\"line\">        <span class=\"comment\">// args： 这是个数组，它将作为参数传递给Function类</span></span><br><span class=\"line\">        <span class=\"comment\">// function Person(name,age)&#123;</span></span><br><span class=\"line\">        <span class=\"comment\">//     this.name=name;</span></span><br><span class=\"line\">        <span class=\"comment\">//     this.age=age;</span></span><br><span class=\"line\">        <span class=\"comment\">//     this.sayhello=function()&#123;alert(\"hello\")//&#125;;</span></span><br><span class=\"line\">        <span class=\"comment\">// &#125; </span></span><br><span class=\"line\">        <span class=\"comment\">// function Student(name,age,grade,school)&#123;</span></span><br><span class=\"line\">        <span class=\"comment\">//     Person.apply(this,arguments);</span></span><br><span class=\"line\">        <span class=\"comment\">//     this.grade=grade;</span></span><br><span class=\"line\">        <span class=\"comment\">//     this.school=school;</span></span><br><span class=\"line\">        <span class=\"comment\">// &#125; </span></span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'Result'</span>, result);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> additionAndLog =  logAndReturn(addition);</span><br><span class=\"line\"><span class=\"keyword\">const</span> subtractionAndLog =  logAndReturn(subtraction);</span><br><span class=\"line\"><span class=\"keyword\">const</span> multiplicationAndLog =  logAndReturn(multiplication);</span><br><span class=\"line\"><span class=\"keyword\">const</span> divisionAndLog =  logAndReturn(division);</span><br></pre></td></tr></table></figure>\n<h2 id=\"高阶组件\"><a href=\"#高阶组件\" class=\"headerlink\" title=\"高阶组件\"></a>高阶组件</h2><p>一个路由组件的例子：<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Link</span> <span class=\"attr\">to</span>=<span class=\"string\">\"/\"</span> <span class=\"attr\">activeClassName</span>=<span class=\"string\">\"active-link\"</span>&gt;</span> Home <span class=\"tag\">&lt;/<span class=\"name\">Link</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Link</span> <span class=\"attr\">to</span>=<span class=\"string\">\"/about\"</span> <span class=\"attr\">activeClassName</span>=<span class=\"string\">\"active-link\"</span>&gt;</span> About<span class=\"tag\">&lt;/<span class=\"name\">Link</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Link</span> <span class=\"attr\">to</span>=<span class=\"string\">\"/contact\"</span> <span class=\"attr\">activeClassName</span>=<span class=\"string\">\"active-link\"</span>&gt;</span> Contact<span class=\"tag\">&lt;/<span class=\"name\">Link</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p>初步优化，提取相同的代码：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> AppLink=React.createClass(&#123;</span><br><span class=\"line\">    <span class=\"attr\">render</span>:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>(</span><br><span class=\"line\">            <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">Link</span> <span class=\"attr\">to</span>=<span class=\"string\">&#123;this.props.to&#125;</span> <span class=\"attr\">activeClassName</span>=<span class=\"string\">\"active-link\"</span>&gt;</span></span><br><span class=\"line\">                &#123;this.props.children&#125;</span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">Link</span>&gt;</span></span>;</span><br><span class=\"line\">        );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>改变现在的路由组件：<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">AppLink</span> <span class=\"attr\">to</span>=<span class=\"string\">\"/\"</span>&gt;</span>Home<span class=\"tag\">&lt;/<span class=\"name\">AppLink</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">AppLink</span> <span class=\"attr\">to</span>=<span class=\"string\">\"/about\"</span>&gt;</span>About<span class=\"tag\">&lt;/<span class=\"name\">AppLink</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">AppLink</span> <span class=\"attr\">to</span>=<span class=\"string\">\"/contact\"</span>&gt;</span>Contact<span class=\"tag\">&lt;/<span class=\"name\">AppLink</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p>进一步优化，对props的覆盖控制：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//高阶组件覆盖，强调统一</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> AppLink=React.createClass(&#123;</span><br><span class=\"line\">    <span class=\"attr\">render</span>:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> &#123;children, props&#125; = <span class=\"keyword\">this</span>.props;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>(</span><br><span class=\"line\">            <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">Link</span> &#123;<span class=\"attr\">...props</span>&#125; <span class=\"attr\">activeClassName</span>=<span class=\"string\">\"active-link\"</span>&gt;</span></span><br><span class=\"line\">                &#123;children&#125;</span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">Link</span>&gt;</span></span>;</span><br><span class=\"line\">        );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//调用组件覆盖，强调默认值和定制化</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> AppLink=React.createClass(&#123;</span><br><span class=\"line\">    <span class=\"attr\">render</span>:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> &#123;children, props&#125; = <span class=\"keyword\">this</span>.props;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>(</span><br><span class=\"line\">            <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">Link</span> <span class=\"attr\">activeClassName</span>=<span class=\"string\">\"active-link\"</span> &#123;<span class=\"attr\">...props</span>&#125;&gt;</span></span><br><span class=\"line\">                &#123;children&#125;</span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">Link</span>&gt;</span></span>;</span><br><span class=\"line\">        );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"SAAS项目的应用实例—–权限控制组件\"><a href=\"#SAAS项目的应用实例—–权限控制组件\" class=\"headerlink\" title=\"SAAS项目的应用实例—–权限控制组件\"></a>SAAS项目的应用实例—–<AuthControl>权限控制组件</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AuthControl</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">    render() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> &#123; roles, userRoles, deniedAuth, children &#125; = <span class=\"keyword\">this</span>.props;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (_.intersection(roles, userRoles).length === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (deniedAuth !== <span class=\"literal\">undefined</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> deniedAuth;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> (children);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">AuthControl.propTypes = &#123;</span><br><span class=\"line\">    <span class=\"attr\">roles</span>: React.PropTypes.array.isRequired,</span><br><span class=\"line\">    <span class=\"attr\">userRoles</span>: React.PropTypes.array.isRequired,</span><br><span class=\"line\">    <span class=\"attr\">children</span>: React.PropTypes.element,</span><br><span class=\"line\">    <span class=\"attr\">deniedAuth</span>: React.PropTypes.element,</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">AuthControl</span></span><br><span class=\"line\">    <span class=\"attr\">roles</span>=<span class=\"string\">&#123;[</span>'<span class=\"attr\">admin</span>']&#125; </span><br><span class=\"line\">    <span class=\"attr\">userRoles</span>=<span class=\"string\">&#123;[‘user’]&#125;</span></span><br><span class=\"line\">    <span class=\"attr\">deniedAuth</span>=<span class=\"string\">&#123;</span>&lt;<span class=\"attr\">div</span>&gt;</span>没有权限<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span>&#125;</span><br><span class=\"line\">&gt;</span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>有权限<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">AuthControl</span>&gt;</span></span></span><br></pre></td></tr></table></figure>\n<h2 id=\"结论\"><a href=\"#结论\" class=\"headerlink\" title=\"结论\"></a>结论</h2><p>通过将纯函数和高阶函数的函数式编程的原理应用到React，您可以创建一个更容易维护和使用的代码库。</p>"},{"title":"react model函数单元测试用例与实践体验","date":"2017-12-16T12:42:59.000Z","_content":"构造函数的主要作用就是对输入的对象进行类别的区分。以及暴露出一个修饰过的fetch函数。\n\n源代码：\n\n<!--more-->\n```javascript\nimport { camelCase } from 'utils';\nimport fetch from 'dva/fetch';\n \nexport default class CrmModel {\n    constructor(args) {\n        if (typeof args === 'object' && args !== null) {\n            Object.keys(args).forEach((key) => {\n                this[key] = args[key];\n            });\n        }\n    }\n}\n \nexport const addReactHeader = (options = { headers: new Headers() }) => {\n    if (options.headers instanceof Headers === false) {\n        options.headers = new Headers();\n    }\n    options.headers.append('X-React-Request', 1);\n    return options;\n};\n \nexport const modifyFetch = (fun1, fun2) => {\n    if(typeof fun1 === 'function' && typeof fun2 === 'function'){\n        return function () {\n            const [url, options, ...args] = arguments;\n            return fun1(url, fun2(options));\n        }\n    }\n};\n \nexport const crmFetch = modifyFetch(fetch, addReactHeader);\n```\n\n测试代码\n\n```javascript\nimport CrmModel, { addReactHeader, modifyFetch, crmFetch } from './CrmModel.js';\nimport fetch from 'dva/fetch';\n \ndescribe('CrmModel', () => {\n    describe('constructor', () => {\n        test('constructor no arg', () => {\n            expect(new CrmModel()).toEqual({});\n        });\n \n        test('constructor arg type of object', () => {\n            const cm = new CrmModel({\n                test: '0'\n            });\n            expect(cm).toEqual({ test: '0' });\n            expect(cm).not.toEqual({ test: '1' });\n        });\n    });\n \n    describe('add React Header', () => {\n        test('no arg', () => {\n            expect(addReactHeader()).toEqual({ \"headers\": { \"_headers\": { \"x-react-request\": [1] } } });\n        });\n \n        test('has arg no headers', () => {\n            expect(addReactHeader({ name: 'eric' })).toEqual({\n                \"name\": \"eric\",\n                \"headers\": { \"_headers\": { \"x-react-request\": [1] } }\n            });\n        });\n \n        test('has arg has headers but headers is not instance of Headers', () => {\n            expect(addReactHeader({ name: 'eric', headers: { 'test': 1 } })).toEqual({\n                \"name\": \"eric\",\n                \"headers\": { \"_headers\": { \"x-react-request\": [1] } }\n            });\n        });\n \n        // test('has arg has headers and headers is instance of Headers', () => {\n        //     expect(addReactHeader({ name: 'eric' })).toEqual({//todo 无法获取 Headers\n        //         \"name\": \"eric\",\n        //     });\n        // });\n    });\n \n    describe('modify Fetch', () => {\n        test('no args ', () => {\n            expect(modifyFetch()).toEqual(undefined);\n        });\n \n        test('has args but type not function', () => {\n            expect(modifyFetch('a', 'b')).toEqual(undefined);\n        });\n \n        test('has args but type not function', () => {\n            expect(modifyFetch(function () {\n            }, 'b')).toEqual(undefined);\n        });\n \n        test('has args but type not function', () => {\n            expect(modifyFetch('a', function () {\n            },)).toEqual(undefined);\n        });\n \n        describe('has args and type is function', () => {\n            test('return is function and args has be call', () => {\n                const mockFun0 = jest.fn();\n                const mockFun1 = jest.fn();\n                const fun = modifyFetch(mockFun0, mockFun1);\n \n                mockFun1.mockReturnValue(5);\n                fun('a', 'b');\n \n                expect(typeof fun).toBe('function');\n                expect(mockFun0.mock.calls.length).toBe(1);\n                expect(mockFun0.mock.calls[0][0]).toBe('a');\n                expect(mockFun0.mock.calls[0][1]).toEqual(5);\n                expect(mockFun1.mock.calls.length).toBe(1);\n                expect(mockFun1.mock.calls[0][0]).toBe('b');\n            });\n \n            test('return is function and args has be call', () => {\n                const fun0 = function (x, y) {\n                    return x + y;\n                };\n                const fun1 = function (y) {\n                    return y * y;\n                };\n                const fun = modifyFetch(fun0, fun1);\n                expect(fun(2, 3)).toBe(11);\n            });\n        });\n    });\n \n    test('return promise', () => {\n        expect(crmFetch() instanceof Promise).toBe(true);\n    });\n \n});\n```","source":"_posts/react-model函数单元测试用例与实践体验.md","raw":"---\ntitle: react model函数单元测试用例与实践体验\ndate: 2017-12-16 20:42:59\ntags: ['单元测试','unit test','react','model']\ncategory: 'coding'\n---\n构造函数的主要作用就是对输入的对象进行类别的区分。以及暴露出一个修饰过的fetch函数。\n\n源代码：\n\n<!--more-->\n```javascript\nimport { camelCase } from 'utils';\nimport fetch from 'dva/fetch';\n \nexport default class CrmModel {\n    constructor(args) {\n        if (typeof args === 'object' && args !== null) {\n            Object.keys(args).forEach((key) => {\n                this[key] = args[key];\n            });\n        }\n    }\n}\n \nexport const addReactHeader = (options = { headers: new Headers() }) => {\n    if (options.headers instanceof Headers === false) {\n        options.headers = new Headers();\n    }\n    options.headers.append('X-React-Request', 1);\n    return options;\n};\n \nexport const modifyFetch = (fun1, fun2) => {\n    if(typeof fun1 === 'function' && typeof fun2 === 'function'){\n        return function () {\n            const [url, options, ...args] = arguments;\n            return fun1(url, fun2(options));\n        }\n    }\n};\n \nexport const crmFetch = modifyFetch(fetch, addReactHeader);\n```\n\n测试代码\n\n```javascript\nimport CrmModel, { addReactHeader, modifyFetch, crmFetch } from './CrmModel.js';\nimport fetch from 'dva/fetch';\n \ndescribe('CrmModel', () => {\n    describe('constructor', () => {\n        test('constructor no arg', () => {\n            expect(new CrmModel()).toEqual({});\n        });\n \n        test('constructor arg type of object', () => {\n            const cm = new CrmModel({\n                test: '0'\n            });\n            expect(cm).toEqual({ test: '0' });\n            expect(cm).not.toEqual({ test: '1' });\n        });\n    });\n \n    describe('add React Header', () => {\n        test('no arg', () => {\n            expect(addReactHeader()).toEqual({ \"headers\": { \"_headers\": { \"x-react-request\": [1] } } });\n        });\n \n        test('has arg no headers', () => {\n            expect(addReactHeader({ name: 'eric' })).toEqual({\n                \"name\": \"eric\",\n                \"headers\": { \"_headers\": { \"x-react-request\": [1] } }\n            });\n        });\n \n        test('has arg has headers but headers is not instance of Headers', () => {\n            expect(addReactHeader({ name: 'eric', headers: { 'test': 1 } })).toEqual({\n                \"name\": \"eric\",\n                \"headers\": { \"_headers\": { \"x-react-request\": [1] } }\n            });\n        });\n \n        // test('has arg has headers and headers is instance of Headers', () => {\n        //     expect(addReactHeader({ name: 'eric' })).toEqual({//todo 无法获取 Headers\n        //         \"name\": \"eric\",\n        //     });\n        // });\n    });\n \n    describe('modify Fetch', () => {\n        test('no args ', () => {\n            expect(modifyFetch()).toEqual(undefined);\n        });\n \n        test('has args but type not function', () => {\n            expect(modifyFetch('a', 'b')).toEqual(undefined);\n        });\n \n        test('has args but type not function', () => {\n            expect(modifyFetch(function () {\n            }, 'b')).toEqual(undefined);\n        });\n \n        test('has args but type not function', () => {\n            expect(modifyFetch('a', function () {\n            },)).toEqual(undefined);\n        });\n \n        describe('has args and type is function', () => {\n            test('return is function and args has be call', () => {\n                const mockFun0 = jest.fn();\n                const mockFun1 = jest.fn();\n                const fun = modifyFetch(mockFun0, mockFun1);\n \n                mockFun1.mockReturnValue(5);\n                fun('a', 'b');\n \n                expect(typeof fun).toBe('function');\n                expect(mockFun0.mock.calls.length).toBe(1);\n                expect(mockFun0.mock.calls[0][0]).toBe('a');\n                expect(mockFun0.mock.calls[0][1]).toEqual(5);\n                expect(mockFun1.mock.calls.length).toBe(1);\n                expect(mockFun1.mock.calls[0][0]).toBe('b');\n            });\n \n            test('return is function and args has be call', () => {\n                const fun0 = function (x, y) {\n                    return x + y;\n                };\n                const fun1 = function (y) {\n                    return y * y;\n                };\n                const fun = modifyFetch(fun0, fun1);\n                expect(fun(2, 3)).toBe(11);\n            });\n        });\n    });\n \n    test('return promise', () => {\n        expect(crmFetch() instanceof Promise).toBe(true);\n    });\n \n});\n```","slug":"react-model函数单元测试用例与实践体验","published":1,"updated":"2019-02-20T02:50:38.488Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjsgue0fc001pgpi64vu9myzf","content":"<p>构造函数的主要作用就是对输入的对象进行类别的区分。以及暴露出一个修饰过的fetch函数。</p>\n<p>源代码：</p>\n<a id=\"more\"></a>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; camelCase &#125; <span class=\"keyword\">from</span> <span class=\"string\">'utils'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> fetch <span class=\"keyword\">from</span> <span class=\"string\">'dva/fetch'</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CrmModel</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">constructor</span>(args) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> args === <span class=\"string\">'object'</span> &amp;&amp; args !== <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">Object</span>.keys(args).forEach(<span class=\"function\">(<span class=\"params\">key</span>) =&gt;</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">this</span>[key] = args[key];</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> addReactHeader = <span class=\"function\">(<span class=\"params\">options = &#123; headers: <span class=\"keyword\">new</span> Headers(</span>) &#125;) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (options.headers <span class=\"keyword\">instanceof</span> Headers === <span class=\"literal\">false</span>) &#123;</span><br><span class=\"line\">        options.headers = <span class=\"keyword\">new</span> Headers();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    options.headers.append(<span class=\"string\">'X-React-Request'</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> options;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> modifyFetch = <span class=\"function\">(<span class=\"params\">fun1, fun2</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"keyword\">typeof</span> fun1 === <span class=\"string\">'function'</span> &amp;&amp; <span class=\"keyword\">typeof</span> fun2 === <span class=\"string\">'function'</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> [url, options, ...args] = <span class=\"built_in\">arguments</span>;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> fun1(url, fun2(options));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> crmFetch = modifyFetch(fetch, addReactHeader);</span><br></pre></td></tr></table></figure>\n<p>测试代码</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> CrmModel, &#123; addReactHeader, modifyFetch, crmFetch &#125; <span class=\"keyword\">from</span> <span class=\"string\">'./CrmModel.js'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> fetch <span class=\"keyword\">from</span> <span class=\"string\">'dva/fetch'</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\">describe(<span class=\"string\">'CrmModel'</span>, () =&gt; &#123;</span><br><span class=\"line\">    describe(<span class=\"string\">'constructor'</span>, () =&gt; &#123;</span><br><span class=\"line\">        test(<span class=\"string\">'constructor no arg'</span>, () =&gt; &#123;</span><br><span class=\"line\">            expect(<span class=\"keyword\">new</span> CrmModel()).toEqual(&#123;&#125;);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"> </span><br><span class=\"line\">        test(<span class=\"string\">'constructor arg type of object'</span>, () =&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> cm = <span class=\"keyword\">new</span> CrmModel(&#123;</span><br><span class=\"line\">                <span class=\"attr\">test</span>: <span class=\"string\">'0'</span></span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            expect(cm).toEqual(&#123; <span class=\"attr\">test</span>: <span class=\"string\">'0'</span> &#125;);</span><br><span class=\"line\">            expect(cm).not.toEqual(&#123; <span class=\"attr\">test</span>: <span class=\"string\">'1'</span> &#125;);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"> </span><br><span class=\"line\">    describe(<span class=\"string\">'add React Header'</span>, () =&gt; &#123;</span><br><span class=\"line\">        test(<span class=\"string\">'no arg'</span>, () =&gt; &#123;</span><br><span class=\"line\">            expect(addReactHeader()).toEqual(&#123; <span class=\"string\">\"headers\"</span>: &#123; <span class=\"string\">\"_headers\"</span>: &#123; <span class=\"string\">\"x-react-request\"</span>: [<span class=\"number\">1</span>] &#125; &#125; &#125;);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"> </span><br><span class=\"line\">        test(<span class=\"string\">'has arg no headers'</span>, () =&gt; &#123;</span><br><span class=\"line\">            expect(addReactHeader(&#123; <span class=\"attr\">name</span>: <span class=\"string\">'eric'</span> &#125;)).toEqual(&#123;</span><br><span class=\"line\">                <span class=\"string\">\"name\"</span>: <span class=\"string\">\"eric\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"headers\"</span>: &#123; <span class=\"string\">\"_headers\"</span>: &#123; <span class=\"string\">\"x-react-request\"</span>: [<span class=\"number\">1</span>] &#125; &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"> </span><br><span class=\"line\">        test(<span class=\"string\">'has arg has headers but headers is not instance of Headers'</span>, () =&gt; &#123;</span><br><span class=\"line\">            expect(addReactHeader(&#123; <span class=\"attr\">name</span>: <span class=\"string\">'eric'</span>, <span class=\"attr\">headers</span>: &#123; <span class=\"string\">'test'</span>: <span class=\"number\">1</span> &#125; &#125;)).toEqual(&#123;</span><br><span class=\"line\">                <span class=\"string\">\"name\"</span>: <span class=\"string\">\"eric\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"headers\"</span>: &#123; <span class=\"string\">\"_headers\"</span>: &#123; <span class=\"string\">\"x-react-request\"</span>: [<span class=\"number\">1</span>] &#125; &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"> </span><br><span class=\"line\">        <span class=\"comment\">// test('has arg has headers and headers is instance of Headers', () =&gt; &#123;</span></span><br><span class=\"line\">        <span class=\"comment\">//     expect(addReactHeader(&#123; name: 'eric' &#125;)).toEqual(&#123;//todo 无法获取 Headers</span></span><br><span class=\"line\">        <span class=\"comment\">//         \"name\": \"eric\",</span></span><br><span class=\"line\">        <span class=\"comment\">//     &#125;);</span></span><br><span class=\"line\">        <span class=\"comment\">// &#125;);</span></span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"> </span><br><span class=\"line\">    describe(<span class=\"string\">'modify Fetch'</span>, () =&gt; &#123;</span><br><span class=\"line\">        test(<span class=\"string\">'no args '</span>, () =&gt; &#123;</span><br><span class=\"line\">            expect(modifyFetch()).toEqual(<span class=\"literal\">undefined</span>);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"> </span><br><span class=\"line\">        test(<span class=\"string\">'has args but type not function'</span>, () =&gt; &#123;</span><br><span class=\"line\">            expect(modifyFetch(<span class=\"string\">'a'</span>, <span class=\"string\">'b'</span>)).toEqual(<span class=\"literal\">undefined</span>);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"> </span><br><span class=\"line\">        test(<span class=\"string\">'has args but type not function'</span>, () =&gt; &#123;</span><br><span class=\"line\">            expect(modifyFetch(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            &#125;, <span class=\"string\">'b'</span>)).toEqual(<span class=\"literal\">undefined</span>);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"> </span><br><span class=\"line\">        test(<span class=\"string\">'has args but type not function'</span>, () =&gt; &#123;</span><br><span class=\"line\">            expect(modifyFetch(<span class=\"string\">'a'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            &#125;,)).toEqual(<span class=\"literal\">undefined</span>);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"> </span><br><span class=\"line\">        describe(<span class=\"string\">'has args and type is function'</span>, () =&gt; &#123;</span><br><span class=\"line\">            test(<span class=\"string\">'return is function and args has be call'</span>, () =&gt; &#123;</span><br><span class=\"line\">                <span class=\"keyword\">const</span> mockFun0 = jest.fn();</span><br><span class=\"line\">                <span class=\"keyword\">const</span> mockFun1 = jest.fn();</span><br><span class=\"line\">                <span class=\"keyword\">const</span> fun = modifyFetch(mockFun0, mockFun1);</span><br><span class=\"line\"> </span><br><span class=\"line\">                mockFun1.mockReturnValue(<span class=\"number\">5</span>);</span><br><span class=\"line\">                fun(<span class=\"string\">'a'</span>, <span class=\"string\">'b'</span>);</span><br><span class=\"line\"> </span><br><span class=\"line\">                expect(<span class=\"keyword\">typeof</span> fun).toBe(<span class=\"string\">'function'</span>);</span><br><span class=\"line\">                expect(mockFun0.mock.calls.length).toBe(<span class=\"number\">1</span>);</span><br><span class=\"line\">                expect(mockFun0.mock.calls[<span class=\"number\">0</span>][<span class=\"number\">0</span>]).toBe(<span class=\"string\">'a'</span>);</span><br><span class=\"line\">                expect(mockFun0.mock.calls[<span class=\"number\">0</span>][<span class=\"number\">1</span>]).toEqual(<span class=\"number\">5</span>);</span><br><span class=\"line\">                expect(mockFun1.mock.calls.length).toBe(<span class=\"number\">1</span>);</span><br><span class=\"line\">                expect(mockFun1.mock.calls[<span class=\"number\">0</span>][<span class=\"number\">0</span>]).toBe(<span class=\"string\">'b'</span>);</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\"> </span><br><span class=\"line\">            test(<span class=\"string\">'return is function and args has be call'</span>, () =&gt; &#123;</span><br><span class=\"line\">                <span class=\"keyword\">const</span> fun0 = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">x, y</span>) </span>&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> x + y;</span><br><span class=\"line\">                &#125;;</span><br><span class=\"line\">                <span class=\"keyword\">const</span> fun1 = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">y</span>) </span>&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> y * y;</span><br><span class=\"line\">                &#125;;</span><br><span class=\"line\">                <span class=\"keyword\">const</span> fun = modifyFetch(fun0, fun1);</span><br><span class=\"line\">                expect(fun(<span class=\"number\">2</span>, <span class=\"number\">3</span>)).toBe(<span class=\"number\">11</span>);</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"> </span><br><span class=\"line\">    test(<span class=\"string\">'return promise'</span>, () =&gt; &#123;</span><br><span class=\"line\">        expect(crmFetch() <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Promise</span>).toBe(<span class=\"literal\">true</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"> </span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>","excerpt":"<p>构造函数的主要作用就是对输入的对象进行类别的区分。以及暴露出一个修饰过的fetch函数。</p>\n<p>源代码：</p>","more":"<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; camelCase &#125; <span class=\"keyword\">from</span> <span class=\"string\">'utils'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> fetch <span class=\"keyword\">from</span> <span class=\"string\">'dva/fetch'</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CrmModel</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">constructor</span>(args) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> args === <span class=\"string\">'object'</span> &amp;&amp; args !== <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">Object</span>.keys(args).forEach(<span class=\"function\">(<span class=\"params\">key</span>) =&gt;</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">this</span>[key] = args[key];</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> addReactHeader = <span class=\"function\">(<span class=\"params\">options = &#123; headers: <span class=\"keyword\">new</span> Headers(</span>) &#125;) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (options.headers <span class=\"keyword\">instanceof</span> Headers === <span class=\"literal\">false</span>) &#123;</span><br><span class=\"line\">        options.headers = <span class=\"keyword\">new</span> Headers();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    options.headers.append(<span class=\"string\">'X-React-Request'</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> options;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> modifyFetch = <span class=\"function\">(<span class=\"params\">fun1, fun2</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"keyword\">typeof</span> fun1 === <span class=\"string\">'function'</span> &amp;&amp; <span class=\"keyword\">typeof</span> fun2 === <span class=\"string\">'function'</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> [url, options, ...args] = <span class=\"built_in\">arguments</span>;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> fun1(url, fun2(options));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> crmFetch = modifyFetch(fetch, addReactHeader);</span><br></pre></td></tr></table></figure>\n<p>测试代码</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> CrmModel, &#123; addReactHeader, modifyFetch, crmFetch &#125; <span class=\"keyword\">from</span> <span class=\"string\">'./CrmModel.js'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> fetch <span class=\"keyword\">from</span> <span class=\"string\">'dva/fetch'</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\">describe(<span class=\"string\">'CrmModel'</span>, () =&gt; &#123;</span><br><span class=\"line\">    describe(<span class=\"string\">'constructor'</span>, () =&gt; &#123;</span><br><span class=\"line\">        test(<span class=\"string\">'constructor no arg'</span>, () =&gt; &#123;</span><br><span class=\"line\">            expect(<span class=\"keyword\">new</span> CrmModel()).toEqual(&#123;&#125;);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"> </span><br><span class=\"line\">        test(<span class=\"string\">'constructor arg type of object'</span>, () =&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> cm = <span class=\"keyword\">new</span> CrmModel(&#123;</span><br><span class=\"line\">                <span class=\"attr\">test</span>: <span class=\"string\">'0'</span></span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            expect(cm).toEqual(&#123; <span class=\"attr\">test</span>: <span class=\"string\">'0'</span> &#125;);</span><br><span class=\"line\">            expect(cm).not.toEqual(&#123; <span class=\"attr\">test</span>: <span class=\"string\">'1'</span> &#125;);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"> </span><br><span class=\"line\">    describe(<span class=\"string\">'add React Header'</span>, () =&gt; &#123;</span><br><span class=\"line\">        test(<span class=\"string\">'no arg'</span>, () =&gt; &#123;</span><br><span class=\"line\">            expect(addReactHeader()).toEqual(&#123; <span class=\"string\">\"headers\"</span>: &#123; <span class=\"string\">\"_headers\"</span>: &#123; <span class=\"string\">\"x-react-request\"</span>: [<span class=\"number\">1</span>] &#125; &#125; &#125;);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"> </span><br><span class=\"line\">        test(<span class=\"string\">'has arg no headers'</span>, () =&gt; &#123;</span><br><span class=\"line\">            expect(addReactHeader(&#123; <span class=\"attr\">name</span>: <span class=\"string\">'eric'</span> &#125;)).toEqual(&#123;</span><br><span class=\"line\">                <span class=\"string\">\"name\"</span>: <span class=\"string\">\"eric\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"headers\"</span>: &#123; <span class=\"string\">\"_headers\"</span>: &#123; <span class=\"string\">\"x-react-request\"</span>: [<span class=\"number\">1</span>] &#125; &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"> </span><br><span class=\"line\">        test(<span class=\"string\">'has arg has headers but headers is not instance of Headers'</span>, () =&gt; &#123;</span><br><span class=\"line\">            expect(addReactHeader(&#123; <span class=\"attr\">name</span>: <span class=\"string\">'eric'</span>, <span class=\"attr\">headers</span>: &#123; <span class=\"string\">'test'</span>: <span class=\"number\">1</span> &#125; &#125;)).toEqual(&#123;</span><br><span class=\"line\">                <span class=\"string\">\"name\"</span>: <span class=\"string\">\"eric\"</span>,</span><br><span class=\"line\">                <span class=\"string\">\"headers\"</span>: &#123; <span class=\"string\">\"_headers\"</span>: &#123; <span class=\"string\">\"x-react-request\"</span>: [<span class=\"number\">1</span>] &#125; &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"> </span><br><span class=\"line\">        <span class=\"comment\">// test('has arg has headers and headers is instance of Headers', () =&gt; &#123;</span></span><br><span class=\"line\">        <span class=\"comment\">//     expect(addReactHeader(&#123; name: 'eric' &#125;)).toEqual(&#123;//todo 无法获取 Headers</span></span><br><span class=\"line\">        <span class=\"comment\">//         \"name\": \"eric\",</span></span><br><span class=\"line\">        <span class=\"comment\">//     &#125;);</span></span><br><span class=\"line\">        <span class=\"comment\">// &#125;);</span></span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"> </span><br><span class=\"line\">    describe(<span class=\"string\">'modify Fetch'</span>, () =&gt; &#123;</span><br><span class=\"line\">        test(<span class=\"string\">'no args '</span>, () =&gt; &#123;</span><br><span class=\"line\">            expect(modifyFetch()).toEqual(<span class=\"literal\">undefined</span>);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"> </span><br><span class=\"line\">        test(<span class=\"string\">'has args but type not function'</span>, () =&gt; &#123;</span><br><span class=\"line\">            expect(modifyFetch(<span class=\"string\">'a'</span>, <span class=\"string\">'b'</span>)).toEqual(<span class=\"literal\">undefined</span>);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"> </span><br><span class=\"line\">        test(<span class=\"string\">'has args but type not function'</span>, () =&gt; &#123;</span><br><span class=\"line\">            expect(modifyFetch(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            &#125;, <span class=\"string\">'b'</span>)).toEqual(<span class=\"literal\">undefined</span>);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"> </span><br><span class=\"line\">        test(<span class=\"string\">'has args but type not function'</span>, () =&gt; &#123;</span><br><span class=\"line\">            expect(modifyFetch(<span class=\"string\">'a'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            &#125;,)).toEqual(<span class=\"literal\">undefined</span>);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"> </span><br><span class=\"line\">        describe(<span class=\"string\">'has args and type is function'</span>, () =&gt; &#123;</span><br><span class=\"line\">            test(<span class=\"string\">'return is function and args has be call'</span>, () =&gt; &#123;</span><br><span class=\"line\">                <span class=\"keyword\">const</span> mockFun0 = jest.fn();</span><br><span class=\"line\">                <span class=\"keyword\">const</span> mockFun1 = jest.fn();</span><br><span class=\"line\">                <span class=\"keyword\">const</span> fun = modifyFetch(mockFun0, mockFun1);</span><br><span class=\"line\"> </span><br><span class=\"line\">                mockFun1.mockReturnValue(<span class=\"number\">5</span>);</span><br><span class=\"line\">                fun(<span class=\"string\">'a'</span>, <span class=\"string\">'b'</span>);</span><br><span class=\"line\"> </span><br><span class=\"line\">                expect(<span class=\"keyword\">typeof</span> fun).toBe(<span class=\"string\">'function'</span>);</span><br><span class=\"line\">                expect(mockFun0.mock.calls.length).toBe(<span class=\"number\">1</span>);</span><br><span class=\"line\">                expect(mockFun0.mock.calls[<span class=\"number\">0</span>][<span class=\"number\">0</span>]).toBe(<span class=\"string\">'a'</span>);</span><br><span class=\"line\">                expect(mockFun0.mock.calls[<span class=\"number\">0</span>][<span class=\"number\">1</span>]).toEqual(<span class=\"number\">5</span>);</span><br><span class=\"line\">                expect(mockFun1.mock.calls.length).toBe(<span class=\"number\">1</span>);</span><br><span class=\"line\">                expect(mockFun1.mock.calls[<span class=\"number\">0</span>][<span class=\"number\">0</span>]).toBe(<span class=\"string\">'b'</span>);</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\"> </span><br><span class=\"line\">            test(<span class=\"string\">'return is function and args has be call'</span>, () =&gt; &#123;</span><br><span class=\"line\">                <span class=\"keyword\">const</span> fun0 = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">x, y</span>) </span>&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> x + y;</span><br><span class=\"line\">                &#125;;</span><br><span class=\"line\">                <span class=\"keyword\">const</span> fun1 = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">y</span>) </span>&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> y * y;</span><br><span class=\"line\">                &#125;;</span><br><span class=\"line\">                <span class=\"keyword\">const</span> fun = modifyFetch(fun0, fun1);</span><br><span class=\"line\">                expect(fun(<span class=\"number\">2</span>, <span class=\"number\">3</span>)).toBe(<span class=\"number\">11</span>);</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"> </span><br><span class=\"line\">    test(<span class=\"string\">'return promise'</span>, () =&gt; &#123;</span><br><span class=\"line\">        expect(crmFetch() <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Promise</span>).toBe(<span class=\"literal\">true</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"> </span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>"},{"title":"优化代码的小技巧（三）","date":"2019-02-28T09:04:16.000Z","_content":"\n写了那么多的代码，怎么才能确保代码的可控性是个比较头痛的问题。下面就介绍一些小技巧。\n<!--more-->\n\n>函数不要直接外围变量\n\n```JAVASCRIPT\nvar xs = [1,2,3,4,5];\n\n// 没有修改xs\nxs.slice(0,3);\n//=> [1,2,3]\n\nxs.slice(0,3);\n//=> [1,2,3]\n\nxs.slice(0,3);\n//=> [1,2,3]\n\n\n// 修改了xs\nxs.splice(0,3);\n//=> [1,2,3]\n\nxs.splice(0,3);\n//=> [4,5]\n\nxs.splice(0,3);\n\n```\n>同样是返回截取的数组，splice 把原来的变量赋值为截取后的数组，所以实际上 splice 每次操作的数值都在改变。但是这些很难发现。来看看另一个例子。\n\n```JAVASCRIPT\n// 使用了函数外面的变量\nvar minimum = 21;\n\nvar checkAge = function(age) {\n  return age >= minimum;\n};\n```\n\n>这样的函数很头疼，因为你不知道在使用 `checkAge` 的时候 `minimum` 还是不是原来的值。所以最好还是把 `minimum` 放在函数内部。由函数自己来管理。\n\n```JAVASCRIPT\nvar checkAge = function(age) {\n  var minimum = 21;\n  return age >= minimum;\n};\n```\n\n>其实上面所做的目的只有一个就是把函数变成 `纯函数`，那么什么样的函数可以称为纯函数呢？纯函数是这样一种函数，即相同的输入，永远会得到相同的输出，而且没有任何可观察的副作用。现在你也许又要问了什么是副作用呢？","source":"_posts/优化代码的小技巧（三）.md","raw":"---\ntitle: 优化代码的小技巧（三）\ndate: 2019-02-28 17:04:16\ntags: ['函数式编程','Functional programming','优化代码']\ncategory: 'coding'\n---\n\n写了那么多的代码，怎么才能确保代码的可控性是个比较头痛的问题。下面就介绍一些小技巧。\n<!--more-->\n\n>函数不要直接外围变量\n\n```JAVASCRIPT\nvar xs = [1,2,3,4,5];\n\n// 没有修改xs\nxs.slice(0,3);\n//=> [1,2,3]\n\nxs.slice(0,3);\n//=> [1,2,3]\n\nxs.slice(0,3);\n//=> [1,2,3]\n\n\n// 修改了xs\nxs.splice(0,3);\n//=> [1,2,3]\n\nxs.splice(0,3);\n//=> [4,5]\n\nxs.splice(0,3);\n\n```\n>同样是返回截取的数组，splice 把原来的变量赋值为截取后的数组，所以实际上 splice 每次操作的数值都在改变。但是这些很难发现。来看看另一个例子。\n\n```JAVASCRIPT\n// 使用了函数外面的变量\nvar minimum = 21;\n\nvar checkAge = function(age) {\n  return age >= minimum;\n};\n```\n\n>这样的函数很头疼，因为你不知道在使用 `checkAge` 的时候 `minimum` 还是不是原来的值。所以最好还是把 `minimum` 放在函数内部。由函数自己来管理。\n\n```JAVASCRIPT\nvar checkAge = function(age) {\n  var minimum = 21;\n  return age >= minimum;\n};\n```\n\n>其实上面所做的目的只有一个就是把函数变成 `纯函数`，那么什么样的函数可以称为纯函数呢？纯函数是这样一种函数，即相同的输入，永远会得到相同的输出，而且没有任何可观察的副作用。现在你也许又要问了什么是副作用呢？","slug":"优化代码的小技巧（三）","published":1,"updated":"2019-02-28T09:26:58.954Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjytjg80v0000g6i62u5fqrgo","content":"<p>写了那么多的代码，怎么才能确保代码的可控性是个比较头痛的问题。下面就介绍一些小技巧。</p>\n<a id=\"more\"></a>\n\n<blockquote>\n<p>函数不要直接外围变量</p>\n</blockquote>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> xs = [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 没有修改xs</span></span><br><span class=\"line\">xs.slice(<span class=\"number\">0</span>,<span class=\"number\">3</span>);</span><br><span class=\"line\"><span class=\"comment\">//=&gt; [1,2,3]</span></span><br><span class=\"line\"></span><br><span class=\"line\">xs.slice(<span class=\"number\">0</span>,<span class=\"number\">3</span>);</span><br><span class=\"line\"><span class=\"comment\">//=&gt; [1,2,3]</span></span><br><span class=\"line\"></span><br><span class=\"line\">xs.slice(<span class=\"number\">0</span>,<span class=\"number\">3</span>);</span><br><span class=\"line\"><span class=\"comment\">//=&gt; [1,2,3]</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 修改了xs</span></span><br><span class=\"line\">xs.splice(<span class=\"number\">0</span>,<span class=\"number\">3</span>);</span><br><span class=\"line\"><span class=\"comment\">//=&gt; [1,2,3]</span></span><br><span class=\"line\"></span><br><span class=\"line\">xs.splice(<span class=\"number\">0</span>,<span class=\"number\">3</span>);</span><br><span class=\"line\"><span class=\"comment\">//=&gt; [4,5]</span></span><br><span class=\"line\"></span><br><span class=\"line\">xs.splice(<span class=\"number\">0</span>,<span class=\"number\">3</span>);</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>同样是返回截取的数组，splice 把原来的变量赋值为截取后的数组，所以实际上 splice 每次操作的数值都在改变。但是这些很难发现。来看看另一个例子。</p>\n</blockquote>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 使用了函数外面的变量</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> minimum = <span class=\"number\">21</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> checkAge = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">age</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> age &gt;= minimum;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>这样的函数很头疼，因为你不知道在使用 <code>checkAge</code> 的时候 <code>minimum</code> 还是不是原来的值。所以最好还是把 <code>minimum</code> 放在函数内部。由函数自己来管理。</p>\n</blockquote>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> checkAge = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">age</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> minimum = <span class=\"number\">21</span>;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> age &gt;= minimum;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>其实上面所做的目的只有一个就是把函数变成 <code>纯函数</code>，那么什么样的函数可以称为纯函数呢？纯函数是这样一种函数，即相同的输入，永远会得到相同的输出，而且没有任何可观察的副作用。现在你也许又要问了什么是副作用呢？</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"<p>写了那么多的代码，怎么才能确保代码的可控性是个比较头痛的问题。下面就介绍一些小技巧。</p>","more":"<blockquote>\n<p>函数不要直接外围变量</p>\n</blockquote>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> xs = [<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 没有修改xs</span></span><br><span class=\"line\">xs.slice(<span class=\"number\">0</span>,<span class=\"number\">3</span>);</span><br><span class=\"line\"><span class=\"comment\">//=&gt; [1,2,3]</span></span><br><span class=\"line\"></span><br><span class=\"line\">xs.slice(<span class=\"number\">0</span>,<span class=\"number\">3</span>);</span><br><span class=\"line\"><span class=\"comment\">//=&gt; [1,2,3]</span></span><br><span class=\"line\"></span><br><span class=\"line\">xs.slice(<span class=\"number\">0</span>,<span class=\"number\">3</span>);</span><br><span class=\"line\"><span class=\"comment\">//=&gt; [1,2,3]</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 修改了xs</span></span><br><span class=\"line\">xs.splice(<span class=\"number\">0</span>,<span class=\"number\">3</span>);</span><br><span class=\"line\"><span class=\"comment\">//=&gt; [1,2,3]</span></span><br><span class=\"line\"></span><br><span class=\"line\">xs.splice(<span class=\"number\">0</span>,<span class=\"number\">3</span>);</span><br><span class=\"line\"><span class=\"comment\">//=&gt; [4,5]</span></span><br><span class=\"line\"></span><br><span class=\"line\">xs.splice(<span class=\"number\">0</span>,<span class=\"number\">3</span>);</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>同样是返回截取的数组，splice 把原来的变量赋值为截取后的数组，所以实际上 splice 每次操作的数值都在改变。但是这些很难发现。来看看另一个例子。</p>\n</blockquote>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 使用了函数外面的变量</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> minimum = <span class=\"number\">21</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> checkAge = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">age</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> age &gt;= minimum;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>这样的函数很头疼，因为你不知道在使用 <code>checkAge</code> 的时候 <code>minimum</code> 还是不是原来的值。所以最好还是把 <code>minimum</code> 放在函数内部。由函数自己来管理。</p>\n</blockquote>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> checkAge = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">age</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> minimum = <span class=\"number\">21</span>;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> age &gt;= minimum;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>其实上面所做的目的只有一个就是把函数变成 <code>纯函数</code>，那么什么样的函数可以称为纯函数呢？纯函数是这样一种函数，即相同的输入，永远会得到相同的输出，而且没有任何可观察的副作用。现在你也许又要问了什么是副作用呢？</p>\n</blockquote>"},{"title":"taro with DVA ----tarojs 配合 dva.js的实践","date":"2019-08-02T03:22:32.000Z","_content":"\n![taro with DVA ](/0/taro_dva.jpg)\n\n## 为什么使用 tarojs\nTaro 是一套遵循 React 语法规范的 多端开发 解决方案。现如今市面上端的形态多种多样，Web、React-Native、微信小程序等各种端大行其道，当业务要求同时在不同的端都要求有所表现的时候，针对不同的端去编写多套代码的成本显然非常高，这时候只编写一套代码就能够适配到多端的能力就显得极为需要。\n使用 Taro，我们可以只书写一套代码，再通过 Taro 的编译工具，将源代码分别编译出可以在不同端（微信/百度/支付宝/字节跳动/QQ小程序、快应用、H5、React-Native 等）运行的代码。\n\n## 为什么使用 davjs\n因为 Taro 是类 React 框架，所以　React　有的问题　Taro　也同样存在。所以 davjs 的介入就变的十分重要。（具体dvajs做了什么可以看文章 [dva脚手架的demo](https://zjafei.coding.me/2017/12/26/dva%E8%84%9A%E6%89%8B%E6%9E%B6%E7%9A%84demo/)）\n\n## 实践demo的目的\n\n* 规范项目目录结构\n* 总结一些常用的工具和服务\n* 提供常规业务的最佳实践\n\n<!--more-->\n\n## 相关框架内容请去官网\n\n* [taro](https://github.com/NervJS/taro)\n* [dvajs](https://github.com/dvajs/dva)\n\n## 使用 npm 或者 yarn 全局安装\n\n```\nnpm install -g @tarojs/cli\n// 或\nyarn global add @tarojs/cli\n```\n\n### clone 项目\n```bash\ngit clone git@github.com:zjafei/taro-dva-demo.git\n```\n\n## 然后使用npm 或者yarn 安装依赖\n\n```\nnpm install\n// 或\nyarn\n```\n\n## 启动小程序开发环境\n\n```\nnpm run dev:weapp\n// 或\nyarn run dev:weapp\n```\n*微信开发者工具导入项目根目录进行预览*\n\n## 编译产出小程序\n\n```\nnpm run build:weapp\n// 或\nyarn run build:weapp\n```\n\n## 创建页面\n\n```\nnpm run page 'pageDemo'\n// 或\nyarn run page 'pageDemo'\n```\n\n### assets目录下的静态资源的上传\n```\n./deploy scp \n```\n\n## 项目结构\n```bash\n/\n├── config\n│   ├── dev.js                      // 开发环境的配置\n│   ├── index.js                    // 配置\n│   └── pro.js                      // 生产环境的配置             \n├── src\n│   ├── assets                      // 静态资源\n│   ├── components                  // 公用组件\n│   ├── models                      // 模型\n│   │   ├── globalModel.js          // 全局模型\n│   │   └── index.js                // 所有模型\n│   ├── pages\n│   │   └── PageDemo\n│   │       ├── index.jsx           // 业务页面\n│   │       ├── index.scss          // 页面样式\n│   │       └── model.js            // 页面模型\n│   ├── server\n│   │   ├── api.js                  // api\n│   │   ├── hostMap.js              // baseUrl的配置\n│   │   └── mock.js                 // mock 数据\n│   ├── utils                       // 工具方法\n│   ├── app.global.scss             // 全局公共样式 样式名称不会被 CSS Modules\n│   ├── app.js                      // 程序入口\n│   ├── base.scss                   // 样式变量\n│   └── index.html                  // spa页面的模板\n├── .editorconfig                   \n├── .eslintignore                   \n├── .eslintrc                       \n├── .gitignore                      \n├── .prettierignore                 \n├── .prettierrc                     \n├── .stylelintrc.json               \n├── componentsTemplate.js           \n├── deploy                          // 脚本文件\n├── package.json                    \n├── pageTemplate.js                 // 页面模板脚本\n├── project.config.json             \n├── README.md                       \n├── tsconfig.json                   \n└── tslint.json                     \n```\n\n## 结语\n\n> 欢迎小伙伴们使用。有需求建议和问题尽管提交issue，我尽力修正。当然直接pull request那是更好。","source":"_posts/taro-with-DVA-tarojs-配合-dva-js的实践.md","raw":"---\ntitle: taro with DVA ----tarojs 配合 dva.js的实践\ndate: 2019-08-02 11:22:32\ntags: ['taro.js','js','javascript','react','小程序','dvajs','最佳实践']\ncategory: 'coding'\n---\n\n![taro with DVA ](/0/taro_dva.jpg)\n\n## 为什么使用 tarojs\nTaro 是一套遵循 React 语法规范的 多端开发 解决方案。现如今市面上端的形态多种多样，Web、React-Native、微信小程序等各种端大行其道，当业务要求同时在不同的端都要求有所表现的时候，针对不同的端去编写多套代码的成本显然非常高，这时候只编写一套代码就能够适配到多端的能力就显得极为需要。\n使用 Taro，我们可以只书写一套代码，再通过 Taro 的编译工具，将源代码分别编译出可以在不同端（微信/百度/支付宝/字节跳动/QQ小程序、快应用、H5、React-Native 等）运行的代码。\n\n## 为什么使用 davjs\n因为 Taro 是类 React 框架，所以　React　有的问题　Taro　也同样存在。所以 davjs 的介入就变的十分重要。（具体dvajs做了什么可以看文章 [dva脚手架的demo](https://zjafei.coding.me/2017/12/26/dva%E8%84%9A%E6%89%8B%E6%9E%B6%E7%9A%84demo/)）\n\n## 实践demo的目的\n\n* 规范项目目录结构\n* 总结一些常用的工具和服务\n* 提供常规业务的最佳实践\n\n<!--more-->\n\n## 相关框架内容请去官网\n\n* [taro](https://github.com/NervJS/taro)\n* [dvajs](https://github.com/dvajs/dva)\n\n## 使用 npm 或者 yarn 全局安装\n\n```\nnpm install -g @tarojs/cli\n// 或\nyarn global add @tarojs/cli\n```\n\n### clone 项目\n```bash\ngit clone git@github.com:zjafei/taro-dva-demo.git\n```\n\n## 然后使用npm 或者yarn 安装依赖\n\n```\nnpm install\n// 或\nyarn\n```\n\n## 启动小程序开发环境\n\n```\nnpm run dev:weapp\n// 或\nyarn run dev:weapp\n```\n*微信开发者工具导入项目根目录进行预览*\n\n## 编译产出小程序\n\n```\nnpm run build:weapp\n// 或\nyarn run build:weapp\n```\n\n## 创建页面\n\n```\nnpm run page 'pageDemo'\n// 或\nyarn run page 'pageDemo'\n```\n\n### assets目录下的静态资源的上传\n```\n./deploy scp \n```\n\n## 项目结构\n```bash\n/\n├── config\n│   ├── dev.js                      // 开发环境的配置\n│   ├── index.js                    // 配置\n│   └── pro.js                      // 生产环境的配置             \n├── src\n│   ├── assets                      // 静态资源\n│   ├── components                  // 公用组件\n│   ├── models                      // 模型\n│   │   ├── globalModel.js          // 全局模型\n│   │   └── index.js                // 所有模型\n│   ├── pages\n│   │   └── PageDemo\n│   │       ├── index.jsx           // 业务页面\n│   │       ├── index.scss          // 页面样式\n│   │       └── model.js            // 页面模型\n│   ├── server\n│   │   ├── api.js                  // api\n│   │   ├── hostMap.js              // baseUrl的配置\n│   │   └── mock.js                 // mock 数据\n│   ├── utils                       // 工具方法\n│   ├── app.global.scss             // 全局公共样式 样式名称不会被 CSS Modules\n│   ├── app.js                      // 程序入口\n│   ├── base.scss                   // 样式变量\n│   └── index.html                  // spa页面的模板\n├── .editorconfig                   \n├── .eslintignore                   \n├── .eslintrc                       \n├── .gitignore                      \n├── .prettierignore                 \n├── .prettierrc                     \n├── .stylelintrc.json               \n├── componentsTemplate.js           \n├── deploy                          // 脚本文件\n├── package.json                    \n├── pageTemplate.js                 // 页面模板脚本\n├── project.config.json             \n├── README.md                       \n├── tsconfig.json                   \n└── tslint.json                     \n```\n\n## 结语\n\n> 欢迎小伙伴们使用。有需求建议和问题尽管提交issue，我尽力修正。当然直接pull request那是更好。","slug":"taro-with-DVA-tarojs-配合-dva-js的实践","published":1,"updated":"2019-08-02T06:24:28.279Z","_id":"cjytjli950001ghi6f2ddult1","comments":1,"layout":"post","photos":[],"link":"","content":"<p><img src=\"/0/taro_dva.jpg\" alt=\"taro with DVA \"></p>\n<h2 id=\"为什么使用-tarojs\"><a href=\"#为什么使用-tarojs\" class=\"headerlink\" title=\"为什么使用 tarojs\"></a>为什么使用 tarojs</h2><p>Taro 是一套遵循 React 语法规范的 多端开发 解决方案。现如今市面上端的形态多种多样，Web、React-Native、微信小程序等各种端大行其道，当业务要求同时在不同的端都要求有所表现的时候，针对不同的端去编写多套代码的成本显然非常高，这时候只编写一套代码就能够适配到多端的能力就显得极为需要。<br>使用 Taro，我们可以只书写一套代码，再通过 Taro 的编译工具，将源代码分别编译出可以在不同端（微信/百度/支付宝/字节跳动/QQ小程序、快应用、H5、React-Native 等）运行的代码。</p>\n<h2 id=\"为什么使用-davjs\"><a href=\"#为什么使用-davjs\" class=\"headerlink\" title=\"为什么使用 davjs\"></a>为什么使用 davjs</h2><p>因为 Taro 是类 React 框架，所以　React　有的问题　Taro　也同样存在。所以 davjs 的介入就变的十分重要。（具体dvajs做了什么可以看文章 <a href=\"https://zjafei.coding.me/2017/12/26/dva%E8%84%9A%E6%89%8B%E6%9E%B6%E7%9A%84demo/\" target=\"_blank\" rel=\"noopener\">dva脚手架的demo</a>）</p>\n<h2 id=\"实践demo的目的\"><a href=\"#实践demo的目的\" class=\"headerlink\" title=\"实践demo的目的\"></a>实践demo的目的</h2><ul>\n<li>规范项目目录结构</li>\n<li>总结一些常用的工具和服务</li>\n<li>提供常规业务的最佳实践</li>\n</ul>\n<a id=\"more\"></a>\n\n<h2 id=\"相关框架内容请去官网\"><a href=\"#相关框架内容请去官网\" class=\"headerlink\" title=\"相关框架内容请去官网\"></a>相关框架内容请去官网</h2><ul>\n<li><a href=\"https://github.com/NervJS/taro\" target=\"_blank\" rel=\"noopener\">taro</a></li>\n<li><a href=\"https://github.com/dvajs/dva\" target=\"_blank\" rel=\"noopener\">dvajs</a></li>\n</ul>\n<h2 id=\"使用-npm-或者-yarn-全局安装\"><a href=\"#使用-npm-或者-yarn-全局安装\" class=\"headerlink\" title=\"使用 npm 或者 yarn 全局安装\"></a>使用 npm 或者 yarn 全局安装</h2><figure class=\"highlight coffeescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">npm</span> install -g @tarojs/cli</span><br><span class=\"line\"><span class=\"regexp\">//</span> 或</span><br><span class=\"line\">yarn <span class=\"built_in\">global</span> add @tarojs/cli</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"clone-项目\"><a href=\"#clone-项目\" class=\"headerlink\" title=\"clone 项目\"></a>clone 项目</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">clone</span> git@github.com:zjafei/taro-dva-demo.git</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"然后使用npm-或者yarn-安装依赖\"><a href=\"#然后使用npm-或者yarn-安装依赖\" class=\"headerlink\" title=\"然后使用npm 或者yarn 安装依赖\"></a>然后使用npm 或者yarn 安装依赖</h2><figure class=\"highlight 1c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install</span><br><span class=\"line\"><span class=\"comment\">// 或</span></span><br><span class=\"line\">yarn</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"启动小程序开发环境\"><a href=\"#启动小程序开发环境\" class=\"headerlink\" title=\"启动小程序开发环境\"></a>启动小程序开发环境</h2><figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm <span class=\"keyword\">run</span><span class=\"bash\"> dev:weapp</span></span><br><span class=\"line\">// 或</span><br><span class=\"line\">yarn <span class=\"keyword\">run</span><span class=\"bash\"> dev:weapp</span></span><br></pre></td></tr></table></figure>\n\n<p><em>微信开发者工具导入项目根目录进行预览</em></p>\n<h2 id=\"编译产出小程序\"><a href=\"#编译产出小程序\" class=\"headerlink\" title=\"编译产出小程序\"></a>编译产出小程序</h2><figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm <span class=\"keyword\">run</span><span class=\"bash\"> build:weapp</span></span><br><span class=\"line\">// 或</span><br><span class=\"line\">yarn <span class=\"keyword\">run</span><span class=\"bash\"> build:weapp</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"创建页面\"><a href=\"#创建页面\" class=\"headerlink\" title=\"创建页面\"></a>创建页面</h2><figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm <span class=\"keyword\">run</span><span class=\"bash\"> page <span class=\"string\">'pageDemo'</span></span></span><br><span class=\"line\">// 或</span><br><span class=\"line\">yarn <span class=\"keyword\">run</span><span class=\"bash\"> page <span class=\"string\">'pageDemo'</span></span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"assets目录下的静态资源的上传\"><a href=\"#assets目录下的静态资源的上传\" class=\"headerlink\" title=\"assets目录下的静态资源的上传\"></a>assets目录下的静态资源的上传</h3><figure class=\"highlight jboss-cli\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">./deploy</span> scp</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"项目结构\"><a href=\"#项目结构\" class=\"headerlink\" title=\"项目结构\"></a>项目结构</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/</span><br><span class=\"line\">├── config</span><br><span class=\"line\">│   ├── dev.js                      // 开发环境的配置</span><br><span class=\"line\">│   ├── index.js                    // 配置</span><br><span class=\"line\">│   └── pro.js                      // 生产环境的配置             </span><br><span class=\"line\">├── src</span><br><span class=\"line\">│   ├── assets                      // 静态资源</span><br><span class=\"line\">│   ├── components                  // 公用组件</span><br><span class=\"line\">│   ├── models                      // 模型</span><br><span class=\"line\">│   │   ├── globalModel.js          // 全局模型</span><br><span class=\"line\">│   │   └── index.js                // 所有模型</span><br><span class=\"line\">│   ├── pages</span><br><span class=\"line\">│   │   └── PageDemo</span><br><span class=\"line\">│   │       ├── index.jsx           // 业务页面</span><br><span class=\"line\">│   │       ├── index.scss          // 页面样式</span><br><span class=\"line\">│   │       └── model.js            // 页面模型</span><br><span class=\"line\">│   ├── server</span><br><span class=\"line\">│   │   ├── api.js                  // api</span><br><span class=\"line\">│   │   ├── hostMap.js              // baseUrl的配置</span><br><span class=\"line\">│   │   └── mock.js                 // mock 数据</span><br><span class=\"line\">│   ├── utils                       // 工具方法</span><br><span class=\"line\">│   ├── app.global.scss             // 全局公共样式 样式名称不会被 CSS Modules</span><br><span class=\"line\">│   ├── app.js                      // 程序入口</span><br><span class=\"line\">│   ├── base.scss                   // 样式变量</span><br><span class=\"line\">│   └── index.html                  // spa页面的模板</span><br><span class=\"line\">├── .editorconfig                   </span><br><span class=\"line\">├── .eslintignore                   </span><br><span class=\"line\">├── .eslintrc                       </span><br><span class=\"line\">├── .gitignore                      </span><br><span class=\"line\">├── .prettierignore                 </span><br><span class=\"line\">├── .prettierrc                     </span><br><span class=\"line\">├── .stylelintrc.json               </span><br><span class=\"line\">├── componentsTemplate.js           </span><br><span class=\"line\">├── deploy                          // 脚本文件</span><br><span class=\"line\">├── package.json                    </span><br><span class=\"line\">├── pageTemplate.js                 // 页面模板脚本</span><br><span class=\"line\">├── project.config.json             </span><br><span class=\"line\">├── README.md                       </span><br><span class=\"line\">├── tsconfig.json                   </span><br><span class=\"line\">└── tslint.json</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"结语\"><a href=\"#结语\" class=\"headerlink\" title=\"结语\"></a>结语</h2><blockquote>\n<p>欢迎小伙伴们使用。有需求建议和问题尽管提交issue，我尽力修正。当然直接pull request那是更好。</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"<p><img src=\"/0/taro_dva.jpg\" alt=\"taro with DVA \"></p>\n<h2 id=\"为什么使用-tarojs\"><a href=\"#为什么使用-tarojs\" class=\"headerlink\" title=\"为什么使用 tarojs\"></a>为什么使用 tarojs</h2><p>Taro 是一套遵循 React 语法规范的 多端开发 解决方案。现如今市面上端的形态多种多样，Web、React-Native、微信小程序等各种端大行其道，当业务要求同时在不同的端都要求有所表现的时候，针对不同的端去编写多套代码的成本显然非常高，这时候只编写一套代码就能够适配到多端的能力就显得极为需要。<br>使用 Taro，我们可以只书写一套代码，再通过 Taro 的编译工具，将源代码分别编译出可以在不同端（微信/百度/支付宝/字节跳动/QQ小程序、快应用、H5、React-Native 等）运行的代码。</p>\n<h2 id=\"为什么使用-davjs\"><a href=\"#为什么使用-davjs\" class=\"headerlink\" title=\"为什么使用 davjs\"></a>为什么使用 davjs</h2><p>因为 Taro 是类 React 框架，所以　React　有的问题　Taro　也同样存在。所以 davjs 的介入就变的十分重要。（具体dvajs做了什么可以看文章 <a href=\"https://zjafei.coding.me/2017/12/26/dva%E8%84%9A%E6%89%8B%E6%9E%B6%E7%9A%84demo/\" target=\"_blank\" rel=\"noopener\">dva脚手架的demo</a>）</p>\n<h2 id=\"实践demo的目的\"><a href=\"#实践demo的目的\" class=\"headerlink\" title=\"实践demo的目的\"></a>实践demo的目的</h2><ul>\n<li>规范项目目录结构</li>\n<li>总结一些常用的工具和服务</li>\n<li>提供常规业务的最佳实践</li>\n</ul>","more":"<h2 id=\"相关框架内容请去官网\"><a href=\"#相关框架内容请去官网\" class=\"headerlink\" title=\"相关框架内容请去官网\"></a>相关框架内容请去官网</h2><ul>\n<li><a href=\"https://github.com/NervJS/taro\" target=\"_blank\" rel=\"noopener\">taro</a></li>\n<li><a href=\"https://github.com/dvajs/dva\" target=\"_blank\" rel=\"noopener\">dvajs</a></li>\n</ul>\n<h2 id=\"使用-npm-或者-yarn-全局安装\"><a href=\"#使用-npm-或者-yarn-全局安装\" class=\"headerlink\" title=\"使用 npm 或者 yarn 全局安装\"></a>使用 npm 或者 yarn 全局安装</h2><figure class=\"highlight coffeescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">npm</span> install -g @tarojs/cli</span><br><span class=\"line\"><span class=\"regexp\">//</span> 或</span><br><span class=\"line\">yarn <span class=\"built_in\">global</span> add @tarojs/cli</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"clone-项目\"><a href=\"#clone-项目\" class=\"headerlink\" title=\"clone 项目\"></a>clone 项目</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">clone</span> git@github.com:zjafei/taro-dva-demo.git</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"然后使用npm-或者yarn-安装依赖\"><a href=\"#然后使用npm-或者yarn-安装依赖\" class=\"headerlink\" title=\"然后使用npm 或者yarn 安装依赖\"></a>然后使用npm 或者yarn 安装依赖</h2><figure class=\"highlight 1c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install</span><br><span class=\"line\"><span class=\"comment\">// 或</span></span><br><span class=\"line\">yarn</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"启动小程序开发环境\"><a href=\"#启动小程序开发环境\" class=\"headerlink\" title=\"启动小程序开发环境\"></a>启动小程序开发环境</h2><figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm <span class=\"keyword\">run</span><span class=\"bash\"> dev:weapp</span></span><br><span class=\"line\">// 或</span><br><span class=\"line\">yarn <span class=\"keyword\">run</span><span class=\"bash\"> dev:weapp</span></span><br></pre></td></tr></table></figure>\n\n<p><em>微信开发者工具导入项目根目录进行预览</em></p>\n<h2 id=\"编译产出小程序\"><a href=\"#编译产出小程序\" class=\"headerlink\" title=\"编译产出小程序\"></a>编译产出小程序</h2><figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm <span class=\"keyword\">run</span><span class=\"bash\"> build:weapp</span></span><br><span class=\"line\">// 或</span><br><span class=\"line\">yarn <span class=\"keyword\">run</span><span class=\"bash\"> build:weapp</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"创建页面\"><a href=\"#创建页面\" class=\"headerlink\" title=\"创建页面\"></a>创建页面</h2><figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm <span class=\"keyword\">run</span><span class=\"bash\"> page <span class=\"string\">'pageDemo'</span></span></span><br><span class=\"line\">// 或</span><br><span class=\"line\">yarn <span class=\"keyword\">run</span><span class=\"bash\"> page <span class=\"string\">'pageDemo'</span></span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"assets目录下的静态资源的上传\"><a href=\"#assets目录下的静态资源的上传\" class=\"headerlink\" title=\"assets目录下的静态资源的上传\"></a>assets目录下的静态资源的上传</h3><figure class=\"highlight jboss-cli\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">./deploy</span> scp</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"项目结构\"><a href=\"#项目结构\" class=\"headerlink\" title=\"项目结构\"></a>项目结构</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/</span><br><span class=\"line\">├── config</span><br><span class=\"line\">│   ├── dev.js                      // 开发环境的配置</span><br><span class=\"line\">│   ├── index.js                    // 配置</span><br><span class=\"line\">│   └── pro.js                      // 生产环境的配置             </span><br><span class=\"line\">├── src</span><br><span class=\"line\">│   ├── assets                      // 静态资源</span><br><span class=\"line\">│   ├── components                  // 公用组件</span><br><span class=\"line\">│   ├── models                      // 模型</span><br><span class=\"line\">│   │   ├── globalModel.js          // 全局模型</span><br><span class=\"line\">│   │   └── index.js                // 所有模型</span><br><span class=\"line\">│   ├── pages</span><br><span class=\"line\">│   │   └── PageDemo</span><br><span class=\"line\">│   │       ├── index.jsx           // 业务页面</span><br><span class=\"line\">│   │       ├── index.scss          // 页面样式</span><br><span class=\"line\">│   │       └── model.js            // 页面模型</span><br><span class=\"line\">│   ├── server</span><br><span class=\"line\">│   │   ├── api.js                  // api</span><br><span class=\"line\">│   │   ├── hostMap.js              // baseUrl的配置</span><br><span class=\"line\">│   │   └── mock.js                 // mock 数据</span><br><span class=\"line\">│   ├── utils                       // 工具方法</span><br><span class=\"line\">│   ├── app.global.scss             // 全局公共样式 样式名称不会被 CSS Modules</span><br><span class=\"line\">│   ├── app.js                      // 程序入口</span><br><span class=\"line\">│   ├── base.scss                   // 样式变量</span><br><span class=\"line\">│   └── index.html                  // spa页面的模板</span><br><span class=\"line\">├── .editorconfig                   </span><br><span class=\"line\">├── .eslintignore                   </span><br><span class=\"line\">├── .eslintrc                       </span><br><span class=\"line\">├── .gitignore                      </span><br><span class=\"line\">├── .prettierignore                 </span><br><span class=\"line\">├── .prettierrc                     </span><br><span class=\"line\">├── .stylelintrc.json               </span><br><span class=\"line\">├── componentsTemplate.js           </span><br><span class=\"line\">├── deploy                          // 脚本文件</span><br><span class=\"line\">├── package.json                    </span><br><span class=\"line\">├── pageTemplate.js                 // 页面模板脚本</span><br><span class=\"line\">├── project.config.json             </span><br><span class=\"line\">├── README.md                       </span><br><span class=\"line\">├── tsconfig.json                   </span><br><span class=\"line\">└── tslint.json</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"结语\"><a href=\"#结语\" class=\"headerlink\" title=\"结语\"></a>结语</h2><blockquote>\n<p>欢迎小伙伴们使用。有需求建议和问题尽管提交issue，我尽力修正。当然直接pull request那是更好。</p>\n</blockquote>"},{"title":"nginx基于pfx文件创建https","date":"2020-06-01T14:05:41.000Z","_content":"\n# 什么是pfx文件\n公钥加密来技术12号标准（Public Key Cryptography Standards #12，PKCS#12）为存储和传输用户或服务器私钥、公钥和证书指源定了一个可移植的格式2113。它是一种二进制格5261式，这些文件也称为PFX文件。开发人员通常需要将PFX文件转换为某些不同的格式，如PEM或JKS，以便可以为使用SSL通信的独立Java客户4102端或WebLogic Server使用。<!--more-->\n\n# 证书的类型\n\n  * 带有私钥的证书\n    由Public Key Cryptography Standards #12，PKCS#12标准定义，包含了公钥和私钥的二进制格式的证书形式，以pfx作为证书文件后缀名。\n  * 二进制编码的证书\n    证书中没有私钥，DER 编码二进制格式的证书文件，以cer作为证书文件后缀名。\n  * Base64编码的证书\n    证书中没有私钥，BASE64 编码格式的证书文件，也是以cer作为证书文件后缀名。\n\n  > 所以pfx的最大特点就是同时包含公钥和私钥\n\n\n# 通过pfx生成常用证书的方法\n\n```bash\nopenssl pkcs12 -in /path/to/in/file.pfx -clcerts -nokeys -out /path/to/out/file.crt\nopenssl pkcs12 -in /path/to/in/file.pfx -nocerts -nodes -out /path/to/out/file.rsa\n##验证证书正确性\nopenssl s_server -www -accept 443 -cert /path/to/file.crt -key /path/to/file.rsa\n\nopenssl pkcs12 -in /path/to/in/file.pfx -nodes -out /path/to/out/file.pem\nopenssl rsa -in /path/to/in/file.pem -out /path/to/out/file.key\nopenssl x509 -in /path/to/in/file.pem -out /path/to/out/file.crt\n\n```\n\n# 不同证书的nginx的配置\n\n```nginx\nserver {  \n    listen 443;  \n    server_name localhost;\n    ssl on;  \n    ssl_certificate /path/to/out/file.crt;  \n    ssl_certificate_key /path/to/out/file.rsa;  \n    ssl_session_timeout 5m;  \n    ssl_protocols SSLv2 SSLv3 TLSv1;  \n    ssl_ciphers ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP;  \n    ssl_prefer_server_ciphers on;  \n    # location仅为事例\n    location ~ /api/(.*) {\n            proxy_redirect off;\n            proxy_set_header Host $host;\n            proxy_set_header X-Ssl on;\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_pass http://serverAPI;\n    }\n}\n```\n\n***如果nginx报错***\n```bash\nSSL: error:0906D06C:PEM routines:PEM_read_bio:no start line:Expecting: TRUSTED CERTIFICATE\n```\n可以尝试使用`pem证书`\n```nginx\nserver {  \n    listen 443;  \n    server_name localhost;\n    ssl_certificate     /path/to/out/file.pem;\n    ssl_certificate_key /path/to/out/file.key;\n    ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;\n    ssl_ciphers         HIGH:!aNULL:!MD5;   \n    # location仅为事例\n    location ~ /api/(.*) {\n            proxy_redirect off;\n            proxy_set_header Host $host;\n            proxy_set_header X-Ssl on;\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_pass http://serverAPI;\n    }\n}\n```\n这时候启动nginx会出现`Enter PEM pass phrase`\n\n```bash\nopenssl rsa -in /path/to/in/file.key -out /path/to/out/file.unsecure\n```\n修改nginx配置\n```nginx\nserver {  \n    listen 443;  \n    server_name localhost;\n    ssl_certificate     /path/to/file.pem;\n    ssl_certificate_key /path/to/file.unsecure;\n    ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;\n    ssl_ciphers         HIGH:!aNULL:!MD5;   \n    # location仅为事例\n    location ~ /api/(.*) {\n            proxy_redirect off;\n            proxy_set_header Host $host;\n            proxy_set_header X-Ssl on;\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_pass http://serverAPI;\n    }\n}\n```\n这样就不需要每次启动nginx输入PEM pass phrase\n\n>最后祝大家儿童节快乐 :)","source":"_posts/nginx基于pfx文件创建https.md","raw":"---\ntitle: nginx基于pfx文件创建https\ndate: 2020-06-01 22:05:41\ntags: ['nginx','pfx','https']\ncategory: 'coding'\n---\n\n# 什么是pfx文件\n公钥加密来技术12号标准（Public Key Cryptography Standards #12，PKCS#12）为存储和传输用户或服务器私钥、公钥和证书指源定了一个可移植的格式2113。它是一种二进制格5261式，这些文件也称为PFX文件。开发人员通常需要将PFX文件转换为某些不同的格式，如PEM或JKS，以便可以为使用SSL通信的独立Java客户4102端或WebLogic Server使用。<!--more-->\n\n# 证书的类型\n\n  * 带有私钥的证书\n    由Public Key Cryptography Standards #12，PKCS#12标准定义，包含了公钥和私钥的二进制格式的证书形式，以pfx作为证书文件后缀名。\n  * 二进制编码的证书\n    证书中没有私钥，DER 编码二进制格式的证书文件，以cer作为证书文件后缀名。\n  * Base64编码的证书\n    证书中没有私钥，BASE64 编码格式的证书文件，也是以cer作为证书文件后缀名。\n\n  > 所以pfx的最大特点就是同时包含公钥和私钥\n\n\n# 通过pfx生成常用证书的方法\n\n```bash\nopenssl pkcs12 -in /path/to/in/file.pfx -clcerts -nokeys -out /path/to/out/file.crt\nopenssl pkcs12 -in /path/to/in/file.pfx -nocerts -nodes -out /path/to/out/file.rsa\n##验证证书正确性\nopenssl s_server -www -accept 443 -cert /path/to/file.crt -key /path/to/file.rsa\n\nopenssl pkcs12 -in /path/to/in/file.pfx -nodes -out /path/to/out/file.pem\nopenssl rsa -in /path/to/in/file.pem -out /path/to/out/file.key\nopenssl x509 -in /path/to/in/file.pem -out /path/to/out/file.crt\n\n```\n\n# 不同证书的nginx的配置\n\n```nginx\nserver {  \n    listen 443;  \n    server_name localhost;\n    ssl on;  \n    ssl_certificate /path/to/out/file.crt;  \n    ssl_certificate_key /path/to/out/file.rsa;  \n    ssl_session_timeout 5m;  \n    ssl_protocols SSLv2 SSLv3 TLSv1;  \n    ssl_ciphers ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP;  \n    ssl_prefer_server_ciphers on;  \n    # location仅为事例\n    location ~ /api/(.*) {\n            proxy_redirect off;\n            proxy_set_header Host $host;\n            proxy_set_header X-Ssl on;\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_pass http://serverAPI;\n    }\n}\n```\n\n***如果nginx报错***\n```bash\nSSL: error:0906D06C:PEM routines:PEM_read_bio:no start line:Expecting: TRUSTED CERTIFICATE\n```\n可以尝试使用`pem证书`\n```nginx\nserver {  \n    listen 443;  \n    server_name localhost;\n    ssl_certificate     /path/to/out/file.pem;\n    ssl_certificate_key /path/to/out/file.key;\n    ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;\n    ssl_ciphers         HIGH:!aNULL:!MD5;   \n    # location仅为事例\n    location ~ /api/(.*) {\n            proxy_redirect off;\n            proxy_set_header Host $host;\n            proxy_set_header X-Ssl on;\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_pass http://serverAPI;\n    }\n}\n```\n这时候启动nginx会出现`Enter PEM pass phrase`\n\n```bash\nopenssl rsa -in /path/to/in/file.key -out /path/to/out/file.unsecure\n```\n修改nginx配置\n```nginx\nserver {  \n    listen 443;  \n    server_name localhost;\n    ssl_certificate     /path/to/file.pem;\n    ssl_certificate_key /path/to/file.unsecure;\n    ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;\n    ssl_ciphers         HIGH:!aNULL:!MD5;   \n    # location仅为事例\n    location ~ /api/(.*) {\n            proxy_redirect off;\n            proxy_set_header Host $host;\n            proxy_set_header X-Ssl on;\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_pass http://serverAPI;\n    }\n}\n```\n这样就不需要每次启动nginx输入PEM pass phrase\n\n>最后祝大家儿童节快乐 :)","slug":"nginx基于pfx文件创建https","published":1,"updated":"2020-06-01T15:13:46.786Z","_id":"ckawkslat00003ti6cp6kdbsf","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"什么是pfx文件\"><a href=\"#什么是pfx文件\" class=\"headerlink\" title=\"什么是pfx文件\"></a>什么是pfx文件</h1><p>公钥加密来技术12号标准（Public Key Cryptography Standards #12，PKCS#12）为存储和传输用户或服务器私钥、公钥和证书指源定了一个可移植的格式2113。它是一种二进制格5261式，这些文件也称为PFX文件。开发人员通常需要将PFX文件转换为某些不同的格式，如PEM或JKS，以便可以为使用SSL通信的独立Java客户4102端或WebLogic Server使用。<a id=\"more\"></a></p>\n<h1 id=\"证书的类型\"><a href=\"#证书的类型\" class=\"headerlink\" title=\"证书的类型\"></a>证书的类型</h1><ul>\n<li><p>带有私钥的证书<br>由Public Key Cryptography Standards #12，PKCS#12标准定义，包含了公钥和私钥的二进制格式的证书形式，以pfx作为证书文件后缀名。</p>\n</li>\n<li><p>二进制编码的证书<br>证书中没有私钥，DER 编码二进制格式的证书文件，以cer作为证书文件后缀名。</p>\n</li>\n<li><p>Base64编码的证书<br>证书中没有私钥，BASE64 编码格式的证书文件，也是以cer作为证书文件后缀名。</p>\n<blockquote>\n<p>所以pfx的最大特点就是同时包含公钥和私钥</p>\n</blockquote>\n</li>\n</ul>\n<h1 id=\"通过pfx生成常用证书的方法\"><a href=\"#通过pfx生成常用证书的方法\" class=\"headerlink\" title=\"通过pfx生成常用证书的方法\"></a>通过pfx生成常用证书的方法</h1><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">openssl pkcs12 -<span class=\"keyword\">in</span> /path/to/<span class=\"keyword\">in</span>/file.pfx -clcerts -nokeys -out /path/to/out/file.crt</span><br><span class=\"line\">openssl pkcs12 -<span class=\"keyword\">in</span> /path/to/<span class=\"keyword\">in</span>/file.pfx -nocerts -nodes -out /path/to/out/file.rsa</span><br><span class=\"line\"><span class=\"comment\">##验证证书正确性</span></span><br><span class=\"line\">openssl s_server -www -accept 443 -cert /path/to/file.crt -key /path/to/file.rsa</span><br><span class=\"line\"></span><br><span class=\"line\">openssl pkcs12 -<span class=\"keyword\">in</span> /path/to/<span class=\"keyword\">in</span>/file.pfx -nodes -out /path/to/out/file.pem</span><br><span class=\"line\">openssl rsa -<span class=\"keyword\">in</span> /path/to/<span class=\"keyword\">in</span>/file.pem -out /path/to/out/file.key</span><br><span class=\"line\">openssl x509 -<span class=\"keyword\">in</span> /path/to/<span class=\"keyword\">in</span>/file.pem -out /path/to/out/file.crt</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"不同证书的nginx的配置\"><a href=\"#不同证书的nginx的配置\" class=\"headerlink\" title=\"不同证书的nginx的配置\"></a>不同证书的nginx的配置</h1><figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">server</span> &#123;  </span><br><span class=\"line\">    <span class=\"attribute\">listen</span> <span class=\"number\">443</span>;  </span><br><span class=\"line\">    <span class=\"attribute\">server_name</span> localhost;</span><br><span class=\"line\">    <span class=\"attribute\">ssl</span> <span class=\"literal\">on</span>;  </span><br><span class=\"line\">    <span class=\"attribute\">ssl_certificate</span> /path/to/out/file.crt;  </span><br><span class=\"line\">    <span class=\"attribute\">ssl_certificate_key</span> /path/to/out/file.rsa;  </span><br><span class=\"line\">    <span class=\"attribute\">ssl_session_timeout</span> <span class=\"number\">5m</span>;  </span><br><span class=\"line\">    <span class=\"attribute\">ssl_protocols</span> SSLv2 SSLv3 TLSv1;  </span><br><span class=\"line\">    <span class=\"attribute\">ssl_ciphers</span> ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP;  </span><br><span class=\"line\">    <span class=\"attribute\">ssl_prefer_server_ciphers</span> <span class=\"literal\">on</span>;  </span><br><span class=\"line\">    <span class=\"comment\"># location仅为事例</span></span><br><span class=\"line\">    <span class=\"attribute\">location</span> <span class=\"regexp\">~ /api/(.*)</span> &#123;</span><br><span class=\"line\">            <span class=\"attribute\">proxy_redirect</span> <span class=\"literal\">off</span>;</span><br><span class=\"line\">            <span class=\"attribute\">proxy_set_header</span> Host <span class=\"variable\">$host</span>;</span><br><span class=\"line\">            <span class=\"attribute\">proxy_set_header</span> X-Ssl <span class=\"literal\">on</span>;</span><br><span class=\"line\">            <span class=\"attribute\">proxy_set_header</span> X-Real-IP <span class=\"variable\">$remote_addr</span>;</span><br><span class=\"line\">            <span class=\"attribute\">proxy_set_header</span> X-Forwarded-For <span class=\"variable\">$proxy_add_x_forwarded_for</span>;</span><br><span class=\"line\">            <span class=\"attribute\">proxy_pass</span> http://serverAPI;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong><em>如果nginx报错</em></strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SSL: error:0906D06C:PEM routines:PEM_read_bio:no start line:Expecting: TRUSTED CERTIFICATE</span><br></pre></td></tr></table></figure>\n<p>可以尝试使用<code>pem证书</code></p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">server</span> &#123;  </span><br><span class=\"line\">    <span class=\"attribute\">listen</span> <span class=\"number\">443</span>;  </span><br><span class=\"line\">    <span class=\"attribute\">server_name</span> localhost;</span><br><span class=\"line\">    <span class=\"attribute\">ssl_certificate</span>     /path/to/out/file.pem;</span><br><span class=\"line\">    <span class=\"attribute\">ssl_certificate_key</span> /path/to/out/file.key;</span><br><span class=\"line\">    <span class=\"attribute\">ssl_protocols</span>       TLSv1 TLSv1.<span class=\"number\">1</span> TLSv1.<span class=\"number\">2</span>;</span><br><span class=\"line\">    <span class=\"attribute\">ssl_ciphers</span>         HIGH:!aNULL:!MD5;   </span><br><span class=\"line\">    <span class=\"comment\"># location仅为事例</span></span><br><span class=\"line\">    <span class=\"attribute\">location</span> <span class=\"regexp\">~ /api/(.*)</span> &#123;</span><br><span class=\"line\">            <span class=\"attribute\">proxy_redirect</span> <span class=\"literal\">off</span>;</span><br><span class=\"line\">            <span class=\"attribute\">proxy_set_header</span> Host <span class=\"variable\">$host</span>;</span><br><span class=\"line\">            <span class=\"attribute\">proxy_set_header</span> X-Ssl <span class=\"literal\">on</span>;</span><br><span class=\"line\">            <span class=\"attribute\">proxy_set_header</span> X-Real-IP <span class=\"variable\">$remote_addr</span>;</span><br><span class=\"line\">            <span class=\"attribute\">proxy_set_header</span> X-Forwarded-For <span class=\"variable\">$proxy_add_x_forwarded_for</span>;</span><br><span class=\"line\">            <span class=\"attribute\">proxy_pass</span> http://serverAPI;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这时候启动nginx会出现<code>Enter PEM pass phrase</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">openssl rsa -<span class=\"keyword\">in</span> /path/to/<span class=\"keyword\">in</span>/file.key -out /path/to/out/file.unsecure</span><br></pre></td></tr></table></figure>\n<p>修改nginx配置</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">server</span> &#123;  </span><br><span class=\"line\">    <span class=\"attribute\">listen</span> <span class=\"number\">443</span>;  </span><br><span class=\"line\">    <span class=\"attribute\">server_name</span> localhost;</span><br><span class=\"line\">    <span class=\"attribute\">ssl_certificate</span>     /path/to/file.pem;</span><br><span class=\"line\">    <span class=\"attribute\">ssl_certificate_key</span> /path/to/file.unsecure;</span><br><span class=\"line\">    <span class=\"attribute\">ssl_protocols</span>       TLSv1 TLSv1.<span class=\"number\">1</span> TLSv1.<span class=\"number\">2</span>;</span><br><span class=\"line\">    <span class=\"attribute\">ssl_ciphers</span>         HIGH:!aNULL:!MD5;   </span><br><span class=\"line\">    <span class=\"comment\"># location仅为事例</span></span><br><span class=\"line\">    <span class=\"attribute\">location</span> <span class=\"regexp\">~ /api/(.*)</span> &#123;</span><br><span class=\"line\">            <span class=\"attribute\">proxy_redirect</span> <span class=\"literal\">off</span>;</span><br><span class=\"line\">            <span class=\"attribute\">proxy_set_header</span> Host <span class=\"variable\">$host</span>;</span><br><span class=\"line\">            <span class=\"attribute\">proxy_set_header</span> X-Ssl <span class=\"literal\">on</span>;</span><br><span class=\"line\">            <span class=\"attribute\">proxy_set_header</span> X-Real-IP <span class=\"variable\">$remote_addr</span>;</span><br><span class=\"line\">            <span class=\"attribute\">proxy_set_header</span> X-Forwarded-For <span class=\"variable\">$proxy_add_x_forwarded_for</span>;</span><br><span class=\"line\">            <span class=\"attribute\">proxy_pass</span> http://serverAPI;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这样就不需要每次启动nginx输入PEM pass phrase</p>\n<blockquote>\n<p>最后祝大家儿童节快乐 :)</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"<h1 id=\"什么是pfx文件\"><a href=\"#什么是pfx文件\" class=\"headerlink\" title=\"什么是pfx文件\"></a>什么是pfx文件</h1><p>公钥加密来技术12号标准（Public Key Cryptography Standards #12，PKCS#12）为存储和传输用户或服务器私钥、公钥和证书指源定了一个可移植的格式2113。它是一种二进制格5261式，这些文件也称为PFX文件。开发人员通常需要将PFX文件转换为某些不同的格式，如PEM或JKS，以便可以为使用SSL通信的独立Java客户4102端或WebLogic Server使用。","more":"</p>\n<h1 id=\"证书的类型\"><a href=\"#证书的类型\" class=\"headerlink\" title=\"证书的类型\"></a>证书的类型</h1><ul>\n<li><p>带有私钥的证书<br>由Public Key Cryptography Standards #12，PKCS#12标准定义，包含了公钥和私钥的二进制格式的证书形式，以pfx作为证书文件后缀名。</p>\n</li>\n<li><p>二进制编码的证书<br>证书中没有私钥，DER 编码二进制格式的证书文件，以cer作为证书文件后缀名。</p>\n</li>\n<li><p>Base64编码的证书<br>证书中没有私钥，BASE64 编码格式的证书文件，也是以cer作为证书文件后缀名。</p>\n<blockquote>\n<p>所以pfx的最大特点就是同时包含公钥和私钥</p>\n</blockquote>\n</li>\n</ul>\n<h1 id=\"通过pfx生成常用证书的方法\"><a href=\"#通过pfx生成常用证书的方法\" class=\"headerlink\" title=\"通过pfx生成常用证书的方法\"></a>通过pfx生成常用证书的方法</h1><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">openssl pkcs12 -<span class=\"keyword\">in</span> /path/to/<span class=\"keyword\">in</span>/file.pfx -clcerts -nokeys -out /path/to/out/file.crt</span><br><span class=\"line\">openssl pkcs12 -<span class=\"keyword\">in</span> /path/to/<span class=\"keyword\">in</span>/file.pfx -nocerts -nodes -out /path/to/out/file.rsa</span><br><span class=\"line\"><span class=\"comment\">##验证证书正确性</span></span><br><span class=\"line\">openssl s_server -www -accept 443 -cert /path/to/file.crt -key /path/to/file.rsa</span><br><span class=\"line\"></span><br><span class=\"line\">openssl pkcs12 -<span class=\"keyword\">in</span> /path/to/<span class=\"keyword\">in</span>/file.pfx -nodes -out /path/to/out/file.pem</span><br><span class=\"line\">openssl rsa -<span class=\"keyword\">in</span> /path/to/<span class=\"keyword\">in</span>/file.pem -out /path/to/out/file.key</span><br><span class=\"line\">openssl x509 -<span class=\"keyword\">in</span> /path/to/<span class=\"keyword\">in</span>/file.pem -out /path/to/out/file.crt</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"不同证书的nginx的配置\"><a href=\"#不同证书的nginx的配置\" class=\"headerlink\" title=\"不同证书的nginx的配置\"></a>不同证书的nginx的配置</h1><figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">server</span> &#123;  </span><br><span class=\"line\">    <span class=\"attribute\">listen</span> <span class=\"number\">443</span>;  </span><br><span class=\"line\">    <span class=\"attribute\">server_name</span> localhost;</span><br><span class=\"line\">    <span class=\"attribute\">ssl</span> <span class=\"literal\">on</span>;  </span><br><span class=\"line\">    <span class=\"attribute\">ssl_certificate</span> /path/to/out/file.crt;  </span><br><span class=\"line\">    <span class=\"attribute\">ssl_certificate_key</span> /path/to/out/file.rsa;  </span><br><span class=\"line\">    <span class=\"attribute\">ssl_session_timeout</span> <span class=\"number\">5m</span>;  </span><br><span class=\"line\">    <span class=\"attribute\">ssl_protocols</span> SSLv2 SSLv3 TLSv1;  </span><br><span class=\"line\">    <span class=\"attribute\">ssl_ciphers</span> ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP;  </span><br><span class=\"line\">    <span class=\"attribute\">ssl_prefer_server_ciphers</span> <span class=\"literal\">on</span>;  </span><br><span class=\"line\">    <span class=\"comment\"># location仅为事例</span></span><br><span class=\"line\">    <span class=\"attribute\">location</span> <span class=\"regexp\">~ /api/(.*)</span> &#123;</span><br><span class=\"line\">            <span class=\"attribute\">proxy_redirect</span> <span class=\"literal\">off</span>;</span><br><span class=\"line\">            <span class=\"attribute\">proxy_set_header</span> Host <span class=\"variable\">$host</span>;</span><br><span class=\"line\">            <span class=\"attribute\">proxy_set_header</span> X-Ssl <span class=\"literal\">on</span>;</span><br><span class=\"line\">            <span class=\"attribute\">proxy_set_header</span> X-Real-IP <span class=\"variable\">$remote_addr</span>;</span><br><span class=\"line\">            <span class=\"attribute\">proxy_set_header</span> X-Forwarded-For <span class=\"variable\">$proxy_add_x_forwarded_for</span>;</span><br><span class=\"line\">            <span class=\"attribute\">proxy_pass</span> http://serverAPI;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong><em>如果nginx报错</em></strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SSL: error:0906D06C:PEM routines:PEM_read_bio:no start line:Expecting: TRUSTED CERTIFICATE</span><br></pre></td></tr></table></figure>\n<p>可以尝试使用<code>pem证书</code></p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">server</span> &#123;  </span><br><span class=\"line\">    <span class=\"attribute\">listen</span> <span class=\"number\">443</span>;  </span><br><span class=\"line\">    <span class=\"attribute\">server_name</span> localhost;</span><br><span class=\"line\">    <span class=\"attribute\">ssl_certificate</span>     /path/to/out/file.pem;</span><br><span class=\"line\">    <span class=\"attribute\">ssl_certificate_key</span> /path/to/out/file.key;</span><br><span class=\"line\">    <span class=\"attribute\">ssl_protocols</span>       TLSv1 TLSv1.<span class=\"number\">1</span> TLSv1.<span class=\"number\">2</span>;</span><br><span class=\"line\">    <span class=\"attribute\">ssl_ciphers</span>         HIGH:!aNULL:!MD5;   </span><br><span class=\"line\">    <span class=\"comment\"># location仅为事例</span></span><br><span class=\"line\">    <span class=\"attribute\">location</span> <span class=\"regexp\">~ /api/(.*)</span> &#123;</span><br><span class=\"line\">            <span class=\"attribute\">proxy_redirect</span> <span class=\"literal\">off</span>;</span><br><span class=\"line\">            <span class=\"attribute\">proxy_set_header</span> Host <span class=\"variable\">$host</span>;</span><br><span class=\"line\">            <span class=\"attribute\">proxy_set_header</span> X-Ssl <span class=\"literal\">on</span>;</span><br><span class=\"line\">            <span class=\"attribute\">proxy_set_header</span> X-Real-IP <span class=\"variable\">$remote_addr</span>;</span><br><span class=\"line\">            <span class=\"attribute\">proxy_set_header</span> X-Forwarded-For <span class=\"variable\">$proxy_add_x_forwarded_for</span>;</span><br><span class=\"line\">            <span class=\"attribute\">proxy_pass</span> http://serverAPI;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这时候启动nginx会出现<code>Enter PEM pass phrase</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">openssl rsa -<span class=\"keyword\">in</span> /path/to/<span class=\"keyword\">in</span>/file.key -out /path/to/out/file.unsecure</span><br></pre></td></tr></table></figure>\n<p>修改nginx配置</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">server</span> &#123;  </span><br><span class=\"line\">    <span class=\"attribute\">listen</span> <span class=\"number\">443</span>;  </span><br><span class=\"line\">    <span class=\"attribute\">server_name</span> localhost;</span><br><span class=\"line\">    <span class=\"attribute\">ssl_certificate</span>     /path/to/file.pem;</span><br><span class=\"line\">    <span class=\"attribute\">ssl_certificate_key</span> /path/to/file.unsecure;</span><br><span class=\"line\">    <span class=\"attribute\">ssl_protocols</span>       TLSv1 TLSv1.<span class=\"number\">1</span> TLSv1.<span class=\"number\">2</span>;</span><br><span class=\"line\">    <span class=\"attribute\">ssl_ciphers</span>         HIGH:!aNULL:!MD5;   </span><br><span class=\"line\">    <span class=\"comment\"># location仅为事例</span></span><br><span class=\"line\">    <span class=\"attribute\">location</span> <span class=\"regexp\">~ /api/(.*)</span> &#123;</span><br><span class=\"line\">            <span class=\"attribute\">proxy_redirect</span> <span class=\"literal\">off</span>;</span><br><span class=\"line\">            <span class=\"attribute\">proxy_set_header</span> Host <span class=\"variable\">$host</span>;</span><br><span class=\"line\">            <span class=\"attribute\">proxy_set_header</span> X-Ssl <span class=\"literal\">on</span>;</span><br><span class=\"line\">            <span class=\"attribute\">proxy_set_header</span> X-Real-IP <span class=\"variable\">$remote_addr</span>;</span><br><span class=\"line\">            <span class=\"attribute\">proxy_set_header</span> X-Forwarded-For <span class=\"variable\">$proxy_add_x_forwarded_for</span>;</span><br><span class=\"line\">            <span class=\"attribute\">proxy_pass</span> http://serverAPI;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这样就不需要每次启动nginx输入PEM pass phrase</p>\n<blockquote>\n<p>最后祝大家儿童节快乐 :)</p>\n</blockquote>"},{"title":"centOS服务器添加服务添加启动项脚本","date":"2020-06-13T14:05:41.000Z","_content":"\n再好的服务器都有重启的一天。重启后服务的自启动变的非常有必要。centOS的启动都写在`/etc/rc.local`这个文件里面。这个文件是个软连接，它指向的是`/etc/rc.d/rc.local `。默认这两个文件没有可执行的权限，这也是为什么很多启动项失败的原因<!--more-->\n\n# 第一步 添加可执行权限\n```bash\nchmod +x /etc/rc.local \nchmod +x /etc/rc.d/rc.local \n```\n\n# 第二步 启动服务查看服务状态\n```bash\nsystemctl start rc-local.service \nsystemctl status rc-local.service\n```\n\n# 第三步 制作一个服务通过systemctl启动\n\n```bash\ncd /etc/systemd/system\nvim yourProjectName.service ## 可以把yourProjectName设置为你想起的服务名\n```\n\nyourProjectName.service的内容如下\n```bash\n[Unit]  \nDescription=yourProjectName #描述  \nAfter=syslog.target network.target  #依赖  \n \n[Service]  \nType=simple  \n \nExecStart=/usr/bin/java -jar /opt/javaapps/yourProjectName.jar  \n#前面是java命令的绝对路径  后面是jar包的绝对路径  \nExecStop=/bin/kill -15 $MAINPID   ## kill -9 与 kill -15 -9 是立即停止 -15 等服务空闲后停止\n \nUser=root  \nGroup=root   \n \n[Install]  \nWantedBy=multi-user.target  \n```\n\n# 第四步 添加你要自启动的服务到文件里面\n```bash\n#!/bin/bash\n# THIS FILE IS ADDED FOR COMPATIBILITY PURPOSES\n#\n# It is highly advisable to create own systemd services or udev rules\n# to run scripts during boot instead of using this file.\n#\n# In contrast to previous versions due to parallel execution during boot\n# this script will NOT be run after all other services.\n#\n# Please note that you must run 'chmod +x /etc/rc.d/rc.local' to ensure\n# that this script will be executed during boot.\n\ntouch /var/lock/subsys/local\n\nsystemctl start yourProjectName.service\n```\n\n如果启动服务遇到\n```bash\nWarning: nginx.service changed on disk. Run 'systemctl daemon-reload' to reload units.\n```\n\n解决方案\n```bash\nsystemctl daemon-reload\n```\n\n>好了就写这么多,出去玩耍了 :)","source":"_posts/centOS服务器添加服务添加启动项脚本.md","raw":"---\ntitle: centOS服务器添加服务添加启动项脚本\ndate: 2020-06-13 22:05:41\ntags: ['centOS','service','启动项','rc.local','daemon','reload', 'systemctl']\ncategory: 'coding'\n---\n\n再好的服务器都有重启的一天。重启后服务的自启动变的非常有必要。centOS的启动都写在`/etc/rc.local`这个文件里面。这个文件是个软连接，它指向的是`/etc/rc.d/rc.local `。默认这两个文件没有可执行的权限，这也是为什么很多启动项失败的原因<!--more-->\n\n# 第一步 添加可执行权限\n```bash\nchmod +x /etc/rc.local \nchmod +x /etc/rc.d/rc.local \n```\n\n# 第二步 启动服务查看服务状态\n```bash\nsystemctl start rc-local.service \nsystemctl status rc-local.service\n```\n\n# 第三步 制作一个服务通过systemctl启动\n\n```bash\ncd /etc/systemd/system\nvim yourProjectName.service ## 可以把yourProjectName设置为你想起的服务名\n```\n\nyourProjectName.service的内容如下\n```bash\n[Unit]  \nDescription=yourProjectName #描述  \nAfter=syslog.target network.target  #依赖  \n \n[Service]  \nType=simple  \n \nExecStart=/usr/bin/java -jar /opt/javaapps/yourProjectName.jar  \n#前面是java命令的绝对路径  后面是jar包的绝对路径  \nExecStop=/bin/kill -15 $MAINPID   ## kill -9 与 kill -15 -9 是立即停止 -15 等服务空闲后停止\n \nUser=root  \nGroup=root   \n \n[Install]  \nWantedBy=multi-user.target  \n```\n\n# 第四步 添加你要自启动的服务到文件里面\n```bash\n#!/bin/bash\n# THIS FILE IS ADDED FOR COMPATIBILITY PURPOSES\n#\n# It is highly advisable to create own systemd services or udev rules\n# to run scripts during boot instead of using this file.\n#\n# In contrast to previous versions due to parallel execution during boot\n# this script will NOT be run after all other services.\n#\n# Please note that you must run 'chmod +x /etc/rc.d/rc.local' to ensure\n# that this script will be executed during boot.\n\ntouch /var/lock/subsys/local\n\nsystemctl start yourProjectName.service\n```\n\n如果启动服务遇到\n```bash\nWarning: nginx.service changed on disk. Run 'systemctl daemon-reload' to reload units.\n```\n\n解决方案\n```bash\nsystemctl daemon-reload\n```\n\n>好了就写这么多,出去玩耍了 :)","slug":"centOS服务器添加服务添加启动项脚本","published":1,"updated":"2020-06-13T07:00:42.360Z","_id":"ckbdagv2k0000wxi6c637cwfo","comments":1,"layout":"post","photos":[],"link":"","content":"<p>再好的服务器都有重启的一天。重启后服务的自启动变的非常有必要。centOS的启动都写在<code>/etc/rc.local</code>这个文件里面。这个文件是个软连接，它指向的是<code>/etc/rc.d/rc.local</code>。默认这两个文件没有可执行的权限，这也是为什么很多启动项失败的原因<a id=\"more\"></a></p>\n<h1 id=\"第一步-添加可执行权限\"><a href=\"#第一步-添加可执行权限\" class=\"headerlink\" title=\"第一步 添加可执行权限\"></a>第一步 添加可执行权限</h1><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chmod +x /etc/rc.local </span><br><span class=\"line\">chmod +x /etc/rc.d/rc.local</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"第二步-启动服务查看服务状态\"><a href=\"#第二步-启动服务查看服务状态\" class=\"headerlink\" title=\"第二步 启动服务查看服务状态\"></a>第二步 启动服务查看服务状态</h1><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl start rc-local.service </span><br><span class=\"line\">systemctl status rc-local.service</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"第三步-制作一个服务通过systemctl启动\"><a href=\"#第三步-制作一个服务通过systemctl启动\" class=\"headerlink\" title=\"第三步 制作一个服务通过systemctl启动\"></a>第三步 制作一个服务通过systemctl启动</h1><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /etc/systemd/system</span><br><span class=\"line\">vim yourProjectName.service <span class=\"comment\">## 可以把yourProjectName设置为你想起的服务名</span></span><br></pre></td></tr></table></figure>\n\n<p>yourProjectName.service的内容如下</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Unit]  </span><br><span class=\"line\">Description=yourProjectName <span class=\"comment\">#描述  </span></span><br><span class=\"line\">After=syslog.target network.target  <span class=\"comment\">#依赖  </span></span><br><span class=\"line\"> </span><br><span class=\"line\">[Service]  </span><br><span class=\"line\">Type=simple  </span><br><span class=\"line\"> </span><br><span class=\"line\">ExecStart=/usr/bin/java -jar /opt/javaapps/yourProjectName.jar  </span><br><span class=\"line\"><span class=\"comment\">#前面是java命令的绝对路径  后面是jar包的绝对路径  </span></span><br><span class=\"line\">ExecStop=/bin/<span class=\"built_in\">kill</span> -15 <span class=\"variable\">$MAINPID</span>   <span class=\"comment\">## kill -9 与 kill -15 -9 是立即停止 -15 等服务空闲后停止</span></span><br><span class=\"line\"> </span><br><span class=\"line\">User=root  </span><br><span class=\"line\">Group=root   </span><br><span class=\"line\"> </span><br><span class=\"line\">[Install]  </span><br><span class=\"line\">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"第四步-添加你要自启动的服务到文件里面\"><a href=\"#第四步-添加你要自启动的服务到文件里面\" class=\"headerlink\" title=\"第四步 添加你要自启动的服务到文件里面\"></a>第四步 添加你要自启动的服务到文件里面</h1><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"comment\"># THIS FILE IS ADDED FOR COMPATIBILITY PURPOSES</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># It is highly advisable to create own systemd services or udev rules</span></span><br><span class=\"line\"><span class=\"comment\"># to run scripts during boot instead of using this file.</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># In contrast to previous versions due to parallel execution during boot</span></span><br><span class=\"line\"><span class=\"comment\"># this script will NOT be run after all other services.</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># Please note that you must run 'chmod +x /etc/rc.d/rc.local' to ensure</span></span><br><span class=\"line\"><span class=\"comment\"># that this script will be executed during boot.</span></span><br><span class=\"line\"></span><br><span class=\"line\">touch /var/lock/subsys/<span class=\"built_in\">local</span></span><br><span class=\"line\"></span><br><span class=\"line\">systemctl start yourProjectName.service</span><br></pre></td></tr></table></figure>\n\n<p>如果启动服务遇到</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Warning: nginx.service changed on disk. Run <span class=\"string\">'systemctl daemon-reload'</span> to reload units.</span><br></pre></td></tr></table></figure>\n\n<p>解决方案</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl daemon-reload</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>好了就写这么多,出去玩耍了 :)</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"<p>再好的服务器都有重启的一天。重启后服务的自启动变的非常有必要。centOS的启动都写在<code>/etc/rc.local</code>这个文件里面。这个文件是个软连接，它指向的是<code>/etc/rc.d/rc.local</code>。默认这两个文件没有可执行的权限，这也是为什么很多启动项失败的原因","more":"</p>\n<h1 id=\"第一步-添加可执行权限\"><a href=\"#第一步-添加可执行权限\" class=\"headerlink\" title=\"第一步 添加可执行权限\"></a>第一步 添加可执行权限</h1><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chmod +x /etc/rc.local </span><br><span class=\"line\">chmod +x /etc/rc.d/rc.local</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"第二步-启动服务查看服务状态\"><a href=\"#第二步-启动服务查看服务状态\" class=\"headerlink\" title=\"第二步 启动服务查看服务状态\"></a>第二步 启动服务查看服务状态</h1><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl start rc-local.service </span><br><span class=\"line\">systemctl status rc-local.service</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"第三步-制作一个服务通过systemctl启动\"><a href=\"#第三步-制作一个服务通过systemctl启动\" class=\"headerlink\" title=\"第三步 制作一个服务通过systemctl启动\"></a>第三步 制作一个服务通过systemctl启动</h1><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /etc/systemd/system</span><br><span class=\"line\">vim yourProjectName.service <span class=\"comment\">## 可以把yourProjectName设置为你想起的服务名</span></span><br></pre></td></tr></table></figure>\n\n<p>yourProjectName.service的内容如下</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Unit]  </span><br><span class=\"line\">Description=yourProjectName <span class=\"comment\">#描述  </span></span><br><span class=\"line\">After=syslog.target network.target  <span class=\"comment\">#依赖  </span></span><br><span class=\"line\"> </span><br><span class=\"line\">[Service]  </span><br><span class=\"line\">Type=simple  </span><br><span class=\"line\"> </span><br><span class=\"line\">ExecStart=/usr/bin/java -jar /opt/javaapps/yourProjectName.jar  </span><br><span class=\"line\"><span class=\"comment\">#前面是java命令的绝对路径  后面是jar包的绝对路径  </span></span><br><span class=\"line\">ExecStop=/bin/<span class=\"built_in\">kill</span> -15 <span class=\"variable\">$MAINPID</span>   <span class=\"comment\">## kill -9 与 kill -15 -9 是立即停止 -15 等服务空闲后停止</span></span><br><span class=\"line\"> </span><br><span class=\"line\">User=root  </span><br><span class=\"line\">Group=root   </span><br><span class=\"line\"> </span><br><span class=\"line\">[Install]  </span><br><span class=\"line\">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"第四步-添加你要自启动的服务到文件里面\"><a href=\"#第四步-添加你要自启动的服务到文件里面\" class=\"headerlink\" title=\"第四步 添加你要自启动的服务到文件里面\"></a>第四步 添加你要自启动的服务到文件里面</h1><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"comment\"># THIS FILE IS ADDED FOR COMPATIBILITY PURPOSES</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># It is highly advisable to create own systemd services or udev rules</span></span><br><span class=\"line\"><span class=\"comment\"># to run scripts during boot instead of using this file.</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># In contrast to previous versions due to parallel execution during boot</span></span><br><span class=\"line\"><span class=\"comment\"># this script will NOT be run after all other services.</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># Please note that you must run 'chmod +x /etc/rc.d/rc.local' to ensure</span></span><br><span class=\"line\"><span class=\"comment\"># that this script will be executed during boot.</span></span><br><span class=\"line\"></span><br><span class=\"line\">touch /var/lock/subsys/<span class=\"built_in\">local</span></span><br><span class=\"line\"></span><br><span class=\"line\">systemctl start yourProjectName.service</span><br></pre></td></tr></table></figure>\n\n<p>如果启动服务遇到</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Warning: nginx.service changed on disk. Run <span class=\"string\">'systemctl daemon-reload'</span> to reload units.</span><br></pre></td></tr></table></figure>\n\n<p>解决方案</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl daemon-reload</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>好了就写这么多,出去玩耍了 :)</p>\n</blockquote>"}],"PostAsset":[],"PostCategory":[{"post_id":"cjsgue0e70005gpi631xcsa13","category_id":"cjsgue0e20002gpi6t4cvdqge","_id":"cjsgue0ee000agpi6khjd98o2"},{"post_id":"cjsgue0ds0000gpi66gwzqcas","category_id":"cjsgue0e20002gpi6t4cvdqge","_id":"cjsgue0eh000dgpi6qseykcvg"},{"post_id":"cjsgue0e90006gpi66ijio50o","category_id":"cjsgue0e20002gpi6t4cvdqge","_id":"cjsgue0ej000fgpi6qdgq5hir"},{"post_id":"cjsgue0ed0009gpi602zon8hj","category_id":"cjsgue0e20002gpi6t4cvdqge","_id":"cjsgue0em000igpi6v0cttyxa"},{"post_id":"cjsgue0e50004gpi613qntlxe","category_id":"cjsgue0e20002gpi6t4cvdqge","_id":"cjsgue0eo000kgpi63lh6ff8c"},{"post_id":"cjsgue0ef000bgpi6uwetdawh","category_id":"cjsgue0e20002gpi6t4cvdqge","_id":"cjsgue0ep000mgpi6sbt9wb57"},{"post_id":"cjsgue0ei000egpi611alyy5e","category_id":"cjsgue0e20002gpi6t4cvdqge","_id":"cjsgue0es000qgpi62iti00py"},{"post_id":"cjsgue0ej000ggpi6yv055zvs","category_id":"cjsgue0e20002gpi6t4cvdqge","_id":"cjsgue0et000tgpi6ohy4vrz3"},{"post_id":"cjsgue0em000jgpi6149iogw1","category_id":"cjsgue0e20002gpi6t4cvdqge","_id":"cjsgue0ev000xgpi6h3bj6l7a"},{"post_id":"cjsgue0eo000lgpi6h8agjzqt","category_id":"cjsgue0e20002gpi6t4cvdqge","_id":"cjsgue0ex0010gpi651t68wxh"},{"post_id":"cjsgue0eq000ogpi6p5g0385v","category_id":"cjsgue0e20002gpi6t4cvdqge","_id":"cjsgue0ez0013gpi6pylya0m7"},{"post_id":"cjsgue0es000rgpi6i92g0drq","category_id":"cjsgue0e20002gpi6t4cvdqge","_id":"cjsgue0f00015gpi6fxd40etz"},{"post_id":"cjsgue0eu000ugpi6lc0j481c","category_id":"cjsgue0e20002gpi6t4cvdqge","_id":"cjsgue0f20018gpi63pc7ctoo"},{"post_id":"cjsgue0ew000ygpi6cd4vh61n","category_id":"cjsgue0e20002gpi6t4cvdqge","_id":"cjsgue0f3001agpi666eil5dr"},{"post_id":"cjsgue0ex0011gpi6v9obn9oz","category_id":"cjsgue0e20002gpi6t4cvdqge","_id":"cjsgue0f5001cgpi6bbpqfje0"},{"post_id":"cjsgue0ez0014gpi6i5sjqqly","category_id":"cjsgue0e20002gpi6t4cvdqge","_id":"cjsgue0f7001fgpi6s5kc796c"},{"post_id":"cjsgue0f10016gpi6azcidofk","category_id":"cjsgue0e20002gpi6t4cvdqge","_id":"cjsgue0f8001hgpi6426yysyy"},{"post_id":"cjsgue0f20019gpi61fizu1j8","category_id":"cjsgue0e20002gpi6t4cvdqge","_id":"cjsgue0fa001kgpi67rrd12s5"},{"post_id":"cjsgue0f4001bgpi6ulp0s9a4","category_id":"cjsgue0e20002gpi6t4cvdqge","_id":"cjsgue0fb001ngpi6563ojqlt"},{"post_id":"cjsgue0f5001egpi6vfqogvi0","category_id":"cjsgue0e20002gpi6t4cvdqge","_id":"cjsgue0fe001rgpi6w7zoi7cq"},{"post_id":"cjsgue0f7001ggpi6par81qzf","category_id":"cjsgue0e20002gpi6t4cvdqge","_id":"cjsgue0fe001tgpi6h0iq04rd"},{"post_id":"cjsgue0f8001igpi66jp72ug9","category_id":"cjsgue0e20002gpi6t4cvdqge","_id":"cjsgue0ff001wgpi6r6m8o7p9"},{"post_id":"cjsgue0fa001mgpi6wbrcfeu3","category_id":"cjsgue0e20002gpi6t4cvdqge","_id":"cjsgue0ff001ygpi6doztvlyn"},{"post_id":"cjsgue0fc001pgpi64vu9myzf","category_id":"cjsgue0e20002gpi6t4cvdqge","_id":"cjsgue0fg001zgpi60xj79liw"},{"post_id":"cjsgue0dy0001gpi6pjujt2dy","category_id":"cjsgue0e20002gpi6t4cvdqge","_id":"cjsguiwwr0001mbi6g0om3fk8"},{"post_id":"cjytjg80v0000g6i62u5fqrgo","category_id":"cjsgue0e20002gpi6t4cvdqge","_id":"cjytjg81f0002g6i6lgsaeugw"},{"post_id":"cjytjli950001ghi6f2ddult1","category_id":"cjsgue0e20002gpi6t4cvdqge","_id":"cjytq0t5s000fghi67ttqo9ej"},{"post_id":"ckawkslat00003ti6cp6kdbsf","category_id":"cjsgue0e20002gpi6t4cvdqge","_id":"ckawkslb800023ti6obr61mqm"},{"post_id":"ckbdagv2k0000wxi6c637cwfo","category_id":"cjsgue0e20002gpi6t4cvdqge","_id":"ckbdagv320002wxi6g1og53xe"}],"PostTag":[{"post_id":"cjsgue0ds0000gpi66gwzqcas","tag_id":"cjsgue0e40003gpi6ve3b6zu3","_id":"cjsgue0es000pgpi6m8pt7fkb"},{"post_id":"cjsgue0ds0000gpi66gwzqcas","tag_id":"cjsgue0ea0008gpi6qdzl6enr","_id":"cjsgue0et000sgpi6ifxyjvrj"},{"post_id":"cjsgue0ds0000gpi66gwzqcas","tag_id":"cjsgue0eg000cgpi6fja231tl","_id":"cjsgue0ev000wgpi6kez9m28k"},{"post_id":"cjsgue0ds0000gpi66gwzqcas","tag_id":"cjsgue0em000hgpi6mhv5tyst","_id":"cjsgue0ex000zgpi6ixp3kfex"},{"post_id":"cjsgue0e50004gpi613qntlxe","tag_id":"cjsgue0ep000ngpi6f7gf9hec","_id":"cjsgue0fa001lgpi6laklxeck"},{"post_id":"cjsgue0e50004gpi613qntlxe","tag_id":"cjsgue0ev000vgpi6kj5ts9jf","_id":"cjsgue0fb001ogpi6iry6rxto"},{"post_id":"cjsgue0e50004gpi613qntlxe","tag_id":"cjsgue0ey0012gpi6fqchdft7","_id":"cjsgue0fe001sgpi6hcit6i27"},{"post_id":"cjsgue0e50004gpi613qntlxe","tag_id":"cjsgue0f20017gpi6xvl044sy","_id":"cjsgue0fe001ugpi6z18x65ka"},{"post_id":"cjsgue0e50004gpi613qntlxe","tag_id":"cjsgue0f5001dgpi6ncprflbx","_id":"cjsgue0ff001xgpi653uqx1lk"},{"post_id":"cjsgue0e70005gpi631xcsa13","tag_id":"cjsgue0f9001jgpi65fdm8e35","_id":"cjsgue0fh0022gpi6ibq1xtlo"},{"post_id":"cjsgue0e70005gpi631xcsa13","tag_id":"cjsgue0fd001qgpi6w9m3vu2o","_id":"cjsgue0fh0023gpi6kjv9gegm"},{"post_id":"cjsgue0e70005gpi631xcsa13","tag_id":"cjsgue0ff001vgpi6wm0uupgo","_id":"cjsgue0fh0025gpi6murkdt2q"},{"post_id":"cjsgue0e70005gpi631xcsa13","tag_id":"cjsgue0fg0020gpi682hfptz1","_id":"cjsgue0fi0026gpi6z5u2aobz"},{"post_id":"cjsgue0e90006gpi66ijio50o","tag_id":"cjsgue0ep000ngpi6f7gf9hec","_id":"cjsgue0fk002bgpi6dotaifj2"},{"post_id":"cjsgue0e90006gpi66ijio50o","tag_id":"cjsgue0ev000vgpi6kj5ts9jf","_id":"cjsgue0fk002cgpi62y0s7lnf"},{"post_id":"cjsgue0e90006gpi66ijio50o","tag_id":"cjsgue0ey0012gpi6fqchdft7","_id":"cjsgue0fk002egpi69i1bhyed"},{"post_id":"cjsgue0e90006gpi66ijio50o","tag_id":"cjsgue0f20017gpi6xvl044sy","_id":"cjsgue0fk002fgpi6kasu3r9j"},{"post_id":"cjsgue0e90006gpi66ijio50o","tag_id":"cjsgue0f5001dgpi6ncprflbx","_id":"cjsgue0fl002hgpi6kyw0mgdm"},{"post_id":"cjsgue0ed0009gpi602zon8hj","tag_id":"cjsgue0ff001vgpi6wm0uupgo","_id":"cjsgue0fm002lgpi60hl68kbp"},{"post_id":"cjsgue0ed0009gpi602zon8hj","tag_id":"cjsgue0fk002dgpi6uszzvhqe","_id":"cjsgue0fm002mgpi6kb2q6667"},{"post_id":"cjsgue0ed0009gpi602zon8hj","tag_id":"cjsgue0fl002ggpi6tjuufblv","_id":"cjsgue0fm002ogpi64qvpxrz3"},{"post_id":"cjsgue0ed0009gpi602zon8hj","tag_id":"cjsgue0fl002igpi6vs4hnuie","_id":"cjsgue0fm002pgpi6coauoruj"},{"post_id":"cjsgue0ed0009gpi602zon8hj","tag_id":"cjsgue0fl002jgpi6yhon9ut3","_id":"cjsgue0fn002rgpi6yfcl54jj"},{"post_id":"cjsgue0ef000bgpi6uwetdawh","tag_id":"cjsgue0fl002kgpi6kpq3zzgh","_id":"cjsgue0fp002ygpi6u4cns93e"},{"post_id":"cjsgue0ef000bgpi6uwetdawh","tag_id":"cjsgue0fm002ngpi6bsgejkat","_id":"cjsgue0fp002zgpi6n6oxk9iv"},{"post_id":"cjsgue0ef000bgpi6uwetdawh","tag_id":"cjsgue0fm002qgpi6jbo4hmbi","_id":"cjsgue0fq0031gpi6gaj77qz3"},{"post_id":"cjsgue0ef000bgpi6uwetdawh","tag_id":"cjsgue0fn002sgpi64sezl1ax","_id":"cjsgue0fq0032gpi6i7sdw6m3"},{"post_id":"cjsgue0ef000bgpi6uwetdawh","tag_id":"cjsgue0fn002tgpi66owmcqxc","_id":"cjsgue0fr0034gpi6jzpnmfo3"},{"post_id":"cjsgue0ef000bgpi6uwetdawh","tag_id":"cjsgue0fn002ugpi66gkumtny","_id":"cjsgue0fr0035gpi6h6sp7xvs"},{"post_id":"cjsgue0ef000bgpi6uwetdawh","tag_id":"cjsgue0fo002vgpi6if35ftzd","_id":"cjsgue0fr0037gpi6oxvr4pql"},{"post_id":"cjsgue0ef000bgpi6uwetdawh","tag_id":"cjsgue0fo002wgpi67rlj2hxb","_id":"cjsgue0fr0038gpi6xqj3jq4o"},{"post_id":"cjsgue0ei000egpi611alyy5e","tag_id":"cjsgue0fo002xgpi6ih32p7xh","_id":"cjsgue0fs003bgpi6wvre2zl3"},{"post_id":"cjsgue0ei000egpi611alyy5e","tag_id":"cjsgue0fp0030gpi6ckf993x0","_id":"cjsgue0fs003cgpi6llnj1tux"},{"post_id":"cjsgue0ei000egpi611alyy5e","tag_id":"cjsgue0fr0033gpi6nwl51m7s","_id":"cjsgue0ft003egpi68myerciy"},{"post_id":"cjsgue0ei000egpi611alyy5e","tag_id":"cjsgue0fr0036gpi6tzklf3el","_id":"cjsgue0ft003fgpi6v9y89k25"},{"post_id":"cjsgue0ei000egpi611alyy5e","tag_id":"cjsgue0fs0039gpi64npbccjq","_id":"cjsgue0ft003hgpi6yc1u8rlw"},{"post_id":"cjsgue0ej000ggpi6yv055zvs","tag_id":"cjsgue0fs003agpi63038y24z","_id":"cjsgue0fw003kgpi6cr3zm7iq"},{"post_id":"cjsgue0ej000ggpi6yv055zvs","tag_id":"cjsgue0ft003dgpi64b3w43kn","_id":"cjsgue0fw003lgpi6e4ow721k"},{"post_id":"cjsgue0ej000ggpi6yv055zvs","tag_id":"cjsgue0ft003ggpi6o92f388f","_id":"cjsgue0fx003ngpi6rkw6csm2"},{"post_id":"cjsgue0ej000ggpi6yv055zvs","tag_id":"cjsgue0fu003igpi6stgaq03d","_id":"cjsgue0fx003ogpi6c3ya8jin"},{"post_id":"cjsgue0em000jgpi6149iogw1","tag_id":"cjsgue0f9001jgpi65fdm8e35","_id":"cjsgue0fz003sgpi6iyjn82lm"},{"post_id":"cjsgue0em000jgpi6149iogw1","tag_id":"cjsgue0fd001qgpi6w9m3vu2o","_id":"cjsgue0fz003tgpi6xab9nwme"},{"post_id":"cjsgue0em000jgpi6149iogw1","tag_id":"cjsgue0ff001vgpi6wm0uupgo","_id":"cjsgue0g0003vgpi650y1ledk"},{"post_id":"cjsgue0em000jgpi6149iogw1","tag_id":"cjsgue0fs0039gpi64npbccjq","_id":"cjsgue0g0003wgpi6670vvtg8"},{"post_id":"cjsgue0eo000lgpi6h8agjzqt","tag_id":"cjsgue0ep000ngpi6f7gf9hec","_id":"cjsgue0g30041gpi6eudo4x1k"},{"post_id":"cjsgue0eo000lgpi6h8agjzqt","tag_id":"cjsgue0ev000vgpi6kj5ts9jf","_id":"cjsgue0g30042gpi6veq75g3c"},{"post_id":"cjsgue0eo000lgpi6h8agjzqt","tag_id":"cjsgue0ey0012gpi6fqchdft7","_id":"cjsgue0g30044gpi6df9k3wav"},{"post_id":"cjsgue0eo000lgpi6h8agjzqt","tag_id":"cjsgue0f20017gpi6xvl044sy","_id":"cjsgue0g30045gpi6oiel3wmp"},{"post_id":"cjsgue0eo000lgpi6h8agjzqt","tag_id":"cjsgue0f5001dgpi6ncprflbx","_id":"cjsgue0g40047gpi6b8uduevb"},{"post_id":"cjsgue0eq000ogpi6p5g0385v","tag_id":"cjsgue0ep000ngpi6f7gf9hec","_id":"cjsgue0g6004bgpi6im5msvht"},{"post_id":"cjsgue0eq000ogpi6p5g0385v","tag_id":"cjsgue0ev000vgpi6kj5ts9jf","_id":"cjsgue0g6004cgpi6ntkqrmgn"},{"post_id":"cjsgue0eq000ogpi6p5g0385v","tag_id":"cjsgue0ey0012gpi6fqchdft7","_id":"cjsgue0g6004egpi6al8qq85d"},{"post_id":"cjsgue0eq000ogpi6p5g0385v","tag_id":"cjsgue0f20017gpi6xvl044sy","_id":"cjsgue0g6004fgpi60fodwx9y"},{"post_id":"cjsgue0eq000ogpi6p5g0385v","tag_id":"cjsgue0f5001dgpi6ncprflbx","_id":"cjsgue0g6004hgpi6vuwd0vjd"},{"post_id":"cjsgue0es000rgpi6i92g0drq","tag_id":"cjsgue0g5004agpi66kpg7eev","_id":"cjsgue0g8004lgpi679jxh0tv"},{"post_id":"cjsgue0es000rgpi6i92g0drq","tag_id":"cjsgue0g6004dgpi6r585f1xk","_id":"cjsgue0g8004mgpi64vbwk1pz"},{"post_id":"cjsgue0es000rgpi6i92g0drq","tag_id":"cjsgue0g6004ggpi64ukm88fx","_id":"cjsgue0g8004ogpi6bwe3geoz"},{"post_id":"cjsgue0es000rgpi6i92g0drq","tag_id":"cjsgue0g7004igpi6s5ik848a","_id":"cjsgue0g8004pgpi6ghdcyyj2"},{"post_id":"cjsgue0es000rgpi6i92g0drq","tag_id":"cjsgue0g7004jgpi6dmywappb","_id":"cjsgue0g9004rgpi6rgp5fmtr"},{"post_id":"cjsgue0eu000ugpi6lc0j481c","tag_id":"cjsgue0fo002xgpi6ih32p7xh","_id":"cjsgue0gb004vgpi6gsu3v3gb"},{"post_id":"cjsgue0eu000ugpi6lc0j481c","tag_id":"cjsgue0fp0030gpi6ckf993x0","_id":"cjsgue0gb004wgpi6pqq14nqx"},{"post_id":"cjsgue0eu000ugpi6lc0j481c","tag_id":"cjsgue0fr0033gpi6nwl51m7s","_id":"cjsgue0gb004ygpi6hgsbq2e1"},{"post_id":"cjsgue0eu000ugpi6lc0j481c","tag_id":"cjsgue0fr0036gpi6tzklf3el","_id":"cjsgue0gc004zgpi6g35urjgr"},{"post_id":"cjsgue0eu000ugpi6lc0j481c","tag_id":"cjsgue0fs0039gpi64npbccjq","_id":"cjsgue0gc0051gpi6xe7l0pyg"},{"post_id":"cjsgue0ew000ygpi6cd4vh61n","tag_id":"cjsgue0g5004agpi66kpg7eev","_id":"cjsgue0ge0055gpi6zdtq6btd"},{"post_id":"cjsgue0ew000ygpi6cd4vh61n","tag_id":"cjsgue0g6004dgpi6r585f1xk","_id":"cjsgue0ge0056gpi64khhv5ci"},{"post_id":"cjsgue0ew000ygpi6cd4vh61n","tag_id":"cjsgue0g6004ggpi64ukm88fx","_id":"cjsgue0ge0058gpi6kqcmog3k"},{"post_id":"cjsgue0ew000ygpi6cd4vh61n","tag_id":"cjsgue0g7004igpi6s5ik848a","_id":"cjsgue0ge0059gpi6vw0b59eq"},{"post_id":"cjsgue0ew000ygpi6cd4vh61n","tag_id":"cjsgue0gd0053gpi61uz1d1dn","_id":"cjsgue0gf005bgpi6g7fjp8yv"},{"post_id":"cjsgue0ex0011gpi6v9obn9oz","tag_id":"cjsgue0ff001vgpi6wm0uupgo","_id":"cjsgue0gg005ggpi6uy3xd6em"},{"post_id":"cjsgue0ex0011gpi6v9obn9oz","tag_id":"cjsgue0ge0057gpi6w8qp21ir","_id":"cjsgue0gg005hgpi61dtbefc3"},{"post_id":"cjsgue0ex0011gpi6v9obn9oz","tag_id":"cjsgue0ge005agpi6919vyk2g","_id":"cjsgue0gg005jgpi6a0n7esou"},{"post_id":"cjsgue0ex0011gpi6v9obn9oz","tag_id":"cjsgue0gf005cgpi6mbcnrccy","_id":"cjsgue0gh005kgpi692bgzts4"},{"post_id":"cjsgue0ex0011gpi6v9obn9oz","tag_id":"cjsgue0gf005dgpi6ponpdcaq","_id":"cjsgue0gh005mgpi6hbtdbtp1"},{"post_id":"cjsgue0ex0011gpi6v9obn9oz","tag_id":"cjsgue0gf005egpi6bu8t5pxc","_id":"cjsgue0gh005ngpi67ilhkiel"},{"post_id":"cjsgue0ez0014gpi6i5sjqqly","tag_id":"cjsgue0gg005fgpi6umd45kod","_id":"cjsgue0gi005rgpi6ta41g7b8"},{"post_id":"cjsgue0ez0014gpi6i5sjqqly","tag_id":"cjsgue0gg005igpi6hmg605ex","_id":"cjsgue0gi005sgpi6xwyt4f2o"},{"post_id":"cjsgue0ez0014gpi6i5sjqqly","tag_id":"cjsgue0gh005lgpi6h1hlaas5","_id":"cjsgue0gi005ugpi6wmews4ew"},{"post_id":"cjsgue0ez0014gpi6i5sjqqly","tag_id":"cjsgue0gh005ogpi6exdfxzx1","_id":"cjsgue0gj005vgpi6jlu77c9d"},{"post_id":"cjsgue0ez0014gpi6i5sjqqly","tag_id":"cjsgue0gh005pgpi690907rtt","_id":"cjsgue0gj005xgpi6gcilych0"},{"post_id":"cjsgue0f10016gpi6azcidofk","tag_id":"cjsgue0gi005qgpi6h6fedgqp","_id":"cjsgue0gk0060gpi65nr6kvm5"},{"post_id":"cjsgue0f10016gpi6azcidofk","tag_id":"cjsgue0gi005tgpi6ps05dt7a","_id":"cjsgue0gk0061gpi6twdb2eru"},{"post_id":"cjsgue0f10016gpi6azcidofk","tag_id":"cjsgue0gj005wgpi65yzojymd","_id":"cjsgue0gl0063gpi6444e1dyf"},{"post_id":"cjsgue0f10016gpi6azcidofk","tag_id":"cjsgue0gj005ygpi67j4ylgdu","_id":"cjsgue0gl0064gpi6gy6wxi7s"},{"post_id":"cjsgue0f20019gpi61fizu1j8","tag_id":"cjsgue0g5004agpi66kpg7eev","_id":"cjsgue0gn0068gpi6gk53f7i6"},{"post_id":"cjsgue0f20019gpi61fizu1j8","tag_id":"cjsgue0g6004dgpi6r585f1xk","_id":"cjsgue0gn0069gpi6e1oxwkir"},{"post_id":"cjsgue0f20019gpi61fizu1j8","tag_id":"cjsgue0g6004ggpi64ukm88fx","_id":"cjsgue0go006bgpi6pjkoir5x"},{"post_id":"cjsgue0f20019gpi61fizu1j8","tag_id":"cjsgue0g7004igpi6s5ik848a","_id":"cjsgue0go006cgpi6y6h4rswk"},{"post_id":"cjsgue0f4001bgpi6ulp0s9a4","tag_id":"cjsgue0gh005pgpi690907rtt","_id":"cjsgue0gq006hgpi6k9bvd2oo"},{"post_id":"cjsgue0f4001bgpi6ulp0s9a4","tag_id":"cjsgue0gn006agpi6bpscdkuq","_id":"cjsgue0gq006igpi64lxea2ax"},{"post_id":"cjsgue0f4001bgpi6ulp0s9a4","tag_id":"cjsgue0go006dgpi6k4ra29h9","_id":"cjsgue0gq006kgpi6g0yow87m"},{"post_id":"cjsgue0f4001bgpi6ulp0s9a4","tag_id":"cjsgue0go006egpi6mdzg0uoa","_id":"cjsgue0gq006lgpi6j2d9dph1"},{"post_id":"cjsgue0f4001bgpi6ulp0s9a4","tag_id":"cjsgue0gp006fgpi650g1ca0s","_id":"cjsgue0gr006ngpi6oxl7jqla"},{"post_id":"cjsgue0f5001egpi6vfqogvi0","tag_id":"cjsgue0gp006ggpi67xqsel8q","_id":"cjsgue0gu006tgpi6s108ibm8"},{"post_id":"cjsgue0f5001egpi6vfqogvi0","tag_id":"cjsgue0gq006jgpi6bm4h014e","_id":"cjsgue0gv006ugpi65m6hpn42"},{"post_id":"cjsgue0f5001egpi6vfqogvi0","tag_id":"cjsgue0g6004dgpi6r585f1xk","_id":"cjsgue0gv006wgpi6i136i1ai"},{"post_id":"cjsgue0f5001egpi6vfqogvi0","tag_id":"cjsgue0g6004ggpi64ukm88fx","_id":"cjsgue0gv006xgpi6ilgue65r"},{"post_id":"cjsgue0f5001egpi6vfqogvi0","tag_id":"cjsgue0g7004igpi6s5ik848a","_id":"cjsgue0gw006zgpi64y14g1tr"},{"post_id":"cjsgue0f5001egpi6vfqogvi0","tag_id":"cjsgue0gt006qgpi6dzf0dnkv","_id":"cjsgue0gw0070gpi6lh8zs5d5"},{"post_id":"cjsgue0f5001egpi6vfqogvi0","tag_id":"cjsgue0gt006rgpi61q1qajeo","_id":"cjsgue0gw0072gpi6z4guha2w"},{"post_id":"cjsgue0f7001ggpi6par81qzf","tag_id":"cjsgue0gu006sgpi6g4rc8u6a","_id":"cjsgue0gy0075gpi6l3wfb7hb"},{"post_id":"cjsgue0f7001ggpi6par81qzf","tag_id":"cjsgue0gv006vgpi61330ux9u","_id":"cjsgue0gy0076gpi6o2hnjvua"},{"post_id":"cjsgue0f7001ggpi6par81qzf","tag_id":"cjsgue0gv006ygpi6lrgh438e","_id":"cjsgue0gz0078gpi65yly5r8c"},{"post_id":"cjsgue0f7001ggpi6par81qzf","tag_id":"cjsgue0gw0071gpi6mozrcw4y","_id":"cjsgue0gz0079gpi6lsk6218e"},{"post_id":"cjsgue0f7001ggpi6par81qzf","tag_id":"cjsgue0gw0073gpi6owyzchgo","_id":"cjsgue0h0007bgpi6wwi8p26c"},{"post_id":"cjsgue0f8001igpi66jp72ug9","tag_id":"cjsgue0gp006ggpi67xqsel8q","_id":"cjsgue0h6007lgpi62kqvx79w"},{"post_id":"cjsgue0f8001igpi66jp72ug9","tag_id":"cjsgue0gq006jgpi6bm4h014e","_id":"cjsgue0h7007mgpi6gaq6i4xw"},{"post_id":"cjsgue0f8001igpi66jp72ug9","tag_id":"cjsgue0g6004dgpi6r585f1xk","_id":"cjsgue0h7007ogpi6ba5fjm6q"},{"post_id":"cjsgue0f8001igpi66jp72ug9","tag_id":"cjsgue0g6004ggpi64ukm88fx","_id":"cjsgue0h7007pgpi6mvrszm99"},{"post_id":"cjsgue0f8001igpi66jp72ug9","tag_id":"cjsgue0g7004igpi6s5ik848a","_id":"cjsgue0h8007rgpi6l93a5rrb"},{"post_id":"cjsgue0f8001igpi66jp72ug9","tag_id":"cjsgue0gt006qgpi6dzf0dnkv","_id":"cjsgue0h8007sgpi6gt1uaojn"},{"post_id":"cjsgue0f8001igpi66jp72ug9","tag_id":"cjsgue0gt006rgpi61q1qajeo","_id":"cjsgue0h9007ugpi6otfvhjso"},{"post_id":"cjsgue0f8001igpi66jp72ug9","tag_id":"cjsgue0ff001vgpi6wm0uupgo","_id":"cjsgue0h9007vgpi6o36y823v"},{"post_id":"cjsgue0f8001igpi66jp72ug9","tag_id":"cjsgue0h4007hgpi6ub5cz27a","_id":"cjsgue0ha007xgpi6xxoxgfi4"},{"post_id":"cjsgue0f8001igpi66jp72ug9","tag_id":"cjsgue0h4007igpi6l5s37a0y","_id":"cjsgue0ha007ygpi6z2c67xsw"},{"post_id":"cjsgue0f8001igpi66jp72ug9","tag_id":"cjsgue0h4007jgpi6ew962xn2","_id":"cjsgue0hb0080gpi6bdw7bh7t"},{"post_id":"cjsgue0fa001mgpi6wbrcfeu3","tag_id":"cjsgue0g6004dgpi6r585f1xk","_id":"cjsgue0hd0083gpi6jmyyr1x1"},{"post_id":"cjsgue0fa001mgpi6wbrcfeu3","tag_id":"cjsgue0g6004ggpi64ukm88fx","_id":"cjsgue0hd0084gpi6vzhusdzn"},{"post_id":"cjsgue0fa001mgpi6wbrcfeu3","tag_id":"cjsgue0g7004igpi6s5ik848a","_id":"cjsgue0he0086gpi6f28b0gde"},{"post_id":"cjsgue0fa001mgpi6wbrcfeu3","tag_id":"cjsgue0ff001vgpi6wm0uupgo","_id":"cjsgue0he0087gpi63pzusqrd"},{"post_id":"cjsgue0fa001mgpi6wbrcfeu3","tag_id":"cjsgue0h9007wgpi6oahdkwol","_id":"cjsgue0hf0089gpi6989i9j5a"},{"post_id":"cjsgue0fa001mgpi6wbrcfeu3","tag_id":"cjsgue0gq006jgpi6bm4h014e","_id":"cjsgue0hf008agpi6szwfzvas"},{"post_id":"cjsgue0fa001mgpi6wbrcfeu3","tag_id":"cjsgue0h4007igpi6l5s37a0y","_id":"cjsgue0hf008bgpi6f0wk4d7y"},{"post_id":"cjsgue0fc001pgpi64vu9myzf","tag_id":"cjsgue0f9001jgpi65fdm8e35","_id":"cjsgue0hg008cgpi6aczfmm2l"},{"post_id":"cjsgue0fc001pgpi64vu9myzf","tag_id":"cjsgue0fd001qgpi6w9m3vu2o","_id":"cjsgue0hg008dgpi6u8avggqi"},{"post_id":"cjsgue0fc001pgpi64vu9myzf","tag_id":"cjsgue0ff001vgpi6wm0uupgo","_id":"cjsgue0hg008egpi69pu0gtms"},{"post_id":"cjsgue0fc001pgpi64vu9myzf","tag_id":"cjsgue0he0088gpi62b3fcyu2","_id":"cjsgue0hg008fgpi6u0xug8pm"},{"post_id":"cjsgue0dy0001gpi6pjujt2dy","tag_id":"cjsgue0ff001vgpi6wm0uupgo","_id":"cjsguiwwu0005mbi60udzbagh"},{"post_id":"cjsgue0dy0001gpi6pjujt2dy","tag_id":"cjsguiwwf0000mbi631it0knu","_id":"cjsguiwwv0006mbi6ec7ssoyy"},{"post_id":"cjsgue0dy0001gpi6pjujt2dy","tag_id":"cjsguiwws0002mbi6ddme1cgs","_id":"cjsguiwwv0007mbi6ub1k62qm"},{"post_id":"cjsgue0dy0001gpi6pjujt2dy","tag_id":"cjsguiwwt0003mbi6nin2kojw","_id":"cjsguiwwv0008mbi6vc6gysk7"},{"post_id":"cjsgue0dy0001gpi6pjujt2dy","tag_id":"cjsguiwwt0004mbi62qy8wkk4","_id":"cjsguiwwv0009mbi6e0e4y74s"},{"post_id":"cjytjg80v0000g6i62u5fqrgo","tag_id":"cjytjg8180001g6i6mo2ixqzl","_id":"cjytjg81h0005g6i6ruml72sv"},{"post_id":"cjytjg80v0000g6i62u5fqrgo","tag_id":"cjytjg81f0003g6i6gzegnb5j","_id":"cjytjg81h0006g6i6l4j2bmqb"},{"post_id":"cjytjg80v0000g6i62u5fqrgo","tag_id":"cjytjg81g0004g6i69lg7lw9y","_id":"cjytjg81h0007g6i6tu0br2pl"},{"post_id":"cjsgue0dy0001gpi6pjujt2dy","tag_id":"cjytjg81t0008g6i6ozvl3a1c","_id":"cjytjg81w0009g6i63bzsuzpb"},{"post_id":"cjytjli950001ghi6f2ddult1","tag_id":"cjytjn5170002ghi6zycu3obo","_id":"cjytq0t5s000dghi6tt2f4k3z"},{"post_id":"cjytjli950001ghi6f2ddult1","tag_id":"cjsgue0g6004ggpi64ukm88fx","_id":"cjytq0t5s000eghi6yu0nlvzw"},{"post_id":"cjytjli950001ghi6f2ddult1","tag_id":"cjsgue0g7004igpi6s5ik848a","_id":"cjytq0t5t000gghi6nrtof27a"},{"post_id":"cjytjli950001ghi6f2ddult1","tag_id":"cjsgue0ff001vgpi6wm0uupgo","_id":"cjytq0t5t000hghi68p3jxpg3"},{"post_id":"cjytjli950001ghi6f2ddult1","tag_id":"cjytjn5190004ghi6tgsxs4mc","_id":"cjytq0t5t000ighi6mbzxjc3k"},{"post_id":"cjytjli950001ghi6f2ddult1","tag_id":"cjytjn51a0005ghi6ohlc5ioz","_id":"cjytq0t5t000jghi6b4ughr54"},{"post_id":"cjytjli950001ghi6f2ddult1","tag_id":"cjsgue0gf005egpi6bu8t5pxc","_id":"cjytq0t5t000kghi65e6jlj89"},{"post_id":"ckawkslat00003ti6cp6kdbsf","tag_id":"ckawkslb100013ti6c6qi68fy","_id":"ckawkslba00053ti6syto4v3n"},{"post_id":"ckawkslat00003ti6cp6kdbsf","tag_id":"ckawkslb900033ti6b317vfg4","_id":"ckawkslba00063ti6rl8jzhwo"},{"post_id":"ckawkslat00003ti6cp6kdbsf","tag_id":"ckawkslb900043ti6hcjnze7u","_id":"ckawkslba00073ti6bh6necvx"},{"post_id":"ckbdagv2k0000wxi6c637cwfo","tag_id":"ckbdagv2u0001wxi6eforblot","_id":"ckbdagv3b0009wxi6hnog2sc3"},{"post_id":"ckbdagv2k0000wxi6c637cwfo","tag_id":"ckbdagv330003wxi64oj00axb","_id":"ckbdagv3e000awxi645odd7q7"},{"post_id":"ckbdagv2k0000wxi6c637cwfo","tag_id":"ckbdagv340004wxi68cnvg0t1","_id":"ckbdagv3e000bwxi6ajujf2ft"},{"post_id":"ckbdagv2k0000wxi6c637cwfo","tag_id":"ckbdagv350005wxi66iy686sh","_id":"ckbdagv3f000cwxi636i47ep1"},{"post_id":"ckbdagv2k0000wxi6c637cwfo","tag_id":"ckbdagv350006wxi6dgvf2d3o","_id":"ckbdagv3f000dwxi6ftpu4o4s"},{"post_id":"ckbdagv2k0000wxi6c637cwfo","tag_id":"ckbdagv360007wxi6axwwes01","_id":"ckbdagv3f000ewxi69qx95e7n"},{"post_id":"ckbdagv2k0000wxi6c637cwfo","tag_id":"ckbdagv370008wxi668egfx4n","_id":"ckbdagv3f000fwxi6462r6p64"}],"Tag":[{"name":"WDS","_id":"cjsgue0e40003gpi6ve3b6zu3"},{"name":"eslint","_id":"cjsgue0ea0008gpi6qdzl6enr"},{"name":"HMR","_id":"cjsgue0eg000cgpi6fja231tl"},{"name":"webpack-dev-server","_id":"cjsgue0em000hgpi6mhv5tyst"},{"name":"shell","_id":"cjsgue0ep000ngpi6f7gf9hec"},{"name":"bash","_id":"cjsgue0ev000vgpi6kj5ts9jf"},{"name":"脚本","_id":"cjsgue0ey0012gpi6fqchdft7"},{"name":"终端","_id":"cjsgue0f20017gpi6xvl044sy"},{"name":"命令行","_id":"cjsgue0f5001dgpi6ncprflbx"},{"name":"单元测试","_id":"cjsgue0f9001jgpi65fdm8e35"},{"name":"unit test","_id":"cjsgue0fd001qgpi6w9m3vu2o"},{"name":"react","_id":"cjsgue0ff001vgpi6wm0uupgo"},{"name":"effects","_id":"cjsgue0fg0020gpi682hfptz1"},{"name":"state","_id":"cjsgue0fk002dgpi6uszzvhqe"},{"name":"props","_id":"cjsgue0fl002ggpi6tjuufblv"},{"name":"组件沟通","_id":"cjsgue0fl002igpi6vs4hnuie"},{"name":"信息传递","_id":"cjsgue0fl002jgpi6yhon9ut3"},{"name":"css布局","_id":"cjsgue0fl002kgpi6kpq3zzgh"},{"name":"css","_id":"cjsgue0fm002ngpi6bsgejkat"},{"name":"两栏","_id":"cjsgue0fm002qgpi6jbo4hmbi"},{"name":"三栏","_id":"cjsgue0fn002sgpi64sezl1ax"},{"name":"圣杯","_id":"cjsgue0fn002tgpi66owmcqxc"},{"name":"双飞翼","_id":"cjsgue0fn002ugpi66gkumtny"},{"name":"bfc","_id":"cjsgue0fo002vgpi6if35ftzd"},{"name":"块格式化上下文","_id":"cjsgue0fo002wgpi67rlj2hxb"},{"name":"reduxe","_id":"cjsgue0fo002xgpi6ih32p7xh"},{"name":"redux-saga","_id":"cjsgue0fp0030gpi6ckf993x0"},{"name":"effect","_id":"cjsgue0fr0033gpi6nwl51m7s"},{"name":"dispatch","_id":"cjsgue0fr0036gpi6tzklf3el"},{"name":"reducer","_id":"cjsgue0fs0039gpi64npbccjq"},{"name":"npm","_id":"cjsgue0fs003agpi63038y24z"},{"name":"semver","_id":"cjsgue0ft003dgpi64b3w43kn"},{"name":"package","_id":"cjsgue0ft003ggpi6o92f388f"},{"name":"包版本管理","_id":"cjsgue0fu003igpi6stgaq03d"},{"name":"webpack","_id":"cjsgue0g5004agpi66kpg7eev"},{"name":"前端","_id":"cjsgue0g6004dgpi6r585f1xk"},{"name":"js","_id":"cjsgue0g6004ggpi64ukm88fx"},{"name":"javascript","_id":"cjsgue0g7004igpi6s5ik848a"},{"name":"integrations","_id":"cjsgue0g7004jgpi6dmywappb"},{"name":"shimming","_id":"cjsgue0gd0053gpi61uz1d1dn"},{"name":"生命周期","_id":"cjsgue0ge0057gpi6w8qp21ir"},{"name":"Fiber","_id":"cjsgue0ge005agpi6919vyk2g"},{"name":"getSnapshotBeforeUpdate","_id":"cjsgue0gf005cgpi6mbcnrccy"},{"name":"getDerivedStateFromProps","_id":"cjsgue0gf005dgpi6ponpdcaq"},{"name":"最佳实践","_id":"cjsgue0gf005egpi6bu8t5pxc"},{"name":"CI","_id":"cjsgue0gg005fgpi6umd45kod"},{"name":"持续集成","_id":"cjsgue0gg005igpi6hmg605ex"},{"name":"jenkins","_id":"cjsgue0gh005lgpi6h1hlaas5"},{"name":"continuous integration","_id":"cjsgue0gh005ogpi6exdfxzx1"},{"name":"ubuntu","_id":"cjsgue0gh005pgpi690907rtt"},{"name":"nodejs","_id":"cjsgue0gi005qgpi6h6fedgqp"},{"name":"RESTful","_id":"cjsgue0gi005tgpi6ps05dt7a"},{"name":"http","_id":"cjsgue0gj005wgpi65yzojymd"},{"name":"cURL","_id":"cjsgue0gj005ygpi67j4ylgdu"},{"name":"python","_id":"cjsgue0gn006agpi6bpscdkuq"},{"name":"版本","_id":"cjsgue0go006dgpi6k4ra29h9"},{"name":"版本管理","_id":"cjsgue0go006egpi6mdzg0uoa"},{"name":"切换","_id":"cjsgue0gp006fgpi650g1ca0s"},{"name":"pure funtion","_id":"cjsgue0gp006ggpi67xqsel8q"},{"name":"纯函数","_id":"cjsgue0gq006jgpi6bm4h014e"},{"name":"side effects","_id":"cjsgue0gt006qgpi6dzf0dnkv"},{"name":"副作用","_id":"cjsgue0gt006rgpi61q1qajeo"},{"name":"vue","_id":"cjsgue0gu006sgpi6g4rc8u6a"},{"name":"apicloud","_id":"cjsgue0gv006vgpi61330ux9u"},{"name":"hybrid app","_id":"cjsgue0gv006ygpi6lrgh438e"},{"name":"tools","_id":"cjsgue0gw0071gpi6mozrcw4y"},{"name":"cli","_id":"cjsgue0gw0073gpi6owyzchgo"},{"name":"组件","_id":"cjsgue0h4007hgpi6ub5cz27a"},{"name":"高阶组件","_id":"cjsgue0h4007igpi6l5s37a0y"},{"name":"Higher Order Components","_id":"cjsgue0h4007jgpi6ew962xn2"},{"name":"高阶函数","_id":"cjsgue0h9007wgpi6oahdkwol"},{"name":"model","_id":"cjsgue0he0088gpi62b3fcyu2"},{"name":"hooks","_id":"cjsguiwwf0000mbi631it0knu"},{"name":"useState","_id":"cjsguiwws0002mbi6ddme1cgs"},{"name":"useEffect","_id":"cjsguiwwt0003mbi6nin2kojw"},{"name":"自定义钩子","_id":"cjsguiwwt0004mbi62qy8wkk4"},{"name":"函数式编程","_id":"cjytjg8180001g6i6mo2ixqzl"},{"name":"Functional programming","_id":"cjytjg81f0003g6i6gzegnb5j"},{"name":"优化代码","_id":"cjytjg81g0004g6i69lg7lw9y"},{"name":"钩子","_id":"cjytjg81t0008g6i6ozvl3a1c"},{"name":"taro.js","_id":"cjytjn5170002ghi6zycu3obo"},{"name":"小程序","_id":"cjytjn5190004ghi6tgsxs4mc"},{"name":"dvajs","_id":"cjytjn51a0005ghi6ohlc5ioz"},{"name":"nginx","_id":"ckawkslb100013ti6c6qi68fy"},{"name":"pfx","_id":"ckawkslb900033ti6b317vfg4"},{"name":"https","_id":"ckawkslb900043ti6hcjnze7u"},{"name":"centOS","_id":"ckbdagv2u0001wxi6eforblot"},{"name":"service","_id":"ckbdagv330003wxi64oj00axb"},{"name":"启动项","_id":"ckbdagv340004wxi68cnvg0t1"},{"name":"rc.local","_id":"ckbdagv350005wxi66iy686sh"},{"name":"daemon","_id":"ckbdagv350006wxi6dgvf2d3o"},{"name":"reload","_id":"ckbdagv360007wxi6axwwes01"},{"name":"systemctl","_id":"ckbdagv370008wxi668egfx4n"}]}}